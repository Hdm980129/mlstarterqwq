"use strict";var THREE=THREE||{REVISION:"49"};self.Int32Array||(self.Int32Array=Array,self.Float32Array=Array);(function(){for(var e=0,t=["ms","moz","webkit","o"],i=0;i<t.length&&!window.requestAnimationFrame;++i){window.requestAnimationFrame=window[t[i]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[t[i]+"CancelAnimationFrame"]||window[t[i]+"CancelRequestAnimationFrame"]}if(!window.requestAnimationFrame)window.requestAnimationFrame=function(t){var i=Date.now(),r=Math.max(0,16-(i-e)),o=window.setTimeout(function(){t(i+r)},r);e=i+r;return o};if(!window.cancelAnimationFrame)window.cancelAnimationFrame=function(e){clearTimeout(e)}})();THREE.Clock=function(e){this.autoStart=e!==void 0?e:true;this.elapsedTime=this.oldTime=this.startTime=0;this.running=false};THREE.Clock.prototype.start=function(){this.oldTime=this.startTime=Date.now();this.running=true};THREE.Clock.prototype.stop=function(){this.getElapsedTime();this.running=false};THREE.Clock.prototype.getElapsedTime=function(){return this.elapsedTime=this.elapsedTime+this.getDelta()};THREE.Clock.prototype.getDelta=function(){var e=0;this.autoStart&&!this.running&&this.start();if(this.running){var t=Date.now(),e=.001*(t-this.oldTime);this.oldTime=t;this.elapsedTime=this.elapsedTime+e}return e};THREE.Color=function(e){e!==void 0&&this.setHex(e);return this};THREE.Color.prototype={constructor:THREE.Color,r:1,g:1,b:1,copy:function(e){this.r=e.r;this.g=e.g;this.b=e.b;return this},copyGammaToLinear:function(e){this.r=e.r*e.r;this.g=e.g*e.g;this.b=e.b*e.b;return this},copyLinearToGamma:function(e){this.r=Math.sqrt(e.r);this.g=Math.sqrt(e.g);this.b=Math.sqrt(e.b);return this},convertGammaToLinear:function(){var e=this.r,t=this.g,i=this.b;this.r=e*e;this.g=t*t;this.b=i*i;return this},convertLinearToGamma:function(){this.r=Math.sqrt(this.r);this.g=Math.sqrt(this.g);this.b=Math.sqrt(this.b);return this},setRGB:function(e,t,i){this.r=e;this.g=t;this.b=i;return this},setHSV:function(e,t,i){var r,o,n;if(i===0)this.r=this.g=this.b=0;else{r=Math.floor(e*6);o=e*6-r;e=i*(1-t);n=i*(1-t*o);t=i*(1-t*(1-o));switch(r){case 1:this.r=n;this.g=i;this.b=e;break;case 2:this.r=e;this.g=i;this.b=t;break;case 3:this.r=e;this.g=n;this.b=i;break;case 4:this.r=t;this.g=e;this.b=i;break;case 5:this.r=i;this.g=e;this.b=n;break;case 6:case 0:this.r=i;this.g=t;this.b=e}}return this},setHex:function(e){e=Math.floor(e);this.r=(e>>16&255)/255;this.g=(e>>8&255)/255;this.b=(e&255)/255;return this},lerpSelf:function(e,t){this.r=this.r+(e.r-this.r)*t;this.g=this.g+(e.g-this.g)*t;this.b=this.b+(e.b-this.b)*t;return this},getHex:function(){return Math.floor(this.r*255)<<16^Math.floor(this.g*255)<<8^Math.floor(this.b*255)},getContextStyle:function(){return"rgb("+Math.floor(this.r*255)+","+Math.floor(this.g*255)+","+Math.floor(this.b*255)+")"},clone:function(){return(new THREE.Color).setRGB(this.r,this.g,this.b)}};THREE.Vector2=function(e,t){this.x=e||0;this.y=t||0};THREE.Vector2.prototype={constructor:THREE.Vector2,set:function(e,t){this.x=e;this.y=t;return this},copy:function(e){this.x=e.x;this.y=e.y;return this},add:function(e,t){this.x=e.x+t.x;this.y=e.y+t.y;return this},addSelf:function(e){this.x=this.x+e.x;this.y=this.y+e.y;return this},sub:function(e,t){this.x=e.x-t.x;this.y=e.y-t.y;return this},subSelf:function(e){this.x=this.x-e.x;this.y=this.y-e.y;return this},multiplyScalar:function(e){this.x=this.x*e;this.y=this.y*e;return this},divideScalar:function(e){if(e){this.x=this.x/e;this.y=this.y/e}else this.set(0,0);return this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.lengthSq())},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,e=this.y-e.y;return t*t+e*e},setLength:function(e){return this.normalize().multiplyScalar(e)},lerpSelf:function(e,t){this.x=this.x+(e.x-this.x)*t;this.y=this.y+(e.y-this.y)*t;return this},equals:function(e){return e.x===this.x&&e.y===this.y},isZero:function(){return this.lengthSq()<1e-4},clone:function(){return new THREE.Vector2(this.x,this.y)}};THREE.Vector3=function(e,t,i){this.x=e||0;this.y=t||0;this.z=i||0};THREE.Vector3.prototype={constructor:THREE.Vector3,set:function(e,t,i){this.x=e;this.y=t;this.z=i;return this},setX:function(e){this.x=e;return this},setY:function(e){this.y=e;return this},setZ:function(e){this.z=e;return this},copy:function(e){this.x=e.x;this.y=e.y;this.z=e.z;return this},add:function(e,t){this.x=e.x+t.x;this.y=e.y+t.y;this.z=e.z+t.z;return this},addSelf:function(e){this.x=this.x+e.x;this.y=this.y+e.y;this.z=this.z+e.z;return this},addScalar:function(e){this.x=this.x+e;this.y=this.y+e;this.z=this.z+e;return this},sub:function(e,t){this.x=e.x-t.x;this.y=e.y-t.y;this.z=e.z-t.z;return this},subSelf:function(e){this.x=this.x-e.x;this.y=this.y-e.y;this.z=this.z-e.z;return this},multiply:function(e,t){this.x=e.x*t.x;this.y=e.y*t.y;this.z=e.z*t.z;return this},multiplySelf:function(e){this.x=this.x*e.x;this.y=this.y*e.y;this.z=this.z*e.z;return this},multiplyScalar:function(e){this.x=this.x*e;this.y=this.y*e;this.z=this.z*e;return this},divideSelf:function(e){this.x=this.x/e.x;this.y=this.y/e.y;this.z=this.z/e.z;return this},divideScalar:function(e){if(e){this.x=this.x/e;this.y=this.y/e;this.z=this.z/e}else this.z=this.y=this.x=0;return this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.lengthSq())},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){return this.normalize().multiplyScalar(e)},lerpSelf:function(e,t){this.x=this.x+(e.x-this.x)*t;this.y=this.y+(e.y-this.y)*t;this.z=this.z+(e.z-this.z)*t;return this},cross:function(e,t){this.x=e.y*t.z-e.z*t.y;this.y=e.z*t.x-e.x*t.z;this.z=e.x*t.y-e.y*t.x;return this},crossSelf:function(e){var t=this.x,i=this.y,r=this.z;this.x=i*e.z-r*e.y;this.y=r*e.x-t*e.z;this.z=t*e.y-i*e.x;return this},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){return(new THREE.Vector3).sub(this,e).lengthSq()},getPositionFromMatrix:function(e){this.x=e.elements[12];this.y=e.elements[13];this.z=e.elements[14];return this},getRotationFromMatrix:function(e,t){var i=t?t.x:1,r=t?t.y:1,o=t?t.z:1,n=e.elements[0]/i,a=e.elements[4]/r,i=e.elements[1]/i,r=e.elements[5]/r,s=e.elements[9]/o,l=e.elements[10]/o;this.y=Math.asin(e.elements[8]/o);o=Math.cos(this.y);if(Math.abs(o)>1e-5){this.x=Math.atan2(-s/o,l/o);this.z=Math.atan2(-a/o,n/o)}else{this.x=0;this.z=Math.atan2(i,r)}return this},getScaleFromMatrix:function(e){var t=this.set(e.elements[0],e.elements[1],e.elements[2]).length(),i=this.set(e.elements[4],e.elements[5],e.elements[6]).length(),e=this.set(e.elements[8],e.elements[9],e.elements[10]).length();this.x=t;this.y=i;this.z=e},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},isZero:function(){return this.lengthSq()<1e-4},clone:function(){return new THREE.Vector3(this.x,this.y,this.z)}};THREE.Vector4=function(e,t,i,r){this.x=e||0;this.y=t||0;this.z=i||0;this.w=r!==void 0?r:1};THREE.Vector4.prototype={constructor:THREE.Vector4,set:function(e,t,i,r){this.x=e;this.y=t;this.z=i;this.w=r;return this},copy:function(e){this.x=e.x;this.y=e.y;this.z=e.z;this.w=e.w!==void 0?e.w:1;return this},add:function(e,t){this.x=e.x+t.x;this.y=e.y+t.y;this.z=e.z+t.z;this.w=e.w+t.w;return this},addSelf:function(e){this.x=this.x+e.x;this.y=this.y+e.y;this.z=this.z+e.z;this.w=this.w+e.w;return this},sub:function(e,t){this.x=e.x-t.x;this.y=e.y-t.y;this.z=e.z-t.z;this.w=e.w-t.w;return this},subSelf:function(e){this.x=this.x-e.x;this.y=this.y-e.y;this.z=this.z-e.z;this.w=this.w-e.w;return this},multiplyScalar:function(e){this.x=this.x*e;this.y=this.y*e;this.z=this.z*e;this.w=this.w*e;return this},divideScalar:function(e){if(e){this.x=this.x/e;this.y=this.y/e;this.z=this.z/e;this.w=this.w/e}else{this.z=this.y=this.x=0;this.w=1}return this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.dot(this)},length:function(){return Math.sqrt(this.lengthSq())},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){return this.normalize().multiplyScalar(e)},lerpSelf:function(e,t){this.x=this.x+(e.x-this.x)*t;this.y=this.y+(e.y-this.y)*t;this.z=this.z+(e.z-this.z)*t;this.w=this.w+(e.w-this.w)*t;return this},clone:function(){return new THREE.Vector4(this.x,this.y,this.z,this.w)}};THREE.Frustum=function(){this.planes=[new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4,new THREE.Vector4]};THREE.Frustum.prototype.setFromMatrix=function(e){var t,i=this.planes,r=e.elements,e=r[0];t=r[1];var o=r[2],n=r[3],a=r[4],s=r[5],l=r[6],h=r[7],c=r[8],f=r[9],u=r[10],E=r[11],p=r[12],d=r[13],m=r[14],r=r[15];i[0].set(n-e,h-a,E-c,r-p);i[1].set(n+e,h+a,E+c,r+p);i[2].set(n+t,h+s,E+f,r+d);i[3].set(n-t,h-s,E-f,r-d);i[4].set(n-o,h-l,E-u,r-m);i[5].set(n+o,h+l,E+u,r+m);for(e=0;e<6;e++){t=i[e];t.divideScalar(Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z))}};THREE.Frustum.prototype.contains=function(e){for(var t=this.planes,i=e.matrixWorld,r=i.elements,i=-e.geometry.boundingSphere.radius*i.getMaxScaleOnAxis(),o=0;o<6;o++){e=t[o].x*r[12]+t[o].y*r[13]+t[o].z*r[14]+t[o].w;if(e<=i)return false}return true};THREE.Frustum.__v1=new THREE.Vector3;THREE.Ray=function(e,t){function i(e,t,i){p.sub(i,e);g=p.dot(t);v=d.add(e,m.copy(t).multiplyScalar(g));return T=i.distanceTo(v)}function r(e,t,i,r){p.sub(r,t);d.sub(i,t);m.sub(e,t);R=p.dot(p);y=p.dot(d);x=p.dot(m);H=d.dot(d);b=d.dot(m);w=1/(R*H-y*y);_=(H*x-y*b)*w;S=(R*b-y*x)*w;return _>=0&&S>=0&&_+S<1}this.origin=e||new THREE.Vector3;this.direction=t||new THREE.Vector3;var o=1e-4;this.setPrecision=function(e){o=e};var n=new THREE.Vector3,a=new THREE.Vector3,s=new THREE.Vector3,l=new THREE.Vector3,h=new THREE.Vector3,c=new THREE.Vector3,f=new THREE.Vector3,u=new THREE.Vector3,E=new THREE.Vector3;this.intersectObject=function(e){var t,p=[];if(e instanceof THREE.Particle){var d=i(this.origin,this.direction,e.matrixWorld.getPosition());if(d>e.scale.x)return[];t={distance:d,point:e.position,face:null,object:e};p.push(t)}else if(e instanceof THREE.Mesh){var d=i(this.origin,this.direction,e.matrixWorld.getPosition()),m=THREE.Frustum.__v1.set(e.matrixWorld.getColumnX().length(),e.matrixWorld.getColumnY().length(),e.matrixWorld.getColumnZ().length());if(d>e.geometry.boundingSphere.radius*Math.max(m.x,Math.max(m.y,m.z)))return p;var g,v,T=e.geometry,R=T.vertices,y;e.matrixRotationWorld.extractRotation(e.matrixWorld);d=0;for(m=T.faces.length;d<m;d++){t=T.faces[d];h.copy(this.origin);c.copy(this.direction);y=e.matrixWorld;f=y.multiplyVector3(f.copy(t.centroid)).subSelf(h);u=e.matrixRotationWorld.multiplyVector3(u.copy(t.normal));g=c.dot(u);if(!(Math.abs(g)<o)){v=u.dot(f)/g;if(!(v<0)&&(e.doubleSided||(e.flipSided?g>0:g<0))){E.add(h,c.multiplyScalar(v));if(t instanceof THREE.Face3){n=y.multiplyVector3(n.copy(R[t.a]));a=y.multiplyVector3(a.copy(R[t.b]));s=y.multiplyVector3(s.copy(R[t.c]));if(r(E,n,a,s)){t={distance:h.distanceTo(E),point:E.clone(),face:t,object:e};p.push(t)}}else if(t instanceof THREE.Face4){n=y.multiplyVector3(n.copy(R[t.a]));a=y.multiplyVector3(a.copy(R[t.b]));s=y.multiplyVector3(s.copy(R[t.c]));l=y.multiplyVector3(l.copy(R[t.d]));if(r(E,n,a,l)||r(E,a,s,l)){t={distance:h.distanceTo(E),point:E.clone(),face:t,object:e};p.push(t)}}}}}}return p};this.intersectObjects=function(e){for(var t=[],i=0,r=e.length;i<r;i++)Array.prototype.push.apply(t,this.intersectObject(e[i]));t.sort(function(e,t){return e.distance-t.distance});return t};var p=new THREE.Vector3,d=new THREE.Vector3,m=new THREE.Vector3,g,v,T,R,y,x,H,b,w,_,S};THREE.Rectangle=function(){function e(){n=r-t;a=o-i}var t,i,r,o,n,a,s=true;this.getX=function(){return t};this.getY=function(){return i};this.getWidth=function(){return n};this.getHeight=function(){return a};this.getLeft=function(){return t};this.getTop=function(){return i};this.getRight=function(){return r};this.getBottom=function(){return o};this.set=function(n,a,l,h){s=false;t=n;i=a;r=l;o=h;e()};this.addPoint=function(n,a){if(s){s=false;t=n;i=a;r=n;o=a}else{t=t<n?t:n;i=i<a?i:a;r=r>n?r:n;o=o>a?o:a}e()};this.add3Points=function(n,a,l,h,c,f){if(s){s=false;t=n<l?n<c?n:c:l<c?l:c;i=a<h?a<f?a:f:h<f?h:f;r=n>l?n>c?n:c:l>c?l:c;o=a>h?a>f?a:f:h>f?h:f}else{t=n<l?n<c?n<t?n:t:c<t?c:t:l<c?l<t?l:t:c<t?c:t;i=a<h?a<f?a<i?a:i:f<i?f:i:h<f?h<i?h:i:f<i?f:i;r=n>l?n>c?n>r?n:r:c>r?c:r:l>c?l>r?l:r:c>r?c:r;o=a>h?a>f?a>o?a:o:f>o?f:o:h>f?h>o?h:o:f>o?f:o}e()};this.addRectangle=function(n){if(s){s=false;t=n.getLeft();i=n.getTop();r=n.getRight();o=n.getBottom()}else{t=t<n.getLeft()?t:n.getLeft();i=i<n.getTop()?i:n.getTop();r=r>n.getRight()?r:n.getRight();o=o>n.getBottom()?o:n.getBottom()}e()};this.inflate=function(n){t=t-n;i=i-n;r=r+n;o=o+n;e()};this.minSelf=function(n){t=t>n.getLeft()?t:n.getLeft();i=i>n.getTop()?i:n.getTop();r=r<n.getRight()?r:n.getRight();o=o<n.getBottom()?o:n.getBottom();e()};this.intersects=function(e){return r<e.getLeft()||t>e.getRight()||o<e.getTop()||i>e.getBottom()?false:true};this.empty=function(){s=true;o=r=i=t=0;e()};this.isEmpty=function(){return s}};THREE.Math={clamp:function(e,t,i){return e<t?t:e>i?i:e},clampBottom:function(e,t){return e<t?t:e},mapLinear:function(e,t,i,r,o){return r+(e-t)*(o-r)/(i-t)},random16:function(){return(65280*Math.random()+255*Math.random())/65535},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},sign:function(e){return e<0?-1:e>0?1:0}};THREE.Matrix3=function(){this.elements=new Float32Array(9)};THREE.Matrix3.prototype={constructor:THREE.Matrix3,getInverse:function(e){var t=e.elements,e=t[10]*t[5]-t[6]*t[9],i=-t[10]*t[1]+t[2]*t[9],r=t[6]*t[1]-t[2]*t[5],o=-t[10]*t[4]+t[6]*t[8],n=t[10]*t[0]-t[2]*t[8],a=-t[6]*t[0]+t[2]*t[4],s=t[9]*t[4]-t[5]*t[8],l=-t[9]*t[0]+t[1]*t[8],h=t[5]*t[0]-t[1]*t[4],t=t[0]*e+t[1]*o+t[2]*s;t===0&&console.warn("Matrix3.getInverse(): determinant == 0");var t=1/t,c=this.elements;c[0]=t*e;c[1]=t*i;c[2]=t*r;c[3]=t*o;c[4]=t*n;c[5]=t*a;c[6]=t*s;c[7]=t*l;c[8]=t*h;return this},transpose:function(){var e,t=this.elements;e=t[1];t[1]=t[3];t[3]=e;e=t[2];t[2]=t[6];t[6]=e;e=t[5];t[5]=t[7];t[7]=e;return this},transposeIntoArray:function(e){var t=this.m;e[0]=t[0];e[1]=t[3];e[2]=t[6];e[3]=t[1];e[4]=t[4];e[5]=t[7];e[6]=t[2];e[7]=t[5];e[8]=t[8];return this}};THREE.Matrix4=function(e,t,i,r,o,n,a,s,l,h,c,f,u,E,p,d){this.elements=new Float32Array(16);this.set(e!==void 0?e:1,t||0,i||0,r||0,o||0,n!==void 0?n:1,a||0,s||0,l||0,h||0,c!==void 0?c:1,f||0,u||0,E||0,p||0,d!==void 0?d:1)};THREE.Matrix4.prototype={constructor:THREE.Matrix4,set:function(e,t,i,r,o,n,a,s,l,h,c,f,u,E,p,d){var m=this.elements;m[0]=e;m[4]=t;m[8]=i;m[12]=r;m[1]=o;m[5]=n;m[9]=a;m[13]=s;m[2]=l;m[6]=h;m[10]=c;m[14]=f;m[3]=u;m[7]=E;m[11]=p;m[15]=d;return this},identity:function(){this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return this},copy:function(e){e=e.elements;this.set(e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15]);return this},lookAt:function(e,t,i){var r=this.elements,o=THREE.Matrix4.__v1,n=THREE.Matrix4.__v2,a=THREE.Matrix4.__v3;a.sub(e,t).normalize();if(a.length()===0)a.z=1;o.cross(i,a).normalize();if(o.length()===0){a.x=a.x+1e-4;o.cross(i,a).normalize()}n.cross(a,o);r[0]=o.x;r[4]=n.x;r[8]=a.x;r[1]=o.y;r[5]=n.y;r[9]=a.y;r[2]=o.z;r[6]=n.z;r[10]=a.z;return this},multiply:function(e,t){var i=e.elements,r=t.elements,o=this.elements,n=i[0],a=i[4],s=i[8],l=i[12],h=i[1],c=i[5],f=i[9],u=i[13],E=i[2],p=i[6],d=i[10],m=i[14],g=i[3],v=i[7],T=i[11],i=i[15],R=r[0],y=r[4],x=r[8],H=r[12],b=r[1],w=r[5],_=r[9],S=r[13],M=r[2],A=r[6],C=r[10],L=r[14],P=r[3],F=r[7],U=r[11],r=r[15];o[0]=n*R+a*b+s*M+l*P;o[4]=n*y+a*w+s*A+l*F;o[8]=n*x+a*_+s*C+l*U;o[12]=n*H+a*S+s*L+l*r;o[1]=h*R+c*b+f*M+u*P;o[5]=h*y+c*w+f*A+u*F;o[9]=h*x+c*_+f*C+u*U;o[13]=h*H+c*S+f*L+u*r;o[2]=E*R+p*b+d*M+m*P;o[6]=E*y+p*w+d*A+m*F;o[10]=E*x+p*_+d*C+m*U;o[14]=E*H+p*S+d*L+m*r;o[3]=g*R+v*b+T*M+i*P;o[7]=g*y+v*w+T*A+i*F;o[11]=g*x+v*_+T*C+i*U;o[15]=g*H+v*S+T*L+i*r;return this},multiplySelf:function(e){return this.multiply(this,e)},multiplyToArray:function(e,t,i){var r=this.elements;this.multiply(e,t);i[0]=r[0];i[1]=r[1];i[2]=r[2];i[3]=r[3];i[4]=r[4];i[5]=r[5];i[6]=r[6];i[7]=r[7];i[8]=r[8];i[9]=r[9];i[10]=r[10];i[11]=r[11];i[12]=r[12];i[13]=r[13];i[14]=r[14];i[15]=r[15];return this},multiplyScalar:function(e){var t=this.elements;t[0]=t[0]*e;t[4]=t[4]*e;t[8]=t[8]*e;t[12]=t[12]*e;t[1]=t[1]*e;t[5]=t[5]*e;t[9]=t[9]*e;t[13]=t[13]*e;t[2]=t[2]*e;t[6]=t[6]*e;t[10]=t[10]*e;t[14]=t[14]*e;t[3]=t[3]*e;t[7]=t[7]*e;t[11]=t[11]*e;t[15]=t[15]*e;return this},multiplyVector3:function(e){var t=this.elements,i=e.x,r=e.y,o=e.z,n=1/(t[3]*i+t[7]*r+t[11]*o+t[15]);e.x=(t[0]*i+t[4]*r+t[8]*o+t[12])*n;e.y=(t[1]*i+t[5]*r+t[9]*o+t[13])*n;e.z=(t[2]*i+t[6]*r+t[10]*o+t[14])*n;return e},multiplyVector4:function(e){var t=this.elements,i=e.x,r=e.y,o=e.z,n=e.w;e.x=t[0]*i+t[4]*r+t[8]*o+t[12]*n;e.y=t[1]*i+t[5]*r+t[9]*o+t[13]*n;e.z=t[2]*i+t[6]*r+t[10]*o+t[14]*n;e.w=t[3]*i+t[7]*r+t[11]*o+t[15]*n;return e},rotateAxis:function(e){var t=this.elements,i=e.x,r=e.y,o=e.z;e.x=i*t[0]+r*t[4]+o*t[8];e.y=i*t[1]+r*t[5]+o*t[9];e.z=i*t[2]+r*t[6]+o*t[10];e.normalize();return e},crossVector:function(e){var t=this.elements,i=new THREE.Vector4;i.x=t[0]*e.x+t[4]*e.y+t[8]*e.z+t[12]*e.w;i.y=t[1]*e.x+t[5]*e.y+t[9]*e.z+t[13]*e.w;i.z=t[2]*e.x+t[6]*e.y+t[10]*e.z+t[14]*e.w;i.w=e.w?t[3]*e.x+t[7]*e.y+t[11]*e.z+t[15]*e.w:1;return i},determinant:function(){var e=this.elements,t=e[0],i=e[4],r=e[8],o=e[12],n=e[1],a=e[5],s=e[9],l=e[13],h=e[2],c=e[6],f=e[10],u=e[14],E=e[3],p=e[7],d=e[11],e=e[15];return o*s*c*E-r*l*c*E-o*a*f*E+i*l*f*E+r*a*u*E-i*s*u*E-o*s*h*p+r*l*h*p+o*n*f*p-t*l*f*p-r*n*u*p+t*s*u*p+o*a*h*d-i*l*h*d-o*n*c*d+t*l*c*d+i*n*u*d-t*a*u*d-r*a*h*e+i*s*h*e+r*n*c*e-t*s*c*e-i*n*f*e+t*a*f*e},transpose:function(){var e=this.elements,t;t=e[1];e[1]=e[4];e[4]=t;t=e[2];e[2]=e[8];e[8]=t;t=e[6];e[6]=e[9];e[9]=t;t=e[3];e[3]=e[12];e[12]=t;t=e[7];e[7]=e[13];e[13]=t;t=e[11];e[11]=e[14];e[14]=t;return this},flattenToArray:function(e){var t=this.elements;e[0]=t[0];e[1]=t[1];e[2]=t[2];e[3]=t[3];e[4]=t[4];e[5]=t[5];e[6]=t[6];e[7]=t[7];e[8]=t[8];e[9]=t[9];e[10]=t[10];e[11]=t[11];e[12]=t[12];e[13]=t[13];e[14]=t[14];e[15]=t[15];return e},flattenToArrayOffset:function(e,t){var i=this.elements;e[t]=i[0];e[t+1]=i[1];e[t+2]=i[2];e[t+3]=i[3];e[t+4]=i[4];e[t+5]=i[5];e[t+6]=i[6];e[t+7]=i[7];e[t+8]=i[8];e[t+9]=i[9];e[t+10]=i[10];e[t+11]=i[11];e[t+12]=i[12];e[t+13]=i[13];e[t+14]=i[14];e[t+15]=i[15];return e},getPosition:function(){var e=this.elements;return THREE.Matrix4.__v1.set(e[12],e[13],e[14])},setPosition:function(e){var t=this.elements;t[12]=e.x;t[13]=e.y;t[14]=e.z;return this},getColumnX:function(){var e=this.elements;return THREE.Matrix4.__v1.set(e[0],e[1],e[2])},getColumnY:function(){var e=this.elements;return THREE.Matrix4.__v1.set(e[4],e[5],e[6])},getColumnZ:function(){var e=this.elements;return THREE.Matrix4.__v1.set(e[8],e[9],e[10])},getInverse:function(e){var t=this.elements,i=e.elements,r=i[0],o=i[4],n=i[8],a=i[12],s=i[1],l=i[5],h=i[9],c=i[13],f=i[2],u=i[6],E=i[10],p=i[14],d=i[3],m=i[7],g=i[11],i=i[15];t[0]=h*p*m-c*E*m+c*u*g-l*p*g-h*u*i+l*E*i;t[4]=a*E*m-n*p*m-a*u*g+o*p*g+n*u*i-o*E*i;t[8]=n*c*m-a*h*m+a*l*g-o*c*g-n*l*i+o*h*i;t[12]=a*h*u-n*c*u-a*l*E+o*c*E+n*l*p-o*h*p;t[1]=c*E*d-h*p*d-c*f*g+s*p*g+h*f*i-s*E*i;t[5]=n*p*d-a*E*d+a*f*g-r*p*g-n*f*i+r*E*i;t[9]=a*h*d-n*c*d-a*s*g+r*c*g+n*s*i-r*h*i;t[13]=n*c*f-a*h*f+a*s*E-r*c*E-n*s*p+r*h*p;t[2]=l*p*d-c*u*d+c*f*m-s*p*m-l*f*i+s*u*i;t[6]=a*u*d-o*p*d-a*f*m+r*p*m+o*f*i-r*u*i;t[10]=o*c*d-a*l*d+a*s*m-r*c*m-o*s*i+r*l*i;t[14]=a*l*f-o*c*f-a*s*u+r*c*u+o*s*p-r*l*p;t[3]=h*u*d-l*E*d-h*f*m+s*E*m+l*f*g-s*u*g;t[7]=o*E*d-n*u*d+n*f*m-r*E*m-o*f*g+r*u*g;t[11]=n*l*d-o*h*d-n*s*m+r*h*m+o*s*g-r*l*g;t[15]=o*h*f-n*l*f+n*s*u-r*h*u-o*s*E+r*l*E;this.multiplyScalar(1/e.determinant());return this},setRotationFromEuler:function(e,t){var i=this.elements,r=e.x,o=e.y,n=e.z,a=Math.cos(r),r=Math.sin(r),s=Math.cos(o),o=Math.sin(o),l=Math.cos(n),n=Math.sin(n);switch(t){case"YXZ":var h=s*l,c=s*n,f=o*l,u=o*n;i[0]=h+u*r;i[4]=f*r-c;i[8]=a*o;i[1]=a*n;i[5]=a*l;i[9]=-r;i[2]=c*r-f;i[6]=u+h*r;i[10]=a*s;break;case"ZXY":h=s*l;c=s*n;f=o*l;u=o*n;i[0]=h-u*r;i[4]=-a*n;i[8]=f+c*r;i[1]=c+f*r;i[5]=a*l;i[9]=u-h*r;i[2]=-a*o;i[6]=r;i[10]=a*s;break;case"ZYX":h=a*l;c=a*n;f=r*l;u=r*n;i[0]=s*l;i[4]=f*o-c;i[8]=h*o+u;i[1]=s*n;i[5]=u*o+h;i[9]=c*o-f;i[2]=-o;i[6]=r*s;i[10]=a*s;break;case"YZX":h=a*s;c=a*o;f=r*s;u=r*o;i[0]=s*l;i[4]=u-h*n;i[8]=f*n+c;i[1]=n;i[5]=a*l;i[9]=-r*l;i[2]=-o*l;i[6]=c*n+f;i[10]=h-u*n;break;case"XZY":h=a*s;c=a*o;f=r*s;u=r*o;i[0]=s*l;i[4]=-n;i[8]=o*l;i[1]=h*n+u;i[5]=a*l;i[9]=c*n-f;i[2]=f*n-c;i[6]=r*l;i[10]=u*n+h;break;default:h=a*l;c=a*n;f=r*l;u=r*n;i[0]=s*l;i[4]=-s*n;i[8]=o;i[1]=c+f*o;i[5]=h-u*o;i[9]=-r*s;i[2]=u-h*o;i[6]=f+c*o;i[10]=a*s}return this},setRotationFromQuaternion:function(e){var t=this.elements,i=e.x,r=e.y,o=e.z,n=e.w,a=i+i,s=r+r,l=o+o,e=i*a,h=i*s,i=i*l,c=r*s,r=r*l,o=o*l,a=n*a,s=n*s,n=n*l;t[0]=1-(c+o);t[4]=h-n;t[8]=i+s;t[1]=h+n;t[5]=1-(e+o);t[9]=r-a;t[2]=i-s;t[6]=r+a;t[10]=1-(e+c);return this},compose:function(e,t,i){var r=this.elements,o=THREE.Matrix4.__m1,n=THREE.Matrix4.__m2;o.identity();o.setRotationFromQuaternion(t);n.makeScale(i.x,i.y,i.z);this.multiply(o,n);r[12]=e.x;r[13]=e.y;r[14]=e.z;return this},decompose:function(e,t,i){var r=this.elements,o=THREE.Matrix4.__v1,n=THREE.Matrix4.__v2,a=THREE.Matrix4.__v3;o.set(r[0],r[1],r[2]);n.set(r[4],r[5],r[6]);a.set(r[8],r[9],r[10]);e=e instanceof THREE.Vector3?e:new THREE.Vector3;t=t instanceof THREE.Quaternion?t:new THREE.Quaternion;i=i instanceof THREE.Vector3?i:new THREE.Vector3;i.x=o.length();i.y=n.length();i.z=a.length();e.x=r[12];e.y=r[13];e.z=r[14];r=THREE.Matrix4.__m1;r.copy(this);r.elements[0]=r.elements[0]/i.x;r.elements[1]=r.elements[1]/i.x;r.elements[2]=r.elements[2]/i.x;r.elements[4]=r.elements[4]/i.y;r.elements[5]=r.elements[5]/i.y;r.elements[6]=r.elements[6]/i.y;r.elements[8]=r.elements[8]/i.z;r.elements[9]=r.elements[9]/i.z;r.elements[10]=r.elements[10]/i.z;t.setFromRotationMatrix(r);return[e,t,i]},extractPosition:function(e){var t=this.elements,e=e.elements;t[12]=e[12];t[13]=e[13];t[14]=e[14];return this},extractRotation:function(e){var t=this.elements,e=e.elements,i=THREE.Matrix4.__v1,r=1/i.set(e[0],e[1],e[2]).length(),o=1/i.set(e[4],e[5],e[6]).length(),i=1/i.set(e[8],e[9],e[10]).length();t[0]=e[0]*r;t[1]=e[1]*r;t[2]=e[2]*r;t[4]=e[4]*o;t[5]=e[5]*o;t[6]=e[6]*o;t[8]=e[8]*i;t[9]=e[9]*i;t[10]=e[10]*i;return this},translate:function(e){var t=this.elements,i=e.x,r=e.y,e=e.z;t[12]=t[0]*i+t[4]*r+t[8]*e+t[12];t[13]=t[1]*i+t[5]*r+t[9]*e+t[13];t[14]=t[2]*i+t[6]*r+t[10]*e+t[14];t[15]=t[3]*i+t[7]*r+t[11]*e+t[15];return this},rotateX:function(e){var t=this.elements,i=t[4],r=t[5],o=t[6],n=t[7],a=t[8],s=t[9],l=t[10],h=t[11],c=Math.cos(e),e=Math.sin(e);t[4]=c*i+e*a;t[5]=c*r+e*s;t[6]=c*o+e*l;t[7]=c*n+e*h;t[8]=c*a-e*i;t[9]=c*s-e*r;t[10]=c*l-e*o;t[11]=c*h-e*n;return this},rotateY:function(e){var t=this.elements,i=t[0],r=t[1],o=t[2],n=t[3],a=t[8],s=t[9],l=t[10],h=t[11],c=Math.cos(e),e=Math.sin(e);t[0]=c*i-e*a;t[1]=c*r-e*s;t[2]=c*o-e*l;t[3]=c*n-e*h;t[8]=c*a+e*i;t[9]=c*s+e*r;t[10]=c*l+e*o;t[11]=c*h+e*n;return this},rotateZ:function(e){var t=this.elements,i=t[0],r=t[1],o=t[2],n=t[3],a=t[4],s=t[5],l=t[6],h=t[7],c=Math.cos(e),e=Math.sin(e);t[0]=c*i+e*a;t[1]=c*r+e*s;t[2]=c*o+e*l;t[3]=c*n+e*h;t[4]=c*a-e*i;t[5]=c*s-e*r;t[6]=c*l-e*o;t[7]=c*h-e*n;return this},rotateByAxis:function(e,t){var i=this.elements;if(e.x===1&&e.y===0&&e.z===0)return this.rotateX(t);if(e.x===0&&e.y===1&&e.z===0)return this.rotateY(t);if(e.x===0&&e.y===0&&e.z===1)return this.rotateZ(t);var r=e.x,o=e.y,n=e.z,a=Math.sqrt(r*r+o*o+n*n),r=r/a,o=o/a,n=n/a,a=r*r,s=o*o,l=n*n,h=Math.cos(t),c=Math.sin(t),f=1-h,u=r*o*f,E=r*n*f,f=o*n*f,r=r*c,p=o*c,c=n*c,n=a+(1-a)*h,a=u+c,o=E-p,u=u-c,s=s+(1-s)*h,c=f+r,E=E+p,f=f-r,l=l+(1-l)*h,h=i[0],r=i[1],p=i[2],d=i[3],m=i[4],g=i[5],v=i[6],T=i[7],R=i[8],y=i[9],x=i[10],H=i[11];i[0]=n*h+a*m+o*R;i[1]=n*r+a*g+o*y;i[2]=n*p+a*v+o*x;i[3]=n*d+a*T+o*H;i[4]=u*h+s*m+c*R;i[5]=u*r+s*g+c*y;i[6]=u*p+s*v+c*x;i[7]=u*d+s*T+c*H;i[8]=E*h+f*m+l*R;i[9]=E*r+f*g+l*y;i[10]=E*p+f*v+l*x;i[11]=E*d+f*T+l*H;return this},scale:function(e){var t=this.elements,i=e.x,r=e.y,e=e.z;t[0]=t[0]*i;t[4]=t[4]*r;t[8]=t[8]*e;t[1]=t[1]*i;t[5]=t[5]*r;t[9]=t[9]*e;t[2]=t[2]*i;t[6]=t[6]*r;t[10]=t[10]*e;t[3]=t[3]*i;t[7]=t[7]*r;t[11]=t[11]*e;return this},getMaxScaleOnAxis:function(){var e=this.elements;return Math.sqrt(Math.max(e[0]*e[0]+e[1]*e[1]+e[2]*e[2],Math.max(e[4]*e[4]+e[5]*e[5]+e[6]*e[6],e[8]*e[8]+e[9]*e[9]+e[10]*e[10])))},makeTranslation:function(e,t,i){this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1);return this},makeRotationX:function(e){var t=Math.cos(e),e=Math.sin(e);this.set(1,0,0,0,0,t,-e,0,0,e,t,0,0,0,0,1);return this},makeRotationY:function(e){var t=Math.cos(e),e=Math.sin(e);this.set(t,0,e,0,0,1,0,0,-e,0,t,0,0,0,0,1);return this},makeRotationZ:function(e){var t=Math.cos(e),e=Math.sin(e);this.set(t,-e,0,0,e,t,0,0,0,0,1,0,0,0,0,1);return this},makeRotationAxis:function(e,t){var i=Math.cos(t),r=Math.sin(t),o=1-i,n=e.x,a=e.y,s=e.z,l=o*n,h=o*a;this.set(l*n+i,l*a-r*s,l*s+r*a,0,l*a+r*s,h*a+i,h*s-r*n,0,l*s-r*a,h*s+r*n,o*s*s+i,0,0,0,0,1);return this},makeScale:function(e,t,i){this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1);return this},makeFrustum:function(e,t,i,r,o,n){var a=this.elements;a[0]=2*o/(t-e);a[4]=0;a[8]=(t+e)/(t-e);a[12]=0;a[1]=0;a[5]=2*o/(r-i);a[9]=(r+i)/(r-i);a[13]=0;a[2]=0;a[6]=0;a[10]=-(n+o)/(n-o);a[14]=-2*n*o/(n-o);a[3]=0;a[7]=0;a[11]=-1;a[15]=0;return this},makePerspective:function(e,t,i,r){var e=i*Math.tan(e*Math.PI/360),o=-e;return this.makeFrustum(o*t,e*t,o,e,i,r)},makeOrthographic:function(e,t,i,r,o,n){var a=this.elements,s=t-e,l=i-r,h=n-o;a[0]=2/s;a[4]=0;a[8]=0;a[12]=-((t+e)/s);a[1]=0;a[5]=2/l;a[9]=0;a[13]=-((i+r)/l);a[2]=0;a[6]=0;a[10]=-2/h;a[14]=-((n+o)/h);a[3]=0;a[7]=0;a[11]=0;a[15]=1;return this},clone:function(){var e=this.elements;return new THREE.Matrix4(e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15])}};THREE.Matrix4.__v1=new THREE.Vector3;THREE.Matrix4.__v2=new THREE.Vector3;THREE.Matrix4.__v3=new THREE.Vector3;THREE.Matrix4.__m1=new THREE.Matrix4;THREE.Matrix4.__m2=new THREE.Matrix4;THREE.Object3D=function(){this.id=THREE.Object3DCount++;this.name="";this.parent=void 0;this.children=[];this.up=new THREE.Vector3(0,1,0);this.position=new THREE.Vector3;this.rotation=new THREE.Vector3;this.eulerOrder="XYZ";this.scale=new THREE.Vector3(1,1,1);this.flipSided=this.doubleSided=false;this.renderDepth=null;this.rotationAutoUpdate=true;this.matrix=new THREE.Matrix4;this.matrixWorld=new THREE.Matrix4;this.matrixRotationWorld=new THREE.Matrix4;this.matrixWorldNeedsUpdate=this.matrixAutoUpdate=true;this.quaternion=new THREE.Quaternion;this.useQuaternion=false;this.boundRadius=0;this.boundRadiusScale=1;this.visible=true;this.receiveShadow=this.castShadow=false;this.frustumCulled=true;this._vector=new THREE.Vector3};THREE.Object3D.prototype={constructor:THREE.Object3D,applyMatrix:function(e){this.matrix.multiply(e,this.matrix);this.scale.getScaleFromMatrix(this.matrix);this.rotation.getRotationFromMatrix(this.matrix,this.scale);this.position.getPositionFromMatrix(this.matrix)},translate:function(e,t){this.matrix.rotateAxis(t);this.position.addSelf(t.multiplyScalar(e))},translateX:function(e){this.translate(e,this._vector.set(1,0,0))},translateY:function(e){this.translate(e,this._vector.set(0,1,0))},translateZ:function(e){this.translate(e,this._vector.set(0,0,1))},lookAt:function(e){this.matrix.lookAt(e,this.position,this.up);this.rotationAutoUpdate&&this.rotation.getRotationFromMatrix(this.matrix)},add:function(e){if(e===this)console.warn("THREE.Object3D.add: An object can't be added as a child of itself.");else if(e instanceof THREE.Object3D){e.parent!==void 0&&e.parent.remove(e);e.parent=this;this.children.push(e);for(var t=this;t.parent!==void 0;)t=t.parent;t!==void 0&&t instanceof THREE.Scene&&t.__addObject(e)}},remove:function(e){var t=this.children.indexOf(e);if(t!==-1){e.parent=void 0;this.children.splice(t,1);for(t=this;t.parent!==void 0;)t=t.parent;t!==void 0&&t instanceof THREE.Scene&&t.__removeObject(e)}},getChildByName:function(e,t){var i,r,o;i=0;for(r=this.children.length;i<r;i++){o=this.children[i];if(o.name===e)return o;if(t){o=o.getChildByName(e,t);if(o!==void 0)return o}}},updateMatrix:function(){this.matrix.setPosition(this.position);this.useQuaternion?this.matrix.setRotationFromQuaternion(this.quaternion):this.matrix.setRotationFromEuler(this.rotation,this.eulerOrder);if(this.scale.x!==1||this.scale.y!==1||this.scale.z!==1){this.matrix.scale(this.scale);this.boundRadiusScale=Math.max(this.scale.x,Math.max(this.scale.y,this.scale.z))}this.matrixWorldNeedsUpdate=true},updateMatrixWorld:function(e){this.matrixAutoUpdate&&this.updateMatrix();if(this.matrixWorldNeedsUpdate||e){this.parent?this.matrixWorld.multiply(this.parent.matrixWorld,this.matrix):this.matrixWorld.copy(this.matrix);this.matrixWorldNeedsUpdate=false;e=true}for(var t=0,i=this.children.length;t<i;t++)this.children[t].updateMatrixWorld(e)}};THREE.Object3DCount=0;THREE.Projector=function(){function e(){var e=a[n]=a[n]||new THREE.RenderableObject;n++;return e}function t(){var e=h[l]=h[l]||new THREE.RenderableVertex;l++;return e}function i(e,t){return t.z-e.z}function r(e,t){var i=0,r=1,o=e.z+e.w,n=t.z+t.w,a=-e.z+e.w,s=-t.z+t.w;if(o>=0&&n>=0&&a>=0&&s>=0)return true;if(o<0&&n<0||a<0&&s<0)return false;o<0?i=Math.max(i,o/(o-n)):n<0&&(r=Math.min(r,o/(o-n)));a<0?i=Math.max(i,a/(a-s)):s<0&&(r=Math.min(r,a/(a-s)));if(r<i)return false;e.lerpSelf(t,i);t.lerpSelf(e,1-r);return true}var o,n,a=[],s,l,h=[],c,f,u=[],E,p=[],d,m,g=[],v,T,R=[],y={objects:[],sprites:[],lights:[],elements:[]},x=new THREE.Vector3,H=new THREE.Vector4,b=new THREE.Matrix4,w=new THREE.Matrix4,_=new THREE.Frustum,S=new THREE.Vector4,M=new THREE.Vector4;this.projectVector=function(e,t){t.matrixWorldInverse.getInverse(t.matrixWorld);b.multiply(t.projectionMatrix,t.matrixWorldInverse);b.multiplyVector3(e);return e};this.unprojectVector=function(e,t){t.projectionMatrixInverse.getInverse(t.projectionMatrix);b.multiply(t.matrixWorld,t.projectionMatrixInverse);b.multiplyVector3(e);return e};this.pickingRay=function(e,t){var i;e.z=-1;i=new THREE.Vector3(e.x,e.y,1);this.unprojectVector(e,t);this.unprojectVector(i,t);i.subSelf(e).normalize();return new THREE.Ray(e,i)};this.projectGraph=function(t,r){n=0;y.objects.length=0;y.sprites.length=0;y.lights.length=0;var a=function(t){if(t.visible!==false){if((t instanceof THREE.Mesh||t instanceof THREE.Line)&&(t.frustumCulled===false||_.contains(t))){x.copy(t.matrixWorld.getPosition());b.multiplyVector3(x);o=e();o.object=t;o.z=x.z;y.objects.push(o)}else if(t instanceof THREE.Sprite||t instanceof THREE.Particle){x.copy(t.matrixWorld.getPosition());b.multiplyVector3(x);o=e();o.object=t;o.z=x.z;y.sprites.push(o)}else t instanceof THREE.Light&&y.lights.push(t);for(var i=0,r=t.children.length;i<r;i++)a(t.children[i])}};a(t);r&&y.objects.sort(i);return y};this.projectScene=function(e,o,n){var a=o.near,x=o.far,A=false,C,L,P,F,U,D,V,B,z,N,k,O,I,W,G;T=m=E=f=0;y.elements.length=0;if(o.parent===void 0){console.warn("DEPRECATED: Camera hasn't been added to a Scene. Adding it...");e.add(o)}e.updateMatrixWorld();o.matrixWorldInverse.getInverse(o.matrixWorld);b.multiply(o.projectionMatrix,o.matrixWorldInverse);_.setFromMatrix(b);y=this.projectGraph(e,false);e=0;for(C=y.objects.length;e<C;e++){z=y.objects[e].object;N=z.matrixWorld;l=0;if(z instanceof THREE.Mesh){k=z.geometry;
O=z.geometry.materials;F=k.vertices;I=k.faces;W=k.faceVertexUvs;k=z.matrixRotationWorld.extractRotation(N);L=0;for(P=F.length;L<P;L++){s=t();s.positionWorld.copy(F[L]);N.multiplyVector3(s.positionWorld);s.positionScreen.copy(s.positionWorld);b.multiplyVector4(s.positionScreen);s.positionScreen.x=s.positionScreen.x/s.positionScreen.w;s.positionScreen.y=s.positionScreen.y/s.positionScreen.w;s.visible=s.positionScreen.z>a&&s.positionScreen.z<x}F=0;for(L=I.length;F<L;F++){P=I[F];if(P instanceof THREE.Face3){U=h[P.a];D=h[P.b];V=h[P.c];if(U.visible&&D.visible&&V.visible){A=(V.positionScreen.x-U.positionScreen.x)*(D.positionScreen.y-U.positionScreen.y)-(V.positionScreen.y-U.positionScreen.y)*(D.positionScreen.x-U.positionScreen.x)<0;if(z.doubleSided||A!=z.flipSided){B=u[f]=u[f]||new THREE.RenderableFace3;f++;c=B;c.v1.copy(U);c.v2.copy(D);c.v3.copy(V)}else continue}else continue}else if(P instanceof THREE.Face4){U=h[P.a];D=h[P.b];V=h[P.c];B=h[P.d];if(U.visible&&D.visible&&V.visible&&B.visible){A=(B.positionScreen.x-U.positionScreen.x)*(D.positionScreen.y-U.positionScreen.y)-(B.positionScreen.y-U.positionScreen.y)*(D.positionScreen.x-U.positionScreen.x)<0||(D.positionScreen.x-V.positionScreen.x)*(B.positionScreen.y-V.positionScreen.y)-(D.positionScreen.y-V.positionScreen.y)*(B.positionScreen.x-V.positionScreen.x)<0;if(z.doubleSided||A!=z.flipSided){G=p[E]=p[E]||new THREE.RenderableFace4;E++;c=G;c.v1.copy(U);c.v2.copy(D);c.v3.copy(V);c.v4.copy(B)}else continue}else continue}c.normalWorld.copy(P.normal);!A&&(z.flipSided||z.doubleSided)&&c.normalWorld.negate();k.multiplyVector3(c.normalWorld);c.centroidWorld.copy(P.centroid);N.multiplyVector3(c.centroidWorld);c.centroidScreen.copy(c.centroidWorld);b.multiplyVector3(c.centroidScreen);V=P.vertexNormals;U=0;for(D=V.length;U<D;U++){B=c.vertexNormalsWorld[U];B.copy(V[U]);!A&&(z.flipSided||z.doubleSided)&&B.negate();k.multiplyVector3(B)}U=0;for(D=W.length;U<D;U++)if(G=W[U][F]){V=0;for(B=G.length;V<B;V++)c.uvs[U][V]=G[V]}c.material=z.material;c.faceMaterial=P.materialIndex!==null?O[P.materialIndex]:null;c.z=c.centroidScreen.z;y.elements.push(c)}}else if(z instanceof THREE.Line){w.multiply(b,N);F=z.geometry.vertices;U=t();U.positionScreen.copy(F[0]);w.multiplyVector4(U.positionScreen);N=z.type===THREE.LinePieces?2:1;L=1;for(P=F.length;L<P;L++){U=t();U.positionScreen.copy(F[L]);w.multiplyVector4(U.positionScreen);if(!((L+1)%N>0)){D=h[l-2];S.copy(U.positionScreen);M.copy(D.positionScreen);if(r(S,M)){S.multiplyScalar(1/S.w);M.multiplyScalar(1/M.w);O=g[m]=g[m]||new THREE.RenderableLine;m++;d=O;d.v1.positionScreen.copy(S);d.v2.positionScreen.copy(M);d.z=Math.max(S.z,M.z);d.material=z.material;y.elements.push(d)}}}}}e=0;for(C=y.sprites.length;e<C;e++){z=y.sprites[e].object;N=z.matrixWorld;if(z instanceof THREE.Particle){H.set(N.elements[12],N.elements[13],N.elements[14],1);b.multiplyVector4(H);H.z=H.z/H.w;if(H.z>0&&H.z<1){a=R[T]=R[T]||new THREE.RenderableParticle;T++;v=a;v.x=H.x/H.w;v.y=H.y/H.w;v.z=H.z;v.rotation=z.rotation.z;v.scale.x=z.scale.x*Math.abs(v.x-(H.x+o.projectionMatrix.elements[0])/(H.w+o.projectionMatrix.elements[12]));v.scale.y=z.scale.y*Math.abs(v.y-(H.y+o.projectionMatrix.elements[5])/(H.w+o.projectionMatrix.elements[13]));v.material=z.material;y.elements.push(v)}}}n&&y.elements.sort(i);return y}};THREE.Quaternion=function(e,t,i,r){this.x=e||0;this.y=t||0;this.z=i||0;this.w=r!==void 0?r:1};THREE.Quaternion.prototype={constructor:THREE.Quaternion,set:function(e,t,i,r){this.x=e;this.y=t;this.z=i;this.w=r;return this},copy:function(e){this.x=e.x;this.y=e.y;this.z=e.z;this.w=e.w;return this},setFromEuler:function(e){var t=Math.PI/360,i=e.x*t,r=e.y*t,o=e.z*t,e=Math.cos(r),r=Math.sin(r),t=Math.cos(-o),o=Math.sin(-o),n=Math.cos(i),i=Math.sin(i),a=e*t,s=r*o;this.w=a*n-s*i;this.x=a*i+s*n;this.y=r*t*n+e*o*i;this.z=e*o*n-r*t*i;return this},setFromAxisAngle:function(e,t){var i=t/2,r=Math.sin(i);this.x=e.x*r;this.y=e.y*r;this.z=e.z*r;this.w=Math.cos(i);return this},setFromRotationMatrix:function(e){var t=Math.pow(e.determinant(),1/3);this.w=Math.sqrt(Math.max(0,t+e.elements[0]+e.elements[5]+e.elements[10]))/2;this.x=Math.sqrt(Math.max(0,t+e.elements[0]-e.elements[5]-e.elements[10]))/2;this.y=Math.sqrt(Math.max(0,t-e.elements[0]+e.elements[5]-e.elements[10]))/2;this.z=Math.sqrt(Math.max(0,t-e.elements[0]-e.elements[5]+e.elements[10]))/2;this.x=e.elements[6]-e.elements[9]<0?-Math.abs(this.x):Math.abs(this.x);this.y=e.elements[8]-e.elements[2]<0?-Math.abs(this.y):Math.abs(this.y);this.z=e.elements[1]-e.elements[4]<0?-Math.abs(this.z):Math.abs(this.z);this.normalize();return this},calculateW:function(){this.w=-Math.sqrt(Math.abs(1-this.x*this.x-this.y*this.y-this.z*this.z));return this},inverse:function(){this.x=this.x*-1;this.y=this.y*-1;this.z=this.z*-1;return this},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},normalize:function(){var e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);if(e===0)this.w=this.z=this.y=this.x=0;else{e=1/e;this.x=this.x*e;this.y=this.y*e;this.z=this.z*e;this.w=this.w*e}return this},multiply:function(e,t){this.x=e.x*t.w+e.y*t.z-e.z*t.y+e.w*t.x;this.y=-e.x*t.z+e.y*t.w+e.z*t.x+e.w*t.y;this.z=e.x*t.y-e.y*t.x+e.z*t.w+e.w*t.z;this.w=-e.x*t.x-e.y*t.y-e.z*t.z+e.w*t.w;return this},multiplySelf:function(e){var t=this.x,i=this.y,r=this.z,o=this.w,n=e.x,a=e.y,s=e.z,e=e.w;this.x=t*e+o*n+i*s-r*a;this.y=i*e+o*a+r*n-t*s;this.z=r*e+o*s+t*a-i*n;this.w=o*e-t*n-i*a-r*s;return this},multiplyVector3:function(e,t){t||(t=e);var i=e.x,r=e.y,o=e.z,n=this.x,a=this.y,s=this.z,l=this.w,h=l*i+a*o-s*r,c=l*r+s*i-n*o,f=l*o+n*r-a*i,i=-n*i-a*r-s*o;t.x=h*l+i*-n+c*-s-f*-a;t.y=c*l+i*-a+f*-n-h*-s;t.z=f*l+i*-s+h*-a-c*-n;return t},clone:function(){return new THREE.Quaternion(this.x,this.y,this.z,this.w)}};THREE.Quaternion.slerp=function(e,t,i,r){var o=e.w*t.w+e.x*t.x+e.y*t.y+e.z*t.z;if(o<0){i.w=-t.w;i.x=-t.x;i.y=-t.y;i.z=-t.z;o=-o}else i.copy(t);if(Math.abs(o)>=1){i.w=e.w;i.x=e.x;i.y=e.y;i.z=e.z;return i}var n=Math.acos(o),o=Math.sqrt(1-o*o);if(Math.abs(o)<.001){i.w=.5*(e.w+t.w);i.x=.5*(e.x+t.x);i.y=.5*(e.y+t.y);i.z=.5*(e.z+t.z);return i}t=Math.sin((1-r)*n)/o;r=Math.sin(r*n)/o;i.w=e.w*t+i.w*r;i.x=e.x*t+i.x*r;i.y=e.y*t+i.y*r;i.z=e.z*t+i.z*r;return i};THREE.Vertex=function(){console.warn("THREE.Vertex has been DEPRECATED. Use THREE.Vector3 instead.")};THREE.Face3=function(e,t,i,r,o,n){this.a=e;this.b=t;this.c=i;this.normal=r instanceof THREE.Vector3?r:new THREE.Vector3;this.vertexNormals=r instanceof Array?r:[];this.color=o instanceof THREE.Color?o:new THREE.Color;this.vertexColors=o instanceof Array?o:[];this.vertexTangents=[];this.materialIndex=n;this.centroid=new THREE.Vector3};THREE.Face3.prototype={constructor:THREE.Face3,clone:function(){var e=new THREE.Face3(this.a,this.b,this.c);e.normal.copy(this.normal);e.color.copy(this.color);e.centroid.copy(this.centroid);e.materialIndex=this.materialIndex;var t,i;t=0;for(i=this.vertexNormals.length;t<i;t++)e.vertexNormals[t]=this.vertexNormals[t].clone();t=0;for(i=this.vertexColors.length;t<i;t++)e.vertexColors[t]=this.vertexColors[t].clone();t=0;for(i=this.vertexTangents.length;t<i;t++)e.vertexTangents[t]=this.vertexTangents[t].clone();return e}};THREE.Face4=function(e,t,i,r,o,n,a){this.a=e;this.b=t;this.c=i;this.d=r;this.normal=o instanceof THREE.Vector3?o:new THREE.Vector3;this.vertexNormals=o instanceof Array?o:[];this.color=n instanceof THREE.Color?n:new THREE.Color;this.vertexColors=n instanceof Array?n:[];this.vertexTangents=[];this.materialIndex=a;this.centroid=new THREE.Vector3};THREE.Face4.prototype={constructor:THREE.Face4,clone:function(){var e=new THREE.Face4(this.a,this.b,this.c,this.d);e.normal.copy(this.normal);e.color.copy(this.color);e.centroid.copy(this.centroid);e.materialIndex=this.materialIndex;var t,i;t=0;for(i=this.vertexNormals.length;t<i;t++)e.vertexNormals[t]=this.vertexNormals[t].clone();t=0;for(i=this.vertexColors.length;t<i;t++)e.vertexColors[t]=this.vertexColors[t].clone();t=0;for(i=this.vertexTangents.length;t<i;t++)e.vertexTangents[t]=this.vertexTangents[t].clone();return e}};THREE.UV=function(e,t){this.u=e||0;this.v=t||0};THREE.UV.prototype={constructor:THREE.UV,set:function(e,t){this.u=e;this.v=t;return this},copy:function(e){this.u=e.u;this.v=e.v;return this},lerpSelf:function(e,t){this.u=this.u+(e.u-this.u)*t;this.v=this.v+(e.v-this.v)*t;return this},clone:function(){return new THREE.UV(this.u,this.v)}};THREE.Geometry=function(){this.id=THREE.GeometryCount++;this.vertices=[];this.colors=[];this.materials=[];this.faces=[];this.faceUvs=[[]];this.faceVertexUvs=[[]];this.morphTargets=[];this.morphColors=[];this.morphNormals=[];this.skinWeights=[];this.skinIndices=[];this.boundingSphere=this.boundingBox=null;this.dynamic=this.hasTangents=false};THREE.Geometry.prototype={constructor:THREE.Geometry,applyMatrix:function(e){var t=new THREE.Matrix4;t.extractRotation(e);for(var i=0,r=this.vertices.length;i<r;i++)e.multiplyVector3(this.vertices[i]);i=0;for(r=this.faces.length;i<r;i++){var o=this.faces[i];t.multiplyVector3(o.normal);for(var n=0,a=o.vertexNormals.length;n<a;n++)t.multiplyVector3(o.vertexNormals[n]);e.multiplyVector3(o.centroid)}},computeCentroids:function(){var e,t,i;e=0;for(t=this.faces.length;e<t;e++){i=this.faces[e];i.centroid.set(0,0,0);if(i instanceof THREE.Face3){i.centroid.addSelf(this.vertices[i.a]);i.centroid.addSelf(this.vertices[i.b]);i.centroid.addSelf(this.vertices[i.c]);i.centroid.divideScalar(3)}else if(i instanceof THREE.Face4){i.centroid.addSelf(this.vertices[i.a]);i.centroid.addSelf(this.vertices[i.b]);i.centroid.addSelf(this.vertices[i.c]);i.centroid.addSelf(this.vertices[i.d]);i.centroid.divideScalar(4)}}},computeFaceNormals:function(){var e,t,i,r,o,n,a=new THREE.Vector3,s=new THREE.Vector3;e=0;for(t=this.faces.length;e<t;e++){i=this.faces[e];r=this.vertices[i.a];o=this.vertices[i.b];n=this.vertices[i.c];a.sub(n,o);s.sub(r,o);a.crossSelf(s);a.isZero()||a.normalize();i.normal.copy(a)}},computeVertexNormals:function(){var e,t,i,r;if(this.__tmpVertices===void 0){r=this.__tmpVertices=Array(this.vertices.length);e=0;for(t=this.vertices.length;e<t;e++)r[e]=new THREE.Vector3;e=0;for(t=this.faces.length;e<t;e++){i=this.faces[e];if(i instanceof THREE.Face3)i.vertexNormals=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];else if(i instanceof THREE.Face4)i.vertexNormals=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3]}}else{r=this.__tmpVertices;e=0;for(t=this.vertices.length;e<t;e++)r[e].set(0,0,0)}e=0;for(t=this.faces.length;e<t;e++){i=this.faces[e];if(i instanceof THREE.Face3){r[i.a].addSelf(i.normal);r[i.b].addSelf(i.normal);r[i.c].addSelf(i.normal)}else if(i instanceof THREE.Face4){r[i.a].addSelf(i.normal);r[i.b].addSelf(i.normal);r[i.c].addSelf(i.normal);r[i.d].addSelf(i.normal)}}e=0;for(t=this.vertices.length;e<t;e++)r[e].normalize();e=0;for(t=this.faces.length;e<t;e++){i=this.faces[e];if(i instanceof THREE.Face3){i.vertexNormals[0].copy(r[i.a]);i.vertexNormals[1].copy(r[i.b]);i.vertexNormals[2].copy(r[i.c])}else if(i instanceof THREE.Face4){i.vertexNormals[0].copy(r[i.a]);i.vertexNormals[1].copy(r[i.b]);i.vertexNormals[2].copy(r[i.c]);i.vertexNormals[3].copy(r[i.d])}}},computeMorphNormals:function(){var e,t,i,r,o;i=0;for(r=this.faces.length;i<r;i++){o=this.faces[i];o.__originalFaceNormal?o.__originalFaceNormal.copy(o.normal):o.__originalFaceNormal=o.normal.clone();if(!o.__originalVertexNormals)o.__originalVertexNormals=[];e=0;for(t=o.vertexNormals.length;e<t;e++)o.__originalVertexNormals[e]?o.__originalVertexNormals[e].copy(o.vertexNormals[e]):o.__originalVertexNormals[e]=o.vertexNormals[e].clone()}var n=new THREE.Geometry;n.faces=this.faces;e=0;for(t=this.morphTargets.length;e<t;e++){if(!this.morphNormals[e]){this.morphNormals[e]={};this.morphNormals[e].faceNormals=[];this.morphNormals[e].vertexNormals=[];var a=this.morphNormals[e].faceNormals,s=this.morphNormals[e].vertexNormals,l,h;i=0;for(r=this.faces.length;i<r;i++){o=this.faces[i];l=new THREE.Vector3;h=o instanceof THREE.Face3?{a:new THREE.Vector3,b:new THREE.Vector3,c:new THREE.Vector3}:{a:new THREE.Vector3,b:new THREE.Vector3,c:new THREE.Vector3,d:new THREE.Vector3};a.push(l);s.push(h)}}a=this.morphNormals[e];n.vertices=this.morphTargets[e].vertices;n.computeFaceNormals();n.computeVertexNormals();i=0;for(r=this.faces.length;i<r;i++){o=this.faces[i];l=a.faceNormals[i];h=a.vertexNormals[i];l.copy(o.normal);if(o instanceof THREE.Face3){h.a.copy(o.vertexNormals[0]);h.b.copy(o.vertexNormals[1]);h.c.copy(o.vertexNormals[2])}else{h.a.copy(o.vertexNormals[0]);h.b.copy(o.vertexNormals[1]);h.c.copy(o.vertexNormals[2]);h.d.copy(o.vertexNormals[3])}}}i=0;for(r=this.faces.length;i<r;i++){o=this.faces[i];o.normal=o.__originalFaceNormal;o.vertexNormals=o.__originalVertexNormals}},computeTangents:function(){function e(e,t,i,r,o,n,b){s=e.vertices[t];l=e.vertices[i];h=e.vertices[r];c=a[o];f=a[n];u=a[b];E=l.x-s.x;p=h.x-s.x;d=l.y-s.y;m=h.y-s.y;g=l.z-s.z;v=h.z-s.z;T=f.u-c.u;R=u.u-c.u;y=f.v-c.v;x=u.v-c.v;H=1/(T*x-R*y);S.set((x*E-y*p)*H,(x*d-y*m)*H,(x*g-y*v)*H);M.set((T*p-R*E)*H,(T*m-R*d)*H,(T*v-R*g)*H);w[t].addSelf(S);w[i].addSelf(S);w[r].addSelf(S);_[t].addSelf(M);_[i].addSelf(M);_[r].addSelf(M)}var t,i,r,o,n,a,s,l,h,c,f,u,E,p,d,m,g,v,T,R,y,x,H,b,w=[],_=[],S=new THREE.Vector3,M=new THREE.Vector3,A=new THREE.Vector3,C=new THREE.Vector3,L=new THREE.Vector3;t=0;for(i=this.vertices.length;t<i;t++){w[t]=new THREE.Vector3;_[t]=new THREE.Vector3}t=0;for(i=this.faces.length;t<i;t++){n=this.faces[t];a=this.faceVertexUvs[0][t];if(n instanceof THREE.Face3)e(this,n.a,n.b,n.c,0,1,2);else if(n instanceof THREE.Face4){e(this,n.a,n.b,n.d,0,1,3);e(this,n.b,n.c,n.d,1,2,3)}}var P=["a","b","c","d"];t=0;for(i=this.faces.length;t<i;t++){n=this.faces[t];for(r=0;r<n.vertexNormals.length;r++){L.copy(n.vertexNormals[r]);o=n[P[r]];b=w[o];A.copy(b);A.subSelf(L.multiplyScalar(L.dot(b))).normalize();C.cross(n.vertexNormals[r],b);o=C.dot(_[o]);o=o<0?-1:1;n.vertexTangents[r]=new THREE.Vector4(A.x,A.y,A.z,o)}}this.hasTangents=true},computeBoundingBox:function(){if(!this.boundingBox)this.boundingBox={min:new THREE.Vector3,max:new THREE.Vector3};if(this.vertices.length>0){var e;e=this.vertices[0];this.boundingBox.min.copy(e);this.boundingBox.max.copy(e);for(var t=this.boundingBox.min,i=this.boundingBox.max,r=1,o=this.vertices.length;r<o;r++){e=this.vertices[r];if(e.x<t.x)t.x=e.x;else if(e.x>i.x)i.x=e.x;if(e.y<t.y)t.y=e.y;else if(e.y>i.y)i.y=e.y;if(e.z<t.z)t.z=e.z;else if(e.z>i.z)i.z=e.z}}else{this.boundingBox.min.set(0,0,0);this.boundingBox.max.set(0,0,0)}},computeBoundingSphere:function(){if(!this.boundingSphere)this.boundingSphere={radius:0};for(var e,t=0,i=0,r=this.vertices.length;i<r;i++){e=this.vertices[i].length();e>t&&(t=e)}this.boundingSphere.radius=t},mergeVertices:function(){var e={},t=[],i=[],r,o=Math.pow(10,4),n,a,s;n=0;for(a=this.vertices.length;n<a;n++){r=this.vertices[n];r=[Math.round(r.x*o),Math.round(r.y*o),Math.round(r.z*o)].join("_");if(e[r]===void 0){e[r]=n;t.push(this.vertices[n]);i[n]=t.length-1}else i[n]=i[e[r]]}n=0;for(a=this.faces.length;n<a;n++){o=this.faces[n];if(o instanceof THREE.Face3){o.a=i[o.a];o.b=i[o.b];o.c=i[o.c]}else if(o instanceof THREE.Face4){o.a=i[o.a];o.b=i[o.b];o.c=i[o.c];o.d=i[o.d];r=[o.a,o.b,o.c,o.d];for(e=3;e>0;e--)if(r.indexOf(o["abcd"[e]])!=e){r.splice(e,1);this.faces[n]=new THREE.Face3(r[0],r[1],r[2]);o=0;for(r=this.faceVertexUvs.length;o<r;o++)(s=this.faceVertexUvs[o][n])&&s.splice(e,1);break}}}i=this.vertices.length-t.length;this.vertices=t;return i}};THREE.GeometryCount=0;THREE.Spline=function(e){function t(e,t,i,r,o,n,a){e=(i-e)*.5;r=(r-t)*.5;return(2*(t-i)+e+r)*a+(-3*(t-i)-2*e-r)*n+e*o+t}this.points=e;var i=[],r={x:0,y:0,z:0},o,n,a,s,l,h,c,f,u;this.initFromArray=function(e){this.points=[];for(var t=0;t<e.length;t++)this.points[t]={x:e[t][0],y:e[t][1],z:e[t][2]}};this.getPoint=function(e){o=(this.points.length-1)*e;n=Math.floor(o);a=o-n;i[0]=n===0?n:n-1;i[1]=n;i[2]=n>this.points.length-2?this.points.length-1:n+1;i[3]=n>this.points.length-3?this.points.length-1:n+2;h=this.points[i[0]];c=this.points[i[1]];f=this.points[i[2]];u=this.points[i[3]];s=a*a;l=a*s;r.x=t(h.x,c.x,f.x,u.x,a,s,l);r.y=t(h.y,c.y,f.y,u.y,a,s,l);r.z=t(h.z,c.z,f.z,u.z,a,s,l);return r};this.getControlPointsArray=function(){var e,t,i=this.points.length,r=[];for(e=0;e<i;e++){t=this.points[e];r[e]=[t.x,t.y,t.z]}return r};this.getLength=function(e){var t,i,r,o=t=t=0,n=new THREE.Vector3,a=new THREE.Vector3,s=[],l=0;s[0]=0;e||(e=100);i=this.points.length*e;n.copy(this.points[0]);for(e=1;e<i;e++){t=e/i;r=this.getPoint(t);a.copy(r);l=l+a.distanceTo(n);n.copy(r);t=(this.points.length-1)*t;t=Math.floor(t);if(t!=o){s[t]=l;o=t}}s[s.length]=l;return{chunks:s,total:l}};this.reparametrizeByArcLength=function(e){var t,i,r,o,n,a,s=[],l=new THREE.Vector3,h=this.getLength();s.push(l.copy(this.points[0]).clone());for(t=1;t<this.points.length;t++){i=h.chunks[t]-h.chunks[t-1];a=Math.ceil(e*i/h.total);o=(t-1)/(this.points.length-1);n=t/(this.points.length-1);for(i=1;i<a-1;i++){r=o+i*(1/a)*(n-o);r=this.getPoint(r);s.push(l.copy(r).clone())}s.push(l.copy(this.points[t]).clone())}this.points=s}};THREE.Camera=function(){THREE.Object3D.call(this);this.matrixWorldInverse=new THREE.Matrix4;this.projectionMatrix=new THREE.Matrix4;this.projectionMatrixInverse=new THREE.Matrix4};THREE.Camera.prototype=new THREE.Object3D;THREE.Camera.prototype.constructor=THREE.Camera;THREE.Camera.prototype.lookAt=function(e){this.matrix.lookAt(this.position,e,this.up);this.rotationAutoUpdate&&this.rotation.getRotationFromMatrix(this.matrix)};THREE.OrthographicCamera=function(e,t,i,r,o,n){THREE.Camera.call(this);this.left=e;this.right=t;this.top=i;this.bottom=r;this.near=o!==void 0?o:.1;this.far=n!==void 0?n:2e3;this.updateProjectionMatrix()};THREE.OrthographicCamera.prototype=new THREE.Camera;THREE.OrthographicCamera.prototype.constructor=THREE.OrthographicCamera;THREE.OrthographicCamera.prototype.updateProjectionMatrix=function(){this.projectionMatrix.makeOrthographic(this.left,this.right,this.top,this.bottom,this.near,this.far)};THREE.PerspectiveCamera=function(e,t,i,r){THREE.Camera.call(this);this.fov=e!==void 0?e:50;this.aspect=t!==void 0?t:1;this.near=i!==void 0?i:.1;this.far=r!==void 0?r:2e3;this.updateProjectionMatrix()};THREE.PerspectiveCamera.prototype=new THREE.Camera;THREE.PerspectiveCamera.prototype.constructor=THREE.PerspectiveCamera;THREE.PerspectiveCamera.prototype.setLens=function(e,t){this.fov=2*Math.atan((t!==void 0?t:24)/(e*2))*(180/Math.PI);this.updateProjectionMatrix()};THREE.PerspectiveCamera.prototype.setViewOffset=function(e,t,i,r,o,n){this.fullWidth=e;this.fullHeight=t;this.x=i;this.y=r;this.width=o;this.height=n;this.updateProjectionMatrix()};THREE.PerspectiveCamera.prototype.updateProjectionMatrix=function(){if(this.fullWidth){var e=this.fullWidth/this.fullHeight,t=Math.tan(this.fov*Math.PI/360)*this.near,i=-t,r=e*i,e=Math.abs(e*t-r),i=Math.abs(t-i);this.projectionMatrix.makeFrustum(r+this.x*e/this.fullWidth,r+(this.x+this.width)*e/this.fullWidth,t-(this.y+this.height)*i/this.fullHeight,t-this.y*i/this.fullHeight,this.near,this.far)}else this.projectionMatrix.makePerspective(this.fov,this.aspect,this.near,this.far)};THREE.Light=function(e){THREE.Object3D.call(this);this.color=new THREE.Color(e)};THREE.Light.prototype=new THREE.Object3D;THREE.Light.prototype.constructor=THREE.Light;THREE.Light.prototype.supr=THREE.Object3D.prototype;THREE.AmbientLight=function(e){THREE.Light.call(this,e)};THREE.AmbientLight.prototype=new THREE.Light;THREE.AmbientLight.prototype.constructor=THREE.AmbientLight;THREE.DirectionalLight=function(e,t,i){THREE.Light.call(this,e);this.position=new THREE.Vector3(0,1,0);this.target=new THREE.Object3D;this.intensity=t!==void 0?t:1;this.distance=i!==void 0?i:0;this.onlyShadow=this.castShadow=false;this.shadowCameraNear=50;this.shadowCameraFar=5e3;this.shadowCameraLeft=-500;this.shadowCameraTop=this.shadowCameraRight=500;this.shadowCameraBottom=-500;this.shadowCameraVisible=false;this.shadowBias=0;this.shadowDarkness=.5;this.shadowMapHeight=this.shadowMapWidth=512;this.shadowCascade=false;this.shadowCascadeOffset=new THREE.Vector3(0,0,-1e3);this.shadowCascadeCount=2;this.shadowCascadeBias=[0,0,0];this.shadowCascadeWidth=[512,512,512];this.shadowCascadeHeight=[512,512,512];this.shadowCascadeNearZ=[-1,.99,.998];this.shadowCascadeFarZ=[.99,.998,1];this.shadowCascadeArray=[];this.shadowMatrix=this.shadowCamera=this.shadowMapSize=this.shadowMap=null};THREE.DirectionalLight.prototype=new THREE.Light;THREE.DirectionalLight.prototype.constructor=THREE.DirectionalLight;THREE.PointLight=function(e,t,i){THREE.Light.call(this,e);this.position=new THREE.Vector3(0,0,0);this.intensity=t!==void 0?t:1;this.distance=i!==void 0?i:0};THREE.PointLight.prototype=new THREE.Light;THREE.PointLight.prototype.constructor=THREE.PointLight;THREE.SpotLight=function(e,t,i,r,o){THREE.Light.call(this,e);this.position=new THREE.Vector3(0,1,0);this.target=new THREE.Object3D;this.intensity=t!==void 0?t:1;this.distance=i!==void 0?i:0;this.angle=r!==void 0?r:Math.PI/2;this.exponent=o!==void 0?o:10;this.onlyShadow=this.castShadow=false;this.shadowCameraNear=50;this.shadowCameraFar=5e3;this.shadowCameraFov=50;this.shadowCameraVisible=false;this.shadowBias=0;this.shadowDarkness=.5;this.shadowMapHeight=this.shadowMapWidth=512;this.shadowMatrix=this.shadowCamera=this.shadowMapSize=this.shadowMap=null};THREE.SpotLight.prototype=new THREE.Light;THREE.SpotLight.prototype.constructor=THREE.SpotLight;THREE.Loader=function(e){this.statusDomElement=(this.showStatus=e)?THREE.Loader.prototype.addStatusElement():null;this.onLoadStart=function(){};this.onLoadProgress=function(){};this.onLoadComplete=function(){}};THREE.Loader.prototype={constructor:THREE.Loader,crossOrigin:"anonymous",addStatusElement:function(){var e=document.createElement("div");e.style.position="absolute";e.style.right="0px";e.style.top="0px";e.style.fontSize="0.8em";e.style.textAlign="left";e.style.background="rgba(0,0,0,0.25)";e.style.color="#fff";e.style.width="120px";e.style.padding="0.5em 0.5em 0.5em 0.5em";e.style.zIndex=1e3;e.innerHTML="Loading ...";return e},updateProgress:function(e){var t="Loaded ",t=e.total?t+((100*e.loaded/e.total).toFixed(0)+"%"):t+((e.loaded/1e3).toFixed(2)+" KB");this.statusDomElement.innerHTML=t},extractUrlBase:function(e){e=e.split("/");e.pop();return(e.length<1?".":e.join("/"))+"/"},initMaterials:function(e,t,i){e.materials=[];for(var r=0;r<t.length;++r)e.materials[r]=THREE.Loader.prototype.createMaterial(t[r],i)},hasNormals:function(e){var t,i,r=e.materials.length;for(i=0;i<r;i++){t=e.materials[i];if(t instanceof THREE.ShaderMaterial)return true}return false},createMaterial:function(e,t){function i(e){e=Math.log(e)/Math.LN2;return Math.floor(e)==e}function r(e){e=Math.log(e)/Math.LN2;return Math.pow(2,Math.round(e))}function o(e,t){var o=new Image;o.onload=function(){if(!i(this.width)||!i(this.height)){var t=r(this.width),o=r(this.height);e.image.width=t;e.image.height=o;e.image.getContext("2d").drawImage(this,0,0,t,o)}else e.image=this;e.needsUpdate=true};o.crossOrigin=s.crossOrigin;o.src=t}function n(e,i,r,n,a,s){var l=document.createElement("canvas");e[i]=new THREE.Texture(l);e[i].sourceFile=r;if(n){e[i].repeat.set(n[0],n[1]);if(n[0]!=1)e[i].wrapS=THREE.RepeatWrapping;if(n[1]!=1)e[i].wrapT=THREE.RepeatWrapping}a&&e[i].offset.set(a[0],a[1]);if(s){n={repeat:THREE.RepeatWrapping,mirror:THREE.MirroredRepeatWrapping};if(n[s[0]]!==void 0)e[i].wrapS=n[s[0]];if(n[s[1]]!==void 0)e[i].wrapT=n[s[1]]}o(e[i],t+"/"+r)}function a(e){return(e[0]*255<<16)+(e[1]*255<<8)+e[2]*255}var s=this,l="MeshLambertMaterial",h={color:15658734,opacity:1,map:null,lightMap:null,normalMap:null,wireframe:e.wireframe};if(e.shading){var c=e.shading.toLowerCase();c==="phong"?l="MeshPhongMaterial":c==="basic"&&(l="MeshBasicMaterial")}if(e.blending!==void 0&&THREE[e.blending]!==void 0)h.blending=THREE[e.blending];if(e.transparent!==void 0||e.opacity<1)h.transparent=e.transparent;if(e.depthTest!==void 0)h.depthTest=e.depthTest;if(e.depthWrite!==void 0)h.depthWrite=e.depthWrite;if(e.vertexColors!==void 0)if(e.vertexColors=="face")h.vertexColors=THREE.FaceColors;else if(e.vertexColors)h.vertexColors=THREE.VertexColors;if(e.colorDiffuse)h.color=a(e.colorDiffuse);else if(e.DbgColor)h.color=e.DbgColor;if(e.colorSpecular)h.specular=a(e.colorSpecular);if(e.colorAmbient)h.ambient=a(e.colorAmbient);if(e.transparency)h.opacity=e.transparency;if(e.specularCoef)h.shininess=e.specularCoef;e.mapDiffuse&&t&&n(h,"map",e.mapDiffuse,e.mapDiffuseRepeat,e.mapDiffuseOffset,e.mapDiffuseWrap);e.mapLight&&t&&n(h,"lightMap",e.mapLight,e.mapLightRepeat,e.mapLightOffset,e.mapLightWrap);e.mapNormal&&t&&n(h,"normalMap",e.mapNormal,e.mapNormalRepeat,e.mapNormalOffset,e.mapNormalWrap);e.mapSpecular&&t&&n(h,"specularMap",e.mapSpecular,e.mapSpecularRepeat,e.mapSpecularOffset,e.mapSpecularWrap);if(e.mapNormal){l=THREE.ShaderUtils.lib.normal;c=THREE.UniformsUtils.clone(l.uniforms);c.tNormal.texture=h.normalMap;if(e.mapNormalFactor)c.uNormalScale.value=e.mapNormalFactor;if(h.map){c.tDiffuse.texture=h.map;c.enableDiffuse.value=true}if(h.specularMap){c.tSpecular.texture=h.specularMap;c.enableSpecular.value=true}if(h.lightMap){c.tAO.texture=h.lightMap;c.enableAO.value=true}c.uDiffuseColor.value.setHex(h.color);c.uSpecularColor.value.setHex(h.specular);c.uAmbientColor.value.setHex(h.ambient);c.uShininess.value=h.shininess;if(h.opacity!==void 0)c.uOpacity.value=h.opacity;h=new THREE.ShaderMaterial({fragmentShader:l.fragmentShader,vertexShader:l.vertexShader,uniforms:c,lights:true,fog:true})}else h=new THREE[l](h);if(e.DbgName!==void 0)h.name=e.DbgName;return h}};THREE.BinaryLoader=function(e){THREE.Loader.call(this,e)};THREE.BinaryLoader.prototype=new THREE.Loader;THREE.BinaryLoader.prototype.constructor=THREE.BinaryLoader;THREE.BinaryLoader.prototype.load=function(e,t,i,r){var i=i?i:this.extractUrlBase(e),r=r?r:this.extractUrlBase(e),o=this.showProgress?THREE.Loader.prototype.updateProgress:null;this.onLoadStart();this.loadAjaxJSON(this,e,t,i,r,o)};THREE.BinaryLoader.prototype.loadAjaxJSON=function(e,t,i,r,o,n){var a=new XMLHttpRequest;a.onreadystatechange=function(){if(a.readyState==4)if(a.status==200||a.status==0){var s=JSON.parse(a.responseText);e.loadAjaxBuffers(s,i,o,r,n)}else console.error("THREE.BinaryLoader: Couldn't load ["+t+"] ["+a.status+"]")};a.open("GET",t,true);a.overrideMimeType&&a.overrideMimeType("text/plain; charset=x-user-defined");a.setRequestHeader("Content-Type","text/plain");a.send(null)};THREE.BinaryLoader.prototype.loadAjaxBuffers=function(e,t,i,r,o){var n=new XMLHttpRequest,a=i+"/"+e.buffers,s=0;n.onreadystatechange=function(){if(n.readyState==4)n.status==200||n.status==0?THREE.BinaryLoader.prototype.createBinModel(n.response,t,r,e.materials):console.error("THREE.BinaryLoader: Couldn't load ["+a+"] ["+n.status+"]");else if(n.readyState==3){if(o){s==0&&(s=n.getResponseHeader("Content-Length"));o({total:s,loaded:n.responseText.length})}}else n.readyState==2&&(s=n.getResponseHeader("Content-Length"))};n.open("GET",a,true);n.responseType="arraybuffer";n.send(null)};THREE.BinaryLoader.prototype.createBinModel=function(e,t,i,r){var o=function(t){var i,o,n,a,s,l,h,c,f,u,E,p,d,m,g;function v(e){return e%4?4-e%4:0}function T(e,t){return new Uint8Array(e,t,1)[0]}function R(e,t){return new Uint32Array(e,t,1)[0]}function y(t,i){var r,o,n,a,s,l,h,c,f=new Uint32Array(e,i,3*t);for(r=0;r<t;r++){o=f[r*3];n=f[r*3+1];a=f[r*3+2];s=C[o*2];o=C[o*2+1];l=C[n*2];h=C[n*2+1];n=C[a*2];c=C[a*2+1];a=S.faceVertexUvs[0];var u=[];u.push(new THREE.UV(s,o));u.push(new THREE.UV(l,h));u.push(new THREE.UV(n,c));a.push(u)}}function x(t,i){var r,o,n,a,s,l,h,c,f,u,E=new Uint32Array(e,i,4*t);for(r=0;r<t;r++){o=E[r*4];n=E[r*4+1];a=E[r*4+2];s=E[r*4+3];l=C[o*2];o=C[o*2+1];h=C[n*2];f=C[n*2+1];c=C[a*2];u=C[a*2+1];a=C[s*2];n=C[s*2+1];s=S.faceVertexUvs[0];var p=[];p.push(new THREE.UV(l,o));p.push(new THREE.UV(h,f));p.push(new THREE.UV(c,u));p.push(new THREE.UV(a,n));s.push(p)}}function H(t,i,r){for(var o,n,a,s,i=new Uint32Array(e,i,3*t),l=new Uint16Array(e,r,t),r=0;r<t;r++){o=i[r*3];n=i[r*3+1];a=i[r*3+2];s=l[r];S.faces.push(new THREE.Face3(o,n,a,null,null,s))}}function b(t,i,r){for(var o,n,a,s,l,i=new Uint32Array(e,i,4*t),h=new Uint16Array(e,r,t),r=0;r<t;r++){o=i[r*4];n=i[r*4+1];a=i[r*4+2];s=i[r*4+3];l=h[r];S.faces.push(new THREE.Face4(o,n,a,s,null,null,l))}}function w(t,i,r,o){for(var n,a,s,l,h,c,f,i=new Uint32Array(e,i,3*t),r=new Uint32Array(e,r,3*t),u=new Uint16Array(e,o,t),o=0;o<t;o++){n=i[o*3];a=i[o*3+1];s=i[o*3+2];h=r[o*3];c=r[o*3+1];f=r[o*3+2];l=u[o];var E=A[c*3],p=A[c*3+1];c=A[c*3+2];var d=A[f*3],m=A[f*3+1];f=A[f*3+2];S.faces.push(new THREE.Face3(n,a,s,[new THREE.Vector3(A[h*3],A[h*3+1],A[h*3+2]),new THREE.Vector3(E,p,c),new THREE.Vector3(d,m,f)],null,l))}}function _(t,i,r,o){for(var n,a,s,l,h,c,f,u,E,i=new Uint32Array(e,i,4*t),r=new Uint32Array(e,r,4*t),p=new Uint16Array(e,o,t),o=0;o<t;o++){n=i[o*4];a=i[o*4+1];s=i[o*4+2];l=i[o*4+3];c=r[o*4];f=r[o*4+1];u=r[o*4+2];E=r[o*4+3];h=p[o];var d=A[f*3],m=A[f*3+1];f=A[f*3+2];var g=A[u*3],v=A[u*3+1];u=A[u*3+2];var T=A[E*3],R=A[E*3+1];E=A[E*3+2];S.faces.push(new THREE.Face4(n,a,s,l,[new THREE.Vector3(A[c*3],A[c*3+1],A[c*3+2]),new THREE.Vector3(d,m,f),new THREE.Vector3(g,v,u),new THREE.Vector3(T,R,E)],null,h))}}var S=this,M=0,A=[],C=[],L,P,F;THREE.Geometry.call(this);THREE.Loader.prototype.initMaterials(S,r,t);(function(e,t,i){for(var e=new Uint8Array(e,t,i),r="",o=0;o<i;o++)r=r+String.fromCharCode(e[t+o]);return r})(e,M,12);i=T(e,M+12);T(e,M+13);T(e,M+14);T(e,M+15);o=T(e,M+16);n=T(e,M+17);a=T(e,M+18);s=T(e,M+19);l=R(e,M+20);h=R(e,M+20+4);c=R(e,M+20+8);t=R(e,M+20+12);f=R(e,M+20+16);u=R(e,M+20+20);E=R(e,M+20+24);p=R(e,M+20+28);d=R(e,M+20+32);m=R(e,M+20+36);g=R(e,M+20+40);M=M+i;i=o*3+s;F=o*4+s;L=t*i;P=f*(i+n*3);o=u*(i+a*3);s=E*(i+n*3+a*3);i=p*F;n=d*(F+n*4);a=m*(F+a*4);M=M+function(t){var t=new Float32Array(e,t,l*3),i,r,o,n;for(i=0;i<l;i++){r=t[i*3];o=t[i*3+1];n=t[i*3+2];S.vertices.push(new THREE.Vector3(r,o,n))}return l*3*Float32Array.BYTES_PER_ELEMENT}(M);M=M+function(t){if(h){var t=new Int8Array(e,t,h*3),i,r,o,n;for(i=0;i<h;i++){r=t[i*3];o=t[i*3+1];n=t[i*3+2];A.push(r/127,o/127,n/127)}}return h*3*Int8Array.BYTES_PER_ELEMENT}(M);M=M+v(h*3);M=M+function(t){if(c){var t=new Float32Array(e,t,c*2),i,r,o;for(i=0;i<c;i++){r=t[i*2];o=t[i*2+1];C.push(r,o)}}return c*2*Float32Array.BYTES_PER_ELEMENT}(M);L=M+L+v(t*2);P=L+P+v(f*2);o=P+o+v(u*2);s=o+s+v(E*2);i=s+i+v(p*2);n=i+n+v(d*2);a=n+a+v(m*2);(function(e){if(u){var t=e+u*Uint32Array.BYTES_PER_ELEMENT*3;H(u,e,t+u*Uint32Array.BYTES_PER_ELEMENT*3);y(u,t)}})(P);(function(e){if(E){var t=e+E*Uint32Array.BYTES_PER_ELEMENT*3,i=t+E*Uint32Array.BYTES_PER_ELEMENT*3;w(E,e,t,i+E*Uint32Array.BYTES_PER_ELEMENT*3);y(E,i)}})(o);(function(e){if(m){var t=e+m*Uint32Array.BYTES_PER_ELEMENT*4;b(m,e,t+m*Uint32Array.BYTES_PER_ELEMENT*4);x(m,t)}})(n);(function(e){if(g){var t=e+g*Uint32Array.BYTES_PER_ELEMENT*4,i=t+g*Uint32Array.BYTES_PER_ELEMENT*4;_(g,e,t,i+g*Uint32Array.BYTES_PER_ELEMENT*4);x(g,i)}})(a);t&&H(t,M,M+t*Uint32Array.BYTES_PER_ELEMENT*3);(function(e){if(f){var t=e+f*Uint32Array.BYTES_PER_ELEMENT*3;w(f,e,t,t+f*Uint32Array.BYTES_PER_ELEMENT*3)}})(L);p&&b(p,s,s+p*Uint32Array.BYTES_PER_ELEMENT*4);(function(e){if(d){var t=e+d*Uint32Array.BYTES_PER_ELEMENT*4;_(d,e,t,t+d*Uint32Array.BYTES_PER_ELEMENT*4)}})(i);this.computeCentroids();this.computeFaceNormals();THREE.Loader.prototype.hasNormals(this)&&this.computeTangents()};o.prototype=new THREE.Geometry;o.prototype.constructor=o;t(new o(i))};THREE.JSONLoader=function(e){THREE.Loader.call(this,e)};THREE.JSONLoader.prototype=new THREE.Loader;THREE.JSONLoader.prototype.constructor=THREE.JSONLoader;THREE.JSONLoader.prototype.load=function(e,t,i){i=i?i:this.extractUrlBase(e);this.onLoadStart();this.loadAjaxJSON(this,e,t,i)};THREE.JSONLoader.prototype.loadAjaxJSON=function(e,t,i,r,o){var n=new XMLHttpRequest,a=0;n.onreadystatechange=function(){if(n.readyState===n.DONE)if(n.status===200||n.status===0){if(n.responseText){var s=JSON.parse(n.responseText);
e.createModel(s,i,r)}else console.warn("THREE.JSONLoader: ["+t+"] seems to be unreachable or file there is empty");e.onLoadComplete()}else console.error("THREE.JSONLoader: Couldn't load ["+t+"] ["+n.status+"]");else if(n.readyState===n.LOADING){if(o){a===0&&(a=n.getResponseHeader("Content-Length"));o({total:a,loaded:n.responseText.length})}}else n.readyState===n.HEADERS_RECEIVED&&(a=n.getResponseHeader("Content-Length"))};n.open("GET",t,true);n.overrideMimeType&&n.overrideMimeType("text/plain; charset=x-user-defined");n.setRequestHeader("Content-Type","text/plain");n.send(null)};THREE.JSONLoader.prototype.createModel=function(e,t,i){var r=new THREE.Geometry,o=e.scale!==void 0?1/e.scale:1;this.initMaterials(r,e.materials,i);(function(t){var i,o,n,a,s,l,h,c,f,u,E,p,d,m,g=e.faces;l=e.vertices;var v=e.normals,T=e.colors,R=0;for(i=0;i<e.uvs.length;i++)e.uvs[i].length&&R++;for(i=0;i<R;i++){r.faceUvs[i]=[];r.faceVertexUvs[i]=[]}a=0;for(s=l.length;a<s;){h=new THREE.Vector3;h.x=l[a++]*t;h.y=l[a++]*t;h.z=l[a++]*t;r.vertices.push(h)}a=0;for(s=g.length;a<s;){t=g[a++];l=t&1;n=t&2;i=t&4;o=t&8;c=t&16;h=t&32;u=t&64;t=t&128;if(l){E=new THREE.Face4;E.a=g[a++];E.b=g[a++];E.c=g[a++];E.d=g[a++];l=4}else{E=new THREE.Face3;E.a=g[a++];E.b=g[a++];E.c=g[a++];l=3}if(n){n=g[a++];E.materialIndex=n}n=r.faces.length;if(i)for(i=0;i<R;i++){p=e.uvs[i];f=g[a++];m=p[f*2];f=p[f*2+1];r.faceUvs[i][n]=new THREE.UV(m,f)}if(o)for(i=0;i<R;i++){p=e.uvs[i];d=[];for(o=0;o<l;o++){f=g[a++];m=p[f*2];f=p[f*2+1];d[o]=new THREE.UV(m,f)}r.faceVertexUvs[i][n]=d}if(c){c=g[a++]*3;o=new THREE.Vector3;o.x=v[c++];o.y=v[c++];o.z=v[c];E.normal=o}if(h)for(i=0;i<l;i++){c=g[a++]*3;o=new THREE.Vector3;o.x=v[c++];o.y=v[c++];o.z=v[c];E.vertexNormals.push(o)}if(u){h=g[a++];h=new THREE.Color(T[h]);E.color=h}if(t)for(i=0;i<l;i++){h=g[a++];h=new THREE.Color(T[h]);E.vertexColors.push(h)}r.faces.push(E)}})(o);(function(){var t,i,o,n;if(e.skinWeights){t=0;for(i=e.skinWeights.length;t<i;t=t+2){o=e.skinWeights[t];n=e.skinWeights[t+1];r.skinWeights.push(new THREE.Vector4(o,n,0,0))}}if(e.skinIndices){t=0;for(i=e.skinIndices.length;t<i;t=t+2){o=e.skinIndices[t];n=e.skinIndices[t+1];r.skinIndices.push(new THREE.Vector4(o,n,0,0))}}r.bones=e.bones;r.animation=e.animation})();(function(t){if(e.morphTargets!==void 0){var i,o,n,a,s,l;i=0;for(o=e.morphTargets.length;i<o;i++){r.morphTargets[i]={};r.morphTargets[i].name=e.morphTargets[i].name;r.morphTargets[i].vertices=[];s=r.morphTargets[i].vertices;l=e.morphTargets[i].vertices;n=0;for(a=l.length;n<a;n=n+3){var h=new THREE.Vector3;h.x=l[n]*t;h.y=l[n+1]*t;h.z=l[n+2]*t;s.push(h)}}}if(e.morphColors!==void 0){i=0;for(o=e.morphColors.length;i<o;i++){r.morphColors[i]={};r.morphColors[i].name=e.morphColors[i].name;r.morphColors[i].colors=[];a=r.morphColors[i].colors;s=e.morphColors[i].colors;t=0;for(n=s.length;t<n;t=t+3){l=new THREE.Color(16755200);l.setRGB(s[t],s[t+1],s[t+2]);a.push(l)}}}})(o);r.computeCentroids();r.computeFaceNormals();this.hasNormals(r)&&r.computeTangents();t(r)};THREE.SceneLoader=function(){this.onLoadStart=function(){};this.onLoadProgress=function(){};this.onLoadComplete=function(){};this.callbackSync=function(){};this.callbackProgress=function(){}};THREE.SceneLoader.prototype.constructor=THREE.SceneLoader;THREE.SceneLoader.prototype.load=function(e,t){var i=this,r=new XMLHttpRequest;r.onreadystatechange=function(){if(r.readyState==4)if(r.status==200||r.status==0){var o=JSON.parse(r.responseText);i.createScene(o,t,e)}else console.error("THREE.SceneLoader: Couldn't load ["+e+"] ["+r.status+"]")};r.open("GET",e,true);r.overrideMimeType&&r.overrideMimeType("text/plain; charset=x-user-defined");r.setRequestHeader("Content-Type","text/plain");r.send(null)};THREE.SceneLoader.prototype.createScene=function(e,t,i){function r(e,t){return t=="relativeToHTML"?e:h+"/"+e}function o(){var e;for(u in L.objects)if(!B.objects[u]){g=L.objects[u];if(g.geometry!==void 0){if(S=B.geometries[g.geometry]){e=false;M=B.materials[g.materials[0]];(e=M instanceof THREE.ShaderMaterial)&&S.computeTangents();y=g.position;x=g.rotation;H=g.quaternion;b=g.scale;v=g.matrix;H=0;g.materials.length==0&&(M=new THREE.MeshFaceMaterial);g.materials.length>1&&(M=new THREE.MeshFaceMaterial);e=new THREE.Mesh(S,M);e.name=u;if(v){e.matrixAutoUpdate=false;e.matrix.set(v[0],v[1],v[2],v[3],v[4],v[5],v[6],v[7],v[8],v[9],v[10],v[11],v[12],v[13],v[14],v[15])}else{e.position.set(y[0],y[1],y[2]);if(H){e.quaternion.set(H[0],H[1],H[2],H[3]);e.useQuaternion=true}else e.rotation.set(x[0],x[1],x[2]);e.scale.set(b[0],b[1],b[2])}e.visible=g.visible;e.doubleSided=g.doubleSided;e.castShadow=g.castShadow;e.receiveShadow=g.receiveShadow;B.scene.add(e);B.objects[u]=e}}else{y=g.position;x=g.rotation;H=g.quaternion;b=g.scale;H=0;e=new THREE.Object3D;e.name=u;e.position.set(y[0],y[1],y[2]);if(H){e.quaternion.set(H[0],H[1],H[2],H[3]);e.useQuaternion=true}else e.rotation.set(x[0],x[1],x[2]);e.scale.set(b[0],b[1],b[2]);e.visible=g.visible!==void 0?g.visible:false;B.scene.add(e);B.objects[u]=e;B.empties[u]=e}}}function n(e){return function(t){B.geometries[e]=t;o();F=F-1;l.onLoadComplete();s()}}function a(e){return function(t){B.geometries[e]=t}}function s(){l.callbackProgress({totalModels:D,totalTextures:V,loadedModels:D-F,loadedTextures:V-U},B);l.onLoadProgress();F==0&&U==0&&t(B)}var l=this,h=THREE.Loader.prototype.extractUrlBase(i),c,f,u,E,p,d,m,g,v,T,R,y,x,H,b,w,_,S,M,A,C,L,P,F,U,D,V,B;L=e;i=new THREE.BinaryLoader;P=new THREE.JSONLoader;U=F=0;B={scene:new THREE.Scene,geometries:{},materials:{},textures:{},objects:{},cameras:{},lights:{},fogs:{},empties:{}};if(L.transform){e=L.transform.position;T=L.transform.rotation;w=L.transform.scale;e&&B.scene.position.set(e[0],e[1],e[2]);T&&B.scene.rotation.set(T[0],T[1],T[2]);w&&B.scene.scale.set(w[0],w[1],w[2]);if(e||T||w){B.scene.updateMatrix();B.scene.updateMatrixWorld()}}e=function(){U=U-1;s();l.onLoadComplete()};for(p in L.cameras){w=L.cameras[p];w.type=="perspective"?A=new THREE.PerspectiveCamera(w.fov,w.aspect,w.near,w.far):w.type=="ortho"&&(A=new THREE.OrthographicCamera(w.left,w.right,w.top,w.bottom,w.near,w.far));y=w.position;T=w.target;w=w.up;A.position.set(y[0],y[1],y[2]);A.target=new THREE.Vector3(T[0],T[1],T[2]);w&&A.up.set(w[0],w[1],w[2]);B.cameras[p]=A}for(E in L.lights){T=L.lights[E];p=T.color!==void 0?T.color:16777215;A=T.intensity!==void 0?T.intensity:1;if(T.type=="directional"){y=T.direction;R=new THREE.DirectionalLight(p,A);R.position.set(y[0],y[1],y[2]);R.position.normalize()}else if(T.type=="point"){y=T.position;R=T.distance;R=new THREE.PointLight(p,A,R);R.position.set(y[0],y[1],y[2])}else T.type=="ambient"&&(R=new THREE.AmbientLight(p));B.scene.add(R);B.lights[E]=R}for(d in L.fogs){E=L.fogs[d];E.type=="linear"?C=new THREE.Fog(0,E.near,E.far):E.type=="exp2"&&(C=new THREE.FogExp2(0,E.density));w=E.color;C.color.setRGB(w[0],w[1],w[2]);B.fogs[d]=C}if(B.cameras&&L.defaults.camera)B.currentCamera=B.cameras[L.defaults.camera];if(B.fogs&&L.defaults.fog)B.scene.fog=B.fogs[L.defaults.fog];w=L.defaults.bgcolor;B.bgColor=new THREE.Color;B.bgColor.setRGB(w[0],w[1],w[2]);B.bgColorAlpha=L.defaults.bgalpha;for(c in L.geometries){d=L.geometries[c];if(d.type=="bin_mesh"||d.type=="ascii_mesh"){F=F+1;l.onLoadStart()}}D=F;for(c in L.geometries){d=L.geometries[c];if(d.type=="cube"){S=new THREE.CubeGeometry(d.width,d.height,d.depth,d.segmentsWidth,d.segmentsHeight,d.segmentsDepth,null,d.flipped,d.sides);B.geometries[c]=S}else if(d.type=="plane"){S=new THREE.PlaneGeometry(d.width,d.height,d.segmentsWidth,d.segmentsHeight);B.geometries[c]=S}else if(d.type=="sphere"){S=new THREE.SphereGeometry(d.radius,d.segmentsWidth,d.segmentsHeight);B.geometries[c]=S}else if(d.type=="cylinder"){S=new THREE.CylinderGeometry(d.topRad,d.botRad,d.height,d.radSegs,d.heightSegs);B.geometries[c]=S}else if(d.type=="torus"){S=new THREE.TorusGeometry(d.radius,d.tube,d.segmentsR,d.segmentsT);B.geometries[c]=S}else if(d.type=="icosahedron"){S=new THREE.IcosahedronGeometry(d.radius,d.subdivisions);B.geometries[c]=S}else if(d.type=="bin_mesh")i.load(r(d.url,L.urlBaseType),n(c));else if(d.type=="ascii_mesh")P.load(r(d.url,L.urlBaseType),n(c));else if(d.type=="embedded_mesh"){d=L.embeds[d.id];d.metadata=L.metadata;d&&P.createModel(d,a(c),"")}}for(m in L.textures){c=L.textures[m];if(c.url instanceof Array){U=U+c.url.length;for(d=0;d<c.url.length;d++)l.onLoadStart()}else{U=U+1;l.onLoadStart()}}V=U;for(m in L.textures){c=L.textures[m];if(c.mapping!=void 0&&THREE[c.mapping]!=void 0)c.mapping=new THREE[c.mapping];if(c.url instanceof Array){d=[];for(C=0;C<c.url.length;C++)d[C]=r(c.url[C],L.urlBaseType);d=THREE.ImageUtils.loadTextureCube(d,c.mapping,e)}else{d=THREE.ImageUtils.loadTexture(r(c.url,L.urlBaseType),c.mapping,e);if(THREE[c.minFilter]!=void 0)d.minFilter=THREE[c.minFilter];if(THREE[c.magFilter]!=void 0)d.magFilter=THREE[c.magFilter];if(c.repeat){d.repeat.set(c.repeat[0],c.repeat[1]);if(c.repeat[0]!=1)d.wrapS=THREE.RepeatWrapping;if(c.repeat[1]!=1)d.wrapT=THREE.RepeatWrapping}c.offset&&d.offset.set(c.offset[0],c.offset[1]);if(c.wrap){C={repeat:THREE.RepeatWrapping,mirror:THREE.MirroredRepeatWrapping};if(C[c.wrap[0]]!==void 0)d.wrapS=C[c.wrap[0]];if(C[c.wrap[1]]!==void 0)d.wrapT=C[c.wrap[1]]}}B.textures[m]=d}for(f in L.materials){v=L.materials[f];for(_ in v.parameters)if(_=="envMap"||_=="map"||_=="lightMap")v.parameters[_]=B.textures[v.parameters[_]];else if(_=="shading")v.parameters[_]=v.parameters[_]=="flat"?THREE.FlatShading:THREE.SmoothShading;else if(_=="blending")v.parameters[_]=THREE[v.parameters[_]]?THREE[v.parameters[_]]:THREE.NormalBlending;else if(_=="combine")v.parameters[_]=v.parameters[_]=="MixOperation"?THREE.MixOperation:THREE.MultiplyOperation;else if(_=="vertexColors")if(v.parameters[_]=="face")v.parameters[_]=THREE.FaceColors;else if(v.parameters[_])v.parameters[_]=THREE.VertexColors;if(v.parameters.opacity!==void 0&&v.parameters.opacity<1)v.parameters.transparent=true;if(v.parameters.normalMap){m=THREE.ShaderUtils.lib.normal;e=THREE.UniformsUtils.clone(m.uniforms);c=v.parameters.color;d=v.parameters.specular;C=v.parameters.ambient;i=v.parameters.shininess;e.tNormal.texture=B.textures[v.parameters.normalMap];if(v.parameters.normalMapFactor)e.uNormalScale.value=v.parameters.normalMapFactor;if(v.parameters.map){e.tDiffuse.texture=v.parameters.map;e.enableDiffuse.value=true}if(v.parameters.lightMap){e.tAO.texture=v.parameters.lightMap;e.enableAO.value=true}if(v.parameters.specularMap){e.tSpecular.texture=B.textures[v.parameters.specularMap];e.enableSpecular.value=true}e.uDiffuseColor.value.setHex(c);e.uSpecularColor.value.setHex(d);e.uAmbientColor.value.setHex(C);e.uShininess.value=i;if(v.parameters.opacity)e.uOpacity.value=v.parameters.opacity;M=new THREE.ShaderMaterial({fragmentShader:m.fragmentShader,vertexShader:m.vertexShader,uniforms:e,lights:true,fog:true})}else M=new THREE[v.type](v.parameters);B.materials[f]=M}o();l.callbackSync(B);s()};THREE.Material=function(e){e=e||{};this.id=THREE.MaterialCount++;this.name="";this.opacity=e.opacity!==void 0?e.opacity:1;this.transparent=e.transparent!==void 0?e.transparent:false;this.blending=e.blending!==void 0?e.blending:THREE.NormalBlending;this.blendSrc=e.blendSrc!==void 0?e.blendSrc:THREE.SrcAlphaFactor;this.blendDst=e.blendDst!==void 0?e.blendDst:THREE.OneMinusSrcAlphaFactor;this.blendEquation=e.blendEquation!==void 0?e.blendEquation:THREE.AddEquation;this.depthTest=e.depthTest!==void 0?e.depthTest:true;this.depthWrite=e.depthWrite!==void 0?e.depthWrite:true;this.polygonOffset=e.polygonOffset!==void 0?e.polygonOffset:false;this.polygonOffsetFactor=e.polygonOffsetFactor!==void 0?e.polygonOffsetFactor:0;this.polygonOffsetUnits=e.polygonOffsetUnits!==void 0?e.polygonOffsetUnits:0;this.alphaTest=e.alphaTest!==void 0?e.alphaTest:0;this.overdraw=e.overdraw!==void 0?e.overdraw:false;this.needsUpdate=this.visible=true};THREE.MaterialCount=0;THREE.NoShading=0;THREE.FlatShading=1;THREE.SmoothShading=2;THREE.NoColors=0;THREE.FaceColors=1;THREE.VertexColors=2;THREE.NoBlending=0;THREE.NormalBlending=1;THREE.AdditiveBlending=2;THREE.SubtractiveBlending=3;THREE.MultiplyBlending=4;THREE.AdditiveAlphaBlending=5;THREE.CustomBlending=6;THREE.AddEquation=100;THREE.SubtractEquation=101;THREE.ReverseSubtractEquation=102;THREE.ZeroFactor=200;THREE.OneFactor=201;THREE.SrcColorFactor=202;THREE.OneMinusSrcColorFactor=203;THREE.SrcAlphaFactor=204;THREE.OneMinusSrcAlphaFactor=205;THREE.DstAlphaFactor=206;THREE.OneMinusDstAlphaFactor=207;THREE.DstColorFactor=208;THREE.OneMinusDstColorFactor=209;THREE.SrcAlphaSaturateFactor=210;THREE.LineBasicMaterial=function(e){THREE.Material.call(this,e);e=e||{};this.color=e.color!==void 0?new THREE.Color(e.color):new THREE.Color(16777215);this.linewidth=e.linewidth!==void 0?e.linewidth:1;this.linecap=e.linecap!==void 0?e.linecap:"round";this.linejoin=e.linejoin!==void 0?e.linejoin:"round";this.vertexColors=e.vertexColors?e.vertexColors:false;this.fog=e.fog!==void 0?e.fog:true};THREE.LineBasicMaterial.prototype=new THREE.Material;THREE.LineBasicMaterial.prototype.constructor=THREE.LineBasicMaterial;THREE.MeshBasicMaterial=function(e){THREE.Material.call(this,e);e=e||{};this.color=e.color!==void 0?new THREE.Color(e.color):new THREE.Color(16777215);this.map=e.map!==void 0?e.map:null;this.lightMap=e.lightMap!==void 0?e.lightMap:null;this.envMap=e.envMap!==void 0?e.envMap:null;this.combine=e.combine!==void 0?e.combine:THREE.MultiplyOperation;this.reflectivity=e.reflectivity!==void 0?e.reflectivity:1;this.refractionRatio=e.refractionRatio!==void 0?e.refractionRatio:.98;this.fog=e.fog!==void 0?e.fog:true;this.shading=e.shading!==void 0?e.shading:THREE.SmoothShading;this.wireframe=e.wireframe!==void 0?e.wireframe:false;this.wireframeLinewidth=e.wireframeLinewidth!==void 0?e.wireframeLinewidth:1;this.wireframeLinecap=e.wireframeLinecap!==void 0?e.wireframeLinecap:"round";this.wireframeLinejoin=e.wireframeLinejoin!==void 0?e.wireframeLinejoin:"round";this.vertexColors=e.vertexColors!==void 0?e.vertexColors:THREE.NoColors;this.skinning=e.skinning!==void 0?e.skinning:false;this.morphTargets=e.morphTargets!==void 0?e.morphTargets:false};THREE.MeshBasicMaterial.prototype=new THREE.Material;THREE.MeshBasicMaterial.prototype.constructor=THREE.MeshBasicMaterial;THREE.MeshLambertMaterial=function(e){THREE.Material.call(this,e);e=e||{};this.color=e.color!==void 0?new THREE.Color(e.color):new THREE.Color(16777215);this.ambient=e.ambient!==void 0?new THREE.Color(e.ambient):new THREE.Color(16777215);this.emissive=e.emissive!==void 0?new THREE.Color(e.emissive):new THREE.Color(0);this.wrapAround=e.wrapAround!==void 0?e.wrapAround:false;this.wrapRGB=new THREE.Vector3(1,1,1);this.map=e.map!==void 0?e.map:null;this.lightMap=e.lightMap!==void 0?e.lightMap:null;this.envMap=e.envMap!==void 0?e.envMap:null;this.combine=e.combine!==void 0?e.combine:THREE.MultiplyOperation;this.reflectivity=e.reflectivity!==void 0?e.reflectivity:1;this.refractionRatio=e.refractionRatio!==void 0?e.refractionRatio:.98;this.fog=e.fog!==void 0?e.fog:true;this.shading=e.shading!==void 0?e.shading:THREE.SmoothShading;this.wireframe=e.wireframe!==void 0?e.wireframe:false;this.wireframeLinewidth=e.wireframeLinewidth!==void 0?e.wireframeLinewidth:1;this.wireframeLinecap=e.wireframeLinecap!==void 0?e.wireframeLinecap:"round";this.wireframeLinejoin=e.wireframeLinejoin!==void 0?e.wireframeLinejoin:"round";this.vertexColors=e.vertexColors!==void 0?e.vertexColors:THREE.NoColors;this.skinning=e.skinning!==void 0?e.skinning:false;this.morphTargets=e.morphTargets!==void 0?e.morphTargets:false;this.morphNormals=e.morphNormals!==void 0?e.morphNormals:false};THREE.MeshLambertMaterial.prototype=new THREE.Material;THREE.MeshLambertMaterial.prototype.constructor=THREE.MeshLambertMaterial;THREE.MeshPhongMaterial=function(e){THREE.Material.call(this,e);e=e||{};this.color=e.color!==void 0?new THREE.Color(e.color):new THREE.Color(16777215);this.ambient=e.ambient!==void 0?new THREE.Color(e.ambient):new THREE.Color(16777215);this.emissive=e.emissive!==void 0?new THREE.Color(e.emissive):new THREE.Color(0);this.specular=e.specular!==void 0?new THREE.Color(e.specular):new THREE.Color(1118481);this.shininess=e.shininess!==void 0?e.shininess:30;this.metal=e.metal!==void 0?e.metal:false;this.perPixel=e.perPixel!==void 0?e.perPixel:false;this.wrapAround=e.wrapAround!==void 0?e.wrapAround:false;this.wrapRGB=new THREE.Vector3(1,1,1);this.map=e.map!==void 0?e.map:null;this.lightMap=e.lightMap!==void 0?e.lightMap:null;this.envMap=e.envMap!==void 0?e.envMap:null;this.combine=e.combine!==void 0?e.combine:THREE.MultiplyOperation;this.reflectivity=e.reflectivity!==void 0?e.reflectivity:1;this.refractionRatio=e.refractionRatio!==void 0?e.refractionRatio:.98;this.fog=e.fog!==void 0?e.fog:true;this.shading=e.shading!==void 0?e.shading:THREE.SmoothShading;this.wireframe=e.wireframe!==void 0?e.wireframe:false;this.wireframeLinewidth=e.wireframeLinewidth!==void 0?e.wireframeLinewidth:1;this.wireframeLinecap=e.wireframeLinecap!==void 0?e.wireframeLinecap:"round";this.wireframeLinejoin=e.wireframeLinejoin!==void 0?e.wireframeLinejoin:"round";this.vertexColors=e.vertexColors!==void 0?e.vertexColors:THREE.NoColors;this.skinning=e.skinning!==void 0?e.skinning:false;this.morphTargets=e.morphTargets!==void 0?e.morphTargets:false;this.morphNormals=e.morphNormals!==void 0?e.morphNormals:false};THREE.MeshPhongMaterial.prototype=new THREE.Material;THREE.MeshPhongMaterial.prototype.constructor=THREE.MeshPhongMaterial;THREE.MeshDepthMaterial=function(e){THREE.Material.call(this,e);e=e||{};this.shading=e.shading!==void 0?e.shading:THREE.SmoothShading;this.wireframe=e.wireframe!==void 0?e.wireframe:false;this.wireframeLinewidth=e.wireframeLinewidth!==void 0?e.wireframeLinewidth:1};THREE.MeshDepthMaterial.prototype=new THREE.Material;THREE.MeshDepthMaterial.prototype.constructor=THREE.MeshDepthMaterial;THREE.MeshNormalMaterial=function(e){THREE.Material.call(this,e);e=e||{};this.shading=e.shading?e.shading:THREE.FlatShading;this.wireframe=e.wireframe?e.wireframe:false;this.wireframeLinewidth=e.wireframeLinewidth?e.wireframeLinewidth:1};THREE.MeshNormalMaterial.prototype=new THREE.Material;THREE.MeshNormalMaterial.prototype.constructor=THREE.MeshNormalMaterial;THREE.MeshFaceMaterial=function(){};THREE.ParticleBasicMaterial=function(e){THREE.Material.call(this,e);e=e||{};this.color=e.color!==void 0?new THREE.Color(e.color):new THREE.Color(16777215);this.map=e.map!==void 0?e.map:null;this.size=e.size!==void 0?e.size:1;this.sizeAttenuation=e.sizeAttenuation!==void 0?e.sizeAttenuation:true;this.vertexColors=e.vertexColors!==void 0?e.vertexColors:false;this.fog=e.fog!==void 0?e.fog:true};THREE.ParticleBasicMaterial.prototype=new THREE.Material;THREE.ParticleBasicMaterial.prototype.constructor=THREE.ParticleBasicMaterial;THREE.ParticleCanvasMaterial=function(e){THREE.Material.call(this,e);e=e||{};this.color=e.color!==void 0?new THREE.Color(e.color):new THREE.Color(16777215);this.program=e.program!==void 0?e.program:function(){}};THREE.ParticleCanvasMaterial.prototype=new THREE.Material;THREE.ParticleCanvasMaterial.prototype.constructor=THREE.ParticleCanvasMaterial;THREE.ParticleDOMMaterial=function(e){THREE.Material.call(this);this.domElement=e};THREE.ShaderMaterial=function(e){THREE.Material.call(this,e);e=e||{};this.fragmentShader=e.fragmentShader!==void 0?e.fragmentShader:"void main() {}";this.vertexShader=e.vertexShader!==void 0?e.vertexShader:"void main() {}";this.uniforms=e.uniforms!==void 0?e.uniforms:{};this.attributes=e.attributes;this.shading=e.shading!==void 0?e.shading:THREE.SmoothShading;this.wireframe=e.wireframe!==void 0?e.wireframe:false;this.wireframeLinewidth=e.wireframeLinewidth!==void 0?e.wireframeLinewidth:1;this.fog=e.fog!==void 0?e.fog:false;this.lights=e.lights!==void 0?e.lights:false;this.vertexColors=e.vertexColors!==void 0?e.vertexColors:THREE.NoColors;this.skinning=e.skinning!==void 0?e.skinning:false;this.morphTargets=e.morphTargets!==void 0?e.morphTargets:false;this.morphNormals=e.morphNormals!==void 0?e.morphNormals:false};THREE.ShaderMaterial.prototype=new THREE.Material;THREE.ShaderMaterial.prototype.constructor=THREE.ShaderMaterial;THREE.Texture=function(e,t,i,r,o,n,a,s){this.id=THREE.TextureCount++;this.image=e;this.mapping=t!==void 0?t:new THREE.UVMapping;this.wrapS=i!==void 0?i:THREE.ClampToEdgeWrapping;this.wrapT=r!==void 0?r:THREE.ClampToEdgeWrapping;this.magFilter=o!==void 0?o:THREE.LinearFilter;this.minFilter=n!==void 0?n:THREE.LinearMipMapLinearFilter;this.format=a!==void 0?a:THREE.RGBAFormat;this.type=s!==void 0?s:THREE.UnsignedByteType;this.offset=new THREE.Vector2(0,0);this.repeat=new THREE.Vector2(1,1);this.generateMipmaps=true;this.needsUpdate=this.premultiplyAlpha=false;this.onUpdate=null};THREE.Texture.prototype={constructor:THREE.Texture,clone:function(){var e=new THREE.Texture(this.image,this.mapping,this.wrapS,this.wrapT,this.magFilter,this.minFilter,this.format,this.type);e.offset.copy(this.offset);e.repeat.copy(this.repeat);return e}};THREE.TextureCount=0;THREE.MultiplyOperation=0;THREE.MixOperation=1;THREE.UVMapping=function(){};THREE.CubeReflectionMapping=function(){};THREE.CubeRefractionMapping=function(){};THREE.SphericalReflectionMapping=function(){};THREE.SphericalRefractionMapping=function(){};THREE.RepeatWrapping=0;THREE.ClampToEdgeWrapping=1;THREE.MirroredRepeatWrapping=2;THREE.NearestFilter=3;THREE.NearestMipMapNearestFilter=4;THREE.NearestMipMapLinearFilter=5;THREE.LinearFilter=6;THREE.LinearMipMapNearestFilter=7;THREE.LinearMipMapLinearFilter=8;THREE.ByteType=9;THREE.UnsignedByteType=10;THREE.ShortType=11;THREE.UnsignedShortType=12;THREE.IntType=13;THREE.UnsignedIntType=14;THREE.FloatType=15;THREE.AlphaFormat=16;THREE.RGBFormat=17;THREE.RGBAFormat=18;THREE.LuminanceFormat=19;THREE.LuminanceAlphaFormat=20;THREE.DataTexture=function(e,t,i,r,o,n,a,s,l,h){THREE.Texture.call(this,null,n,a,s,l,h,r,o);this.image={data:e,width:t,height:i}};THREE.DataTexture.prototype=new THREE.Texture;THREE.DataTexture.prototype.constructor=THREE.DataTexture;THREE.DataTexture.prototype.clone=function(){var e=new THREE.DataTexture(this.image.data,this.image.width,this.image.height,this.format,this.type,this.mapping,this.wrapS,this.wrapT,this.magFilter,this.minFilter);e.offset.copy(this.offset);e.repeat.copy(this.repeat);return e};THREE.Particle=function(e){THREE.Object3D.call(this);this.material=e};THREE.Particle.prototype=new THREE.Object3D;THREE.Particle.prototype.constructor=THREE.Particle;THREE.ParticleSystem=function(e,t){THREE.Object3D.call(this);this.geometry=e;this.material=t!==void 0?t:new THREE.ParticleBasicMaterial({color:Math.random()*16777215});this.sortParticles=false;if(this.geometry){this.geometry.boundingSphere||this.geometry.computeBoundingSphere();this.boundRadius=e.boundingSphere.radius}this.frustumCulled=false};THREE.ParticleSystem.prototype=new THREE.Object3D;THREE.ParticleSystem.prototype.constructor=THREE.ParticleSystem;THREE.Line=function(e,t,i){THREE.Object3D.call(this);this.geometry=e;this.material=t!==void 0?t:new THREE.LineBasicMaterial({color:Math.random()*16777215});this.type=i!==void 0?i:THREE.LineStrip;this.geometry&&(this.geometry.boundingSphere||this.geometry.computeBoundingSphere())};THREE.LineStrip=0;THREE.LinePieces=1;THREE.Line.prototype=new THREE.Object3D;THREE.Line.prototype.constructor=THREE.Line;THREE.Mesh=function(e,t){THREE.Object3D.call(this);this.geometry=e;this.material=t!==void 0?t:new THREE.MeshBasicMaterial({color:Math.random()*16777215,wireframe:true});if(this.geometry){this.geometry.boundingSphere||this.geometry.computeBoundingSphere();this.boundRadius=e.boundingSphere.radius;if(this.geometry.morphTargets.length){this.morphTargetBase=-1;this.morphTargetForcedOrder=[];this.morphTargetInfluences=[];this.morphTargetDictionary={};for(var i=0;i<this.geometry.morphTargets.length;i++){this.morphTargetInfluences.push(0);this.morphTargetDictionary[this.geometry.morphTargets[i].name]=i}}}};THREE.Mesh.prototype=new THREE.Object3D;THREE.Mesh.prototype.constructor=THREE.Mesh;THREE.Mesh.prototype.supr=THREE.Object3D.prototype;THREE.Mesh.prototype.getMorphTargetIndexByName=function(e){if(this.morphTargetDictionary[e]!==void 0)return this.morphTargetDictionary[e];console.log("THREE.Mesh.getMorphTargetIndexByName: morph target "+e+" does not exist. Returning 0.");return 0};THREE.Bone=function(e){THREE.Object3D.call(this);this.skin=e;this.skinMatrix=new THREE.Matrix4};THREE.Bone.prototype=new THREE.Object3D;THREE.Bone.prototype.constructor=THREE.Bone;THREE.Bone.prototype.supr=THREE.Object3D.prototype;THREE.Bone.prototype.update=function(e,t){this.matrixAutoUpdate&&(t=t|this.updateMatrix());if(t||this.matrixWorldNeedsUpdate){e?this.skinMatrix.multiply(e,this.matrix):this.skinMatrix.copy(this.matrix);this.matrixWorldNeedsUpdate=false;t=true}var i,r=this.children.length;for(i=0;i<r;i++)this.children[i].update(this.skinMatrix,t)};THREE.SkinnedMesh=function(e,t){THREE.Mesh.call(this,e,t);this.identityMatrix=new THREE.Matrix4;this.bones=[];this.boneMatrices=[];var i,r,o,n,a,s;if(this.geometry.bones!==void 0){for(i=0;i<this.geometry.bones.length;i++){o=this.geometry.bones[i];n=o.pos;a=o.rotq;s=o.scl;r=this.addBone();r.name=o.name;r.position.set(n[0],n[1],n[2]);r.quaternion.set(a[0],a[1],a[2],a[3]);r.useQuaternion=true;s!==void 0?r.scale.set(s[0],s[1],s[2]):r.scale.set(1,1,1)}for(i=0;i<this.bones.length;i++){o=this.geometry.bones[i];r=this.bones[i];o.parent===-1?this.add(r):this.bones[o.parent].add(r)}this.boneMatrices=new Float32Array(16*this.bones.length);this.pose()}};THREE.SkinnedMesh.prototype=new THREE.Mesh;THREE.SkinnedMesh.prototype.constructor=THREE.SkinnedMesh;THREE.SkinnedMesh.prototype.addBone=function(e){e===void 0&&(e=new THREE.Bone(this));this.bones.push(e);return e};THREE.SkinnedMesh.prototype.updateMatrixWorld=function(e){this.matrixAutoUpdate&&this.updateMatrix();if(this.matrixWorldNeedsUpdate||e){this.parent?this.matrixWorld.multiply(this.parent.matrixWorld,this.matrix):this.matrixWorld.copy(this.matrix);this.matrixWorldNeedsUpdate=false}for(var e=0,t=this.children.length;e<t;e++){var i=this.children[e];i instanceof THREE.Bone?i.update(this.identityMatrix,false):i.updateMatrixWorld(true)}for(var t=this.bones.length,i=this.bones,r=this.boneMatrices,e=0;e<t;e++)i[e].skinMatrix.flattenToArrayOffset(r,e*16)};THREE.SkinnedMesh.prototype.pose=function(){this.updateMatrixWorld(true);for(var e,t=[],i=0;i<this.bones.length;i++){e=this.bones[i];var r=new THREE.Matrix4;r.getInverse(e.skinMatrix);t.push(r);e.skinMatrix.flattenToArrayOffset(this.boneMatrices,i*16)}if(this.geometry.skinVerticesA===void 0){this.geometry.skinVerticesA=[];this.geometry.skinVerticesB=[];for(e=0;e<this.geometry.skinIndices.length;e++){var i=this.geometry.vertices[e],o=this.geometry.skinIndices[e].x,n=this.geometry.skinIndices[e].y,r=new THREE.Vector3(i.x,i.y,i.z);this.geometry.skinVerticesA.push(t[o].multiplyVector3(r));r=new THREE.Vector3(i.x,i.y,i.z);this.geometry.skinVerticesB.push(t[n].multiplyVector3(r));if(this.geometry.skinWeights[e].x+this.geometry.skinWeights[e].y!==1){i=(1-(this.geometry.skinWeights[e].x+this.geometry.skinWeights[e].y))*.5;this.geometry.skinWeights[e].x=this.geometry.skinWeights[e].x+i;this.geometry.skinWeights[e].y=this.geometry.skinWeights[e].y+i}}}};THREE.MorphAnimMesh=function(e,t){THREE.Mesh.call(this,e,t);this.duration=1e3;this.mirroredLoop=false;this.currentKeyframe=this.lastKeyframe=this.time=0;this.direction=1;this.directionBackwards=false;this.setFrameRange(0,this.geometry.morphTargets.length-1)};THREE.MorphAnimMesh.prototype=new THREE.Mesh;THREE.MorphAnimMesh.prototype.constructor=THREE.MorphAnimMesh;THREE.MorphAnimMesh.prototype.setFrameRange=function(e,t){this.startKeyframe=e;this.endKeyframe=t;this.length=this.endKeyframe-this.startKeyframe+1};THREE.MorphAnimMesh.prototype.setDirectionForward=function(){this.direction=1;this.directionBackwards=false};THREE.MorphAnimMesh.prototype.setDirectionBackward=function(){this.direction=-1;this.directionBackwards=true};THREE.MorphAnimMesh.prototype.parseAnimations=function(){var e=this.geometry;if(!e.animations)e.animations={};for(var t,i=e.animations,r=/([a-z]+)(\d+)/,o=0,n=e.morphTargets.length;o<n;o++){var a=e.morphTargets[o].name.match(r);if(a&&a.length>1){a=a[1];i[a]||(i[a]={start:Infinity,end:-Infinity});var s=i[a];if(o<s.start)s.start=o;if(o>s.end)s.end=o;t||(t=a)}}e.firstAnimation=t};THREE.MorphAnimMesh.prototype.setAnimationLabel=function(e,t,i){if(!this.geometry.animations)this.geometry.animations={};this.geometry.animations[e]={start:t,end:i}};THREE.MorphAnimMesh.prototype.playAnimation=function(e,t){var i=this.geometry.animations[e];if(i){this.setFrameRange(i.start,i.end);this.duration=1e3*((i.end-i.start)/t);this.time=0}else console.warn("animation["+e+"] undefined")};THREE.MorphAnimMesh.prototype.updateAnimation=function(e){var t=this.duration/this.length;this.time=this.time+this.direction*e;if(this.mirroredLoop){if(this.time>this.duration||this.time<0){this.direction=this.direction*-1;if(this.time>this.duration){this.time=this.duration;this.directionBackwards=true}if(this.time<0){this.time=0;this.directionBackwards=false}}}else{this.time=this.time%this.duration;if(this.time<0)this.time=this.time+this.duration}e=this.startKeyframe+THREE.Math.clamp(Math.floor(this.time/t),0,this.length-1);if(e!==this.currentKeyframe){this.morphTargetInfluences[this.lastKeyframe]=0;this.morphTargetInfluences[this.currentKeyframe]=1;this.morphTargetInfluences[e]=0;this.lastKeyframe=this.currentKeyframe;this.currentKeyframe=e}t=this.time%t/t;this.directionBackwards&&(t=1-t);this.morphTargetInfluences[this.currentKeyframe]=t;this.morphTargetInfluences[this.lastKeyframe]=1-t};THREE.Ribbon=function(e,t){THREE.Object3D.call(this);this.geometry=e;this.material=t};THREE.Ribbon.prototype=new THREE.Object3D;THREE.Ribbon.prototype.constructor=THREE.Ribbon;THREE.LOD=function(){THREE.Object3D.call(this);this.LODs=[]};THREE.LOD.prototype=new THREE.Object3D;THREE.LOD.prototype.constructor=THREE.LOD;THREE.LOD.prototype.supr=THREE.Object3D.prototype;THREE.LOD.prototype.addLevel=function(e,t){t===void 0&&(t=0);for(var t=Math.abs(t),i=0;i<this.LODs.length;i++)if(t<this.LODs[i].visibleAtDistance)break;this.LODs.splice(i,0,{visibleAtDistance:t,object3D:e});this.add(e)};THREE.LOD.prototype.update=function(e){if(this.LODs.length>1){e.matrixWorldInverse.getInverse(e.matrixWorld);e=e.matrixWorldInverse;e=-(e.elements[2]*this.matrixWorld.elements[12]+e.elements[6]*this.matrixWorld.elements[13]+e.elements[10]*this.matrixWorld.elements[14]+e.elements[14]);this.LODs[0].object3D.visible=true;for(var t=1;t<this.LODs.length;t++)if(e>=this.LODs[t].visibleAtDistance){this.LODs[t-1].object3D.visible=false;this.LODs[t].object3D.visible=true}else break;for(;t<this.LODs.length;t++)this.LODs[t].object3D.visible=false}};THREE.Sprite=function(e){THREE.Object3D.call(this);this.color=e.color!==void 0?new THREE.Color(e.color):new THREE.Color(16777215);this.map=e.map!==void 0?e.map:new THREE.Texture;this.blending=e.blending!==void 0?e.blending:THREE.NormalBlending;this.blendSrc=e.blendSrc!==void 0?e.blendSrc:THREE.SrcAlphaFactor;this.blendDst=e.blendDst!==void 0?e.blendDst:THREE.OneMinusSrcAlphaFactor;this.blendEquation=e.blendEquation!==void 0?e.blendEquation:THREE.AddEquation;this.useScreenCoordinates=e.useScreenCoordinates!==void 0?e.useScreenCoordinates:true;this.mergeWith3D=e.mergeWith3D!==void 0?e.mergeWith3D:!this.useScreenCoordinates;this.affectedByDistance=e.affectedByDistance!==void 0?e.affectedByDistance:!this.useScreenCoordinates;this.scaleByViewport=e.scaleByViewport!==void 0?e.scaleByViewport:!this.affectedByDistance;this.alignment=e.alignment instanceof THREE.Vector2?e.alignment:THREE.SpriteAlignment.center;this.rotation3d=this.rotation;this.rotation=0;this.opacity=1;this.uvOffset=new THREE.Vector2(0,0);this.uvScale=new THREE.Vector2(1,1)};THREE.Sprite.prototype=new THREE.Object3D;THREE.Sprite.prototype.constructor=THREE.Sprite;THREE.Sprite.prototype.updateMatrix=function(){this.matrix.setPosition(this.position);
this.rotation3d.set(0,0,this.rotation);this.matrix.setRotationFromEuler(this.rotation3d);if(this.scale.x!==1||this.scale.y!==1){this.matrix.scale(this.scale);this.boundRadiusScale=Math.max(this.scale.x,this.scale.y)}this.matrixWorldNeedsUpdate=true};THREE.SpriteAlignment={};THREE.SpriteAlignment.topLeft=new THREE.Vector2(1,-1);THREE.SpriteAlignment.topCenter=new THREE.Vector2(0,-1);THREE.SpriteAlignment.topRight=new THREE.Vector2(-1,-1);THREE.SpriteAlignment.centerLeft=new THREE.Vector2(1,0);THREE.SpriteAlignment.center=new THREE.Vector2(0,0);THREE.SpriteAlignment.centerRight=new THREE.Vector2(-1,0);THREE.SpriteAlignment.bottomLeft=new THREE.Vector2(1,1);THREE.SpriteAlignment.bottomCenter=new THREE.Vector2(0,1);THREE.SpriteAlignment.bottomRight=new THREE.Vector2(-1,1);THREE.Scene=function(){THREE.Object3D.call(this);this.overrideMaterial=this.fog=null;this.matrixAutoUpdate=false;this.__objects=[];this.__lights=[];this.__objectsAdded=[];this.__objectsRemoved=[]};THREE.Scene.prototype=new THREE.Object3D;THREE.Scene.prototype.constructor=THREE.Scene;THREE.Scene.prototype.__addObject=function(e){if(e instanceof THREE.Light)this.__lights.indexOf(e)===-1&&this.__lights.push(e);else if(!(e instanceof THREE.Camera||e instanceof THREE.Bone)&&this.__objects.indexOf(e)===-1){this.__objects.push(e);this.__objectsAdded.push(e);var t=this.__objectsRemoved.indexOf(e);t!==-1&&this.__objectsRemoved.splice(t,1)}for(t=0;t<e.children.length;t++)this.__addObject(e.children[t])};THREE.Scene.prototype.__removeObject=function(e){if(e instanceof THREE.Light){var t=this.__lights.indexOf(e);t!==-1&&this.__lights.splice(t,1)}else if(!(e instanceof THREE.Camera)){t=this.__objects.indexOf(e);if(t!==-1){this.__objects.splice(t,1);this.__objectsRemoved.push(e);t=this.__objectsAdded.indexOf(e);t!==-1&&this.__objectsAdded.splice(t,1)}}for(t=0;t<e.children.length;t++)this.__removeObject(e.children[t])};THREE.Fog=function(e,t,i){this.color=new THREE.Color(e);this.near=t!==void 0?t:1;this.far=i!==void 0?i:1e3};THREE.FogExp2=function(e,t){this.color=new THREE.Color(e);this.density=t!==void 0?t:25e-5};THREE.DOMRenderer=function(){console.log("THREE.DOMRenderer",THREE.REVISION);var e,t,i,r,o,n,a,s=new THREE.Projector;a=function(e){for(var t=document.documentElement,i=0;i<e.length;i++)if(typeof t.style[e[i]]==="string")return e[i];return null}(["transform","MozTransform","WebkitTransform","msTransform","OTransform"]);this.domElement=document.createElement("div");this.setSize=function(e,t){i=e;r=t;o=i/2;n=r/2};this.render=function(i,r){var l,h,c,f,u,E;e=s.projectScene(i,r);t=e.elements;l=0;for(h=t.length;l<h;l++){c=t[l];if(c instanceof THREE.RenderableParticle&&c.material instanceof THREE.ParticleDOMMaterial){f=c.material.domElement;u=c.x*o+o-(f.offsetWidth>>1);E=c.y*n+n-(f.offsetHeight>>1);f.style.left=u+"px";f.style.top=E+"px";f.style.zIndex=Math.abs(Math.floor((1-c.z)*r.far/r.near));a&&(f.style[a]="scale("+c.scale.x*o+","+c.scale.y*n+")")}}}};THREE.CanvasRenderer=function(e){function t(e){if(v!=e)d.globalAlpha=v=e}function i(e){if(T!=e){switch(e){case THREE.NormalBlending:d.globalCompositeOperation="source-over";break;case THREE.AdditiveBlending:d.globalCompositeOperation="lighter"}T=e}}function r(e){if(R!=e)d.strokeStyle=R=e}function o(e){if(y!=e)d.fillStyle=y=e}console.log("THREE.CanvasRenderer",THREE.REVISION);var e=e||{},n=this,a,s,l,h=new THREE.Projector,c=e.canvas!==void 0?e.canvas:document.createElement("canvas"),f,u,E,p,d=c.getContext("2d"),m=new THREE.Color(0),g=0,v=1,T=0,R=null,y=null,x=null,H=null,b=null,w,_,S,M,A=new THREE.RenderableVertex,C=new THREE.RenderableVertex,L,P,F,U,D,V,B,z,N,k,O,I,W=new THREE.Color,G=new THREE.Color,j=new THREE.Color,X=new THREE.Color,Y=new THREE.Color,q=[],K=[],Q,Z,J,$,et,tt,it,rt,ot,nt,at=new THREE.Rectangle,st=new THREE.Rectangle,lt=new THREE.Rectangle,ht=false,ct=new THREE.Color,ft=new THREE.Color,ut=new THREE.Color,Et=new THREE.Vector3,pt,dt,mt,gt,vt,Tt,e=16;pt=document.createElement("canvas");pt.width=pt.height=2;dt=pt.getContext("2d");dt.fillStyle="rgba(0,0,0,1)";dt.fillRect(0,0,2,2);mt=dt.getImageData(0,0,2,2);gt=mt.data;vt=document.createElement("canvas");vt.width=vt.height=e;Tt=vt.getContext("2d");Tt.translate(-e/2,-e/2);Tt.scale(e,e);e--;this.domElement=c;this.sortElements=this.sortObjects=this.autoClear=true;this.info={render:{vertices:0,faces:0}};this.setSize=function(e,t){f=e;u=t;E=Math.floor(f/2);p=Math.floor(u/2);c.width=f;c.height=u;at.set(-E,-p,E,p);st.set(-E,-p,E,p);v=1;T=0;b=H=x=y=R=null};this.setClearColor=function(e,t){m.copy(e);g=t!==void 0?t:1;st.set(-E,-p,E,p)};this.setClearColorHex=function(e,t){m.setHex(e);g=t!==void 0?t:1;st.set(-E,-p,E,p)};this.clear=function(){d.setTransform(1,0,0,-1,E,p);if(!st.isEmpty()){st.minSelf(at);st.inflate(2);g<1&&d.clearRect(Math.floor(st.getX()),Math.floor(st.getY()),Math.floor(st.getWidth()),Math.floor(st.getHeight()));if(g>0){i(THREE.NormalBlending);t(1);o("rgba("+Math.floor(m.r*255)+","+Math.floor(m.g*255)+","+Math.floor(m.b*255)+","+g+")");d.fillRect(Math.floor(st.getX()),Math.floor(st.getY()),Math.floor(st.getWidth()),Math.floor(st.getHeight()))}st.empty()}};this.render=function(e,c){function f(e){var t,i,r,o;ct.setRGB(0,0,0);ft.setRGB(0,0,0);ut.setRGB(0,0,0);t=0;for(i=e.length;t<i;t++){r=e[t];o=r.color;if(r instanceof THREE.AmbientLight){ct.r=ct.r+o.r;ct.g=ct.g+o.g;ct.b=ct.b+o.b}else if(r instanceof THREE.DirectionalLight){ft.r=ft.r+o.r;ft.g=ft.g+o.g;ft.b=ft.b+o.b}else if(r instanceof THREE.PointLight){ut.r=ut.r+o.r;ut.g=ut.g+o.g;ut.b=ut.b+o.b}}}function u(e,t,i,r){var o,n,a,s,l,h;o=0;for(n=e.length;o<n;o++){a=e[o];s=a.color;if(a instanceof THREE.DirectionalLight){l=a.matrixWorld.getPosition();h=i.dot(l);if(!(h<=0)){h=h*a.intensity;r.r=r.r+s.r*h;r.g=r.g+s.g*h;r.b=r.b+s.b*h}}else if(a instanceof THREE.PointLight){l=a.matrixWorld.getPosition();h=i.dot(Et.sub(l,t).normalize());if(!(h<=0)){h=h*(a.distance==0?1:1-Math.min(t.distanceTo(l)/a.distance,1));if(h!=0){h=h*a.intensity;r.r=r.r+s.r*h;r.g=r.g+s.g*h;r.b=r.b+s.b*h}}}}}function m(e,n,a){t(a.opacity);i(a.blending);var s,l,h,c,f,u;if(a instanceof THREE.ParticleBasicMaterial){if(a.map){c=a.map.image;f=c.width>>1;u=c.height>>1;a=n.scale.x*E;h=n.scale.y*p;s=a*f;l=h*u;lt.set(e.x-s,e.y-l,e.x+s,e.y+l);if(at.intersects(lt)){d.save();d.translate(e.x,e.y);d.rotate(-n.rotation);d.scale(a,-h);d.translate(-f,-u);d.drawImage(c,0,0);d.restore()}}}else if(a instanceof THREE.ParticleCanvasMaterial){s=n.scale.x*E;l=n.scale.y*p;lt.set(e.x-s,e.y-l,e.x+s,e.y+l);if(at.intersects(lt)){r(a.color.getContextStyle());o(a.color.getContextStyle());d.save();d.translate(e.x,e.y);d.rotate(-n.rotation);d.scale(s,l);a.program(d);d.restore()}}}function g(e,o,n,a){t(a.opacity);i(a.blending);d.beginPath();d.moveTo(e.positionScreen.x,e.positionScreen.y);d.lineTo(o.positionScreen.x,o.positionScreen.y);d.closePath();if(a instanceof THREE.LineBasicMaterial){e=a.linewidth;if(x!=e)d.lineWidth=x=e;e=a.linecap;if(H!=e)d.lineCap=H=e;e=a.linejoin;if(b!=e)d.lineJoin=b=e;r(a.color.getContextStyle());d.stroke();lt.inflate(a.linewidth*2)}}function v(e,r,o,a,s,h,f,E){n.info.render.vertices=n.info.render.vertices+3;n.info.render.faces++;t(E.opacity);i(E.blending);L=e.positionScreen.x;P=e.positionScreen.y;F=r.positionScreen.x;U=r.positionScreen.y;D=o.positionScreen.x;V=o.positionScreen.y;R(L,P,F,U,D,V);if(E instanceof THREE.MeshBasicMaterial)if(E.map){if(E.map.mapping instanceof THREE.UVMapping){$=f.uvs[0];xt(L,P,F,U,D,V,$[a].u,$[a].v,$[s].u,$[s].v,$[h].u,$[h].v,E.map)}}else if(E.envMap){if(E.envMap.mapping instanceof THREE.SphericalReflectionMapping){e=c.matrixWorldInverse;Et.copy(f.vertexNormalsWorld[a]);et=(Et.x*e.elements[0]+Et.y*e.elements[4]+Et.z*e.elements[8])*.5+.5;tt=-(Et.x*e.elements[1]+Et.y*e.elements[5]+Et.z*e.elements[9])*.5+.5;Et.copy(f.vertexNormalsWorld[s]);it=(Et.x*e.elements[0]+Et.y*e.elements[4]+Et.z*e.elements[8])*.5+.5;rt=-(Et.x*e.elements[1]+Et.y*e.elements[5]+Et.z*e.elements[9])*.5+.5;Et.copy(f.vertexNormalsWorld[h]);ot=(Et.x*e.elements[0]+Et.y*e.elements[4]+Et.z*e.elements[8])*.5+.5;nt=-(Et.x*e.elements[1]+Et.y*e.elements[5]+Et.z*e.elements[9])*.5+.5;xt(L,P,F,U,D,V,et,tt,it,rt,ot,nt,E.envMap)}}else E.wireframe?Rt(E.color,E.wireframeLinewidth,E.wireframeLinecap,E.wireframeLinejoin):yt(E.color);else if(E instanceof THREE.MeshLambertMaterial)if(ht)if(!E.wireframe&&E.shading==THREE.SmoothShading&&f.vertexNormalsWorld.length==3){G.r=j.r=X.r=ct.r;G.g=j.g=X.g=ct.g;G.b=j.b=X.b=ct.b;u(l,f.v1.positionWorld,f.vertexNormalsWorld[0],G);u(l,f.v2.positionWorld,f.vertexNormalsWorld[1],j);u(l,f.v3.positionWorld,f.vertexNormalsWorld[2],X);G.r=Math.max(0,Math.min(E.color.r*G.r,1));G.g=Math.max(0,Math.min(E.color.g*G.g,1));G.b=Math.max(0,Math.min(E.color.b*G.b,1));j.r=Math.max(0,Math.min(E.color.r*j.r,1));j.g=Math.max(0,Math.min(E.color.g*j.g,1));j.b=Math.max(0,Math.min(E.color.b*j.b,1));X.r=Math.max(0,Math.min(E.color.r*X.r,1));X.g=Math.max(0,Math.min(E.color.g*X.g,1));X.b=Math.max(0,Math.min(E.color.b*X.b,1));Y.r=(j.r+X.r)*.5;Y.g=(j.g+X.g)*.5;Y.b=(j.b+X.b)*.5;J=bt(G,j,X,Y);Ht(L,P,F,U,D,V,0,0,1,0,0,1,J)}else{W.r=ct.r;W.g=ct.g;W.b=ct.b;u(l,f.centroidWorld,f.normalWorld,W);W.r=Math.max(0,Math.min(E.color.r*W.r,1));W.g=Math.max(0,Math.min(E.color.g*W.g,1));W.b=Math.max(0,Math.min(E.color.b*W.b,1));E.wireframe?Rt(W,E.wireframeLinewidth,E.wireframeLinecap,E.wireframeLinejoin):yt(W)}else E.wireframe?Rt(E.color,E.wireframeLinewidth,E.wireframeLinecap,E.wireframeLinejoin):yt(E.color);else if(E instanceof THREE.MeshDepthMaterial){Q=c.near;Z=c.far;G.r=G.g=G.b=1-wt(e.positionScreen.z,Q,Z);j.r=j.g=j.b=1-wt(r.positionScreen.z,Q,Z);X.r=X.g=X.b=1-wt(o.positionScreen.z,Q,Z);Y.r=(j.r+X.r)*.5;Y.g=(j.g+X.g)*.5;Y.b=(j.b+X.b)*.5;J=bt(G,j,X,Y);Ht(L,P,F,U,D,V,0,0,1,0,0,1,J)}else if(E instanceof THREE.MeshNormalMaterial){W.r=_t(f.normalWorld.x);W.g=_t(f.normalWorld.y);W.b=_t(f.normalWorld.z);E.wireframe?Rt(W,E.wireframeLinewidth,E.wireframeLinecap,E.wireframeLinejoin):yt(W)}}function T(e,r,o,a,s,h,f,E,p){n.info.render.vertices=n.info.render.vertices+4;n.info.render.faces++;t(E.opacity);i(E.blending);if(E.map||E.envMap){v(e,r,a,0,1,3,f,E,p);v(s,o,h,1,2,3,f,E,p)}else{L=e.positionScreen.x;P=e.positionScreen.y;F=r.positionScreen.x;U=r.positionScreen.y;D=o.positionScreen.x;V=o.positionScreen.y;B=a.positionScreen.x;z=a.positionScreen.y;N=s.positionScreen.x;k=s.positionScreen.y;O=h.positionScreen.x;I=h.positionScreen.y;if(E instanceof THREE.MeshBasicMaterial){y(L,P,F,U,D,V,B,z);E.wireframe?Rt(E.color,E.wireframeLinewidth,E.wireframeLinecap,E.wireframeLinejoin):yt(E.color)}else if(E instanceof THREE.MeshLambertMaterial)if(ht)if(!E.wireframe&&E.shading==THREE.SmoothShading&&f.vertexNormalsWorld.length==4){G.r=j.r=X.r=Y.r=ct.r;G.g=j.g=X.g=Y.g=ct.g;G.b=j.b=X.b=Y.b=ct.b;u(l,f.v1.positionWorld,f.vertexNormalsWorld[0],G);u(l,f.v2.positionWorld,f.vertexNormalsWorld[1],j);u(l,f.v4.positionWorld,f.vertexNormalsWorld[3],X);u(l,f.v3.positionWorld,f.vertexNormalsWorld[2],Y);G.r=Math.max(0,Math.min(E.color.r*G.r,1));G.g=Math.max(0,Math.min(E.color.g*G.g,1));G.b=Math.max(0,Math.min(E.color.b*G.b,1));j.r=Math.max(0,Math.min(E.color.r*j.r,1));j.g=Math.max(0,Math.min(E.color.g*j.g,1));j.b=Math.max(0,Math.min(E.color.b*j.b,1));X.r=Math.max(0,Math.min(E.color.r*X.r,1));X.g=Math.max(0,Math.min(E.color.g*X.g,1));X.b=Math.max(0,Math.min(E.color.b*X.b,1));Y.r=Math.max(0,Math.min(E.color.r*Y.r,1));Y.g=Math.max(0,Math.min(E.color.g*Y.g,1));Y.b=Math.max(0,Math.min(E.color.b*Y.b,1));J=bt(G,j,X,Y);R(L,P,F,U,B,z);Ht(L,P,F,U,B,z,0,0,1,0,0,1,J);R(N,k,D,V,O,I);Ht(N,k,D,V,O,I,1,0,1,1,0,1,J)}else{W.r=ct.r;W.g=ct.g;W.b=ct.b;u(l,f.centroidWorld,f.normalWorld,W);W.r=Math.max(0,Math.min(E.color.r*W.r,1));W.g=Math.max(0,Math.min(E.color.g*W.g,1));W.b=Math.max(0,Math.min(E.color.b*W.b,1));y(L,P,F,U,D,V,B,z);E.wireframe?Rt(W,E.wireframeLinewidth,E.wireframeLinecap,E.wireframeLinejoin):yt(W)}else{y(L,P,F,U,D,V,B,z);E.wireframe?Rt(E.color,E.wireframeLinewidth,E.wireframeLinecap,E.wireframeLinejoin):yt(E.color)}else if(E instanceof THREE.MeshNormalMaterial){W.r=_t(f.normalWorld.x);W.g=_t(f.normalWorld.y);W.b=_t(f.normalWorld.z);y(L,P,F,U,D,V,B,z);E.wireframe?Rt(W,E.wireframeLinewidth,E.wireframeLinecap,E.wireframeLinejoin):yt(W)}else if(E instanceof THREE.MeshDepthMaterial){Q=c.near;Z=c.far;G.r=G.g=G.b=1-wt(e.positionScreen.z,Q,Z);j.r=j.g=j.b=1-wt(r.positionScreen.z,Q,Z);X.r=X.g=X.b=1-wt(a.positionScreen.z,Q,Z);Y.r=Y.g=Y.b=1-wt(o.positionScreen.z,Q,Z);J=bt(G,j,X,Y);R(L,P,F,U,B,z);Ht(L,P,F,U,B,z,0,0,1,0,0,1,J);R(N,k,D,V,O,I);Ht(N,k,D,V,O,I,1,0,1,1,0,1,J)}}}function R(e,t,i,r,o,n){d.beginPath();d.moveTo(e,t);d.lineTo(i,r);d.lineTo(o,n);d.lineTo(e,t);d.closePath()}function y(e,t,i,r,o,n,a,s){d.beginPath();d.moveTo(e,t);d.lineTo(i,r);d.lineTo(o,n);d.lineTo(a,s);d.lineTo(e,t);d.closePath()}function Rt(e,t,i,o){if(x!=t)d.lineWidth=x=t;if(H!=i)d.lineCap=H=i;if(b!=o)d.lineJoin=b=o;r(e.getContextStyle());d.stroke();lt.inflate(t*2)}function yt(e){o(e.getContextStyle());d.fill()}function xt(e,t,i,r,n,a,s,l,h,c,f,u,E){if(E.image.width!=0){if(E.needsUpdate==true||q[E.id]==void 0){var p=E.wrapS==THREE.RepeatWrapping,m=E.wrapT==THREE.RepeatWrapping;q[E.id]=d.createPattern(E.image,p&&m?"repeat":p&&!m?"repeat-x":!p&&m?"repeat-y":"no-repeat");E.needsUpdate=false}o(q[E.id]);var p=E.offset.x/E.repeat.x,m=E.offset.y/E.repeat.y,g=E.image.width*E.repeat.x,v=E.image.height*E.repeat.y,s=(s+p)*g,l=(l+m)*v,i=i-e,r=r-t,n=n-e,a=a-t,h=(h+p)*g-s,c=(c+m)*v-l,f=(f+p)*g-s,u=(u+m)*v-l,p=h*u-f*c;if(p==0){if(K[E.id]===void 0){t=document.createElement("canvas");t.width=E.image.width;t.height=E.image.height;t=t.getContext("2d");t.drawImage(E.image,0,0);K[E.id]=t.getImageData(0,0,E.image.width,E.image.height).data}t=K[E.id];s=(Math.floor(s)+Math.floor(l)*E.image.width)*4;W.setRGB(t[s]/255,t[s+1]/255,t[s+2]/255);yt(W)}else{p=1/p;E=(u*i-c*n)*p;c=(u*r-c*a)*p;i=(h*n-f*i)*p;r=(h*a-f*r)*p;e=e-E*s-i*l;s=t-c*s-r*l;d.save();d.transform(E,c,i,r,e,s);d.fill();d.restore()}}}function Ht(e,t,i,r,o,n,a,s,l,h,c,f,u){var E,p;E=u.width-1;p=u.height-1;a=a*E;s=s*p;i=i-e;r=r-t;o=o-e;n=n-t;l=l*E-a;h=h*p-s;c=c*E-a;f=f*p-s;p=1/(l*f-c*h);E=(f*i-h*o)*p;h=(f*r-h*n)*p;i=(l*o-c*i)*p;r=(l*n-c*r)*p;e=e-E*a-i*s;t=t-h*a-r*s;d.save();d.transform(E,h,i,r,e,t);d.clip();d.drawImage(u,0,0);d.restore()}function bt(e,t,i,r){var o=~~(e.r*255),n=~~(e.g*255),e=~~(e.b*255),a=~~(t.r*255),s=~~(t.g*255),t=~~(t.b*255),l=~~(i.r*255),h=~~(i.g*255),i=~~(i.b*255),c=~~(r.r*255),f=~~(r.g*255),r=~~(r.b*255);gt[0]=o<0?0:o>255?255:o;gt[1]=n<0?0:n>255?255:n;gt[2]=e<0?0:e>255?255:e;gt[4]=a<0?0:a>255?255:a;gt[5]=s<0?0:s>255?255:s;gt[6]=t<0?0:t>255?255:t;gt[8]=l<0?0:l>255?255:l;gt[9]=h<0?0:h>255?255:h;gt[10]=i<0?0:i>255?255:i;gt[12]=c<0?0:c>255?255:c;gt[13]=f<0?0:f>255?255:f;gt[14]=r<0?0:r>255?255:r;dt.putImageData(mt,0,0);Tt.drawImage(pt,0,0);return vt}function wt(e,t,i){e=(e-t)/(i-t);return e*e*(3-2*e)}function _t(e){e=(e+1)*.5;return e<0?0:e>1?1:e}function St(e,t){var i=t.x-e.x,r=t.y-e.y,o=i*i+r*r;if(o!=0){o=1/Math.sqrt(o);i=i*o;r=r*o;t.x=t.x+i;t.y=t.y+r;e.x=e.x-i;e.y=e.y-r}}var Mt,At,Ct,Lt;this.autoClear?this.clear():d.setTransform(1,0,0,-1,E,p);n.info.render.vertices=0;n.info.render.faces=0;a=h.projectScene(e,c,this.sortElements);s=a.elements;l=a.lights;(ht=l.length>0)&&f(l);Mt=0;for(At=s.length;Mt<At;Mt++){Ct=s[Mt];Lt=Ct.material;Lt=Lt instanceof THREE.MeshFaceMaterial?Ct.faceMaterial:Lt;if(!(Lt===void 0||Lt.visible===false)){lt.empty();if(Ct instanceof THREE.RenderableParticle){w=Ct;w.x=w.x*E;w.y=w.y*p;m(w,Ct,Lt,e)}else if(Ct instanceof THREE.RenderableLine){w=Ct.v1;_=Ct.v2;w.positionScreen.x=w.positionScreen.x*E;w.positionScreen.y=w.positionScreen.y*p;_.positionScreen.x=_.positionScreen.x*E;_.positionScreen.y=_.positionScreen.y*p;lt.addPoint(w.positionScreen.x,w.positionScreen.y);lt.addPoint(_.positionScreen.x,_.positionScreen.y);at.intersects(lt)&&g(w,_,Ct,Lt,e)}else if(Ct instanceof THREE.RenderableFace3){w=Ct.v1;_=Ct.v2;S=Ct.v3;w.positionScreen.x=w.positionScreen.x*E;w.positionScreen.y=w.positionScreen.y*p;_.positionScreen.x=_.positionScreen.x*E;_.positionScreen.y=_.positionScreen.y*p;S.positionScreen.x=S.positionScreen.x*E;S.positionScreen.y=S.positionScreen.y*p;if(Lt.overdraw){St(w.positionScreen,_.positionScreen);St(_.positionScreen,S.positionScreen);St(S.positionScreen,w.positionScreen)}lt.add3Points(w.positionScreen.x,w.positionScreen.y,_.positionScreen.x,_.positionScreen.y,S.positionScreen.x,S.positionScreen.y);at.intersects(lt)&&v(w,_,S,0,1,2,Ct,Lt,e)}else if(Ct instanceof THREE.RenderableFace4){w=Ct.v1;_=Ct.v2;S=Ct.v3;M=Ct.v4;w.positionScreen.x=w.positionScreen.x*E;w.positionScreen.y=w.positionScreen.y*p;_.positionScreen.x=_.positionScreen.x*E;_.positionScreen.y=_.positionScreen.y*p;S.positionScreen.x=S.positionScreen.x*E;S.positionScreen.y=S.positionScreen.y*p;M.positionScreen.x=M.positionScreen.x*E;M.positionScreen.y=M.positionScreen.y*p;A.positionScreen.copy(_.positionScreen);C.positionScreen.copy(M.positionScreen);if(Lt.overdraw){St(w.positionScreen,_.positionScreen);St(_.positionScreen,M.positionScreen);St(M.positionScreen,w.positionScreen);St(S.positionScreen,A.positionScreen);St(S.positionScreen,C.positionScreen)}lt.addPoint(w.positionScreen.x,w.positionScreen.y);lt.addPoint(_.positionScreen.x,_.positionScreen.y);lt.addPoint(S.positionScreen.x,S.positionScreen.y);lt.addPoint(M.positionScreen.x,M.positionScreen.y);at.intersects(lt)&&T(w,_,S,M,A,C,Ct,Lt,e)}st.addRectangle(lt)}}d.setTransform(1,0,0,1,0,0)}};THREE.SVGRenderer=function(){function e(e,t,i,r){var o,n,a,s,l,h;o=0;for(n=e.length;o<n;o++){a=e[o];s=a.color;if(a instanceof THREE.DirectionalLight){l=a.matrixWorld.getPosition();h=i.dot(l);if(!(h<=0)){h=h*a.intensity;r.r=r.r+s.r*h;r.g=r.g+s.g*h;r.b=r.b+s.b*h}}else if(a instanceof THREE.PointLight){l=a.matrixWorld.getPosition();h=i.dot(w.sub(l,t).normalize());if(!(h<=0)){h=h*(a.distance==0?1:1-Math.min(t.distanceTo(l)/a.distance,1));if(h!=0){h=h*a.intensity;r.r=r.r+s.r*h;r.g=r.g+s.g*h;r.b=r.b+s.b*h}}}}}function t(e){if(_[e]==null){_[e]=document.createElementNS("http://www.w3.org/2000/svg","path");L==0&&_[e].setAttribute("shape-rendering","crispEdges")}return _[e]}function i(e){e=(e+1)*.5;return e<0?0:e>1?1:e}console.log("THREE.SVGRenderer",THREE.REVISION);var r=this,o,n,a,s=new THREE.Projector,l=document.createElementNS("http://www.w3.org/2000/svg","svg"),h,c,f,u,E,p,d,m,g=new THREE.Rectangle,v=new THREE.Rectangle,T=false,R=new THREE.Color,y=new THREE.Color,x=new THREE.Color,H=new THREE.Color,b,w=new THREE.Vector3,_=[],S=[],M,A,C,L=1;this.domElement=l;this.sortElements=this.sortObjects=this.autoClear=true;this.info={render:{vertices:0,faces:0}};this.setQuality=function(e){switch(e){case"high":L=1;break;case"low":L=0}};this.setSize=function(e,t){h=e;c=t;f=h/2;u=c/2;l.setAttribute("viewBox",-f+" "+-u+" "+h+" "+c);l.setAttribute("width",h);l.setAttribute("height",c);g.set(-f,-u,f,u)};this.clear=function(){for(;l.childNodes.length>0;)l.removeChild(l.childNodes[0])};this.render=function(h,c){var w,_,P,F;this.autoClear&&this.clear();r.info.render.vertices=0;r.info.render.faces=0;o=s.projectScene(h,c,this.sortElements);n=o.elements;a=o.lights;C=A=0;if(T=a.length>0){y.setRGB(0,0,0);x.setRGB(0,0,0);H.setRGB(0,0,0);w=0;for(_=a.length;w<_;w++){F=a[w];P=F.color;if(F instanceof THREE.AmbientLight){y.r=y.r+P.r;y.g=y.g+P.g;y.b=y.b+P.b}else if(F instanceof THREE.DirectionalLight){x.r=x.r+P.r;x.g=x.g+P.g;x.b=x.b+P.b}else if(F instanceof THREE.PointLight){H.r=H.r+P.r;H.g=H.g+P.g;H.b=H.b+P.b}}}w=0;for(_=n.length;w<_;w++){P=n[w];F=P.material;F=F instanceof THREE.MeshFaceMaterial?P.faceMaterial:F;if(!(F===void 0||F.visible===false)){v.empty();if(P instanceof THREE.RenderableParticle){E=P;E.x=E.x*f;E.y=E.y*-u}else if(P instanceof THREE.RenderableLine){E=P.v1;p=P.v2;E.positionScreen.x=E.positionScreen.x*f;E.positionScreen.y=E.positionScreen.y*-u;p.positionScreen.x=p.positionScreen.x*f;p.positionScreen.y=p.positionScreen.y*-u;v.addPoint(E.positionScreen.x,E.positionScreen.y);v.addPoint(p.positionScreen.x,p.positionScreen.y);if(g.intersects(v)){P=E;var U=p,D=C++;if(S[D]==null){S[D]=document.createElementNS("http://www.w3.org/2000/svg","line");L==0&&S[D].setAttribute("shape-rendering","crispEdges")}M=S[D];M.setAttribute("x1",P.positionScreen.x);M.setAttribute("y1",P.positionScreen.y);M.setAttribute("x2",U.positionScreen.x);M.setAttribute("y2",U.positionScreen.y);if(F instanceof THREE.LineBasicMaterial){M.setAttribute("style","fill: none; stroke: "+F.color.getContextStyle()+"; stroke-width: "+F.linewidth+"; stroke-opacity: "+F.opacity+"; stroke-linecap: "+F.linecap+"; stroke-linejoin: "+F.linejoin);l.appendChild(M)}}}else if(P instanceof THREE.RenderableFace3){E=P.v1;p=P.v2;d=P.v3;E.positionScreen.x=E.positionScreen.x*f;E.positionScreen.y=E.positionScreen.y*-u;p.positionScreen.x=p.positionScreen.x*f;p.positionScreen.y=p.positionScreen.y*-u;d.positionScreen.x=d.positionScreen.x*f;d.positionScreen.y=d.positionScreen.y*-u;v.addPoint(E.positionScreen.x,E.positionScreen.y);v.addPoint(p.positionScreen.x,p.positionScreen.y);v.addPoint(d.positionScreen.x,d.positionScreen.y);if(g.intersects(v)){var U=E,D=p,V=d;r.info.render.vertices=r.info.render.vertices+3;r.info.render.faces++;M=t(A++);M.setAttribute("d","M "+U.positionScreen.x+" "+U.positionScreen.y+" L "+D.positionScreen.x+" "+D.positionScreen.y+" L "+V.positionScreen.x+","+V.positionScreen.y+"z");if(F instanceof THREE.MeshBasicMaterial)R.copy(F.color);else if(F instanceof THREE.MeshLambertMaterial)if(T){R.r=y.r;R.g=y.g;R.b=y.b;e(a,P.centroidWorld,P.normalWorld,R);R.r=Math.max(0,Math.min(F.color.r*R.r,1));R.g=Math.max(0,Math.min(F.color.g*R.g,1));R.b=Math.max(0,Math.min(F.color.b*R.b,1))}else R.copy(F.color);else if(F instanceof THREE.MeshDepthMaterial){b=1-F.__2near/(F.__farPlusNear-P.z*F.__farMinusNear);R.setRGB(b,b,b)}else F instanceof THREE.MeshNormalMaterial&&R.setRGB(i(P.normalWorld.x),i(P.normalWorld.y),i(P.normalWorld.z));F.wireframe?M.setAttribute("style","fill: none; stroke: "+R.getContextStyle()+"; stroke-width: "+F.wireframeLinewidth+"; stroke-opacity: "+F.opacity+"; stroke-linecap: "+F.wireframeLinecap+"; stroke-linejoin: "+F.wireframeLinejoin):M.setAttribute("style","fill: "+R.getContextStyle()+"; fill-opacity: "+F.opacity);l.appendChild(M)}}else if(P instanceof THREE.RenderableFace4){E=P.v1;p=P.v2;d=P.v3;m=P.v4;E.positionScreen.x=E.positionScreen.x*f;E.positionScreen.y=E.positionScreen.y*-u;p.positionScreen.x=p.positionScreen.x*f;p.positionScreen.y=p.positionScreen.y*-u;d.positionScreen.x=d.positionScreen.x*f;d.positionScreen.y=d.positionScreen.y*-u;m.positionScreen.x=m.positionScreen.x*f;m.positionScreen.y=m.positionScreen.y*-u;v.addPoint(E.positionScreen.x,E.positionScreen.y);v.addPoint(p.positionScreen.x,p.positionScreen.y);v.addPoint(d.positionScreen.x,d.positionScreen.y);v.addPoint(m.positionScreen.x,m.positionScreen.y);if(g.intersects(v)){var U=E,D=p,V=d,B=m;r.info.render.vertices=r.info.render.vertices+4;r.info.render.faces++;M=t(A++);M.setAttribute("d","M "+U.positionScreen.x+" "+U.positionScreen.y+" L "+D.positionScreen.x+" "+D.positionScreen.y+" L "+V.positionScreen.x+","+V.positionScreen.y+" L "+B.positionScreen.x+","+B.positionScreen.y+"z");if(F instanceof THREE.MeshBasicMaterial)R.copy(F.color);else if(F instanceof THREE.MeshLambertMaterial)if(T){R.r=y.r;R.g=y.g;R.b=y.b;e(a,P.centroidWorld,P.normalWorld,R);R.r=Math.max(0,Math.min(F.color.r*R.r,1));R.g=Math.max(0,Math.min(F.color.g*R.g,1));R.b=Math.max(0,Math.min(F.color.b*R.b,1))}else R.copy(F.color);else if(F instanceof THREE.MeshDepthMaterial){b=1-F.__2near/(F.__farPlusNear-P.z*F.__farMinusNear);R.setRGB(b,b,b)}else F instanceof THREE.MeshNormalMaterial&&R.setRGB(i(P.normalWorld.x),i(P.normalWorld.y),i(P.normalWorld.z));F.wireframe?M.setAttribute("style","fill: none; stroke: "+R.getContextStyle()+"; stroke-width: "+F.wireframeLinewidth+"; stroke-opacity: "+F.opacity+"; stroke-linecap: "+F.wireframeLinecap+"; stroke-linejoin: "+F.wireframeLinejoin):M.setAttribute("style","fill: "+R.getContextStyle()+"; fill-opacity: "+F.opacity);l.appendChild(M)}}}}}};THREE.ShaderChunk={fog_pars_fragment:"#ifdef USE_FOG\nuniform vec3 fogColor;\n#ifdef FOG_EXP2\nuniform float fogDensity;\n#else\nuniform float fogNear;\nuniform float fogFar;\n#endif\n#endif",fog_fragment:"#ifdef USE_FOG\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n#ifdef FOG_EXP2\nconst float LOG2 = 1.442695;\nfloat fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\nfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\n#else\nfloat fogFactor = smoothstep( fogNear, fogFar, depth );\n#endif\ngl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\nvarying vec3 vReflect;\nuniform float reflectivity;\nuniform samplerCube envMap;\nuniform float flipEnvMap;\nuniform int combine;\n#endif",envmap_fragment:"#ifdef USE_ENVMAP\n#ifdef DOUBLE_SIDED\nfloat flipNormal = ( -1.0 + 2.0 * float( gl_FrontFacing ) );\nvec4 cubeColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * vReflect.x, vReflect.yz ) );\n#else\nvec4 cubeColor = textureCube( envMap, vec3( flipEnvMap * vReflect.x, vReflect.yz ) );\n#endif\n#ifdef GAMMA_INPUT\ncubeColor.xyz *= cubeColor.xyz;\n#endif\nif ( combine == 1 ) {\ngl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, reflectivity );\n} else {\ngl_FragColor.xyz = gl_FragColor.xyz * cubeColor.xyz;\n}\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\nvarying vec3 vReflect;\nuniform float refractionRatio;\nuniform bool useRefract;\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\nvec3 nWorld = mat3( objectMatrix[ 0 ].xyz, objectMatrix[ 1 ].xyz, objectMatrix[ 2 ].xyz ) * normal;\nif ( useRefract ) {\nvReflect = refract( normalize( mPosition.xyz - cameraPosition ), normalize( nWorld.xyz ), refractionRatio );\n} else {\nvReflect = reflect( normalize( mPosition.xyz - cameraPosition ), normalize( nWorld.xyz ) );\n}\n#endif",map_particle_pars_fragment:"#ifdef USE_MAP\nuniform sampler2D map;\n#endif",map_particle_fragment:"#ifdef USE_MAP\ngl_FragColor = gl_FragColor * texture2D( map, gl_PointCoord );\n#endif",map_pars_vertex:"#ifdef USE_MAP\nvarying vec2 vUv;\nuniform vec4 offsetRepeat;\n#endif",map_pars_fragment:"#ifdef USE_MAP\nvarying vec2 vUv;\nuniform sampler2D map;\n#endif",map_vertex:"#ifdef USE_MAP\nvUv = uv * offsetRepeat.zw + offsetRepeat.xy;\n#endif",map_fragment:"#ifdef USE_MAP\n#ifdef GAMMA_INPUT\nvec4 texelColor = texture2D( map, vUv );\ntexelColor.xyz *= texelColor.xyz;\ngl_FragColor = gl_FragColor * texelColor;\n#else\ngl_FragColor = gl_FragColor * texture2D( map, vUv );\n#endif\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\nvarying vec2 vUv2;\nuniform sampler2D lightMap;\n#endif",lightmap_pars_vertex:"#ifdef USE_LIGHTMAP\nvarying vec2 vUv2;\n#endif",lightmap_fragment:"#ifdef USE_LIGHTMAP\ngl_FragColor = gl_FragColor * texture2D( lightMap, vUv2 );\n#endif",lightmap_vertex:"#ifdef USE_LIGHTMAP\nvUv2 = uv2;\n#endif",lights_lambert_pars_vertex:"uniform vec3 ambient;\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n#endif\n#if MAX_SPOT_LIGHTS > 0\nuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\nuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\nuniform float spotLightAngle[ MAX_SPOT_LIGHTS ];\nuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n#endif\n#ifdef WRAP_AROUND\nuniform vec3 wrapRGB;\n#endif",lights_lambert_vertex:"vLightFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\nvLightBack = vec3( 0.0 );\n#endif\ntransformedNormal = normalize( transformedNormal );\n#if MAX_DIR_LIGHTS > 0\nfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nvec3 dirVector = normalize( lDirection.xyz );\nfloat dotProduct = dot( transformedNormal, dirVector );\nvec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );\n#ifdef DOUBLE_SIDED\nvec3 directionalLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n#ifdef WRAP_AROUND\nvec3 directionalLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n#endif\n#endif\n#ifdef WRAP_AROUND\nvec3 directionalLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\ndirectionalLightWeighting = mix( directionalLightWeighting, directionalLightWeightingHalf, wrapRGB );\n#ifdef DOUBLE_SIDED\ndirectionalLightWeightingBack = mix( directionalLightWeightingBack, directionalLightWeightingHalfBack, wrapRGB );\n#endif\n#endif\nvLightFront += directionalLightColor[ i ] * directionalLightWeighting;\n#ifdef DOUBLE_SIDED\nvLightBack += directionalLightColor[ i ] * directionalLightWeightingBack;\n#endif\n}\n#endif\n#if MAX_POINT_LIGHTS > 0\nfor( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\nfloat dotProduct = dot( transformedNormal, lVector );\nvec3 pointLightWeighting = vec3( max( dotProduct, 0.0 ) );\n#ifdef DOUBLE_SIDED\nvec3 pointLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n#ifdef WRAP_AROUND\nvec3 pointLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n#endif\n#endif\n#ifdef WRAP_AROUND\nvec3 pointLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\npointLightWeighting = mix( pointLightWeighting, pointLightWeightingHalf, wrapRGB );\n#ifdef DOUBLE_SIDED\npointLightWeightingBack = mix( pointLightWeightingBack, pointLightWeightingHalfBack, wrapRGB );\n#endif\n#endif\nvLightFront += pointLightColor[ i ] * pointLightWeighting * lDistance;\n#ifdef DOUBLE_SIDED\nvLightBack += pointLightColor[ i ] * pointLightWeightingBack * lDistance;\n#endif\n}\n#endif\n#if MAX_SPOT_LIGHTS > 0\nfor( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nlVector = normalize( lVector );\nfloat spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - mPosition.xyz ) );\nif ( spotEffect > spotLightAngle[ i ] ) {\nspotEffect = pow( spotEffect, spotLightExponent[ i ] );\nfloat lDistance = 1.0;\nif ( spotLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );\nfloat dotProduct = dot( transformedNormal, lVector );\nvec3 spotLightWeighting = vec3( max( dotProduct, 0.0 ) );\n#ifdef DOUBLE_SIDED\nvec3 spotLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n#ifdef WRAP_AROUND\nvec3 spotLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n#endif\n#endif\n#ifdef WRAP_AROUND\nvec3 spotLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\nspotLightWeighting = mix( spotLightWeighting, spotLightWeightingHalf, wrapRGB );\n#ifdef DOUBLE_SIDED\nspotLightWeightingBack = mix( spotLightWeightingBack, spotLightWeightingHalfBack, wrapRGB );\n#endif\n#endif\nvLightFront += spotLightColor[ i ] * spotLightWeighting * lDistance * spotEffect;\n#ifdef DOUBLE_SIDED\nvLightBack += spotLightColor[ i ] * spotLightWeightingBack * lDistance * spotEffect;\n#endif\n}\n}\n#endif\nvLightFront = vLightFront * diffuse + ambient * ambientLightColor + emissive;\n#ifdef DOUBLE_SIDED\nvLightBack = vLightBack * diffuse + ambient * ambientLightColor + emissive;\n#endif",lights_phong_pars_vertex:"#ifndef PHONG_PER_PIXEL\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\n#if MAX_SPOT_LIGHTS > 0\nuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\nuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\nvarying vec4 vSpotLight[ MAX_SPOT_LIGHTS ];\n#endif\n#endif\n#if MAX_SPOT_LIGHTS > 0\nvarying vec3 vWorldPosition;\n#endif",lights_phong_vertex:"#ifndef PHONG_PER_PIXEL\n#if MAX_POINT_LIGHTS > 0\nfor( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nvPointLight[ i ] = vec4( lVector, lDistance );\n}\n#endif\n#if MAX_SPOT_LIGHTS > 0\nfor( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat lDistance = 1.0;\nif ( spotLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );\nvSpotLight[ i ] = vec4( lVector, lDistance );\n}\n#endif\n#endif\n#if MAX_SPOT_LIGHTS > 0\nvWorldPosition = mPosition.xyz;\n#endif",lights_phong_pars_fragment:"uniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\n#ifdef PHONG_PER_PIXEL\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n#else\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\n#endif\n#if MAX_SPOT_LIGHTS > 0\nuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\nuniform float spotLightAngle[ MAX_SPOT_LIGHTS ];\nuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n#ifdef PHONG_PER_PIXEL\nuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n#else\nvarying vec4 vSpotLight[ MAX_SPOT_LIGHTS ];\n#endif\nvarying vec3 vWorldPosition;\n#endif\n#ifdef WRAP_AROUND\nuniform vec3 wrapRGB;\n#endif\nvarying vec3 vViewPosition;\nvarying vec3 vNormal;",lights_phong_fragment:"vec3 normal = normalize( vNormal );\nvec3 viewPosition = normalize( vViewPosition );\n#ifdef DOUBLE_SIDED\nnormal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n#endif\n#if MAX_POINT_LIGHTS > 0\nvec3 pointDiffuse  = vec3( 0.0 );\nvec3 pointSpecular = vec3( 0.0 );\nfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\n#ifdef PHONG_PER_PIXEL\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz + vViewPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\n#else\nvec3 lVector = normalize( vPointLight[ i ].xyz );\nfloat lDistance = vPointLight[ i ].w;\n#endif\nfloat dotProduct = dot( normal, lVector );\n#ifdef WRAP_AROUND\nfloat pointDiffuseWeightFull = max( dotProduct, 0.0 );\nfloat pointDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\nvec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );\n#else\nfloat pointDiffuseWeight = max( dotProduct, 0.0 );\n#endif\npointDiffuse  += diffuse * pointLightColor[ i ] * pointDiffuseWeight * lDistance;\nvec3 pointHalfVector = normalize( lVector + viewPosition );\nfloat pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );\nfloat pointSpecularWeight = max( pow( pointDotNormalHalf, shininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat specularNormalization = ( shininess + 2.0001 ) / 8.0;\nvec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, pointHalfVector ), 5.0 );\npointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance * specularNormalization;\n#else\npointSpecular += specular * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance;\n#endif\n}\n#endif\n#if MAX_SPOT_LIGHTS > 0\nvec3 spotDiffuse  = vec3( 0.0 );\nvec3 spotSpecular = vec3( 0.0 );\nfor ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\n#ifdef PHONG_PER_PIXEL\nvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz + vViewPosition.xyz;\nfloat lDistance = 1.0;\nif ( spotLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\n#else\nvec3 lVector = normalize( vSpotLight[ i ].xyz );\nfloat lDistance = vSpotLight[ i ].w;\n#endif\nfloat spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );\nif ( spotEffect > spotLightAngle[ i ] ) {\nspotEffect = pow( spotEffect, spotLightExponent[ i ] );\nfloat dotProduct = dot( normal, lVector );\n#ifdef WRAP_AROUND\nfloat spotDiffuseWeightFull = max( dotProduct, 0.0 );\nfloat spotDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\nvec3 spotDiffuseWeight = mix( vec3 ( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );\n#else\nfloat spotDiffuseWeight = max( dotProduct, 0.0 );\n#endif\nspotDiffuse += diffuse * spotLightColor[ i ] * spotDiffuseWeight * lDistance * spotEffect;\nvec3 spotHalfVector = normalize( lVector + viewPosition );\nfloat spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );\nfloat spotSpecularWeight = max( pow( spotDotNormalHalf, shininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat specularNormalization = ( shininess + 2.0001 ) / 8.0;\nvec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, spotHalfVector ), 5.0 );\nspotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * specularNormalization * spotEffect;\n#else\nspotSpecular += specular * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * spotEffect;\n#endif\n}\n}\n#endif\n#if MAX_DIR_LIGHTS > 0\nvec3 dirDiffuse  = vec3( 0.0 );\nvec3 dirSpecular = vec3( 0.0 );\nfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nvec3 dirVector = normalize( lDirection.xyz );\nfloat dotProduct = dot( normal, dirVector );\n#ifdef WRAP_AROUND\nfloat dirDiffuseWeightFull = max( dotProduct, 0.0 );\nfloat dirDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\nvec3 dirDiffuseWeight = mix( vec3( dirDiffuseWeightFull ), vec3( dirDiffuseWeightHalf ), wrapRGB );\n#else\nfloat dirDiffuseWeight = max( dotProduct, 0.0 );\n#endif\ndirDiffuse  += diffuse * directionalLightColor[ i ] * dirDiffuseWeight;\nvec3 dirHalfVector = normalize( dirVector + viewPosition );\nfloat dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );\nfloat dirSpecularWeight = max( pow( dirDotNormalHalf, shininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat specularNormalization = ( shininess + 2.0001 ) / 8.0;\nvec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( dirVector, dirHalfVector ), 5.0 );\ndirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;\n#else\ndirSpecular += specular * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight;\n#endif\n}\n#endif\nvec3 totalDiffuse = vec3( 0.0 );\nvec3 totalSpecular = vec3( 0.0 );\n#if MAX_DIR_LIGHTS > 0\ntotalDiffuse += dirDiffuse;\ntotalSpecular += dirSpecular;\n#endif\n#if MAX_POINT_LIGHTS > 0\ntotalDiffuse += pointDiffuse;\ntotalSpecular += pointSpecular;\n#endif\n#if MAX_SPOT_LIGHTS > 0\ntotalDiffuse += spotDiffuse;\ntotalSpecular += spotSpecular;\n#endif\n#ifdef METAL\ngl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient + totalSpecular );\n#else\ngl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient ) + totalSpecular;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif",color_fragment:"#ifdef USE_COLOR\ngl_FragColor = gl_FragColor * vec4( vColor, opacity );\n#endif",color_pars_vertex:"#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\n#ifdef GAMMA_INPUT\nvColor = color * color;\n#else\nvColor = color;\n#endif\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\nuniform mat4 boneGlobalMatrices[ MAX_BONES ];\n#endif",skinning_vertex:"#ifdef USE_SKINNING\ngl_Position  = ( boneGlobalMatrices[ int( skinIndex.x ) ] * skinVertexA ) * skinWeight.x;\ngl_Position += ( boneGlobalMatrices[ int( skinIndex.y ) ] * skinVertexB ) * skinWeight.y;\ngl_Position  = projectionMatrix * modelViewMatrix * gl_Position;\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n#ifndef USE_MORPHNORMALS\nuniform float morphTargetInfluences[ 8 ];\n#else\nuniform float morphTargetInfluences[ 4 ];\n#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\nvec3 morphed = vec3( 0.0 );\nmorphed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\nmorphed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\nmorphed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\nmorphed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n#ifndef USE_MORPHNORMALS\nmorphed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\nmorphed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\nmorphed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\nmorphed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n#endif\nmorphed += position;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( morphed, 1.0 );\n#endif",default_vertex:"#ifndef USE_MORPHTARGETS\n#ifndef USE_SKINNING\ngl_Position = projectionMatrix * mvPosition;\n#endif\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\nvec3 morphedNormal = vec3( 0.0 );\nmorphedNormal +=  ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\nmorphedNormal +=  ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\nmorphedNormal +=  ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\nmorphedNormal +=  ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\nmorphedNormal += normal;\nvec3 transformedNormal = normalMatrix * morphedNormal;\n#else\nvec3 transformedNormal = normalMatrix * normal;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\nuniform sampler2D shadowMap[ MAX_SHADOWS ];\nuniform vec2 shadowMapSize[ MAX_SHADOWS ];\nuniform float shadowDarkness[ MAX_SHADOWS ];\nuniform float shadowBias[ MAX_SHADOWS ];\nvarying vec4 vShadowCoord[ MAX_SHADOWS ];\nfloat unpackDepth( const in vec4 rgba_depth ) {\nconst vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\nfloat depth = dot( rgba_depth, bit_shift );\nreturn depth;\n}\n#endif",shadowmap_fragment:"#ifdef USE_SHADOWMAP\n#ifdef SHADOWMAP_DEBUG\nvec3 frustumColors[3];\nfrustumColors[0] = vec3( 1.0, 0.5, 0.0 );\nfrustumColors[1] = vec3( 0.0, 1.0, 0.8 );\nfrustumColors[2] = vec3( 0.0, 0.5, 1.0 );\n#endif\n#ifdef SHADOWMAP_CASCADE\nint inFrustumCount = 0;\n#endif\nfloat fDepth;\nvec3 shadowColor = vec3( 1.0 );\nfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\nvec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;\nbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\nbool inFrustum = all( inFrustumVec );\n#ifdef SHADOWMAP_CASCADE\ninFrustumCount += int( inFrustum );\nbvec3 frustumTestVec = bvec3( inFrustum, inFrustumCount == 1, shadowCoord.z <= 1.0 );\n#else\nbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n#endif\nbool frustumTest = all( frustumTestVec );\nif ( frustumTest ) {\nshadowCoord.z += shadowBias[ i ];\n#ifdef SHADOWMAP_SOFT\nfloat shadow = 0.0;\nconst float shadowDelta = 1.0 / 9.0;\nfloat xPixelOffset = 1.0 / shadowMapSize[ i ].x;\nfloat yPixelOffset = 1.0 / shadowMapSize[ i ].y;\nfloat dx0 = -1.25 * xPixelOffset;\nfloat dy0 = -1.25 * yPixelOffset;\nfloat dx1 = 1.25 * xPixelOffset;\nfloat dy1 = 1.25 * yPixelOffset;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nshadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );\n#else\nvec4 rgbaDepth = texture2D( shadowMap[ i ], shadowCoord.xy );\nfloat fDepth = unpackDepth( rgbaDepth );\nif ( fDepth < shadowCoord.z )\nshadowColor = shadowColor * vec3( 1.0 - shadowDarkness[ i ] );\n#endif\n}\n#ifdef SHADOWMAP_DEBUG\n#ifdef SHADOWMAP_CASCADE\nif ( inFrustum && inFrustumCount == 1 ) gl_FragColor.xyz *= frustumColors[ i ];\n#else\nif ( inFrustum ) gl_FragColor.xyz *= frustumColors[ i ];\n#endif\n#endif\n}\n#ifdef GAMMA_OUTPUT\nshadowColor *= shadowColor;\n#endif\ngl_FragColor.xyz = gl_FragColor.xyz * shadowColor;\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\nvarying vec4 vShadowCoord[ MAX_SHADOWS ];\nuniform mat4 shadowMatrix[ MAX_SHADOWS ];\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\nfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\n#ifdef USE_MORPHTARGETS\nvShadowCoord[ i ] = shadowMatrix[ i ] * objectMatrix * vec4( morphed, 1.0 );\n#else\nvShadowCoord[ i ] = shadowMatrix[ i ] * objectMatrix * vec4( position, 1.0 );\n#endif\n}\n#endif",alphatest_fragment:"#ifdef ALPHATEST\nif ( gl_FragColor.a < ALPHATEST ) discard;\n#endif",linear_to_gamma_fragment:"#ifdef GAMMA_OUTPUT\ngl_FragColor.xyz = sqrt( gl_FragColor.xyz );\n#endif"};
THREE.UniformsUtils={merge:function(e){var t,i,r,o={};for(t=0;t<e.length;t++){r=this.clone(e[t]);for(i in r)o[i]=r[i]}return o},clone:function(e){var t,i,r,o={};for(t in e){o[t]={};for(i in e[t]){r=e[t][i];o[t][i]=r instanceof THREE.Color||r instanceof THREE.Vector2||r instanceof THREE.Vector3||r instanceof THREE.Vector4||r instanceof THREE.Matrix4||r instanceof THREE.Texture?r.clone():r instanceof Array?r.slice():r}}return o}};THREE.UniformsLib={common:{diffuse:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:0,texture:null},offsetRepeat:{type:"v4",value:new THREE.Vector4(0,0,1,1)},lightMap:{type:"t",value:2,texture:null},envMap:{type:"t",value:1,texture:null},flipEnvMap:{type:"f",value:-1},useRefract:{type:"i",value:0},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:.98},combine:{type:"i",value:0},morphTargetInfluences:{type:"f",value:0}},fog:{fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new THREE.Color(16777215)}},lights:{ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]},spotLightColor:{type:"fv",value:[]},spotLightPosition:{type:"fv",value:[]},spotLightDirection:{type:"fv",value:[]},spotLightDistance:{type:"fv1",value:[]},spotLightAngle:{type:"fv1",value:[]},spotLightExponent:{type:"fv1",value:[]}},particle:{psColor:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:0,texture:null},fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new THREE.Color(16777215)}},shadowmap:{shadowMap:{type:"tv",value:6,texture:[]},shadowMapSize:{type:"v2v",value:[]},shadowBias:{type:"fv1",value:[]},shadowDarkness:{type:"fv1",value:[]},shadowMatrix:{type:"m4v",value:[]}}};THREE.ShaderLib={depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2e3},opacity:{type:"f",value:1}},vertexShader:"void main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform float mNear;\nuniform float mFar;\nuniform float opacity;\nvoid main() {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nfloat color = 1.0 - smoothstep( mNear, mFar, depth );\ngl_FragColor = vec4( vec3( color ), opacity );\n}"},normal:{uniforms:{opacity:{type:"f",value:1}},vertexShader:"varying vec3 vNormal;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvNormal = normalMatrix * normal;\ngl_Position = projectionMatrix * mvPosition;\n}",fragmentShader:"uniform float opacity;\nvarying vec3 vNormal;\nvoid main() {\ngl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );\n}"},basic:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,THREE.UniformsLib.shadowmap]),vertexShader:[THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,"void main() {\ngl_FragColor = vec4( diffuse, opacity );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},lambert:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap,{ambient:{type:"c",value:new THREE.Color(16777215)},emissive:{type:"c",value:new THREE.Color(0)},wrapRGB:{type:"v3",value:new THREE.Vector3(1,1,1)}}]),vertexShader:["varying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\nvarying vec3 vLightBack;\n#endif",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_lambert_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.morphnormal_vertex,"#ifndef USE_ENVMAP\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\n#endif",THREE.ShaderChunk.lights_lambert_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform float opacity;\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\nvarying vec3 vLightBack;\n#endif",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,"void main() {\ngl_FragColor = vec4( vec3 ( 1.0 ), opacity );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.alphatest_fragment,"#ifdef DOUBLE_SIDED\nif ( gl_FrontFacing )\ngl_FragColor.xyz *= vLightFront;\nelse\ngl_FragColor.xyz *= vLightBack;\n#else\ngl_FragColor.xyz *= vLightFront;\n#endif",THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},phong:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap,{ambient:{type:"c",value:new THREE.Color(16777215)},emissive:{type:"c",value:new THREE.Color(0)},specular:{type:"c",value:new THREE.Color(1118481)},shininess:{type:"f",value:30},wrapRGB:{type:"v3",value:new THREE.Vector3(1,1,1)}}]),vertexShader:["varying vec3 vViewPosition;\nvarying vec3 vNormal;",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_phong_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.color_vertex,"#ifndef USE_ENVMAP\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\n#endif\nvViewPosition = -mvPosition.xyz;",THREE.ShaderChunk.morphnormal_vertex,"vNormal = transformedNormal;",THREE.ShaderChunk.lights_phong_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;\nuniform vec3 ambient;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.lights_phong_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,"void main() {\ngl_FragColor = vec4( vec3 ( 1.0 ), opacity );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.lights_phong_fragment,THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},particle_basic:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.particle,THREE.UniformsLib.shadowmap]),vertexShader:["uniform float size;\nuniform float scale;",THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {",THREE.ShaderChunk.color_vertex,"vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n#ifdef USE_SIZEATTENUATION\ngl_PointSize = size * ( scale / length( mvPosition.xyz ) );\n#else\ngl_PointSize = size;\n#endif\ngl_Position = projectionMatrix * mvPosition;",THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 psColor;\nuniform float opacity;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_particle_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,"void main() {\ngl_FragColor = vec4( psColor, opacity );",THREE.ShaderChunk.map_particle_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},depthRGBA:{uniforms:{},vertexShader:[THREE.ShaderChunk.morphtarget_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.default_vertex,"}"].join("\n"),fragmentShader:"vec4 pack_depth( const in float depth ) {\nconst vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );\nconst vec4 bit_mask  = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );\nvec4 res = fract( depth * bit_shift );\nres -= res.xxyz * bit_mask;\nreturn res;\n}\nvoid main() {\ngl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );\n}"}};THREE.WebGLRenderer=function(e){function t(e,t){var i=e.vertices.length,r=t.material;if(r.attributes){if(e.__webglCustomAttributesList===void 0)e.__webglCustomAttributesList=[];for(var o in r.attributes){var n=r.attributes[o];if(!n.__webglInitialized||n.createUniqueBuffers){n.__webglInitialized=true;var a=1;n.type==="v2"?a=2:n.type==="v3"?a=3:n.type==="v4"?a=4:n.type==="c"&&(a=3);n.size=a;n.array=new Float32Array(i*a);n.buffer=U.createBuffer();n.buffer.belongsToAttribute=o;n.needsUpdate=true}e.__webglCustomAttributesList.push(n)}}}function i(e,t){if(e.material&&!(e.material instanceof THREE.MeshFaceMaterial))return e.material;if(t.materialIndex>=0)return e.geometry.materials[t.materialIndex]}function r(e){return e instanceof THREE.MeshBasicMaterial&&!e.envMap||e instanceof THREE.MeshDepthMaterial?false:e&&e.shading!==void 0&&e.shading===THREE.SmoothShading?THREE.SmoothShading:THREE.FlatShading}function o(e){return e.map||e.lightMap||e instanceof THREE.ShaderMaterial?true:false}function n(e,t,i){var r,o,n,a,s=e.vertices;a=s.length;var l=e.colors,h=l.length,c=e.__vertexArray,f=e.__colorArray,u=e.__sortArray,E=e.verticesNeedUpdate,p=e.colorsNeedUpdate,d=e.__webglCustomAttributesList;if(i.sortParticles){lt.copy(st);lt.multiplySelf(i.matrixWorld);for(r=0;r<a;r++){o=s[r];ht.copy(o);lt.multiplyVector3(ht);u[r]=[ht.z,r]}u.sort(function(e,t){return t[0]-e[0]});for(r=0;r<a;r++){o=s[u[r][1]];n=r*3;c[n]=o.x;c[n+1]=o.y;c[n+2]=o.z}for(r=0;r<h;r++){n=r*3;o=l[u[r][1]];f[n]=o.r;f[n+1]=o.g;f[n+2]=o.b}if(d){l=0;for(h=d.length;l<h;l++){s=d[l];if(s.boundTo===void 0||s.boundTo==="vertices"){n=0;o=s.value.length;if(s.size===1)for(r=0;r<o;r++){a=u[r][1];s.array[r]=s.value[a]}else if(s.size===2)for(r=0;r<o;r++){a=u[r][1];a=s.value[a];s.array[n]=a.x;s.array[n+1]=a.y;n=n+2}else if(s.size===3)if(s.type==="c")for(r=0;r<o;r++){a=u[r][1];a=s.value[a];s.array[n]=a.r;s.array[n+1]=a.g;s.array[n+2]=a.b;n=n+3}else for(r=0;r<o;r++){a=u[r][1];a=s.value[a];s.array[n]=a.x;s.array[n+1]=a.y;s.array[n+2]=a.z;n=n+3}else if(s.size===4)for(r=0;r<o;r++){a=u[r][1];a=s.value[a];s.array[n]=a.x;s.array[n+1]=a.y;s.array[n+2]=a.z;s.array[n+3]=a.w;n=n+4}}}}}else{if(E)for(r=0;r<a;r++){o=s[r];n=r*3;c[n]=o.x;c[n+1]=o.y;c[n+2]=o.z}if(p)for(r=0;r<h;r++){o=l[r];n=r*3;f[n]=o.r;f[n+1]=o.g;f[n+2]=o.b}if(d){l=0;for(h=d.length;l<h;l++){s=d[l];if(s.needsUpdate&&(s.boundTo===void 0||s.boundTo==="vertices")){o=s.value.length;n=0;if(s.size===1)for(r=0;r<o;r++)s.array[r]=s.value[r];else if(s.size===2)for(r=0;r<o;r++){a=s.value[r];s.array[n]=a.x;s.array[n+1]=a.y;n=n+2}else if(s.size===3)if(s.type==="c")for(r=0;r<o;r++){a=s.value[r];s.array[n]=a.r;s.array[n+1]=a.g;s.array[n+2]=a.b;n=n+3}else for(r=0;r<o;r++){a=s.value[r];s.array[n]=a.x;s.array[n+1]=a.y;s.array[n+2]=a.z;n=n+3}else if(s.size===4)for(r=0;r<o;r++){a=s.value[r];s.array[n]=a.x;s.array[n+1]=a.y;s.array[n+2]=a.z;s.array[n+3]=a.w;n=n+4}}}}}if(E||i.sortParticles){U.bindBuffer(U.ARRAY_BUFFER,e.__webglVertexBuffer);U.bufferData(U.ARRAY_BUFFER,c,t)}if(p||i.sortParticles){U.bindBuffer(U.ARRAY_BUFFER,e.__webglColorBuffer);U.bufferData(U.ARRAY_BUFFER,f,t)}if(d){l=0;for(h=d.length;l<h;l++){s=d[l];if(s.needsUpdate||i.sortParticles){U.bindBuffer(U.ARRAY_BUFFER,s.buffer);U.bufferData(U.ARRAY_BUFFER,s.array,t)}}}}function a(e,t){return t.z-e.z}function s(e,t,i){if(e.length)for(var r=0,o=e.length;r<o;r++){k=V=null;z=N=W=I=K=q=G=-1;ft=true;e[r].render(t,i,ot,nt);k=V=null;z=N=W=I=K=q=G=-1;ft=true}}function l(e,t,i,r,o,n,a,s){var l,h,c,f;if(t){h=e.length-1;f=t=-1}else{h=0;t=e.length;f=1}for(var u=h;u!==t;u=u+f){l=e[u];if(l.render){h=l.object;c=l.buffer;if(s)l=s;else{l=l[i];if(!l)continue;a&&F.setBlending(l.blending,l.blendEquation,l.blendSrc,l.blendDst);F.setDepthTest(l.depthTest);F.setDepthWrite(l.depthWrite);g(l.polygonOffset,l.polygonOffsetFactor,l.polygonOffsetUnits)}F.setObjectFaces(h);c instanceof THREE.BufferGeometry?F.renderBufferDirect(r,o,n,l,c,h):F.renderBuffer(r,o,n,l,c,h)}}}function h(e,t,i,r,o,n,a){for(var s,l,h=0,c=e.length;h<c;h++){s=e[h];l=s.object;if(l.visible){if(a)s=a;else{s=s[t];if(!s)continue;n&&F.setBlending(s.blending,s.blendEquation,s.blendSrc,s.blendDst);F.setDepthTest(s.depthTest);F.setDepthWrite(s.depthWrite);g(s.polygonOffset,s.polygonOffsetFactor,s.polygonOffsetUnits)}F.renderImmediateObject(i,r,o,s,l)}}}function c(e,t,i){e.push({buffer:t,object:i,opaque:null,transparent:null})}function f(e){for(var t in e.attributes)if(e.attributes[t].needsUpdate)return true;return false}function u(e){for(var t in e.attributes)e.attributes[t].needsUpdate=false}function E(e,t){for(var i=e.length-1;i>=0;i--)e[i].object===t&&e.splice(i,1)}function p(e,t){for(var i=e.length-1;i>=0;i--)e[i]===t&&e.splice(i,1)}function d(e,t,i,r,o){if(!r.program||r.needsUpdate){F.initMaterial(r,t,i,o);r.needsUpdate=false}if(r.morphTargets&&!o.__webglMorphTargetInfluences){o.__webglMorphTargetInfluences=new Float32Array(F.maxMorphTargets);for(var n=0,a=F.maxMorphTargets;n<a;n++)o.__webglMorphTargetInfluences[n]=0}var s=false,n=r.program,a=n.uniforms,l=r.uniforms;if(n!==V){U.useProgram(n);V=n;s=true}if(r.id!==z){z=r.id;s=true}if(s||e!==k){U.uniformMatrix4fv(a.projectionMatrix,false,e._projectionMatrixArray);e!==k&&(k=e)}if(s){if(i&&r.fog){l.fogColor.value=i.color;if(i instanceof THREE.Fog){l.fogNear.value=i.near;l.fogFar.value=i.far}else if(i instanceof THREE.FogExp2)l.fogDensity.value=i.density}if(r instanceof THREE.MeshPhongMaterial||r instanceof THREE.MeshLambertMaterial||r.lights){if(ft){for(var h,c=0,f=0,u=0,E,p,d,m=ut,g=m.directional.colors,v=m.directional.positions,R=m.point.colors,y=m.point.positions,b=m.point.distances,w=m.spot.colors,_=m.spot.positions,S=m.spot.distances,M=m.spot.directions,A=m.spot.angles,C=m.spot.exponents,L=0,P=0,D=0,B=d=0,i=B=0,s=t.length;i<s;i++){h=t[i];if(!h.onlyShadow){E=h.color;p=h.intensity;d=h.distance;if(h instanceof THREE.AmbientLight)if(F.gammaInput){c=c+E.r*E.r;f=f+E.g*E.g;u=u+E.b*E.b}else{c=c+E.r;f=f+E.g;u=u+E.b}else if(h instanceof THREE.DirectionalLight){d=L*3;if(F.gammaInput){g[d]=E.r*E.r*p*p;g[d+1]=E.g*E.g*p*p;g[d+2]=E.b*E.b*p*p}else{g[d]=E.r*p;g[d+1]=E.g*p;g[d+2]=E.b*p}ct.copy(h.matrixWorld.getPosition());ct.subSelf(h.target.matrixWorld.getPosition());ct.normalize();v[d]=ct.x;v[d+1]=ct.y;v[d+2]=ct.z;L=L+1}else if(h instanceof THREE.PointLight){B=P*3;if(F.gammaInput){R[B]=E.r*E.r*p*p;R[B+1]=E.g*E.g*p*p;R[B+2]=E.b*E.b*p*p}else{R[B]=E.r*p;R[B+1]=E.g*p;R[B+2]=E.b*p}E=h.matrixWorld.getPosition();y[B]=E.x;y[B+1]=E.y;y[B+2]=E.z;b[P]=d;P=P+1}else if(h instanceof THREE.SpotLight){B=D*3;if(F.gammaInput){w[B]=E.r*E.r*p*p;w[B+1]=E.g*E.g*p*p;w[B+2]=E.b*E.b*p*p}else{w[B]=E.r*p;w[B+1]=E.g*p;w[B+2]=E.b*p}E=h.matrixWorld.getPosition();_[B]=E.x;_[B+1]=E.y;_[B+2]=E.z;S[D]=d;ct.copy(E);ct.subSelf(h.target.matrixWorld.getPosition());ct.normalize();M[B]=ct.x;M[B+1]=ct.y;M[B+2]=ct.z;A[D]=Math.cos(h.angle);C[D]=h.exponent;D=D+1}}}i=L*3;for(s=g.length;i<s;i++)g[i]=0;i=P*3;for(s=R.length;i<s;i++)R[i]=0;i=D*3;for(s=w.length;i<s;i++)w[i]=0;m.directional.length=L;m.point.length=P;m.spot.length=D;m.ambient[0]=c;m.ambient[1]=f;m.ambient[2]=u;ft=false}i=ut;l.ambientLightColor.value=i.ambient;l.directionalLightColor.value=i.directional.colors;l.directionalLightDirection.value=i.directional.positions;l.pointLightColor.value=i.point.colors;l.pointLightPosition.value=i.point.positions;l.pointLightDistance.value=i.point.distances;l.spotLightColor.value=i.spot.colors;l.spotLightPosition.value=i.spot.positions;l.spotLightDistance.value=i.spot.distances;l.spotLightDirection.value=i.spot.directions;l.spotLightAngle.value=i.spot.angles;l.spotLightExponent.value=i.spot.exponents}if(r instanceof THREE.MeshBasicMaterial||r instanceof THREE.MeshLambertMaterial||r instanceof THREE.MeshPhongMaterial){l.opacity.value=r.opacity;F.gammaInput?l.diffuse.value.copyGammaToLinear(r.color):l.diffuse.value=r.color;(l.map.texture=r.map)&&l.offsetRepeat.value.set(r.map.offset.x,r.map.offset.y,r.map.repeat.x,r.map.repeat.y);l.lightMap.texture=r.lightMap;l.envMap.texture=r.envMap;l.flipEnvMap.value=r.envMap instanceof THREE.WebGLRenderTargetCube?1:-1;l.reflectivity.value=r.reflectivity;l.refractionRatio.value=r.refractionRatio;l.combine.value=r.combine;l.useRefract.value=r.envMap&&r.envMap.mapping instanceof THREE.CubeRefractionMapping}if(r instanceof THREE.LineBasicMaterial){l.diffuse.value=r.color;l.opacity.value=r.opacity}else if(r instanceof THREE.ParticleBasicMaterial){l.psColor.value=r.color;l.opacity.value=r.opacity;l.size.value=r.size;l.scale.value=H.height/2;l.map.texture=r.map}else if(r instanceof THREE.MeshPhongMaterial){l.shininess.value=r.shininess;if(F.gammaInput){l.ambient.value.copyGammaToLinear(r.ambient);l.emissive.value.copyGammaToLinear(r.emissive);l.specular.value.copyGammaToLinear(r.specular)}else{l.ambient.value=r.ambient;l.emissive.value=r.emissive;l.specular.value=r.specular}r.wrapAround&&l.wrapRGB.value.copy(r.wrapRGB)}else if(r instanceof THREE.MeshLambertMaterial){if(F.gammaInput){l.ambient.value.copyGammaToLinear(r.ambient);l.emissive.value.copyGammaToLinear(r.emissive)}else{l.ambient.value=r.ambient;l.emissive.value=r.emissive}r.wrapAround&&l.wrapRGB.value.copy(r.wrapRGB)}else if(r instanceof THREE.MeshDepthMaterial){l.mNear.value=e.near;l.mFar.value=e.far;l.opacity.value=r.opacity}else if(r instanceof THREE.MeshNormalMaterial)l.opacity.value=r.opacity;if(o.receiveShadow&&!r._shadowPass&&l.shadowMatrix){s=i=0;for(h=t.length;s<h;s++){c=t[s];if(c.castShadow&&(c instanceof THREE.SpotLight||c instanceof THREE.DirectionalLight&&!c.shadowCascade)){l.shadowMap.texture[i]=c.shadowMap;l.shadowMapSize.value[i]=c.shadowMapSize;l.shadowMatrix.value[i]=c.shadowMatrix;l.shadowDarkness.value[i]=c.shadowDarkness;l.shadowBias.value[i]=c.shadowBias;i++}}}t=r.uniformsList;l=0;for(i=t.length;l<i;l++)if(c=n.uniforms[t[l][1]]){s=t[l][0];f=s.type;h=s.value;switch(f){case"i":U.uniform1i(c,h);break;case"f":U.uniform1f(c,h);break;case"v2":U.uniform2f(c,h.x,h.y);break;case"v3":U.uniform3f(c,h.x,h.y,h.z);break;case"v4":U.uniform4f(c,h.x,h.y,h.z,h.w);break;case"c":U.uniform3f(c,h.r,h.g,h.b);break;case"fv1":U.uniform1fv(c,h);break;case"fv":U.uniform3fv(c,h);break;case"v2v":if(!s._array)s._array=new Float32Array(2*h.length);f=0;for(u=h.length;f<u;f++){m=f*2;s._array[m]=h[f].x;s._array[m+1]=h[f].y}U.uniform2fv(c,s._array);break;case"v3v":if(!s._array)s._array=new Float32Array(3*h.length);f=0;for(u=h.length;f<u;f++){m=f*3;s._array[m]=h[f].x;s._array[m+1]=h[f].y;s._array[m+2]=h[f].z}U.uniform3fv(c,s._array);break;case"v4v":if(!s._array)s._array=new Float32Array(4*h.length);f=0;for(u=h.length;f<u;f++){m=f*4;s._array[m]=h[f].x;s._array[m+1]=h[f].y;s._array[m+2]=h[f].z;s._array[m+3]=h[f].w}U.uniform4fv(c,s._array);break;case"m4":if(!s._array)s._array=new Float32Array(16);h.flattenToArray(s._array);U.uniformMatrix4fv(c,false,s._array);break;case"m4v":if(!s._array)s._array=new Float32Array(16*h.length);f=0;for(u=h.length;f<u;f++)h[f].flattenToArrayOffset(s._array,f*16);U.uniformMatrix4fv(c,false,s._array);break;case"t":U.uniform1i(c,h);c=s.texture;if(!c)continue;if(c.image instanceof Array&&c.image.length===6){s=c;if(s.image.length===6)if(s.needsUpdate){if(!s.image.__webglTextureCube)s.image.__webglTextureCube=U.createTexture();U.activeTexture(U.TEXTURE0+h);U.bindTexture(U.TEXTURE_CUBE_MAP,s.image.__webglTextureCube);h=[];for(c=0;c<6;c++){f=h;u=c;if(F.autoScaleCubemaps){m=s.image[c];v=pt;if(!(m.width<=v&&m.height<=v)){R=Math.max(m.width,m.height);g=Math.floor(m.width*v/R);v=Math.floor(m.height*v/R);R=document.createElement("canvas");R.width=g;R.height=v;R.getContext("2d").drawImage(m,0,0,m.width,m.height,0,0,g,v);m=R}}else m=s.image[c];f[u]=m}c=h[0];f=(c.width&c.width-1)===0&&(c.height&c.height-1)===0;u=x(s.format);m=x(s.type);T(U.TEXTURE_CUBE_MAP,s,f);for(c=0;c<6;c++)U.texImage2D(U.TEXTURE_CUBE_MAP_POSITIVE_X+c,0,u,u,m,h[c]);s.generateMipmaps&&f&&U.generateMipmap(U.TEXTURE_CUBE_MAP);s.needsUpdate=false;if(s.onUpdate)s.onUpdate()}else{U.activeTexture(U.TEXTURE0+h);U.bindTexture(U.TEXTURE_CUBE_MAP,s.image.__webglTextureCube)}}else if(c instanceof THREE.WebGLRenderTargetCube){s=c;U.activeTexture(U.TEXTURE0+h);U.bindTexture(U.TEXTURE_CUBE_MAP,s.__webglTexture)}else F.setTexture(c,h);break;case"tv":if(!s._array){s._array=[];f=0;for(u=s.texture.length;f<u;f++)s._array[f]=h+f}U.uniform1iv(c,s._array);f=0;for(u=s.texture.length;f<u;f++)(c=s.texture[f])&&F.setTexture(c,s._array[f])}}if((r instanceof THREE.ShaderMaterial||r instanceof THREE.MeshPhongMaterial||r.envMap)&&a.cameraPosition!==null){t=e.matrixWorld.getPosition();U.uniform3f(a.cameraPosition,t.x,t.y,t.z)}(r instanceof THREE.MeshPhongMaterial||r instanceof THREE.MeshLambertMaterial||r instanceof THREE.ShaderMaterial||r.skinning)&&a.viewMatrix!==null&&U.uniformMatrix4fv(a.viewMatrix,false,e._viewMatrixArray);r.skinning&&U.uniformMatrix4fv(a.boneGlobalMatrices,false,o.boneMatrices)}U.uniformMatrix4fv(a.modelViewMatrix,false,o._modelViewMatrix.elements);a.normalMatrix&&U.uniformMatrix3fv(a.normalMatrix,false,o._normalMatrix.elements);a.objectMatrix!==null&&U.uniformMatrix4fv(a.objectMatrix,false,o.matrixWorld.elements);return n}function m(e,t){e._modelViewMatrix.multiply(t.matrixWorldInverse,e.matrixWorld);e._normalMatrix.getInverse(e._modelViewMatrix);e._normalMatrix.transpose()}function g(e,t,i){if(Q!==e){e?U.enable(U.POLYGON_OFFSET_FILL):U.disable(U.POLYGON_OFFSET_FILL);Q=e}if(e&&(Z!==t||J!==i)){U.polygonOffset(t,i);Z=t;J=i}}function v(e,t){var i;e==="fragment"?i=U.createShader(U.FRAGMENT_SHADER):e==="vertex"&&(i=U.createShader(U.VERTEX_SHADER));U.shaderSource(i,t);U.compileShader(i);if(!U.getShaderParameter(i,U.COMPILE_STATUS)){console.error(U.getShaderInfoLog(i));console.error(t);return null}return i}function T(e,t,i){if(i){U.texParameteri(e,U.TEXTURE_WRAP_S,x(t.wrapS));U.texParameteri(e,U.TEXTURE_WRAP_T,x(t.wrapT));U.texParameteri(e,U.TEXTURE_MAG_FILTER,x(t.magFilter));U.texParameteri(e,U.TEXTURE_MIN_FILTER,x(t.minFilter))}else{U.texParameteri(e,U.TEXTURE_WRAP_S,U.CLAMP_TO_EDGE);U.texParameteri(e,U.TEXTURE_WRAP_T,U.CLAMP_TO_EDGE);U.texParameteri(e,U.TEXTURE_MAG_FILTER,y(t.magFilter));U.texParameteri(e,U.TEXTURE_MIN_FILTER,y(t.minFilter))}}function R(e,t){U.bindRenderbuffer(U.RENDERBUFFER,e);if(t.depthBuffer&&!t.stencilBuffer){U.renderbufferStorage(U.RENDERBUFFER,U.DEPTH_COMPONENT16,t.width,t.height);U.framebufferRenderbuffer(U.FRAMEBUFFER,U.DEPTH_ATTACHMENT,U.RENDERBUFFER,e)}else if(t.depthBuffer&&t.stencilBuffer){U.renderbufferStorage(U.RENDERBUFFER,U.DEPTH_STENCIL,t.width,t.height);U.framebufferRenderbuffer(U.FRAMEBUFFER,U.DEPTH_STENCIL_ATTACHMENT,U.RENDERBUFFER,e)}else U.renderbufferStorage(U.RENDERBUFFER,U.RGBA4,t.width,t.height)}function y(e){switch(e){case THREE.NearestFilter:case THREE.NearestMipMapNearestFilter:case THREE.NearestMipMapLinearFilter:return U.NEAREST;default:return U.LINEAR}}function x(e){switch(e){case THREE.RepeatWrapping:return U.REPEAT;case THREE.ClampToEdgeWrapping:return U.CLAMP_TO_EDGE;case THREE.MirroredRepeatWrapping:return U.MIRRORED_REPEAT;case THREE.NearestFilter:return U.NEAREST;case THREE.NearestMipMapNearestFilter:return U.NEAREST_MIPMAP_NEAREST;case THREE.NearestMipMapLinearFilter:return U.NEAREST_MIPMAP_LINEAR;case THREE.LinearFilter:return U.LINEAR;case THREE.LinearMipMapNearestFilter:return U.LINEAR_MIPMAP_NEAREST;case THREE.LinearMipMapLinearFilter:return U.LINEAR_MIPMAP_LINEAR;case THREE.ByteType:return U.BYTE;case THREE.UnsignedByteType:return U.UNSIGNED_BYTE;case THREE.ShortType:return U.SHORT;case THREE.UnsignedShortType:return U.UNSIGNED_SHORT;case THREE.IntType:return U.INT;case THREE.UnsignedIntType:return U.UNSIGNED_INT;case THREE.FloatType:return U.FLOAT;case THREE.AlphaFormat:return U.ALPHA;case THREE.RGBFormat:return U.RGB;case THREE.RGBAFormat:return U.RGBA;case THREE.LuminanceFormat:return U.LUMINANCE;case THREE.LuminanceAlphaFormat:return U.LUMINANCE_ALPHA;case THREE.AddEquation:return U.FUNC_ADD;case THREE.SubtractEquation:return U.FUNC_SUBTRACT;case THREE.ReverseSubtractEquation:return U.FUNC_REVERSE_SUBTRACT;case THREE.ZeroFactor:return U.ZERO;case THREE.OneFactor:return U.ONE;case THREE.SrcColorFactor:return U.SRC_COLOR;case THREE.OneMinusSrcColorFactor:return U.ONE_MINUS_SRC_COLOR;case THREE.SrcAlphaFactor:return U.SRC_ALPHA;case THREE.OneMinusSrcAlphaFactor:return U.ONE_MINUS_SRC_ALPHA;case THREE.DstAlphaFactor:return U.DST_ALPHA;case THREE.OneMinusDstAlphaFactor:return U.ONE_MINUS_DST_ALPHA;case THREE.DstColorFactor:return U.DST_COLOR;case THREE.OneMinusDstColorFactor:return U.ONE_MINUS_DST_COLOR;case THREE.SrcAlphaSaturateFactor:return U.SRC_ALPHA_SATURATE}return 0}var e=e||{},H=e.canvas!==void 0?e.canvas:document.createElement("canvas"),b=e.precision!==void 0?e.precision:"highp",w=e.alpha!==void 0?e.alpha:true,_=e.premultipliedAlpha!==void 0?e.premultipliedAlpha:true,S=e.antialias!==void 0?e.antialias:false,M=e.stencil!==void 0?e.stencil:true,A=e.preserveDrawingBuffer!==void 0?e.preserveDrawingBuffer:false,C=e.clearColor!==void 0?new THREE.Color(e.clearColor):new THREE.Color(0),L=e.clearAlpha!==void 0?e.clearAlpha:0,P=e.maxLights!==void 0?e.maxLights:4;this.domElement=H;this.context=null;this.autoUpdateScene=this.autoUpdateObjects=this.sortObjects=this.autoClearStencil=this.autoClearDepth=this.autoClearColor=this.autoClear=true;this.shadowMapEnabled=this.physicallyBasedShading=this.gammaOutput=this.gammaInput=false;this.shadowMapCullFrontFaces=this.shadowMapSoft=this.shadowMapAutoUpdate=true;this.shadowMapCascade=this.shadowMapDebug=false;this.maxMorphTargets=8;this.maxMorphNormals=4;this.autoScaleCubemaps=true;this.renderPluginsPre=[];this.renderPluginsPost=[];this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0}};var F=this,U,D=[],V=null,B=null,z=-1,N=null,k=null,O=0,I=-1,W=-1,G=-1,j=-1,X=-1,Y=-1,q=-1,K=-1,Q=null,Z=null,J=null,$=null,et=0,tt=0,it=0,rt=0,ot=0,nt=0,at=new THREE.Frustum,st=new THREE.Matrix4,lt=new THREE.Matrix4,ht=new THREE.Vector4,ct=new THREE.Vector3,ft=true,ut={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},point:{length:0,colors:[],positions:[],distances:[]},spot:{length:0,colors:[],positions:[],distances:[],directions:[],angles:[],exponents:[]}};U=function(){var e;try{if(!(e=H.getContext("experimental-webgl",{alpha:w,premultipliedAlpha:_,antialias:S,stencil:M,preserveDrawingBuffer:A})))throw"Error creating WebGL context."}catch(t){console.error(t)}e.getExtension("OES_texture_float")||console.log("THREE.WebGLRenderer: Float textures not supported.");return e}();U.clearColor(0,0,0,1);U.clearDepth(1);U.clearStencil(0);U.enable(U.DEPTH_TEST);U.depthFunc(U.LEQUAL);U.frontFace(U.CCW);U.cullFace(U.BACK);U.enable(U.CULL_FACE);U.enable(U.BLEND);U.blendEquation(U.FUNC_ADD);U.blendFunc(U.SRC_ALPHA,U.ONE_MINUS_SRC_ALPHA);U.clearColor(C.r,C.g,C.b,L);this.context=U;var Et=U.getParameter(U.MAX_VERTEX_TEXTURE_IMAGE_UNITS);U.getParameter(U.MAX_TEXTURE_SIZE);var pt=U.getParameter(U.MAX_CUBE_MAP_TEXTURE_SIZE);this.getContext=function(){return U};this.supportsVertexTextures=function(){return Et>0};this.setSize=function(e,t){H.width=e;H.height=t;this.setViewport(0,0,H.width,H.height)};this.setViewport=function(e,t,i,r){et=e;tt=t;it=i;rt=r;U.viewport(et,tt,it,rt)};this.setScissor=function(e,t,i,r){U.scissor(e,t,i,r)};this.enableScissorTest=function(e){e?U.enable(U.SCISSOR_TEST):U.disable(U.SCISSOR_TEST)};this.setClearColorHex=function(e,t){C.setHex(e);L=t;U.clearColor(C.r,C.g,C.b,L)};this.setClearColor=function(e,t){C.copy(e);L=t;U.clearColor(C.r,C.g,C.b,L)};this.getClearColor=function(){return C};this.getClearAlpha=function(){return L};this.clear=function(e,t,i){var r=0;if(e===void 0||e)r=r|U.COLOR_BUFFER_BIT;if(t===void 0||t)r=r|U.DEPTH_BUFFER_BIT;if(i===void 0||i)r=r|U.STENCIL_BUFFER_BIT;U.clear(r)};this.clearTarget=function(e,t,i,r){this.setRenderTarget(e);this.clear(t,i,r)};this.addPostPlugin=function(e){e.init(this);this.renderPluginsPost.push(e)};this.addPrePlugin=function(e){e.init(this);this.renderPluginsPre.push(e)};this.deallocateObject=function(e){if(e.__webglInit){e.__webglInit=false;delete e._modelViewMatrix;delete e._normalMatrix;delete e._normalMatrixArray;delete e._modelViewMatrixArray;delete e._objectMatrixArray;if(e instanceof THREE.Mesh)for(var t in e.geometry.geometryGroups){var i=e.geometry.geometryGroups[t];U.deleteBuffer(i.__webglVertexBuffer);U.deleteBuffer(i.__webglNormalBuffer);U.deleteBuffer(i.__webglTangentBuffer);U.deleteBuffer(i.__webglColorBuffer);U.deleteBuffer(i.__webglUVBuffer);U.deleteBuffer(i.__webglUV2Buffer);U.deleteBuffer(i.__webglSkinVertexABuffer);U.deleteBuffer(i.__webglSkinVertexBBuffer);U.deleteBuffer(i.__webglSkinIndicesBuffer);U.deleteBuffer(i.__webglSkinWeightsBuffer);U.deleteBuffer(i.__webglFaceBuffer);U.deleteBuffer(i.__webglLineBuffer);var r=void 0,o=void 0;if(i.numMorphTargets){r=0;for(o=i.numMorphTargets;r<o;r++)U.deleteBuffer(i.__webglMorphTargetsBuffers[r])}if(i.numMorphNormals){r=0;for(o=i.numMorphNormals;r<o;r++)U.deleteBuffer(i.__webglMorphNormalsBuffers[r])}if(i.__webglCustomAttributesList){r=void 0;for(r in i.__webglCustomAttributesList)U.deleteBuffer(i.__webglCustomAttributesList[r].buffer)}F.info.memory.geometries--}else if(e instanceof THREE.Ribbon){e=e.geometry;U.deleteBuffer(e.__webglVertexBuffer);U.deleteBuffer(e.__webglColorBuffer);F.info.memory.geometries--}else if(e instanceof THREE.Line){e=e.geometry;U.deleteBuffer(e.__webglVertexBuffer);U.deleteBuffer(e.__webglColorBuffer);F.info.memory.geometries--}else if(e instanceof THREE.ParticleSystem){e=e.geometry;U.deleteBuffer(e.__webglVertexBuffer);U.deleteBuffer(e.__webglColorBuffer);F.info.memory.geometries--}}};this.deallocateTexture=function(e){if(e.__webglInit){e.__webglInit=false;U.deleteTexture(e.__webglTexture);F.info.memory.textures--}};this.deallocateRenderTarget=function(e){if(e&&e.__webglTexture){U.deleteTexture(e.__webglTexture);
if(e instanceof THREE.WebGLRenderTargetCube)for(var t=0;t<6;t++){U.deleteFramebuffer(e.__webglFramebuffer[t]);U.deleteRenderbuffer(e.__webglRenderbuffer[t])}else{U.deleteFramebuffer(e.__webglFramebuffer);U.deleteRenderbuffer(e.__webglRenderbuffer)}}};this.updateShadowMap=function(e,t){V=null;z=N=K=q=G=-1;ft=true;W=I=-1;this.shadowMapPlugin.update(e,t)};this.renderBufferImmediate=function(e,t,i){if(!e.__webglVertexBuffer)e.__webglVertexBuffer=U.createBuffer();if(!e.__webglNormalBuffer)e.__webglNormalBuffer=U.createBuffer();if(e.hasPos){U.bindBuffer(U.ARRAY_BUFFER,e.__webglVertexBuffer);U.bufferData(U.ARRAY_BUFFER,e.positionArray,U.DYNAMIC_DRAW);U.enableVertexAttribArray(t.attributes.position);U.vertexAttribPointer(t.attributes.position,3,U.FLOAT,false,0,0)}if(e.hasNormal){U.bindBuffer(U.ARRAY_BUFFER,e.__webglNormalBuffer);if(i===THREE.FlatShading){var r,o,n,a,s,l,h,c,f,u,E=e.count*3;for(u=0;u<E;u=u+9){i=e.normalArray;r=i[u];o=i[u+1];n=i[u+2];a=i[u+3];l=i[u+4];c=i[u+5];s=i[u+6];h=i[u+7];f=i[u+8];r=(r+a+s)/3;o=(o+l+h)/3;n=(n+c+f)/3;i[u]=r;i[u+1]=o;i[u+2]=n;i[u+3]=r;i[u+4]=o;i[u+5]=n;i[u+6]=r;i[u+7]=o;i[u+8]=n}}U.bufferData(U.ARRAY_BUFFER,e.normalArray,U.DYNAMIC_DRAW);U.enableVertexAttribArray(t.attributes.normal);U.vertexAttribPointer(t.attributes.normal,3,U.FLOAT,false,0,0)}U.drawArrays(U.TRIANGLES,0,e.count);e.count=0};this.renderBufferDirect=function(e,t,i,r,o,n){if(r.visible!==false){i=d(e,t,i,r,n);e=i.attributes;t=false;r=o.id*16777215+i.id*2+(r.wireframe?1:0);if(r!==N){N=r;t=true}if(n instanceof THREE.Mesh){n=o.offsets;r=0;for(i=n.length;r<i;++r){if(t){U.bindBuffer(U.ARRAY_BUFFER,o.vertexPositionBuffer);U.vertexAttribPointer(e.position,o.vertexPositionBuffer.itemSize,U.FLOAT,false,0,n[r].index*12);if(e.normal>=0&&o.vertexNormalBuffer){U.bindBuffer(U.ARRAY_BUFFER,o.vertexNormalBuffer);U.vertexAttribPointer(e.normal,o.vertexNormalBuffer.itemSize,U.FLOAT,false,0,n[r].index*12)}if(e.uv>=0&&o.vertexUvBuffer)if(o.vertexUvBuffer){U.bindBuffer(U.ARRAY_BUFFER,o.vertexUvBuffer);U.vertexAttribPointer(e.uv,o.vertexUvBuffer.itemSize,U.FLOAT,false,0,n[r].index*8);U.enableVertexAttribArray(e.uv)}else U.disableVertexAttribArray(e.uv);if(e.color>=0&&o.vertexColorBuffer){U.bindBuffer(U.ARRAY_BUFFER,o.vertexColorBuffer);U.vertexAttribPointer(e.color,o.vertexColorBuffer.itemSize,U.FLOAT,false,0,n[r].index*16)}U.bindBuffer(U.ELEMENT_ARRAY_BUFFER,o.vertexIndexBuffer)}U.drawElements(U.TRIANGLES,n[r].count,U.UNSIGNED_SHORT,n[r].start*2);F.info.render.calls++;F.info.render.vertices=F.info.render.vertices+n[r].count;F.info.render.faces=F.info.render.faces+n[r].count/3}}}};this.renderBuffer=function(e,t,i,r,o,n){if(r.visible!==false){var a,s,i=d(e,t,i,r,n),t=i.attributes,e=false,i=o.id*16777215+i.id*2+(r.wireframe?1:0);if(i!==N){N=i;e=true}if(!r.morphTargets&&t.position>=0){if(e){U.bindBuffer(U.ARRAY_BUFFER,o.__webglVertexBuffer);U.vertexAttribPointer(t.position,3,U.FLOAT,false,0,0)}}else if(n.morphTargetBase){i=r.program.attributes;if(n.morphTargetBase!==-1){U.bindBuffer(U.ARRAY_BUFFER,o.__webglMorphTargetsBuffers[n.morphTargetBase]);U.vertexAttribPointer(i.position,3,U.FLOAT,false,0,0)}else if(i.position>=0){U.bindBuffer(U.ARRAY_BUFFER,o.__webglVertexBuffer);U.vertexAttribPointer(i.position,3,U.FLOAT,false,0,0)}if(n.morphTargetForcedOrder.length){a=0;var l=n.morphTargetForcedOrder;for(s=n.morphTargetInfluences;a<r.numSupportedMorphTargets&&a<l.length;){U.bindBuffer(U.ARRAY_BUFFER,o.__webglMorphTargetsBuffers[l[a]]);U.vertexAttribPointer(i["morphTarget"+a],3,U.FLOAT,false,0,0);if(r.morphNormals){U.bindBuffer(U.ARRAY_BUFFER,o.__webglMorphNormalsBuffers[l[a]]);U.vertexAttribPointer(i["morphNormal"+a],3,U.FLOAT,false,0,0)}n.__webglMorphTargetInfluences[a]=s[l[a]];a++}}else{var l=[],h=-1,c=0;s=n.morphTargetInfluences;var f,u=s.length;a=0;for(n.morphTargetBase!==-1&&(l[n.morphTargetBase]=true);a<r.numSupportedMorphTargets;){for(f=0;f<u;f++)if(!l[f]&&s[f]>h){c=f;h=s[c]}U.bindBuffer(U.ARRAY_BUFFER,o.__webglMorphTargetsBuffers[c]);U.vertexAttribPointer(i["morphTarget"+a],3,U.FLOAT,false,0,0);if(r.morphNormals){U.bindBuffer(U.ARRAY_BUFFER,o.__webglMorphNormalsBuffers[c]);U.vertexAttribPointer(i["morphNormal"+a],3,U.FLOAT,false,0,0)}n.__webglMorphTargetInfluences[a]=h;l[c]=1;h=-1;a++}}r.program.uniforms.morphTargetInfluences!==null&&U.uniform1fv(r.program.uniforms.morphTargetInfluences,n.__webglMorphTargetInfluences)}if(e){if(o.__webglCustomAttributesList){a=0;for(s=o.__webglCustomAttributesList.length;a<s;a++){i=o.__webglCustomAttributesList[a];if(t[i.buffer.belongsToAttribute]>=0){U.bindBuffer(U.ARRAY_BUFFER,i.buffer);U.vertexAttribPointer(t[i.buffer.belongsToAttribute],i.size,U.FLOAT,false,0,0)}}}if(t.color>=0){U.bindBuffer(U.ARRAY_BUFFER,o.__webglColorBuffer);U.vertexAttribPointer(t.color,3,U.FLOAT,false,0,0)}if(t.normal>=0){U.bindBuffer(U.ARRAY_BUFFER,o.__webglNormalBuffer);U.vertexAttribPointer(t.normal,3,U.FLOAT,false,0,0)}if(t.tangent>=0){U.bindBuffer(U.ARRAY_BUFFER,o.__webglTangentBuffer);U.vertexAttribPointer(t.tangent,4,U.FLOAT,false,0,0)}if(t.uv>=0)if(o.__webglUVBuffer){U.bindBuffer(U.ARRAY_BUFFER,o.__webglUVBuffer);U.vertexAttribPointer(t.uv,2,U.FLOAT,false,0,0);U.enableVertexAttribArray(t.uv)}else U.disableVertexAttribArray(t.uv);if(t.uv2>=0)if(o.__webglUV2Buffer){U.bindBuffer(U.ARRAY_BUFFER,o.__webglUV2Buffer);U.vertexAttribPointer(t.uv2,2,U.FLOAT,false,0,0);U.enableVertexAttribArray(t.uv2)}else U.disableVertexAttribArray(t.uv2);if(r.skinning&&t.skinVertexA>=0&&t.skinVertexB>=0&&t.skinIndex>=0&&t.skinWeight>=0){U.bindBuffer(U.ARRAY_BUFFER,o.__webglSkinVertexABuffer);U.vertexAttribPointer(t.skinVertexA,4,U.FLOAT,false,0,0);U.bindBuffer(U.ARRAY_BUFFER,o.__webglSkinVertexBBuffer);U.vertexAttribPointer(t.skinVertexB,4,U.FLOAT,false,0,0);U.bindBuffer(U.ARRAY_BUFFER,o.__webglSkinIndicesBuffer);U.vertexAttribPointer(t.skinIndex,4,U.FLOAT,false,0,0);U.bindBuffer(U.ARRAY_BUFFER,o.__webglSkinWeightsBuffer);U.vertexAttribPointer(t.skinWeight,4,U.FLOAT,false,0,0)}}if(n instanceof THREE.Mesh){if(r.wireframe){r=r.wireframeLinewidth;if(r!==$){U.lineWidth(r);$=r}e&&U.bindBuffer(U.ELEMENT_ARRAY_BUFFER,o.__webglLineBuffer);U.drawElements(U.LINES,o.__webglLineCount,U.UNSIGNED_SHORT,0)}else{e&&U.bindBuffer(U.ELEMENT_ARRAY_BUFFER,o.__webglFaceBuffer);U.drawElements(U.TRIANGLES,o.__webglFaceCount,U.UNSIGNED_SHORT,0)}F.info.render.calls++;F.info.render.vertices=F.info.render.vertices+o.__webglFaceCount;F.info.render.faces=F.info.render.faces+o.__webglFaceCount/3}else if(n instanceof THREE.Line){n=n.type===THREE.LineStrip?U.LINE_STRIP:U.LINES;r=r.linewidth;if(r!==$){U.lineWidth(r);$=r}U.drawArrays(n,0,o.__webglLineCount);F.info.render.calls++}else if(n instanceof THREE.ParticleSystem){U.drawArrays(U.POINTS,0,o.__webglParticleCount);F.info.render.calls++;F.info.render.points=F.info.render.points+o.__webglParticleCount}else if(n instanceof THREE.Ribbon){U.drawArrays(U.TRIANGLE_STRIP,0,o.__webglVertexCount);F.info.render.calls++}}};this.render=function(e,t,i,r){var o,n,c,f,u=e.__lights,E=e.fog;z=-1;ft=true;if(t.parent===void 0){console.warn("DEPRECATED: Camera hasn't been added to a Scene. Adding it...");e.add(t)}this.autoUpdateScene&&e.updateMatrixWorld();if(!t._viewMatrixArray)t._viewMatrixArray=new Float32Array(16);if(!t._projectionMatrixArray)t._projectionMatrixArray=new Float32Array(16);t.matrixWorldInverse.getInverse(t.matrixWorld);t.matrixWorldInverse.flattenToArray(t._viewMatrixArray);t.projectionMatrix.flattenToArray(t._projectionMatrixArray);st.multiply(t.projectionMatrix,t.matrixWorldInverse);at.setFromMatrix(st);this.autoUpdateObjects&&this.initWebGLObjects(e);s(this.renderPluginsPre,e,t);F.info.render.calls=0;F.info.render.vertices=0;F.info.render.faces=0;F.info.render.points=0;this.setRenderTarget(i);(this.autoClear||r)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil);f=e.__webglObjects;r=0;for(o=f.length;r<o;r++){n=f[r];c=n.object;n.render=false;if(c.visible&&(!(c instanceof THREE.Mesh||c instanceof THREE.ParticleSystem)||!c.frustumCulled||at.contains(c))){m(c,t);var p=n,d=p.object,v=p.buffer,T=void 0,T=T=void 0,T=d.material;if(T instanceof THREE.MeshFaceMaterial){T=v.materialIndex;if(T>=0){T=d.geometry.materials[T];if(T.transparent){p.transparent=T;p.opaque=null}else{p.opaque=T;p.transparent=null}}}else if(T)if(T.transparent){p.transparent=T;p.opaque=null}else{p.opaque=T;p.transparent=null}n.render=true;if(this.sortObjects)if(c.renderDepth)n.z=c.renderDepth;else{ht.copy(c.matrixWorld.getPosition());st.multiplyVector3(ht);n.z=ht.z}}}this.sortObjects&&f.sort(a);f=e.__webglObjectsImmediate;r=0;for(o=f.length;r<o;r++){n=f[r];c=n.object;if(c.visible){m(c,t);c=n.object.material;if(c.transparent){n.transparent=c;n.opaque=null}else{n.opaque=c;n.transparent=null}}}if(e.overrideMaterial){r=e.overrideMaterial;this.setBlending(r.blending,r.blendEquation,r.blendSrc,r.blendDst);this.setDepthTest(r.depthTest);this.setDepthWrite(r.depthWrite);g(r.polygonOffset,r.polygonOffsetFactor,r.polygonOffsetUnits);l(e.__webglObjects,false,"",t,u,E,true,r);h(e.__webglObjectsImmediate,"",t,u,E,false,r)}else{this.setBlending(THREE.NormalBlending);l(e.__webglObjects,true,"opaque",t,u,E,false);h(e.__webglObjectsImmediate,"opaque",t,u,E,false);l(e.__webglObjects,false,"transparent",t,u,E,true);h(e.__webglObjectsImmediate,"transparent",t,u,E,true)}s(this.renderPluginsPost,e,t);if(i&&i.generateMipmaps&&i.minFilter!==THREE.NearestFilter&&i.minFilter!==THREE.LinearFilter)if(i instanceof THREE.WebGLRenderTargetCube){U.bindTexture(U.TEXTURE_CUBE_MAP,i.__webglTexture);U.generateMipmap(U.TEXTURE_CUBE_MAP);U.bindTexture(U.TEXTURE_CUBE_MAP,null)}else{U.bindTexture(U.TEXTURE_2D,i.__webglTexture);U.generateMipmap(U.TEXTURE_2D);U.bindTexture(U.TEXTURE_2D,null)}this.setDepthTest(true);this.setDepthWrite(true)};this.renderImmediateObject=function(e,t,i,r,o){var n=d(e,t,i,r,o);N=-1;F.setObjectFaces(o);o.immediateRenderCallback?o.immediateRenderCallback(n,U,at):o.render(function(e){F.renderBufferImmediate(e,n,r.shading)})};this.initWebGLObjects=function(e){if(!e.__webglObjects){e.__webglObjects=[];e.__webglObjectsImmediate=[];e.__webglSprites=[];e.__webglFlares=[]}for(;e.__objectsAdded.length;){var a=e.__objectsAdded[0],s=e,l=void 0,h=void 0,d=void 0;if(!a.__webglInit){a.__webglInit=true;a._modelViewMatrix=new THREE.Matrix4;a._normalMatrix=new THREE.Matrix3;if(a instanceof THREE.Mesh){h=a.geometry;if(h instanceof THREE.Geometry){if(h.geometryGroups===void 0){var m=h,g=void 0,v=void 0,T=void 0,R=void 0,y=void 0,x=void 0,H=void 0,b={},w=m.morphTargets.length,_=m.morphNormals.length;m.geometryGroups={};g=0;for(v=m.faces.length;g<v;g++){T=m.faces[g];R=T.materialIndex;x=R!==void 0?R:-1;b[x]===void 0&&(b[x]={hash:x,counter:0});H=b[x].hash+"_"+b[x].counter;m.geometryGroups[H]===void 0&&(m.geometryGroups[H]={faces3:[],faces4:[],materialIndex:R,vertices:0,numMorphTargets:w,numMorphNormals:_});y=T instanceof THREE.Face3?3:4;if(m.geometryGroups[H].vertices+y>65535){b[x].counter=b[x].counter+1;H=b[x].hash+"_"+b[x].counter;m.geometryGroups[H]===void 0&&(m.geometryGroups[H]={faces3:[],faces4:[],materialIndex:R,vertices:0,numMorphTargets:w,numMorphNormals:_})}T instanceof THREE.Face3?m.geometryGroups[H].faces3.push(g):m.geometryGroups[H].faces4.push(g);m.geometryGroups[H].vertices=m.geometryGroups[H].vertices+y}m.geometryGroupsList=[];var S=void 0;for(S in m.geometryGroups){m.geometryGroups[S].id=O++;m.geometryGroupsList.push(m.geometryGroups[S])}}for(l in h.geometryGroups){d=h.geometryGroups[l];if(!d.__webglVertexBuffer){var M=d;M.__webglVertexBuffer=U.createBuffer();M.__webglNormalBuffer=U.createBuffer();M.__webglTangentBuffer=U.createBuffer();M.__webglColorBuffer=U.createBuffer();M.__webglUVBuffer=U.createBuffer();M.__webglUV2Buffer=U.createBuffer();M.__webglSkinVertexABuffer=U.createBuffer();M.__webglSkinVertexBBuffer=U.createBuffer();M.__webglSkinIndicesBuffer=U.createBuffer();M.__webglSkinWeightsBuffer=U.createBuffer();M.__webglFaceBuffer=U.createBuffer();M.__webglLineBuffer=U.createBuffer();var A=void 0,C=void 0;if(M.numMorphTargets){M.__webglMorphTargetsBuffers=[];A=0;for(C=M.numMorphTargets;A<C;A++)M.__webglMorphTargetsBuffers.push(U.createBuffer())}if(M.numMorphNormals){M.__webglMorphNormalsBuffers=[];A=0;for(C=M.numMorphNormals;A<C;A++)M.__webglMorphNormalsBuffers.push(U.createBuffer())}F.info.memory.geometries++;var L=d,P=a,D=P.geometry,V=L.faces3,B=L.faces4,z=V.length*3+B.length*4,N=V.length*1+B.length*2,k=V.length*3+B.length*4,I=i(P,L),W=o(I),G=r(I),j=I.vertexColors?I.vertexColors:false;L.__vertexArray=new Float32Array(z*3);if(G)L.__normalArray=new Float32Array(z*3);if(D.hasTangents)L.__tangentArray=new Float32Array(z*4);if(j)L.__colorArray=new Float32Array(z*3);if(W){if(D.faceUvs.length>0||D.faceVertexUvs.length>0)L.__uvArray=new Float32Array(z*2);if(D.faceUvs.length>1||D.faceVertexUvs.length>1)L.__uv2Array=new Float32Array(z*2)}if(P.geometry.skinWeights.length&&P.geometry.skinIndices.length){L.__skinVertexAArray=new Float32Array(z*4);L.__skinVertexBArray=new Float32Array(z*4);L.__skinIndexArray=new Float32Array(z*4);L.__skinWeightArray=new Float32Array(z*4)}L.__faceArray=new Uint16Array(N*3);L.__lineArray=new Uint16Array(k*2);var X=void 0,Y=void 0;if(L.numMorphTargets){L.__morphTargetsArrays=[];X=0;for(Y=L.numMorphTargets;X<Y;X++)L.__morphTargetsArrays.push(new Float32Array(z*3))}if(L.numMorphNormals){L.__morphNormalsArrays=[];X=0;for(Y=L.numMorphNormals;X<Y;X++)L.__morphNormalsArrays.push(new Float32Array(z*3))}L.__webglFaceCount=N*3;L.__webglLineCount=k*2;if(I.attributes){if(L.__webglCustomAttributesList===void 0)L.__webglCustomAttributesList=[];var q=void 0;for(q in I.attributes){var K=I.attributes[q],Q={},Z;for(Z in K)Q[Z]=K[Z];if(!Q.__webglInitialized||Q.createUniqueBuffers){Q.__webglInitialized=true;var J=1;Q.type==="v2"?J=2:Q.type==="v3"?J=3:Q.type==="v4"?J=4:Q.type==="c"&&(J=3);Q.size=J;Q.array=new Float32Array(z*J);Q.buffer=U.createBuffer();Q.buffer.belongsToAttribute=q;K.needsUpdate=true;Q.__original=K}L.__webglCustomAttributesList.push(Q)}}L.__inittedArrays=true;h.verticesNeedUpdate=true;h.morphTargetsNeedUpdate=true;h.elementsNeedUpdate=true;h.uvsNeedUpdate=true;h.normalsNeedUpdate=true;h.tangetsNeedUpdate=true;h.colorsNeedUpdate=true}}}}else if(a instanceof THREE.Ribbon){h=a.geometry;if(!h.__webglVertexBuffer){var $=h;$.__webglVertexBuffer=U.createBuffer();$.__webglColorBuffer=U.createBuffer();F.info.memory.geometries++;var et=h,tt=et.vertices.length;et.__vertexArray=new Float32Array(tt*3);et.__colorArray=new Float32Array(tt*3);et.__webglVertexCount=tt;h.verticesNeedUpdate=true;h.colorsNeedUpdate=true}}else if(a instanceof THREE.Line){h=a.geometry;if(!h.__webglVertexBuffer){var it=h;it.__webglVertexBuffer=U.createBuffer();it.__webglColorBuffer=U.createBuffer();F.info.memory.geometries++;var rt=h,ot=a,nt=rt.vertices.length;rt.__vertexArray=new Float32Array(nt*3);rt.__colorArray=new Float32Array(nt*3);rt.__webglLineCount=nt;t(rt,ot);h.verticesNeedUpdate=true;h.colorsNeedUpdate=true}}else if(a instanceof THREE.ParticleSystem){h=a.geometry;if(!h.__webglVertexBuffer){var at=h;at.__webglVertexBuffer=U.createBuffer();at.__webglColorBuffer=U.createBuffer();F.info.geometries++;var st=h,lt=a,ht=st.vertices.length;st.__vertexArray=new Float32Array(ht*3);st.__colorArray=new Float32Array(ht*3);st.__sortArray=[];st.__webglParticleCount=ht;t(st,lt);h.verticesNeedUpdate=true;h.colorsNeedUpdate=true}}}if(!a.__webglActive){if(a instanceof THREE.Mesh){h=a.geometry;if(h instanceof THREE.BufferGeometry)c(s.__webglObjects,h,a);else for(l in h.geometryGroups){d=h.geometryGroups[l];c(s.__webglObjects,d,a)}}else if(a instanceof THREE.Ribbon||a instanceof THREE.Line||a instanceof THREE.ParticleSystem){h=a.geometry;c(s.__webglObjects,h,a)}else a instanceof THREE.ImmediateRenderObject||a.immediateRenderCallback?s.__webglObjectsImmediate.push({object:a,opaque:null,transparent:null}):a instanceof THREE.Sprite?s.__webglSprites.push(a):a instanceof THREE.LensFlare&&s.__webglFlares.push(a);a.__webglActive=true}e.__objectsAdded.splice(0,1)}for(;e.__objectsRemoved.length;){var ct=e.__objectsRemoved[0],ft=e;ct instanceof THREE.Mesh||ct instanceof THREE.ParticleSystem||ct instanceof THREE.Ribbon||ct instanceof THREE.Line?E(ft.__webglObjects,ct):ct instanceof THREE.Sprite?p(ft.__webglSprites,ct):ct instanceof THREE.LensFlare?p(ft.__webglFlares,ct):(ct instanceof THREE.ImmediateRenderObject||ct.immediateRenderCallback)&&E(ft.__webglObjectsImmediate,ct);ct.__webglActive=false;e.__objectsRemoved.splice(0,1)}for(var ut=0,Et=e.__webglObjects.length;ut<Et;ut++){var pt=e.__webglObjects[ut].object,dt=pt.geometry,mt=void 0,gt=void 0,vt=void 0;if(pt instanceof THREE.Mesh)if(dt instanceof THREE.BufferGeometry){dt.verticesNeedUpdate=false;dt.elementsNeedUpdate=false;dt.uvsNeedUpdate=false;dt.normalsNeedUpdate=false;dt.colorsNeedUpdate=false}else{for(var Tt=0,Rt=dt.geometryGroupsList.length;Tt<Rt;Tt++){mt=dt.geometryGroupsList[Tt];vt=i(pt,mt);gt=vt.attributes&&f(vt);if(dt.verticesNeedUpdate||dt.morphTargetsNeedUpdate||dt.elementsNeedUpdate||dt.uvsNeedUpdate||dt.normalsNeedUpdate||dt.colorsNeedUpdate||dt.tangetsNeedUpdate||gt){var yt=mt,xt=pt,Ht=U.DYNAMIC_DRAW,bt=!dt.dynamic,wt=vt;if(yt.__inittedArrays){var _t=r(wt),St=wt.vertexColors?wt.vertexColors:false,Mt=o(wt),At=_t===THREE.SmoothShading,Ct=void 0,Lt=void 0,Pt=void 0,Ft=void 0,Ut=void 0,Dt=void 0,Vt=void 0,Bt=void 0,zt=void 0,Nt=void 0,kt=void 0,Ot=void 0,It=void 0,Wt=void 0,Gt=void 0,jt=void 0,Xt=void 0,Yt=void 0,qt=void 0,Kt=void 0,Qt=void 0,Zt=void 0,Jt=void 0,$t=void 0,ei=void 0,ti=void 0,ii=void 0,ri=void 0,oi=void 0,ni=void 0,ai=void 0,si=void 0,li=void 0,hi=void 0,ci=void 0,fi=void 0,ui=void 0,Ei=void 0,pi=void 0,di=void 0,mi=void 0,gi=void 0,vi=void 0,Ti=void 0,Ri=void 0,yi=void 0,xi=void 0,Hi=void 0,bi=void 0,wi=void 0,_i=void 0,Si=void 0,Mi=void 0,Ai=void 0,Ci=0,Li=0,Pi=0,Fi=0,Ui=0,Di=0,Vi=0,Bi=0,zi=0,Ni=0,ki=0,Oi=0,Ii=void 0,Wi=yt.__vertexArray,Gi=yt.__uvArray,ji=yt.__uv2Array,Xi=yt.__normalArray,Yi=yt.__tangentArray,qi=yt.__colorArray,Ki=yt.__skinVertexAArray,Qi=yt.__skinVertexBArray,Zi=yt.__skinIndexArray,Ji=yt.__skinWeightArray,$i=yt.__morphTargetsArrays,er=yt.__morphNormalsArrays,tr=yt.__webglCustomAttributesList,ir=void 0,rr=yt.__faceArray,or=yt.__lineArray,nr=xt.geometry,ar=nr.elementsNeedUpdate,sr=nr.uvsNeedUpdate,lr=nr.normalsNeedUpdate,hr=nr.tangetsNeedUpdate,cr=nr.colorsNeedUpdate,fr=nr.morphTargetsNeedUpdate,ur=nr.vertices,Er=yt.faces3,pr=yt.faces4,dr=nr.faces,mr=nr.faceVertexUvs[0],gr=nr.faceVertexUvs[1],vr=nr.skinVerticesA,Tr=nr.skinVerticesB,Rr=nr.skinIndices,yr=nr.skinWeights,xr=nr.morphTargets,Hr=nr.morphNormals;if(nr.verticesNeedUpdate){Ct=0;for(Lt=Er.length;Ct<Lt;Ct++){Ft=dr[Er[Ct]];Ot=ur[Ft.a];It=ur[Ft.b];Wt=ur[Ft.c];Wi[Li]=Ot.x;Wi[Li+1]=Ot.y;Wi[Li+2]=Ot.z;Wi[Li+3]=It.x;Wi[Li+4]=It.y;Wi[Li+5]=It.z;Wi[Li+6]=Wt.x;Wi[Li+7]=Wt.y;Wi[Li+8]=Wt.z;Li=Li+9}Ct=0;for(Lt=pr.length;Ct<Lt;Ct++){Ft=dr[pr[Ct]];Ot=ur[Ft.a];It=ur[Ft.b];Wt=ur[Ft.c];Gt=ur[Ft.d];Wi[Li]=Ot.x;Wi[Li+1]=Ot.y;Wi[Li+2]=Ot.z;Wi[Li+3]=It.x;Wi[Li+4]=It.y;Wi[Li+5]=It.z;Wi[Li+6]=Wt.x;Wi[Li+7]=Wt.y;Wi[Li+8]=Wt.z;Wi[Li+9]=Gt.x;Wi[Li+10]=Gt.y;Wi[Li+11]=Gt.z;Li=Li+12}U.bindBuffer(U.ARRAY_BUFFER,yt.__webglVertexBuffer);U.bufferData(U.ARRAY_BUFFER,Wi,Ht)}if(fr){bi=0;for(wi=xr.length;bi<wi;bi++){Ct=ki=0;for(Lt=Er.length;Ct<Lt;Ct++){Mi=Er[Ct];Ft=dr[Mi];Ot=xr[bi].vertices[Ft.a];It=xr[bi].vertices[Ft.b];Wt=xr[bi].vertices[Ft.c];_i=$i[bi];_i[ki]=Ot.x;_i[ki+1]=Ot.y;_i[ki+2]=Ot.z;_i[ki+3]=It.x;_i[ki+4]=It.y;_i[ki+5]=It.z;_i[ki+6]=Wt.x;_i[ki+7]=Wt.y;_i[ki+8]=Wt.z;if(wt.morphNormals){if(At){Ai=Hr[bi].vertexNormals[Mi];Kt=Ai.a;Qt=Ai.b;Zt=Ai.c}else Zt=Qt=Kt=Hr[bi].faceNormals[Mi];Si=er[bi];Si[ki]=Kt.x;Si[ki+1]=Kt.y;Si[ki+2]=Kt.z;Si[ki+3]=Qt.x;Si[ki+4]=Qt.y;Si[ki+5]=Qt.z;Si[ki+6]=Zt.x;Si[ki+7]=Zt.y;Si[ki+8]=Zt.z}ki=ki+9}Ct=0;for(Lt=pr.length;Ct<Lt;Ct++){Mi=pr[Ct];Ft=dr[Mi];Ot=xr[bi].vertices[Ft.a];It=xr[bi].vertices[Ft.b];Wt=xr[bi].vertices[Ft.c];Gt=xr[bi].vertices[Ft.d];_i=$i[bi];_i[ki]=Ot.x;_i[ki+1]=Ot.y;_i[ki+2]=Ot.z;_i[ki+3]=It.x;_i[ki+4]=It.y;_i[ki+5]=It.z;_i[ki+6]=Wt.x;_i[ki+7]=Wt.y;_i[ki+8]=Wt.z;_i[ki+9]=Gt.x;_i[ki+10]=Gt.y;_i[ki+11]=Gt.z;if(wt.morphNormals){if(At){Ai=Hr[bi].vertexNormals[Mi];Kt=Ai.a;Qt=Ai.b;Zt=Ai.c;Jt=Ai.d}else Jt=Zt=Qt=Kt=Hr[bi].faceNormals[Mi];Si=er[bi];Si[ki]=Kt.x;Si[ki+1]=Kt.y;Si[ki+2]=Kt.z;Si[ki+3]=Qt.x;Si[ki+4]=Qt.y;Si[ki+5]=Qt.z;Si[ki+6]=Zt.x;Si[ki+7]=Zt.y;Si[ki+8]=Zt.z;Si[ki+9]=Jt.x;Si[ki+10]=Jt.y;Si[ki+11]=Jt.z}ki=ki+12}U.bindBuffer(U.ARRAY_BUFFER,yt.__webglMorphTargetsBuffers[bi]);U.bufferData(U.ARRAY_BUFFER,$i[bi],Ht);if(wt.morphNormals){U.bindBuffer(U.ARRAY_BUFFER,yt.__webglMorphNormalsBuffers[bi]);U.bufferData(U.ARRAY_BUFFER,er[bi],Ht)}}}if(yr.length){Ct=0;for(Lt=Er.length;Ct<Lt;Ct++){Ft=dr[Er[Ct]];ri=yr[Ft.a];oi=yr[Ft.b];ni=yr[Ft.c];Ji[Ni]=ri.x;Ji[Ni+1]=ri.y;Ji[Ni+2]=ri.z;Ji[Ni+3]=ri.w;Ji[Ni+4]=oi.x;Ji[Ni+5]=oi.y;Ji[Ni+6]=oi.z;Ji[Ni+7]=oi.w;Ji[Ni+8]=ni.x;Ji[Ni+9]=ni.y;Ji[Ni+10]=ni.z;Ji[Ni+11]=ni.w;si=Rr[Ft.a];li=Rr[Ft.b];hi=Rr[Ft.c];Zi[Ni]=si.x;Zi[Ni+1]=si.y;Zi[Ni+2]=si.z;Zi[Ni+3]=si.w;Zi[Ni+4]=li.x;Zi[Ni+5]=li.y;Zi[Ni+6]=li.z;Zi[Ni+7]=li.w;Zi[Ni+8]=hi.x;Zi[Ni+9]=hi.y;Zi[Ni+10]=hi.z;Zi[Ni+11]=hi.w;fi=vr[Ft.a];ui=vr[Ft.b];Ei=vr[Ft.c];Ki[Ni]=fi.x;Ki[Ni+1]=fi.y;Ki[Ni+2]=fi.z;Ki[Ni+3]=1;Ki[Ni+4]=ui.x;Ki[Ni+5]=ui.y;Ki[Ni+6]=ui.z;Ki[Ni+7]=1;Ki[Ni+8]=Ei.x;Ki[Ni+9]=Ei.y;Ki[Ni+10]=Ei.z;Ki[Ni+11]=1;di=Tr[Ft.a];mi=Tr[Ft.b];gi=Tr[Ft.c];Qi[Ni]=di.x;Qi[Ni+1]=di.y;Qi[Ni+2]=di.z;Qi[Ni+3]=1;Qi[Ni+4]=mi.x;Qi[Ni+5]=mi.y;Qi[Ni+6]=mi.z;Qi[Ni+7]=1;Qi[Ni+8]=gi.x;Qi[Ni+9]=gi.y;Qi[Ni+10]=gi.z;Qi[Ni+11]=1;Ni=Ni+12}Ct=0;for(Lt=pr.length;Ct<Lt;Ct++){Ft=dr[pr[Ct]];ri=yr[Ft.a];oi=yr[Ft.b];ni=yr[Ft.c];ai=yr[Ft.d];Ji[Ni]=ri.x;Ji[Ni+1]=ri.y;Ji[Ni+2]=ri.z;Ji[Ni+3]=ri.w;Ji[Ni+4]=oi.x;Ji[Ni+5]=oi.y;Ji[Ni+6]=oi.z;Ji[Ni+7]=oi.w;Ji[Ni+8]=ni.x;Ji[Ni+9]=ni.y;Ji[Ni+10]=ni.z;Ji[Ni+11]=ni.w;Ji[Ni+12]=ai.x;Ji[Ni+13]=ai.y;Ji[Ni+14]=ai.z;Ji[Ni+15]=ai.w;si=Rr[Ft.a];li=Rr[Ft.b];hi=Rr[Ft.c];ci=Rr[Ft.d];Zi[Ni]=si.x;Zi[Ni+1]=si.y;Zi[Ni+2]=si.z;Zi[Ni+3]=si.w;Zi[Ni+4]=li.x;Zi[Ni+5]=li.y;Zi[Ni+6]=li.z;Zi[Ni+7]=li.w;Zi[Ni+8]=hi.x;Zi[Ni+9]=hi.y;Zi[Ni+10]=hi.z;Zi[Ni+11]=hi.w;Zi[Ni+12]=ci.x;Zi[Ni+13]=ci.y;Zi[Ni+14]=ci.z;Zi[Ni+15]=ci.w;fi=vr[Ft.a];ui=vr[Ft.b];Ei=vr[Ft.c];pi=vr[Ft.d];Ki[Ni]=fi.x;Ki[Ni+1]=fi.y;Ki[Ni+2]=fi.z;Ki[Ni+3]=1;Ki[Ni+4]=ui.x;Ki[Ni+5]=ui.y;Ki[Ni+6]=ui.z;Ki[Ni+7]=1;Ki[Ni+8]=Ei.x;Ki[Ni+9]=Ei.y;Ki[Ni+10]=Ei.z;Ki[Ni+11]=1;Ki[Ni+12]=pi.x;Ki[Ni+13]=pi.y;Ki[Ni+14]=pi.z;Ki[Ni+15]=1;di=Tr[Ft.a];mi=Tr[Ft.b];gi=Tr[Ft.c];vi=Tr[Ft.d];Qi[Ni]=di.x;Qi[Ni+1]=di.y;Qi[Ni+2]=di.z;Qi[Ni+3]=1;Qi[Ni+4]=mi.x;Qi[Ni+5]=mi.y;Qi[Ni+6]=mi.z;Qi[Ni+7]=1;Qi[Ni+8]=gi.x;Qi[Ni+9]=gi.y;Qi[Ni+10]=gi.z;Qi[Ni+11]=1;Qi[Ni+12]=vi.x;Qi[Ni+13]=vi.y;Qi[Ni+14]=vi.z;Qi[Ni+15]=1;Ni=Ni+16}if(Ni>0){U.bindBuffer(U.ARRAY_BUFFER,yt.__webglSkinVertexABuffer);U.bufferData(U.ARRAY_BUFFER,Ki,Ht);U.bindBuffer(U.ARRAY_BUFFER,yt.__webglSkinVertexBBuffer);U.bufferData(U.ARRAY_BUFFER,Qi,Ht);U.bindBuffer(U.ARRAY_BUFFER,yt.__webglSkinIndicesBuffer);U.bufferData(U.ARRAY_BUFFER,Zi,Ht);U.bindBuffer(U.ARRAY_BUFFER,yt.__webglSkinWeightsBuffer);U.bufferData(U.ARRAY_BUFFER,Ji,Ht)}}if(cr&&St){Ct=0;for(Lt=Er.length;Ct<Lt;Ct++){Ft=dr[Er[Ct]];Vt=Ft.vertexColors;Bt=Ft.color;if(Vt.length===3&&St===THREE.VertexColors){$t=Vt[0];ei=Vt[1];ti=Vt[2]}else ti=ei=$t=Bt;qi[zi]=$t.r;qi[zi+1]=$t.g;qi[zi+2]=$t.b;qi[zi+3]=ei.r;qi[zi+4]=ei.g;qi[zi+5]=ei.b;qi[zi+6]=ti.r;qi[zi+7]=ti.g;qi[zi+8]=ti.b;zi=zi+9}Ct=0;for(Lt=pr.length;Ct<Lt;Ct++){Ft=dr[pr[Ct]];Vt=Ft.vertexColors;Bt=Ft.color;if(Vt.length===4&&St===THREE.VertexColors){$t=Vt[0];ei=Vt[1];ti=Vt[2];ii=Vt[3]}else ii=ti=ei=$t=Bt;qi[zi]=$t.r;qi[zi+1]=$t.g;qi[zi+2]=$t.b;qi[zi+3]=ei.r;qi[zi+4]=ei.g;qi[zi+5]=ei.b;qi[zi+6]=ti.r;qi[zi+7]=ti.g;qi[zi+8]=ti.b;qi[zi+9]=ii.r;qi[zi+10]=ii.g;qi[zi+11]=ii.b;zi=zi+12}if(zi>0){U.bindBuffer(U.ARRAY_BUFFER,yt.__webglColorBuffer);U.bufferData(U.ARRAY_BUFFER,qi,Ht)}}if(hr&&nr.hasTangents){Ct=0;for(Lt=Er.length;Ct<Lt;Ct++){Ft=dr[Er[Ct]];zt=Ft.vertexTangents;jt=zt[0];Xt=zt[1];Yt=zt[2];Yi[Vi]=jt.x;Yi[Vi+1]=jt.y;Yi[Vi+2]=jt.z;Yi[Vi+3]=jt.w;Yi[Vi+4]=Xt.x;Yi[Vi+5]=Xt.y;Yi[Vi+6]=Xt.z;Yi[Vi+7]=Xt.w;Yi[Vi+8]=Yt.x;Yi[Vi+9]=Yt.y;Yi[Vi+10]=Yt.z;Yi[Vi+11]=Yt.w;Vi=Vi+12}Ct=0;for(Lt=pr.length;Ct<Lt;Ct++){Ft=dr[pr[Ct]];zt=Ft.vertexTangents;jt=zt[0];Xt=zt[1];Yt=zt[2];qt=zt[3];Yi[Vi]=jt.x;Yi[Vi+1]=jt.y;Yi[Vi+2]=jt.z;Yi[Vi+3]=jt.w;Yi[Vi+4]=Xt.x;Yi[Vi+5]=Xt.y;Yi[Vi+6]=Xt.z;Yi[Vi+7]=Xt.w;Yi[Vi+8]=Yt.x;Yi[Vi+9]=Yt.y;Yi[Vi+10]=Yt.z;Yi[Vi+11]=Yt.w;Yi[Vi+12]=qt.x;Yi[Vi+13]=qt.y;Yi[Vi+14]=qt.z;Yi[Vi+15]=qt.w;Vi=Vi+16}U.bindBuffer(U.ARRAY_BUFFER,yt.__webglTangentBuffer);U.bufferData(U.ARRAY_BUFFER,Yi,Ht)}if(lr&&_t){Ct=0;for(Lt=Er.length;Ct<Lt;Ct++){Ft=dr[Er[Ct]];Ut=Ft.vertexNormals;Dt=Ft.normal;if(Ut.length===3&&At)for(Ti=0;Ti<3;Ti++){yi=Ut[Ti];Xi[Di]=yi.x;Xi[Di+1]=yi.y;Xi[Di+2]=yi.z;Di=Di+3}else for(Ti=0;Ti<3;Ti++){Xi[Di]=Dt.x;Xi[Di+1]=Dt.y;Xi[Di+2]=Dt.z;Di=Di+3}}Ct=0;for(Lt=pr.length;Ct<Lt;Ct++){Ft=dr[pr[Ct]];Ut=Ft.vertexNormals;Dt=Ft.normal;if(Ut.length===4&&At)for(Ti=0;Ti<4;Ti++){yi=Ut[Ti];Xi[Di]=yi.x;Xi[Di+1]=yi.y;Xi[Di+2]=yi.z;Di=Di+3}else for(Ti=0;Ti<4;Ti++){Xi[Di]=Dt.x;Xi[Di+1]=Dt.y;Xi[Di+2]=Dt.z;Di=Di+3}}U.bindBuffer(U.ARRAY_BUFFER,yt.__webglNormalBuffer);U.bufferData(U.ARRAY_BUFFER,Xi,Ht)}if(sr&&mr&&Mt){Ct=0;for(Lt=Er.length;Ct<Lt;Ct++){Pt=Er[Ct];Ft=dr[Pt];Nt=mr[Pt];if(Nt!==void 0)for(Ti=0;Ti<3;Ti++){xi=Nt[Ti];Gi[Pi]=xi.u;Gi[Pi+1]=xi.v;Pi=Pi+2}}Ct=0;for(Lt=pr.length;Ct<Lt;Ct++){Pt=pr[Ct];Ft=dr[Pt];Nt=mr[Pt];if(Nt!==void 0)for(Ti=0;Ti<4;Ti++){xi=Nt[Ti];Gi[Pi]=xi.u;Gi[Pi+1]=xi.v;Pi=Pi+2}}if(Pi>0){U.bindBuffer(U.ARRAY_BUFFER,yt.__webglUVBuffer);U.bufferData(U.ARRAY_BUFFER,Gi,Ht)}}if(sr&&gr&&Mt){Ct=0;for(Lt=Er.length;Ct<Lt;Ct++){Pt=Er[Ct];Ft=dr[Pt];kt=gr[Pt];if(kt!==void 0)for(Ti=0;Ti<3;Ti++){Hi=kt[Ti];ji[Fi]=Hi.u;ji[Fi+1]=Hi.v;Fi=Fi+2}}Ct=0;for(Lt=pr.length;Ct<Lt;Ct++){Pt=pr[Ct];Ft=dr[Pt];kt=gr[Pt];if(kt!==void 0)for(Ti=0;Ti<4;Ti++){Hi=kt[Ti];ji[Fi]=Hi.u;ji[Fi+1]=Hi.v;Fi=Fi+2}}if(Fi>0){U.bindBuffer(U.ARRAY_BUFFER,yt.__webglUV2Buffer);U.bufferData(U.ARRAY_BUFFER,ji,Ht)}}if(ar){Ct=0;for(Lt=Er.length;Ct<Lt;Ct++){Ft=dr[Er[Ct]];rr[Ui]=Ci;rr[Ui+1]=Ci+1;rr[Ui+2]=Ci+2;Ui=Ui+3;or[Bi]=Ci;or[Bi+1]=Ci+1;or[Bi+2]=Ci;or[Bi+3]=Ci+2;or[Bi+4]=Ci+1;or[Bi+5]=Ci+2;Bi=Bi+6;Ci=Ci+3}Ct=0;for(Lt=pr.length;Ct<Lt;Ct++){Ft=dr[pr[Ct]];rr[Ui]=Ci;rr[Ui+1]=Ci+1;rr[Ui+2]=Ci+3;rr[Ui+3]=Ci+1;rr[Ui+4]=Ci+2;rr[Ui+5]=Ci+3;Ui=Ui+6;or[Bi]=Ci;or[Bi+1]=Ci+1;or[Bi+2]=Ci;or[Bi+3]=Ci+3;or[Bi+4]=Ci+1;or[Bi+5]=Ci+2;or[Bi+6]=Ci+2;or[Bi+7]=Ci+3;Bi=Bi+8;Ci=Ci+4}U.bindBuffer(U.ELEMENT_ARRAY_BUFFER,yt.__webglFaceBuffer);U.bufferData(U.ELEMENT_ARRAY_BUFFER,rr,Ht);U.bindBuffer(U.ELEMENT_ARRAY_BUFFER,yt.__webglLineBuffer);U.bufferData(U.ELEMENT_ARRAY_BUFFER,or,Ht)}if(tr){Ti=0;for(Ri=tr.length;Ti<Ri;Ti++){ir=tr[Ti];if(ir.__original.needsUpdate){Oi=0;if(ir.size===1)if(ir.boundTo===void 0||ir.boundTo==="vertices"){Ct=0;for(Lt=Er.length;Ct<Lt;Ct++){Ft=dr[Er[Ct]];ir.array[Oi]=ir.value[Ft.a];ir.array[Oi+1]=ir.value[Ft.b];ir.array[Oi+2]=ir.value[Ft.c];Oi=Oi+3}Ct=0;for(Lt=pr.length;Ct<Lt;Ct++){Ft=dr[pr[Ct]];ir.array[Oi]=ir.value[Ft.a];ir.array[Oi+1]=ir.value[Ft.b];ir.array[Oi+2]=ir.value[Ft.c];ir.array[Oi+3]=ir.value[Ft.d];Oi=Oi+4}}else{if(ir.boundTo==="faces"){Ct=0;for(Lt=Er.length;Ct<Lt;Ct++){Ii=ir.value[Er[Ct]];ir.array[Oi]=Ii;ir.array[Oi+1]=Ii;ir.array[Oi+2]=Ii;Oi=Oi+3}Ct=0;for(Lt=pr.length;Ct<Lt;Ct++){Ii=ir.value[pr[Ct]];ir.array[Oi]=Ii;ir.array[Oi+1]=Ii;ir.array[Oi+2]=Ii;ir.array[Oi+3]=Ii;Oi=Oi+4}}}else if(ir.size===2)if(ir.boundTo===void 0||ir.boundTo==="vertices"){Ct=0;for(Lt=Er.length;Ct<Lt;Ct++){Ft=dr[Er[Ct]];Ot=ir.value[Ft.a];It=ir.value[Ft.b];Wt=ir.value[Ft.c];ir.array[Oi]=Ot.x;ir.array[Oi+1]=Ot.y;ir.array[Oi+2]=It.x;ir.array[Oi+3]=It.y;ir.array[Oi+4]=Wt.x;ir.array[Oi+5]=Wt.y;Oi=Oi+6}Ct=0;for(Lt=pr.length;Ct<Lt;Ct++){Ft=dr[pr[Ct]];Ot=ir.value[Ft.a];It=ir.value[Ft.b];Wt=ir.value[Ft.c];Gt=ir.value[Ft.d];ir.array[Oi]=Ot.x;ir.array[Oi+1]=Ot.y;ir.array[Oi+2]=It.x;ir.array[Oi+3]=It.y;ir.array[Oi+4]=Wt.x;ir.array[Oi+5]=Wt.y;ir.array[Oi+6]=Gt.x;ir.array[Oi+7]=Gt.y;Oi=Oi+8}}else{if(ir.boundTo==="faces"){Ct=0;for(Lt=Er.length;Ct<Lt;Ct++){Wt=It=Ot=Ii=ir.value[Er[Ct]];ir.array[Oi]=Ot.x;ir.array[Oi+1]=Ot.y;ir.array[Oi+2]=It.x;ir.array[Oi+3]=It.y;ir.array[Oi+4]=Wt.x;ir.array[Oi+5]=Wt.y;Oi=Oi+6}Ct=0;for(Lt=pr.length;Ct<Lt;Ct++){Gt=Wt=It=Ot=Ii=ir.value[pr[Ct]];ir.array[Oi]=Ot.x;ir.array[Oi+1]=Ot.y;ir.array[Oi+2]=It.x;ir.array[Oi+3]=It.y;ir.array[Oi+4]=Wt.x;ir.array[Oi+5]=Wt.y;ir.array[Oi+6]=Gt.x;ir.array[Oi+7]=Gt.y;Oi=Oi+8}}}else if(ir.size===3){var br;br=ir.type==="c"?["r","g","b"]:["x","y","z"];if(ir.boundTo===void 0||ir.boundTo==="vertices"){Ct=0;for(Lt=Er.length;Ct<Lt;Ct++){Ft=dr[Er[Ct]];Ot=ir.value[Ft.a];It=ir.value[Ft.b];Wt=ir.value[Ft.c];ir.array[Oi]=Ot[br[0]];ir.array[Oi+1]=Ot[br[1]];ir.array[Oi+2]=Ot[br[2]];ir.array[Oi+3]=It[br[0]];ir.array[Oi+4]=It[br[1]];ir.array[Oi+5]=It[br[2]];ir.array[Oi+6]=Wt[br[0]];ir.array[Oi+7]=Wt[br[1]];ir.array[Oi+8]=Wt[br[2]];Oi=Oi+9}Ct=0;for(Lt=pr.length;Ct<Lt;Ct++){Ft=dr[pr[Ct]];Ot=ir.value[Ft.a];It=ir.value[Ft.b];Wt=ir.value[Ft.c];Gt=ir.value[Ft.d];ir.array[Oi]=Ot[br[0]];ir.array[Oi+1]=Ot[br[1]];ir.array[Oi+2]=Ot[br[2]];ir.array[Oi+3]=It[br[0]];ir.array[Oi+4]=It[br[1]];ir.array[Oi+5]=It[br[2]];ir.array[Oi+6]=Wt[br[0]];ir.array[Oi+7]=Wt[br[1]];ir.array[Oi+8]=Wt[br[2]];ir.array[Oi+9]=Gt[br[0]];ir.array[Oi+10]=Gt[br[1]];ir.array[Oi+11]=Gt[br[2]];Oi=Oi+12}}else if(ir.boundTo==="faces"){Ct=0;for(Lt=Er.length;Ct<Lt;Ct++){Wt=It=Ot=Ii=ir.value[Er[Ct]];ir.array[Oi]=Ot[br[0]];ir.array[Oi+1]=Ot[br[1]];ir.array[Oi+2]=Ot[br[2]];ir.array[Oi+3]=It[br[0]];ir.array[Oi+4]=It[br[1]];ir.array[Oi+5]=It[br[2]];ir.array[Oi+6]=Wt[br[0]];ir.array[Oi+7]=Wt[br[1]];ir.array[Oi+8]=Wt[br[2]];Oi=Oi+9}Ct=0;for(Lt=pr.length;Ct<Lt;Ct++){Gt=Wt=It=Ot=Ii=ir.value[pr[Ct]];ir.array[Oi]=Ot[br[0]];ir.array[Oi+1]=Ot[br[1]];ir.array[Oi+2]=Ot[br[2]];ir.array[Oi+3]=It[br[0]];ir.array[Oi+4]=It[br[1]];ir.array[Oi+5]=It[br[2]];ir.array[Oi+6]=Wt[br[0]];ir.array[Oi+7]=Wt[br[1]];ir.array[Oi+8]=Wt[br[2]];ir.array[Oi+9]=Gt[br[0]];ir.array[Oi+10]=Gt[br[1]];ir.array[Oi+11]=Gt[br[2]];Oi=Oi+12}}}else if(ir.size===4)if(ir.boundTo===void 0||ir.boundTo==="vertices"){Ct=0;for(Lt=Er.length;Ct<Lt;Ct++){Ft=dr[Er[Ct]];Ot=ir.value[Ft.a];It=ir.value[Ft.b];Wt=ir.value[Ft.c];ir.array[Oi]=Ot.x;ir.array[Oi+1]=Ot.y;ir.array[Oi+2]=Ot.z;ir.array[Oi+3]=Ot.w;ir.array[Oi+4]=It.x;ir.array[Oi+5]=It.y;ir.array[Oi+6]=It.z;ir.array[Oi+7]=It.w;ir.array[Oi+8]=Wt.x;ir.array[Oi+9]=Wt.y;ir.array[Oi+10]=Wt.z;ir.array[Oi+11]=Wt.w;Oi=Oi+12}Ct=0;for(Lt=pr.length;Ct<Lt;Ct++){Ft=dr[pr[Ct]];Ot=ir.value[Ft.a];It=ir.value[Ft.b];Wt=ir.value[Ft.c];Gt=ir.value[Ft.d];ir.array[Oi]=Ot.x;ir.array[Oi+1]=Ot.y;ir.array[Oi+2]=Ot.z;ir.array[Oi+3]=Ot.w;ir.array[Oi+4]=It.x;ir.array[Oi+5]=It.y;ir.array[Oi+6]=It.z;ir.array[Oi+7]=It.w;ir.array[Oi+8]=Wt.x;ir.array[Oi+9]=Wt.y;ir.array[Oi+10]=Wt.z;ir.array[Oi+11]=Wt.w;ir.array[Oi+12]=Gt.x;ir.array[Oi+13]=Gt.y;ir.array[Oi+14]=Gt.z;ir.array[Oi+15]=Gt.w;Oi=Oi+16}}else if(ir.boundTo==="faces"){Ct=0;for(Lt=Er.length;Ct<Lt;Ct++){Wt=It=Ot=Ii=ir.value[Er[Ct]];ir.array[Oi]=Ot.x;ir.array[Oi+1]=Ot.y;ir.array[Oi+2]=Ot.z;ir.array[Oi+3]=Ot.w;ir.array[Oi+4]=It.x;ir.array[Oi+5]=It.y;ir.array[Oi+6]=It.z;ir.array[Oi+7]=It.w;ir.array[Oi+8]=Wt.x;ir.array[Oi+9]=Wt.y;ir.array[Oi+10]=Wt.z;ir.array[Oi+11]=Wt.w;Oi=Oi+12}Ct=0;for(Lt=pr.length;Ct<Lt;Ct++){Gt=Wt=It=Ot=Ii=ir.value[pr[Ct]];ir.array[Oi]=Ot.x;ir.array[Oi+1]=Ot.y;ir.array[Oi+2]=Ot.z;ir.array[Oi+3]=Ot.w;ir.array[Oi+4]=It.x;ir.array[Oi+5]=It.y;ir.array[Oi+6]=It.z;ir.array[Oi+7]=It.w;ir.array[Oi+8]=Wt.x;ir.array[Oi+9]=Wt.y;ir.array[Oi+10]=Wt.z;ir.array[Oi+11]=Wt.w;ir.array[Oi+12]=Gt.x;ir.array[Oi+13]=Gt.y;ir.array[Oi+14]=Gt.z;ir.array[Oi+15]=Gt.w;Oi=Oi+16}}U.bindBuffer(U.ARRAY_BUFFER,ir.buffer);U.bufferData(U.ARRAY_BUFFER,ir.array,Ht)}}}if(bt){delete yt.__inittedArrays;delete yt.__colorArray;delete yt.__normalArray;delete yt.__tangentArray;delete yt.__uvArray;delete yt.__uv2Array;delete yt.__faceArray;delete yt.__vertexArray;delete yt.__lineArray;delete yt.__skinVertexAArray;delete yt.__skinVertexBArray;delete yt.__skinIndexArray;delete yt.__skinWeightArray}}}}dt.verticesNeedUpdate=false;dt.morphTargetsNeedUpdate=false;dt.elementsNeedUpdate=false;
dt.uvsNeedUpdate=false;dt.normalsNeedUpdate=false;dt.colorsNeedUpdate=false;dt.tangetsNeedUpdate=false;vt.attributes&&u(vt)}else if(pt instanceof THREE.Ribbon){if(dt.verticesNeedUpdate||dt.colorsNeedUpdate){var wr=dt,_r=U.DYNAMIC_DRAW,Sr=void 0,Mr=void 0,Ar=void 0,Cr=void 0,Lr=void 0,Pr=wr.vertices,Fr=wr.colors,Ur=Pr.length,Dr=Fr.length,Vr=wr.__vertexArray,Br=wr.__colorArray,zr=wr.colorsNeedUpdate;if(wr.verticesNeedUpdate){for(Sr=0;Sr<Ur;Sr++){Ar=Pr[Sr];Cr=Sr*3;Vr[Cr]=Ar.x;Vr[Cr+1]=Ar.y;Vr[Cr+2]=Ar.z}U.bindBuffer(U.ARRAY_BUFFER,wr.__webglVertexBuffer);U.bufferData(U.ARRAY_BUFFER,Vr,_r)}if(zr){for(Mr=0;Mr<Dr;Mr++){Lr=Fr[Mr];Cr=Mr*3;Br[Cr]=Lr.r;Br[Cr+1]=Lr.g;Br[Cr+2]=Lr.b}U.bindBuffer(U.ARRAY_BUFFER,wr.__webglColorBuffer);U.bufferData(U.ARRAY_BUFFER,Br,_r)}}dt.verticesNeedUpdate=false;dt.colorsNeedUpdate=false}else if(pt instanceof THREE.Line){vt=i(pt,mt);gt=vt.attributes&&f(vt);if(dt.verticesNeedUpdate||dt.colorsNeedUpdate||gt){var Nr=dt,kr=U.DYNAMIC_DRAW,Or=void 0,Ir=void 0,Wr=void 0,Gr=void 0,jr=void 0,Xr=Nr.vertices,Yr=Nr.colors,qr=Xr.length,Kr=Yr.length,Qr=Nr.__vertexArray,Zr=Nr.__colorArray,Jr=Nr.colorsNeedUpdate,$r=Nr.__webglCustomAttributesList,eo=void 0,to=void 0,io=void 0,ro=void 0,oo=void 0,no=void 0;if(Nr.verticesNeedUpdate){for(Or=0;Or<qr;Or++){Wr=Xr[Or];Gr=Or*3;Qr[Gr]=Wr.x;Qr[Gr+1]=Wr.y;Qr[Gr+2]=Wr.z}U.bindBuffer(U.ARRAY_BUFFER,Nr.__webglVertexBuffer);U.bufferData(U.ARRAY_BUFFER,Qr,kr)}if(Jr){for(Ir=0;Ir<Kr;Ir++){jr=Yr[Ir];Gr=Ir*3;Zr[Gr]=jr.r;Zr[Gr+1]=jr.g;Zr[Gr+2]=jr.b}U.bindBuffer(U.ARRAY_BUFFER,Nr.__webglColorBuffer);U.bufferData(U.ARRAY_BUFFER,Zr,kr)}if($r){eo=0;for(to=$r.length;eo<to;eo++){no=$r[eo];if(no.needsUpdate&&(no.boundTo===void 0||no.boundTo==="vertices")){Gr=0;ro=no.value.length;if(no.size===1)for(io=0;io<ro;io++)no.array[io]=no.value[io];else if(no.size===2)for(io=0;io<ro;io++){oo=no.value[io];no.array[Gr]=oo.x;no.array[Gr+1]=oo.y;Gr=Gr+2}else if(no.size===3)if(no.type==="c")for(io=0;io<ro;io++){oo=no.value[io];no.array[Gr]=oo.r;no.array[Gr+1]=oo.g;no.array[Gr+2]=oo.b;Gr=Gr+3}else for(io=0;io<ro;io++){oo=no.value[io];no.array[Gr]=oo.x;no.array[Gr+1]=oo.y;no.array[Gr+2]=oo.z;Gr=Gr+3}else if(no.size===4)for(io=0;io<ro;io++){oo=no.value[io];no.array[Gr]=oo.x;no.array[Gr+1]=oo.y;no.array[Gr+2]=oo.z;no.array[Gr+3]=oo.w;Gr=Gr+4}U.bindBuffer(U.ARRAY_BUFFER,no.buffer);U.bufferData(U.ARRAY_BUFFER,no.array,kr)}}}}dt.verticesNeedUpdate=false;dt.colorsNeedUpdate=false;vt.attributes&&u(vt)}else if(pt instanceof THREE.ParticleSystem){vt=i(pt,mt);gt=vt.attributes&&f(vt);(dt.verticesNeedUpdate||dt.colorsNeedUpdate||pt.sortParticles||gt)&&n(dt,U.DYNAMIC_DRAW,pt);dt.verticesNeedUpdate=false;dt.colorsNeedUpdate=false;vt.attributes&&u(vt)}}};this.initMaterial=function(e,t,i,r){var o,n,a;e instanceof THREE.MeshDepthMaterial?a="depth":e instanceof THREE.MeshNormalMaterial?a="normal":e instanceof THREE.MeshBasicMaterial?a="basic":e instanceof THREE.MeshLambertMaterial?a="lambert":e instanceof THREE.MeshPhongMaterial?a="phong":e instanceof THREE.LineBasicMaterial?a="basic":e instanceof THREE.ParticleBasicMaterial&&(a="particle_basic");if(a){var s=THREE.ShaderLib[a];e.uniforms=THREE.UniformsUtils.clone(s.uniforms);e.vertexShader=s.vertexShader;e.fragmentShader=s.fragmentShader}var l,h,c,f,u;l=f=u=s=0;for(h=t.length;l<h;l++){c=t[l];if(!c.onlyShadow){c instanceof THREE.DirectionalLight&&f++;c instanceof THREE.PointLight&&u++;c instanceof THREE.SpotLight&&s++}}if(u+s+f<=P){h=f;c=u;f=s}else{h=Math.ceil(P*f/(u+f));f=c=P-h}var E=0,s=0;for(u=t.length;s<u;s++){l=t[s];if(l.castShadow){l instanceof THREE.SpotLight&&E++;l instanceof THREE.DirectionalLight&&!l.shadowCascade&&E++}}var p=50;if(r!==void 0&&r instanceof THREE.SkinnedMesh)p=r.bones.length;var d;e:{u=e.fragmentShader;l=e.vertexShader;var s=e.uniforms,t=e.attributes,i={map:!!e.map,envMap:!!e.envMap,lightMap:!!e.lightMap,vertexColors:e.vertexColors,fog:i,useFog:e.fog,sizeAttenuation:e.sizeAttenuation,skinning:e.skinning,maxBones:p,morphTargets:e.morphTargets,morphNormals:e.morphNormals,maxMorphTargets:this.maxMorphTargets,maxMorphNormals:this.maxMorphNormals,maxDirLights:h,maxPointLights:c,maxSpotLights:f,maxShadows:E,shadowMapEnabled:this.shadowMapEnabled&&r.receiveShadow,shadowMapSoft:this.shadowMapSoft,shadowMapDebug:this.shadowMapDebug,shadowMapCascade:this.shadowMapCascade,alphaTest:e.alphaTest,metal:e.metal,perPixel:e.perPixel,wrapAround:e.wrapAround,doubleSided:r&&r.doubleSided},m,r=[];if(a)r.push(a);else{r.push(u);r.push(l)}for(m in i){r.push(m);r.push(i[m])}a=r.join();m=0;for(r=D.length;m<r;m++)if(D[m].code===a){d=D[m].program;break e}m=U.createProgram();r=["precision "+b+" float;",Et>0?"#define VERTEX_TEXTURES":"",F.gammaInput?"#define GAMMA_INPUT":"",F.gammaOutput?"#define GAMMA_OUTPUT":"",F.physicallyBasedShading?"#define PHYSICALLY_BASED_SHADING":"","#define MAX_DIR_LIGHTS "+i.maxDirLights,"#define MAX_POINT_LIGHTS "+i.maxPointLights,"#define MAX_SPOT_LIGHTS "+i.maxSpotLights,"#define MAX_SHADOWS "+i.maxShadows,"#define MAX_BONES "+i.maxBones,i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.lightMap?"#define USE_LIGHTMAP":"",i.vertexColors?"#define USE_COLOR":"",i.skinning?"#define USE_SKINNING":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals?"#define USE_MORPHNORMALS":"",i.perPixel?"#define PHONG_PER_PIXEL":"",i.wrapAround?"#define WRAP_AROUND":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapSoft?"#define SHADOWMAP_SOFT":"",i.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",i.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"","uniform mat4 objectMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat3 normalMatrix;\nuniform vec3 cameraPosition;\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec2 uv;\nattribute vec2 uv2;\n#ifdef USE_COLOR\nattribute vec3 color;\n#endif\n#ifdef USE_MORPHTARGETS\nattribute vec3 morphTarget0;\nattribute vec3 morphTarget1;\nattribute vec3 morphTarget2;\nattribute vec3 morphTarget3;\n#ifdef USE_MORPHNORMALS\nattribute vec3 morphNormal0;\nattribute vec3 morphNormal1;\nattribute vec3 morphNormal2;\nattribute vec3 morphNormal3;\n#else\nattribute vec3 morphTarget4;\nattribute vec3 morphTarget5;\nattribute vec3 morphTarget6;\nattribute vec3 morphTarget7;\n#endif\n#endif\n#ifdef USE_SKINNING\nattribute vec4 skinVertexA;\nattribute vec4 skinVertexB;\nattribute vec4 skinIndex;\nattribute vec4 skinWeight;\n#endif\n"].join("\n");h=["precision "+b+" float;","#define MAX_DIR_LIGHTS "+i.maxDirLights,"#define MAX_POINT_LIGHTS "+i.maxPointLights,"#define MAX_SPOT_LIGHTS "+i.maxSpotLights,"#define MAX_SHADOWS "+i.maxShadows,i.alphaTest?"#define ALPHATEST "+i.alphaTest:"",F.gammaInput?"#define GAMMA_INPUT":"",F.gammaOutput?"#define GAMMA_OUTPUT":"",F.physicallyBasedShading?"#define PHYSICALLY_BASED_SHADING":"",i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fog instanceof THREE.FogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.lightMap?"#define USE_LIGHTMAP":"",i.vertexColors?"#define USE_COLOR":"",i.metal?"#define METAL":"",i.perPixel?"#define PHONG_PER_PIXEL":"",i.wrapAround?"#define WRAP_AROUND":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapSoft?"#define SHADOWMAP_SOFT":"",i.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",i.shadowMapCascade?"#define SHADOWMAP_CASCADE":"","uniform mat4 viewMatrix;\nuniform vec3 cameraPosition;\n"].join("\n");U.attachShader(m,v("fragment",h+u));U.attachShader(m,v("vertex",r+l));U.linkProgram(m);U.getProgramParameter(m,U.LINK_STATUS)||console.error("Could not initialise shader\nVALIDATE_STATUS: "+U.getProgramParameter(m,U.VALIDATE_STATUS)+", gl error ["+U.getError()+"]");m.uniforms={};m.attributes={};var g,r=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix","objectMatrix","cameraPosition","boneGlobalMatrices","morphTargetInfluences"];for(g in s)r.push(g);g=r;r=0;for(s=g.length;r<s;r++){u=g[r];m.uniforms[u]=U.getUniformLocation(m,u)}r=["position","normal","uv","uv2","tangent","color","skinVertexA","skinVertexB","skinIndex","skinWeight"];for(g=0;g<i.maxMorphTargets;g++)r.push("morphTarget"+g);for(g=0;g<i.maxMorphNormals;g++)r.push("morphNormal"+g);for(d in t)r.push(d);d=r;g=0;for(t=d.length;g<t;g++){i=d[g];m.attributes[i]=U.getAttribLocation(m,i)}m.id=D.length;D.push({program:m,code:a});F.info.memory.programs=D.length;d=m}e.program=d;d=e.program.attributes;d.position>=0&&U.enableVertexAttribArray(d.position);d.color>=0&&U.enableVertexAttribArray(d.color);d.normal>=0&&U.enableVertexAttribArray(d.normal);d.tangent>=0&&U.enableVertexAttribArray(d.tangent);if(e.skinning&&d.skinVertexA>=0&&d.skinVertexB>=0&&d.skinIndex>=0&&d.skinWeight>=0){U.enableVertexAttribArray(d.skinVertexA);U.enableVertexAttribArray(d.skinVertexB);U.enableVertexAttribArray(d.skinIndex);U.enableVertexAttribArray(d.skinWeight)}if(e.attributes)for(n in e.attributes)d[n]!==void 0&&d[n]>=0&&U.enableVertexAttribArray(d[n]);if(e.morphTargets){e.numSupportedMorphTargets=0;m="morphTarget";for(n=0;n<this.maxMorphTargets;n++){g=m+n;if(d[g]>=0){U.enableVertexAttribArray(d[g]);e.numSupportedMorphTargets++}}}if(e.morphNormals){e.numSupportedMorphNormals=0;m="morphNormal";for(n=0;n<this.maxMorphNormals;n++){g=m+n;if(d[g]>=0){U.enableVertexAttribArray(d[g]);e.numSupportedMorphNormals++}}}e.uniformsList=[];for(o in e.uniforms)e.uniformsList.push([e.uniforms[o],o])};this.setFaceCulling=function(e,t){if(e){!t||t==="ccw"?U.frontFace(U.CCW):U.frontFace(U.CW);e==="back"?U.cullFace(U.BACK):e==="front"?U.cullFace(U.FRONT):U.cullFace(U.FRONT_AND_BACK);U.enable(U.CULL_FACE)}else U.disable(U.CULL_FACE)};this.setObjectFaces=function(e){if(I!==e.doubleSided){e.doubleSided?U.disable(U.CULL_FACE):U.enable(U.CULL_FACE);I=e.doubleSided}if(W!==e.flipSided){e.flipSided?U.frontFace(U.CW):U.frontFace(U.CCW);W=e.flipSided}};this.setDepthTest=function(e){if(q!==e){e?U.enable(U.DEPTH_TEST):U.disable(U.DEPTH_TEST);q=e}};this.setDepthWrite=function(e){if(K!==e){U.depthMask(e);K=e}};this.setBlending=function(e,t,i,r){if(e!==G){switch(e){case THREE.NoBlending:U.disable(U.BLEND);break;case THREE.AdditiveBlending:U.enable(U.BLEND);U.blendEquation(U.FUNC_ADD);U.blendFunc(U.SRC_ALPHA,U.ONE);break;case THREE.SubtractiveBlending:U.enable(U.BLEND);U.blendEquation(U.FUNC_ADD);U.blendFunc(U.ZERO,U.ONE_MINUS_SRC_COLOR);break;case THREE.MultiplyBlending:U.enable(U.BLEND);U.blendEquation(U.FUNC_ADD);U.blendFunc(U.ZERO,U.SRC_COLOR);break;case THREE.CustomBlending:U.enable(U.BLEND);break;default:U.enable(U.BLEND);U.blendEquationSeparate(U.FUNC_ADD,U.FUNC_ADD);U.blendFuncSeparate(U.SRC_ALPHA,U.ONE_MINUS_SRC_ALPHA,U.ONE,U.ONE_MINUS_SRC_ALPHA)}G=e}if(e===THREE.CustomBlending){if(t!==j){U.blendEquation(x(t));j=t}if(i!==X||r!==Y){U.blendFunc(x(i),x(r));X=i;Y=r}}else Y=X=j=null};this.setTexture=function(e,t){if(e.needsUpdate){if(!e.__webglInit){e.__webglInit=true;e.__webglTexture=U.createTexture();F.info.memory.textures++}U.activeTexture(U.TEXTURE0+t);U.bindTexture(U.TEXTURE_2D,e.__webglTexture);U.pixelStorei(U.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha);var i=e.image,r=(i.width&i.width-1)===0&&(i.height&i.height-1)===0,o=x(e.format),n=x(e.type);T(U.TEXTURE_2D,e,r);e instanceof THREE.DataTexture?U.texImage2D(U.TEXTURE_2D,0,o,i.width,i.height,0,o,n,i.data):U.texImage2D(U.TEXTURE_2D,0,o,o,n,e.image);e.generateMipmaps&&r&&U.generateMipmap(U.TEXTURE_2D);e.needsUpdate=false;if(e.onUpdate)e.onUpdate()}else{U.activeTexture(U.TEXTURE0+t);U.bindTexture(U.TEXTURE_2D,e.__webglTexture)}};this.setRenderTarget=function(e){var t=e instanceof THREE.WebGLRenderTargetCube;if(e&&!e.__webglFramebuffer){if(e.depthBuffer===void 0)e.depthBuffer=true;if(e.stencilBuffer===void 0)e.stencilBuffer=true;e.__webglTexture=U.createTexture();var i=(e.width&e.width-1)===0&&(e.height&e.height-1)===0,r=x(e.format),o=x(e.type);if(t){e.__webglFramebuffer=[];e.__webglRenderbuffer=[];U.bindTexture(U.TEXTURE_CUBE_MAP,e.__webglTexture);T(U.TEXTURE_CUBE_MAP,e,i);for(var n=0;n<6;n++){e.__webglFramebuffer[n]=U.createFramebuffer();e.__webglRenderbuffer[n]=U.createRenderbuffer();U.texImage2D(U.TEXTURE_CUBE_MAP_POSITIVE_X+n,0,r,e.width,e.height,0,r,o,null);var a=e,s=U.TEXTURE_CUBE_MAP_POSITIVE_X+n;U.bindFramebuffer(U.FRAMEBUFFER,e.__webglFramebuffer[n]);U.framebufferTexture2D(U.FRAMEBUFFER,U.COLOR_ATTACHMENT0,s,a.__webglTexture,0);R(e.__webglRenderbuffer[n],e)}i&&U.generateMipmap(U.TEXTURE_CUBE_MAP)}else{e.__webglFramebuffer=U.createFramebuffer();e.__webglRenderbuffer=U.createRenderbuffer();U.bindTexture(U.TEXTURE_2D,e.__webglTexture);T(U.TEXTURE_2D,e,i);U.texImage2D(U.TEXTURE_2D,0,r,e.width,e.height,0,r,o,null);r=U.TEXTURE_2D;U.bindFramebuffer(U.FRAMEBUFFER,e.__webglFramebuffer);U.framebufferTexture2D(U.FRAMEBUFFER,U.COLOR_ATTACHMENT0,r,e.__webglTexture,0);R(e.__webglRenderbuffer,e);i&&U.generateMipmap(U.TEXTURE_2D)}t?U.bindTexture(U.TEXTURE_CUBE_MAP,null):U.bindTexture(U.TEXTURE_2D,null);U.bindRenderbuffer(U.RENDERBUFFER,null);U.bindFramebuffer(U.FRAMEBUFFER,null)}if(e){t=t?e.__webglFramebuffer[e.activeCubeFace]:e.__webglFramebuffer;i=e.width;e=e.height;o=r=0}else{t=null;i=it;e=rt;r=et;o=tt}if(t!==B){U.bindFramebuffer(U.FRAMEBUFFER,t);U.viewport(r,o,i,e);B=t}ot=i;nt=e};this.shadowMapPlugin=new THREE.ShadowMapPlugin;this.addPrePlugin(this.shadowMapPlugin);this.addPostPlugin(new THREE.SpritePlugin);this.addPostPlugin(new THREE.LensFlarePlugin)};THREE.WebGLRenderTarget=function(e,t,i){this.width=e;this.height=t;i=i||{};this.wrapS=i.wrapS!==void 0?i.wrapS:THREE.ClampToEdgeWrapping;this.wrapT=i.wrapT!==void 0?i.wrapT:THREE.ClampToEdgeWrapping;this.magFilter=i.magFilter!==void 0?i.magFilter:THREE.LinearFilter;this.minFilter=i.minFilter!==void 0?i.minFilter:THREE.LinearMipMapLinearFilter;this.offset=new THREE.Vector2(0,0);this.repeat=new THREE.Vector2(1,1);this.format=i.format!==void 0?i.format:THREE.RGBAFormat;this.type=i.type!==void 0?i.type:THREE.UnsignedByteType;this.depthBuffer=i.depthBuffer!==void 0?i.depthBuffer:true;this.stencilBuffer=i.stencilBuffer!==void 0?i.stencilBuffer:true;this.generateMipmaps=true};THREE.WebGLRenderTarget.prototype.clone=function(){var e=new THREE.WebGLRenderTarget(this.width,this.height);e.wrapS=this.wrapS;e.wrapT=this.wrapT;e.magFilter=this.magFilter;e.minFilter=this.minFilter;e.offset.copy(this.offset);e.repeat.copy(this.repeat);e.format=this.format;e.type=this.type;e.depthBuffer=this.depthBuffer;e.stencilBuffer=this.stencilBuffer;return e};THREE.WebGLRenderTargetCube=function(e,t,i){THREE.WebGLRenderTarget.call(this,e,t,i);this.activeCubeFace=0};THREE.WebGLRenderTargetCube.prototype=new THREE.WebGLRenderTarget;THREE.WebGLRenderTargetCube.prototype.constructor=THREE.WebGLRenderTargetCube;THREE.RenderableVertex=function(){this.positionWorld=new THREE.Vector3;this.positionScreen=new THREE.Vector4;this.visible=true};THREE.RenderableVertex.prototype.copy=function(e){this.positionWorld.copy(e.positionWorld);this.positionScreen.copy(e.positionScreen)};THREE.RenderableFace3=function(){this.v1=new THREE.RenderableVertex;this.v2=new THREE.RenderableVertex;this.v3=new THREE.RenderableVertex;this.centroidWorld=new THREE.Vector3;this.centroidScreen=new THREE.Vector3;this.normalWorld=new THREE.Vector3;this.vertexNormalsWorld=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];this.faceMaterial=this.material=null;this.uvs=[[]];this.z=null};THREE.RenderableFace4=function(){this.v1=new THREE.RenderableVertex;this.v2=new THREE.RenderableVertex;this.v3=new THREE.RenderableVertex;this.v4=new THREE.RenderableVertex;this.centroidWorld=new THREE.Vector3;this.centroidScreen=new THREE.Vector3;this.normalWorld=new THREE.Vector3;this.vertexNormalsWorld=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];this.faceMaterial=this.material=null;this.uvs=[[]];this.z=null};THREE.RenderableObject=function(){this.z=this.object=null};THREE.RenderableParticle=function(){this.rotation=this.z=this.y=this.x=null;this.scale=new THREE.Vector2;this.material=null};THREE.RenderableLine=function(){this.z=null;this.v1=new THREE.RenderableVertex;this.v2=new THREE.RenderableVertex;this.material=null};THREE.ColorUtils={adjustHSV:function(e,t,i,r){var o=THREE.ColorUtils.__hsv;THREE.ColorUtils.rgbToHsv(e,o);o.h=THREE.Math.clamp(o.h+t,0,1);o.s=THREE.Math.clamp(o.s+i,0,1);o.v=THREE.Math.clamp(o.v+r,0,1);e.setHSV(o.h,o.s,o.v)},rgbToHsv:function(e,t){var i=e.r,r=e.g,o=e.b,n=Math.max(Math.max(i,r),o),a=Math.min(Math.min(i,r),o);if(a===n)a=i=0;else{var s=n-a,a=s/n,i=(i===n?(r-o)/s:r===n?2+(o-i)/s:4+(i-r)/s)/6;i<0&&(i=i+1);i>1&&(i=i-1)}t===void 0&&(t={h:0,s:0,v:0});t.h=i;t.s=a;t.v=n;return t}};THREE.ColorUtils.__hsv={h:0,s:0,v:0};THREE.GeometryUtils={merge:function(e,t){for(var i,r,o=e.vertices.length,n=t instanceof THREE.Mesh?t.geometry:t,a=e.vertices,s=n.vertices,l=e.faces,h=n.faces,c=e.faceVertexUvs[0],f=n.faceVertexUvs[0],u={},E=0;E<e.materials.length;E++)u[e.materials[E].id]=E;if(t instanceof THREE.Mesh){t.matrixAutoUpdate&&t.updateMatrix();i=t.matrix;r=new THREE.Matrix4;r.extractRotation(i,t.scale)}for(var E=0,p=s.length;E<p;E++){var d=s[E].clone();i&&i.multiplyVector3(d);a.push(d)}E=0;for(p=h.length;E<p;E++){var a=h[E],m,g,v=a.vertexNormals,T=a.vertexColors;a instanceof THREE.Face3?m=new THREE.Face3(a.a+o,a.b+o,a.c+o):a instanceof THREE.Face4&&(m=new THREE.Face4(a.a+o,a.b+o,a.c+o,a.d+o));m.normal.copy(a.normal);r&&r.multiplyVector3(m.normal);s=0;for(d=v.length;s<d;s++){g=v[s].clone();r&&r.multiplyVector3(g);m.vertexNormals.push(g)}m.color.copy(a.color);s=0;for(d=T.length;s<d;s++){g=T[s];m.vertexColors.push(g.clone())}if(a.materialIndex!==void 0){s=n.materials[a.materialIndex];d=s.id;T=u[d];if(T===void 0){T=e.materials.length;u[d]=T;e.materials.push(s)}m.materialIndex=T}m.centroid.copy(a.centroid);i&&i.multiplyVector3(m.centroid);l.push(m)}E=0;for(p=f.length;E<p;E++){i=f[E];r=[];s=0;for(d=i.length;s<d;s++)r.push(new THREE.UV(i[s].u,i[s].v));c.push(r)}},clone:function(e){var t=new THREE.Geometry,i,r=e.vertices,o=e.faces,n=e.faceVertexUvs[0];if(e.materials)t.materials=e.materials.slice();e=0;for(i=r.length;e<i;e++)t.vertices.push(r[e].clone());e=0;for(i=o.length;e<i;e++)t.faces.push(o[e].clone());e=0;for(i=n.length;e<i;e++){for(var r=n[e],o=[],a=0,s=r.length;a<s;a++)o.push(new THREE.UV(r[a].u,r[a].v));t.faceVertexUvs[0].push(o)}return t},randomPointInTriangle:function(e,t,i){var r,o,n,a=new THREE.Vector3,s=THREE.GeometryUtils.__v1;r=THREE.GeometryUtils.random();o=THREE.GeometryUtils.random();if(r+o>1){r=1-r;o=1-o}n=1-r-o;a.copy(e);a.multiplyScalar(r);s.copy(t);s.multiplyScalar(o);a.addSelf(s);s.copy(i);s.multiplyScalar(n);a.addSelf(s);return a},randomPointInFace:function(e,t,i){var r,o,n;if(e instanceof THREE.Face3){r=t.vertices[e.a];o=t.vertices[e.b];n=t.vertices[e.c];return THREE.GeometryUtils.randomPointInTriangle(r,o,n)}if(e instanceof THREE.Face4){r=t.vertices[e.a];o=t.vertices[e.b];n=t.vertices[e.c];var t=t.vertices[e.d],a;if(i)if(e._area1&&e._area2){i=e._area1;a=e._area2}else{i=THREE.GeometryUtils.triangleArea(r,o,t);a=THREE.GeometryUtils.triangleArea(o,n,t);e._area1=i;e._area2=a}else{i=THREE.GeometryUtils.triangleArea(r,o,t);a=THREE.GeometryUtils.triangleArea(o,n,t)}return THREE.GeometryUtils.random()*(i+a)<i?THREE.GeometryUtils.randomPointInTriangle(r,o,t):THREE.GeometryUtils.randomPointInTriangle(o,n,t)}},randomPointsInGeometry:function(e,t){function i(e){function t(i,r){if(r<i)return i;var o=i+Math.floor((r-i)/2);return h[o]>e?t(i,o-1):h[o]<e?t(o+1,r):o}return t(0,h.length-1)}var r,o,n=e.faces,a=e.vertices,s=n.length,l=0,h=[],c,f,u,E;for(o=0;o<s;o++){r=n[o];if(r instanceof THREE.Face3){c=a[r.a];f=a[r.b];u=a[r.c];r._area=THREE.GeometryUtils.triangleArea(c,f,u)}else if(r instanceof THREE.Face4){c=a[r.a];f=a[r.b];u=a[r.c];E=a[r.d];r._area1=THREE.GeometryUtils.triangleArea(c,f,E);r._area2=THREE.GeometryUtils.triangleArea(f,u,E);r._area=r._area1+r._area2}l=l+r._area;h[o]=l}r=[];for(o=0;o<t;o++){a=THREE.GeometryUtils.random()*l;a=i(a);r[o]=THREE.GeometryUtils.randomPointInFace(n[a],e,true)}return r},triangleArea:function(e,t,i){var r,o=THREE.GeometryUtils.__v1;o.sub(e,t);r=o.length();o.sub(e,i);e=o.length();o.sub(t,i);i=o.length();t=.5*(r+e+i);return Math.sqrt(t*(t-r)*(t-e)*(t-i))},center:function(e){e.computeBoundingBox();var t=e.boundingBox,i=new THREE.Vector3;i.add(t.min,t.max);i.multiplyScalar(-.5);e.applyMatrix((new THREE.Matrix4).makeTranslation(i.x,i.y,i.z));e.computeBoundingBox();return i},normalizeUVs:function(e){for(var e=e.faceVertexUvs[0],t=0,i=e.length;t<i;t++)for(var r=e[t],o=0,n=r.length;o<n;o++){if(r[o].u!==1)r[o].u=r[o].u-Math.floor(r[o].u);if(r[o].v!==1)r[o].v=r[o].v-Math.floor(r[o].v)}},triangulateQuads:function(e){var t,i,r,o,n=[],a=[],s=[];t=0;for(i=e.faceUvs.length;t<i;t++)a[t]=[];t=0;for(i=e.faceVertexUvs.length;t<i;t++)s[t]=[];t=0;for(i=e.faces.length;t<i;t++){r=e.faces[t];if(r instanceof THREE.Face4){o=r.a;var l=r.b,h=r.c,c=r.d,f=new THREE.Face3,u=new THREE.Face3;f.color.copy(r.color);u.color.copy(r.color);f.materialIndex=r.materialIndex;u.materialIndex=r.materialIndex;f.a=o;f.b=l;f.c=c;u.a=l;u.b=h;u.c=c;if(r.vertexColors.length===4){f.vertexColors[0]=r.vertexColors[0].clone();f.vertexColors[1]=r.vertexColors[1].clone();f.vertexColors[2]=r.vertexColors[3].clone();u.vertexColors[0]=r.vertexColors[1].clone();u.vertexColors[1]=r.vertexColors[2].clone();u.vertexColors[2]=r.vertexColors[3].clone()}n.push(f,u);r=0;for(o=e.faceVertexUvs.length;r<o;r++)if(e.faceVertexUvs[r].length){f=e.faceVertexUvs[r][t];l=f[1];h=f[2];c=f[3];f=[f[0].clone(),l.clone(),c.clone()];l=[l.clone(),h.clone(),c.clone()];s[r].push(f,l)}r=0;for(o=e.faceUvs.length;r<o;r++)if(e.faceUvs[r].length){l=e.faceUvs[r][t];a[r].push(l,l)}}else{n.push(r);r=0;for(o=e.faceUvs.length;r<o;r++)a[r].push(e.faceUvs[r]);r=0;for(o=e.faceVertexUvs.length;r<o;r++)s[r].push(e.faceVertexUvs[r])}}e.faces=n;e.faceUvs=a;e.faceVertexUvs=s;e.computeCentroids();e.computeFaceNormals();e.computeVertexNormals();e.hasTangents&&e.computeTangents()},explode:function(e){for(var t=[],i=0,r=e.faces.length;i<r;i++){var o=t.length,n=e.faces[i];if(n instanceof THREE.Face4){var a=n.a,s=n.b,l=n.c,a=e.vertices[a],s=e.vertices[s],l=e.vertices[l],h=e.vertices[n.d];t.push(a.clone());t.push(s.clone());t.push(l.clone());t.push(h.clone());n.a=o;n.b=o+1;n.c=o+2;n.d=o+3}else{a=n.a;s=n.b;l=n.c;a=e.vertices[a];s=e.vertices[s];l=e.vertices[l];t.push(a.clone());t.push(s.clone());t.push(l.clone());n.a=o;n.b=o+1;n.c=o+2}}e.vertices=t;delete e.__tmpVertices},tessellate:function(e,t){var i,r,o,n,a,s,l,h,c,f,u,E,p,d,m,g,v,T,R,y=[],x=[];i=0;for(r=e.faceVertexUvs.length;i<r;i++)x[i]=[];i=0;for(r=e.faces.length;i<r;i++){o=e.faces[i];if(o instanceof THREE.Face3){n=o.a;a=o.b;s=o.c;h=e.vertices[n];c=e.vertices[a];f=e.vertices[s];E=h.distanceTo(c);p=c.distanceTo(f);u=h.distanceTo(f);if(E>t||p>t||u>t){l=e.vertices.length;T=o.clone();R=o.clone();if(E>=p&&E>=u){h=h.clone();h.lerpSelf(c,.5);T.a=n;T.b=l;T.c=s;R.a=l;R.b=a;R.c=s;if(o.vertexNormals.length===3){n=o.vertexNormals[0].clone();n.lerpSelf(o.vertexNormals[1],.5);T.vertexNormals[1].copy(n);R.vertexNormals[0].copy(n)}if(o.vertexColors.length===3){n=o.vertexColors[0].clone();n.lerpSelf(o.vertexColors[1],.5);T.vertexColors[1].copy(n);R.vertexColors[0].copy(n)}o=0}else if(p>=E&&p>=u){h=c.clone();h.lerpSelf(f,.5);T.a=n;T.b=a;T.c=l;R.a=l;R.b=s;R.c=n;if(o.vertexNormals.length===3){n=o.vertexNormals[1].clone();n.lerpSelf(o.vertexNormals[2],.5);T.vertexNormals[2].copy(n);R.vertexNormals[0].copy(n);R.vertexNormals[1].copy(o.vertexNormals[2]);R.vertexNormals[2].copy(o.vertexNormals[0])}if(o.vertexColors.length===3){n=o.vertexColors[1].clone();n.lerpSelf(o.vertexColors[2],.5);T.vertexColors[2].copy(n);R.vertexColors[0].copy(n);R.vertexColors[1].copy(o.vertexColors[2]);R.vertexColors[2].copy(o.vertexColors[0])}o=1}else{h=h.clone();h.lerpSelf(f,.5);T.a=n;T.b=a;T.c=l;R.a=l;R.b=a;R.c=s;if(o.vertexNormals.length===3){n=o.vertexNormals[0].clone();n.lerpSelf(o.vertexNormals[2],.5);T.vertexNormals[2].copy(n);R.vertexNormals[0].copy(n)}if(o.vertexColors.length===3){n=o.vertexColors[0].clone();n.lerpSelf(o.vertexColors[2],.5);T.vertexColors[2].copy(n);R.vertexColors[0].copy(n)}o=2}y.push(T,R);e.vertices.push(h);n=0;for(a=e.faceVertexUvs.length;n<a;n++)if(e.faceVertexUvs[n].length){h=e.faceVertexUvs[n][i];R=h[0];s=h[1];T=h[2];if(o===0){c=R.clone();c.lerpSelf(s,.5);h=[R.clone(),c.clone(),T.clone()];s=[c.clone(),s.clone(),T.clone()]}else if(o===1){c=s.clone();c.lerpSelf(T,.5);h=[R.clone(),s.clone(),c.clone()];s=[c.clone(),T.clone(),R.clone()]}else{c=R.clone();c.lerpSelf(T,.5);h=[R.clone(),s.clone(),c.clone()];s=[c.clone(),s.clone(),T.clone()]}x[n].push(h,s)}}else{y.push(o);n=0;for(a=e.faceVertexUvs.length;n<a;n++)x[n].push(e.faceVertexUvs[n][i])}}else{n=o.a;a=o.b;s=o.c;l=o.d;h=e.vertices[n];c=e.vertices[a];f=e.vertices[s];u=e.vertices[l];E=h.distanceTo(c);p=c.distanceTo(f);d=f.distanceTo(u);m=h.distanceTo(u);if(E>t||p>t||d>t||m>t){g=e.vertices.length;v=e.vertices.length+1;T=o.clone();R=o.clone();if(E>=p&&E>=d&&E>=m||d>=p&&d>=E&&d>=m){E=h.clone();E.lerpSelf(c,.5);c=f.clone();c.lerpSelf(u,.5);T.a=n;T.b=g;T.c=v;T.d=l;R.a=g;R.b=a;R.c=s;R.d=v;if(o.vertexNormals.length===4){n=o.vertexNormals[0].clone();n.lerpSelf(o.vertexNormals[1],.5);a=o.vertexNormals[2].clone();a.lerpSelf(o.vertexNormals[3],.5);T.vertexNormals[1].copy(n);T.vertexNormals[2].copy(a);R.vertexNormals[0].copy(n);R.vertexNormals[3].copy(a)}if(o.vertexColors.length===4){n=o.vertexColors[0].clone();n.lerpSelf(o.vertexColors[1],.5);a=o.vertexColors[2].clone();a.lerpSelf(o.vertexColors[3],.5);T.vertexColors[1].copy(n);T.vertexColors[2].copy(a);R.vertexColors[0].copy(n);R.vertexColors[3].copy(a)}o=0}else{E=c.clone();E.lerpSelf(f,.5);c=u.clone();c.lerpSelf(h,.5);T.a=n;T.b=a;T.c=g;T.d=v;R.a=v;R.b=g;R.c=s;R.d=l;if(o.vertexNormals.length===4){n=o.vertexNormals[1].clone();n.lerpSelf(o.vertexNormals[2],.5);a=o.vertexNormals[3].clone();a.lerpSelf(o.vertexNormals[0],.5);T.vertexNormals[2].copy(n);T.vertexNormals[3].copy(a);R.vertexNormals[0].copy(a);R.vertexNormals[1].copy(n)}if(o.vertexColors.length===4){n=o.vertexColors[1].clone();n.lerpSelf(o.vertexColors[2],.5);a=o.vertexColors[3].clone();a.lerpSelf(o.vertexColors[0],.5);T.vertexColors[2].copy(n);T.vertexColors[3].copy(a);R.vertexColors[0].copy(a);R.vertexColors[1].copy(n)}o=1}y.push(T,R);e.vertices.push(E,c);n=0;for(a=e.faceVertexUvs.length;n<a;n++)if(e.faceVertexUvs[n].length){h=e.faceVertexUvs[n][i];R=h[0];s=h[1];T=h[2];h=h[3];if(o===0){c=R.clone();c.lerpSelf(s,.5);f=T.clone();f.lerpSelf(h,.5);R=[R.clone(),c.clone(),f.clone(),h.clone()];s=[c.clone(),s.clone(),T.clone(),f.clone()]}else{c=s.clone();c.lerpSelf(T,.5);f=h.clone();f.lerpSelf(R,.5);R=[R.clone(),s.clone(),c.clone(),f.clone()];s=[f.clone(),c.clone(),T.clone(),h.clone()]}x[n].push(R,s)}}else{y.push(o);n=0;for(a=e.faceVertexUvs.length;n<a;n++)x[n].push(e.faceVertexUvs[n][i])}}}e.faces=y;e.faceVertexUvs=x}};THREE.GeometryUtils.random=THREE.Math.random16;THREE.GeometryUtils.__v1=new THREE.Vector3;THREE.ImageUtils={crossOrigin:"anonymous",loadTexture:function(e,t,i){var r=new Image,o=new THREE.Texture(r,t);r.onload=function(){o.needsUpdate=true;i&&i(this)};r.crossOrigin=this.crossOrigin;r.src=e;return o},loadTextureCube:function(e,t,i){var r,o=[],n=new THREE.Texture(o,t),t=o.loadCount=0;for(r=e.length;t<r;++t){o[t]=new Image;o[t].onload=function(){o.loadCount=o.loadCount+1;if(o.loadCount===6)n.needsUpdate=true;i&&i(this)};o[t].crossOrigin=this.crossOrigin;o[t].src=e[t]}return n},getNormalMap:function(e,t){var i=function(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);return[e[0]/t,e[1]/t,e[2]/t]},t=t|1,r=e.width,o=e.height,n=document.createElement("canvas");n.width=r;n.height=o;var a=n.getContext("2d");a.drawImage(e,0,0);for(var s=a.getImageData(0,0,r,o).data,l=a.createImageData(r,o),h=l.data,c=0;c<r;c++)for(var f=0;f<o;f++){var u=f-1<0?0:f-1,E=f+1>o-1?o-1:f+1,p=c-1<0?0:c-1,d=c+1>r-1?r-1:c+1,m=[],g=[0,0,s[(f*r+c)*4]/255*t];m.push([-1,0,s[(f*r+p)*4]/255*t]);m.push([-1,-1,s[(u*r+p)*4]/255*t]);m.push([0,-1,s[(u*r+c)*4]/255*t]);m.push([1,-1,s[(u*r+d)*4]/255*t]);m.push([1,0,s[(f*r+d)*4]/255*t]);m.push([1,1,s[(E*r+d)*4]/255*t]);m.push([0,1,s[(E*r+c)*4]/255*t]);m.push([-1,1,s[(E*r+p)*4]/255*t]);u=[];p=m.length;for(E=0;E<p;E++){var d=m[E],v=m[(E+1)%p],d=[d[0]-g[0],d[1]-g[1],d[2]-g[2]],v=[v[0]-g[0],v[1]-g[1],v[2]-g[2]];u.push(i([d[1]*v[2]-d[2]*v[1],d[2]*v[0]-d[0]*v[2],d[0]*v[1]-d[1]*v[0]]))}m=[0,0,0];for(E=0;E<u.length;E++){m[0]=m[0]+u[E][0];m[1]=m[1]+u[E][1];m[2]=m[2]+u[E][2]}m[0]=m[0]/u.length;m[1]=m[1]/u.length;m[2]=m[2]/u.length;g=(f*r+c)*4;h[g]=(m[0]+1)/2*255|0;h[g+1]=(m[1]+.5)*255|0;h[g+2]=m[2]*255|0;h[g+3]=255}a.putImageData(l,0,0);return n},generateDataTexture:function(e,t,i){for(var r=e*t,o=new Uint8Array(3*r),n=Math.floor(i.r*255),a=Math.floor(i.g*255),i=Math.floor(i.b*255),s=0;s<r;s++){o[s*3]=n;o[s*3+1]=a;o[s*3+2]=i}e=new THREE.DataTexture(o,e,t,THREE.RGBFormat);e.needsUpdate=true;return e}};THREE.SceneUtils={showHierarchy:function(e,t){THREE.SceneUtils.traverseHierarchy(e,function(e){e.visible=t})},traverseHierarchy:function(e,t){var i,r,o=e.children.length;for(r=0;r<o;r++){i=e.children[r];t(i);THREE.SceneUtils.traverseHierarchy(i,t)}},createMultiMaterialObject:function(e,t){var i,r=t.length,o=new THREE.Object3D;for(i=0;i<r;i++){var n=new THREE.Mesh(e,t[i]);o.add(n)}return o},cloneObject:function(e){var t;if(e instanceof THREE.MorphAnimMesh){t=new THREE.MorphAnimMesh(e.geometry,e.material);t.duration=e.duration;t.mirroredLoop=e.mirroredLoop;t.time=e.time;t.lastKeyframe=e.lastKeyframe;t.currentKeyframe=e.currentKeyframe;t.direction=e.direction;t.directionBackwards=e.directionBackwards}else if(e instanceof THREE.SkinnedMesh)t=new THREE.SkinnedMesh(e.geometry,e.material);else if(e instanceof THREE.Mesh)t=new THREE.Mesh(e.geometry,e.material);else if(e instanceof THREE.Line)t=new THREE.Line(e.geometry,e.material,e.type);else if(e instanceof THREE.Ribbon)t=new THREE.Ribbon(e.geometry,e.material);else if(e instanceof THREE.ParticleSystem){t=new THREE.ParticleSystem(e.geometry,e.material);t.sortParticles=e.sortParticles}else if(e instanceof THREE.Particle)t=new THREE.Particle(e.material);else if(e instanceof THREE.Sprite){t=new THREE.Sprite({});t.color.copy(e.color);t.map=e.map;t.blending=e.blending;t.useScreenCoordinates=e.useScreenCoordinates;t.mergeWith3D=e.mergeWith3D;t.affectedByDistance=e.affectedByDistance;t.scaleByViewport=e.scaleByViewport;t.alignment=e.alignment;t.rotation3d.copy(e.rotation3d);t.rotation=e.rotation;t.opacity=e.opacity;t.uvOffset.copy(e.uvOffset);t.uvScale.copy(e.uvScale)}else if(e instanceof THREE.LOD)t=new THREE.LOD;else if(e instanceof THREE.MarchingCubes){t=new THREE.MarchingCubes(e.resolution,e.material);t.field.set(e.field);t.isolation=e.isolation}else e instanceof THREE.Object3D&&(t=new THREE.Object3D);t.name=e.name;t.parent=e.parent;t.up.copy(e.up);t.position.copy(e.position);t.rotation instanceof THREE.Vector3&&t.rotation.copy(e.rotation);t.eulerOrder=e.eulerOrder;t.scale.copy(e.scale);t.dynamic=e.dynamic;t.doubleSided=e.doubleSided;t.flipSided=e.flipSided;t.renderDepth=e.renderDepth;t.rotationAutoUpdate=e.rotationAutoUpdate;t.matrix.copy(e.matrix);t.matrixWorld.copy(e.matrixWorld);t.matrixRotationWorld.copy(e.matrixRotationWorld);t.matrixAutoUpdate=e.matrixAutoUpdate;t.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate;t.quaternion.copy(e.quaternion);t.useQuaternion=e.useQuaternion;t.boundRadius=e.boundRadius;t.boundRadiusScale=e.boundRadiusScale;t.visible=e.visible;t.castShadow=e.castShadow;t.receiveShadow=e.receiveShadow;t.frustumCulled=e.frustumCulled;for(var i=0;i<e.children.length;i++){var r=THREE.SceneUtils.cloneObject(e.children[i]);t.children[i]=r;r.parent=t}if(e instanceof THREE.LOD)for(i=0;i<e.LODs.length;i++)t.LODs[i]={visibleAtDistance:e.LODs[i].visibleAtDistance,object3D:t.children[i]};return t},detach:function(e,t,i){e.applyMatrix(t.matrixWorld);t.remove(e);i.add(e)},attach:function(e,t,i){var r=new THREE.Matrix4;r.getInverse(i.matrixWorld);e.applyMatrix(r);t.remove(e);
i.add(e)}};THREE.WebGLRenderer&&(THREE.ShaderUtils={lib:{fresnel:{uniforms:{mRefractionRatio:{type:"f",value:1.02},mFresnelBias:{type:"f",value:.1},mFresnelPower:{type:"f",value:2},mFresnelScale:{type:"f",value:1},tCube:{type:"t",value:1,texture:null}},fragmentShader:"uniform samplerCube tCube;\nvarying vec3 vReflect;\nvarying vec3 vRefract[3];\nvarying float vReflectionFactor;\nvoid main() {\nvec4 reflectedColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );\nvec4 refractedColor = vec4( 1.0, 1.0, 1.0, 1.0 );\nrefractedColor.r = textureCube( tCube, vec3( -vRefract[0].x, vRefract[0].yz ) ).r;\nrefractedColor.g = textureCube( tCube, vec3( -vRefract[1].x, vRefract[1].yz ) ).g;\nrefractedColor.b = textureCube( tCube, vec3( -vRefract[2].x, vRefract[2].yz ) ).b;\nrefractedColor.a = 1.0;\ngl_FragColor = mix( refractedColor, reflectedColor, clamp( vReflectionFactor, 0.0, 1.0 ) );\n}",vertexShader:"uniform float mRefractionRatio;\nuniform float mFresnelBias;\nuniform float mFresnelScale;\nuniform float mFresnelPower;\nvarying vec3 vReflect;\nvarying vec3 vRefract[3];\nvarying float vReflectionFactor;\nvoid main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\nvec3 nWorld = normalize ( mat3( objectMatrix[0].xyz, objectMatrix[1].xyz, objectMatrix[2].xyz ) * normal );\nvec3 I = mPosition.xyz - cameraPosition;\nvReflect = reflect( I, nWorld );\nvRefract[0] = refract( normalize( I ), nWorld, mRefractionRatio );\nvRefract[1] = refract( normalize( I ), nWorld, mRefractionRatio * 0.99 );\nvRefract[2] = refract( normalize( I ), nWorld, mRefractionRatio * 0.98 );\nvReflectionFactor = mFresnelBias + mFresnelScale * pow( 1.0 + dot( normalize( I ), nWorld ), mFresnelPower );\ngl_Position = projectionMatrix * mvPosition;\n}"},normal:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap,{enableAO:{type:"i",value:0},enableDiffuse:{type:"i",value:0},enableSpecular:{type:"i",value:0},enableReflection:{type:"i",value:0},tDiffuse:{type:"t",value:0,texture:null},tCube:{type:"t",value:1,texture:null},tNormal:{type:"t",value:2,texture:null},tSpecular:{type:"t",value:3,texture:null},tAO:{type:"t",value:4,texture:null},tDisplacement:{type:"t",value:5,texture:null},uNormalScale:{type:"f",value:1},uDisplacementBias:{type:"f",value:0},uDisplacementScale:{type:"f",value:1},uDiffuseColor:{type:"c",value:new THREE.Color(16777215)},uSpecularColor:{type:"c",value:new THREE.Color(1118481)},uAmbientColor:{type:"c",value:new THREE.Color(16777215)},uShininess:{type:"f",value:30},uOpacity:{type:"f",value:1},uReflectivity:{type:"f",value:.5},uOffset:{type:"v2",value:new THREE.Vector2(0,0)},uRepeat:{type:"v2",value:new THREE.Vector2(1,1)},wrapRGB:{type:"v3",value:new THREE.Vector3(1,1,1)}}]),fragmentShader:["uniform vec3 uAmbientColor;\nuniform vec3 uDiffuseColor;\nuniform vec3 uSpecularColor;\nuniform float uShininess;\nuniform float uOpacity;\nuniform bool enableDiffuse;\nuniform bool enableSpecular;\nuniform bool enableAO;\nuniform bool enableReflection;\nuniform sampler2D tDiffuse;\nuniform sampler2D tNormal;\nuniform sampler2D tSpecular;\nuniform sampler2D tAO;\nuniform samplerCube tCube;\nuniform float uNormalScale;\nuniform float uReflectivity;\nvarying vec3 vTangent;\nvarying vec3 vBinormal;\nvarying vec3 vNormal;\nvarying vec2 vUv;\nuniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\n#ifdef WRAP_AROUND\nuniform vec3 wrapRGB;\n#endif\nvarying vec3 vViewPosition;",THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,"void main() {\ngl_FragColor = vec4( vec3( 1.0 ), uOpacity );\nvec3 specularTex = vec3( 1.0 );\nvec3 normalTex = texture2D( tNormal, vUv ).xyz * 2.0 - 1.0;\nnormalTex.xy *= uNormalScale;\nnormalTex = normalize( normalTex );\nif( enableDiffuse ) {\n#ifdef GAMMA_INPUT\nvec4 texelColor = texture2D( tDiffuse, vUv );\ntexelColor.xyz *= texelColor.xyz;\ngl_FragColor = gl_FragColor * texelColor;\n#else\ngl_FragColor = gl_FragColor * texture2D( tDiffuse, vUv );\n#endif\n}\nif( enableAO ) {\n#ifdef GAMMA_INPUT\nvec4 aoColor = texture2D( tAO, vUv );\naoColor.xyz *= aoColor.xyz;\ngl_FragColor.xyz = gl_FragColor.xyz * aoColor.xyz;\n#else\ngl_FragColor.xyz = gl_FragColor.xyz * texture2D( tAO, vUv ).xyz;\n#endif\n}\nif( enableSpecular )\nspecularTex = texture2D( tSpecular, vUv ).xyz;\nmat3 tsb = mat3( normalize( vTangent ), normalize( vBinormal ), normalize( vNormal ) );\nvec3 finalNormal = tsb * normalTex;\nvec3 normal = normalize( finalNormal );\nvec3 viewPosition = normalize( vViewPosition );\n#if MAX_POINT_LIGHTS > 0\nvec3 pointDiffuse = vec3( 0.0 );\nvec3 pointSpecular = vec3( 0.0 );\nfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\nvec3 pointVector = normalize( vPointLight[ i ].xyz );\nfloat pointDistance = vPointLight[ i ].w;\n#ifdef WRAP_AROUND\nfloat pointDiffuseWeightFull = max( dot( normal, pointVector ), 0.0 );\nfloat pointDiffuseWeightHalf = max( 0.5 * dot( normal, pointVector ) + 0.5, 0.0 );\nvec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );\n#else\nfloat pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );\n#endif\npointDiffuse += pointDistance * pointLightColor[ i ] * uDiffuseColor * pointDiffuseWeight;\nvec3 pointHalfVector = normalize( pointVector + viewPosition );\nfloat pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );\nfloat pointSpecularWeight = specularTex.r * max( pow( pointDotNormalHalf, uShininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat specularNormalization = ( uShininess + 2.0001 ) / 8.0;\nvec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( pointVector, pointHalfVector ), 5.0 );\npointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * pointDistance * specularNormalization;\n#else\npointSpecular += pointDistance * pointLightColor[ i ] * uSpecularColor * pointSpecularWeight * pointDiffuseWeight;\n#endif\n}\n#endif\n#if MAX_DIR_LIGHTS > 0\nvec3 dirDiffuse = vec3( 0.0 );\nvec3 dirSpecular = vec3( 0.0 );\nfor( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nvec3 dirVector = normalize( lDirection.xyz );\n#ifdef WRAP_AROUND\nfloat directionalLightWeightingFull = max( dot( normal, dirVector ), 0.0 );\nfloat directionalLightWeightingHalf = max( 0.5 * dot( normal, dirVector ) + 0.5, 0.0 );\nvec3 dirDiffuseWeight = mix( vec3( directionalLightWeightingFull ), vec3( directionalLightWeightingHalf ), wrapRGB );\n#else\nfloat dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );\n#endif\ndirDiffuse += directionalLightColor[ i ] * uDiffuseColor * dirDiffuseWeight;\nvec3 dirHalfVector = normalize( dirVector + viewPosition );\nfloat dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );\nfloat dirSpecularWeight = specularTex.r * max( pow( dirDotNormalHalf, uShininess ), 0.0 );\n#ifdef PHYSICALLY_BASED_SHADING\nfloat specularNormalization = ( uShininess + 2.0001 ) / 8.0;\nvec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( dirVector, dirHalfVector ), 5.0 );\ndirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;\n#else\ndirSpecular += directionalLightColor[ i ] * uSpecularColor * dirSpecularWeight * dirDiffuseWeight;\n#endif\n}\n#endif\nvec3 totalDiffuse = vec3( 0.0 );\nvec3 totalSpecular = vec3( 0.0 );\n#if MAX_DIR_LIGHTS > 0\ntotalDiffuse += dirDiffuse;\ntotalSpecular += dirSpecular;\n#endif\n#if MAX_POINT_LIGHTS > 0\ntotalDiffuse += pointDiffuse;\ntotalSpecular += pointSpecular;\n#endif\ngl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * uAmbientColor) + totalSpecular;\nif ( enableReflection ) {\nvec3 wPos = cameraPosition - vViewPosition;\nvec3 vReflect = reflect( normalize( wPos ), normal );\nvec4 cubeColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );\n#ifdef GAMMA_INPUT\ncubeColor.xyz *= cubeColor.xyz;\n#endif\ngl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularTex.r * uReflectivity );\n}",THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["attribute vec4 tangent;\nuniform vec2 uOffset;\nuniform vec2 uRepeat;\n#ifdef VERTEX_TEXTURES\nuniform sampler2D tDisplacement;\nuniform float uDisplacementScale;\nuniform float uDisplacementBias;\n#endif\nvarying vec3 vTangent;\nvarying vec3 vBinormal;\nvarying vec3 vNormal;\nvarying vec2 vUv;\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\nvarying vec4 vPointLight[ MAX_POINT_LIGHTS ];\n#endif\nvarying vec3 vViewPosition;",THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\nvViewPosition = -mvPosition.xyz;\nvNormal = normalMatrix * normal;\nvTangent = normalMatrix * tangent.xyz;\nvBinormal = cross( vNormal, vTangent ) * tangent.w;\nvUv = uv * uRepeat + uOffset;\n#if MAX_POINT_LIGHTS > 0\nfor( int i = 0; i < MAX_POINT_LIGHTS; i++ ) {\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\nvPointLight[ i ] = vec4( lVector, lDistance );\n}\n#endif\n#ifdef VERTEX_TEXTURES\nvec3 dv = texture2D( tDisplacement, uv ).xyz;\nfloat df = uDisplacementScale * dv.x + uDisplacementBias;\nvec4 displacedPosition = vec4( normalize( vNormal.xyz ) * df, 0.0 ) + mvPosition;\ngl_Position = projectionMatrix * displacedPosition;\n#else\ngl_Position = projectionMatrix * mvPosition;\n#endif",THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n")},cube:{uniforms:{tCube:{type:"t",value:1,texture:null},tFlip:{type:"f",value:-1}},vertexShader:"varying vec3 vViewPosition;\nvoid main() {\nvec4 mPosition = objectMatrix * vec4( position, 1.0 );\nvViewPosition = cameraPosition - mPosition.xyz;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform samplerCube tCube;\nuniform float tFlip;\nvarying vec3 vViewPosition;\nvoid main() {\nvec3 wPos = cameraPosition - vViewPosition;\ngl_FragColor = textureCube( tCube, vec3( tFlip * wPos.x, wPos.yz ) );\n}"}}});THREE.BufferGeometry=function(){this.id=THREE.GeometryCount++;this.vertexColorArray=this.vertexUvArray=this.vertexNormalArray=this.vertexPositionArray=this.vertexIndexArray=this.vertexColorBuffer=this.vertexUvBuffer=this.vertexNormalBuffer=this.vertexPositionBuffer=this.vertexIndexBuffer=null;this.dynamic=false;this.boundingSphere=this.boundingBox=null;this.morphTargets=[]};THREE.BufferGeometry.prototype={constructor:THREE.BufferGeometry,computeBoundingBox:function(){},computeBoundingSphere:function(){}};THREE.Curve=function(){};THREE.Curve.prototype.getPoint=function(){console.log("Warning, getPoint() not implemented!");return null};THREE.Curve.prototype.getPointAt=function(e){return this.getPoint(this.getUtoTmapping(e))};THREE.Curve.prototype.getPoints=function(e){e||(e=5);var t,i=[];for(t=0;t<=e;t++)i.push(this.getPoint(t/e));return i};THREE.Curve.prototype.getSpacedPoints=function(e){e||(e=5);var t,i=[];for(t=0;t<=e;t++)i.push(this.getPointAt(t/e));return i};THREE.Curve.prototype.getLength=function(){var e=this.getLengths();return e[e.length-1]};THREE.Curve.prototype.getLengths=function(e){e||(e=this.__arcLengthDivisions?this.__arcLengthDivisions:200);if(this.cacheArcLengths&&this.cacheArcLengths.length==e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=false;var t=[],i,r=this.getPoint(0),o,n=0;t.push(0);for(o=1;o<=e;o++){i=this.getPoint(o/e);n=n+i.distanceTo(r);t.push(n);r=i}return this.cacheArcLengths=t};THREE.Curve.prototype.updateArcLengths=function(){this.needsUpdate=true;this.getLengths()};THREE.Curve.prototype.getUtoTmapping=function(e,t){var i=this.getLengths(),r=0,o=i.length,n;n=t?t:e*i[o-1];for(var a=0,s=o-1,l;a<=s;){r=Math.floor(a+(s-a)/2);l=i[r]-n;if(l<0)a=r+1;else if(l>0)s=r-1;else{s=r;break}}r=s;if(i[r]==n)return r/(o-1);a=i[r];return i=(r+(n-a)/(i[r+1]-a))/(o-1)};THREE.Curve.prototype.getNormalVector=function(e){e=this.getTangent(e);return new THREE.Vector2(-e.y,e.x)};THREE.Curve.prototype.getTangent=function(e){var t=e-1e-4,e=e+1e-4;t<0&&(t=0);e>1&&(e=1);t=this.getPoint(t);return this.getPoint(e).clone().subSelf(t).normalize()};THREE.Curve.prototype.getTangentAt=function(e){return this.getTangent(this.getUtoTmapping(e))};THREE.LineCurve=function(e,t){this.v1=e;this.v2=t};THREE.LineCurve.prototype=new THREE.Curve;THREE.LineCurve.prototype.constructor=THREE.LineCurve;THREE.LineCurve.prototype.getPoint=function(e){var t=this.v2.clone().subSelf(this.v1);t.multiplyScalar(e).addSelf(this.v1);return t};THREE.LineCurve.prototype.getPointAt=function(e){return this.getPoint(e)};THREE.LineCurve.prototype.getTangent=function(){return this.v2.clone().subSelf(this.v1).normalize()};THREE.QuadraticBezierCurve=function(e,t,i){this.v0=e;this.v1=t;this.v2=i};THREE.QuadraticBezierCurve.prototype=new THREE.Curve;THREE.QuadraticBezierCurve.prototype.constructor=THREE.QuadraticBezierCurve;THREE.QuadraticBezierCurve.prototype.getPoint=function(e){var t;t=THREE.Shape.Utils.b2(e,this.v0.x,this.v1.x,this.v2.x);e=THREE.Shape.Utils.b2(e,this.v0.y,this.v1.y,this.v2.y);return new THREE.Vector2(t,e)};THREE.QuadraticBezierCurve.prototype.getTangent=function(e){var t;t=THREE.Curve.Utils.tangentQuadraticBezier(e,this.v0.x,this.v1.x,this.v2.x);e=THREE.Curve.Utils.tangentQuadraticBezier(e,this.v0.y,this.v1.y,this.v2.y);t=new THREE.Vector2(t,e);t.normalize();return t};THREE.CubicBezierCurve=function(e,t,i,r){this.v0=e;this.v1=t;this.v2=i;this.v3=r};THREE.CubicBezierCurve.prototype=new THREE.Curve;THREE.CubicBezierCurve.prototype.constructor=THREE.CubicBezierCurve;THREE.CubicBezierCurve.prototype.getPoint=function(e){var t;t=THREE.Shape.Utils.b3(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x);e=THREE.Shape.Utils.b3(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y);return new THREE.Vector2(t,e)};THREE.CubicBezierCurve.prototype.getTangent=function(e){var t;t=THREE.Curve.Utils.tangentCubicBezier(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x);e=THREE.Curve.Utils.tangentCubicBezier(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y);t=new THREE.Vector2(t,e);t.normalize();return t};THREE.SplineCurve=function(e){this.points=e==void 0?[]:e};THREE.SplineCurve.prototype=new THREE.Curve;THREE.SplineCurve.prototype.constructor=THREE.SplineCurve;THREE.SplineCurve.prototype.getPoint=function(e){var t=new THREE.Vector2,i=[],r=this.points,o;o=(r.length-1)*e;e=Math.floor(o);o=o-e;i[0]=e==0?e:e-1;i[1]=e;i[2]=e>r.length-2?r.length-1:e+1;i[3]=e>r.length-3?r.length-1:e+2;t.x=THREE.Curve.Utils.interpolate(r[i[0]].x,r[i[1]].x,r[i[2]].x,r[i[3]].x,o);t.y=THREE.Curve.Utils.interpolate(r[i[0]].y,r[i[1]].y,r[i[2]].y,r[i[3]].y,o);return t};THREE.ArcCurve=function(e,t,i,r,o,n){this.aX=e;this.aY=t;this.aRadius=i;this.aStartAngle=r;this.aEndAngle=o;this.aClockwise=n};THREE.ArcCurve.prototype=new THREE.Curve;THREE.ArcCurve.prototype.constructor=THREE.ArcCurve;THREE.ArcCurve.prototype.getPoint=function(e){var t=this.aEndAngle-this.aStartAngle;this.aClockwise||(e=1-e);t=this.aStartAngle+e*t;e=this.aX+this.aRadius*Math.cos(t);t=this.aY+this.aRadius*Math.sin(t);return new THREE.Vector2(e,t)};THREE.Curve.Utils={tangentQuadraticBezier:function(e,t,i,r){return 2*(1-e)*(i-t)+2*e*(r-i)},tangentCubicBezier:function(e,t,i,r,o){return-3*t*(1-e)*(1-e)+3*i*(1-e)*(1-e)-6*e*i*(1-e)+6*e*r*(1-e)-3*e*e*r+3*e*e*o},tangentSpline:function(e){return 6*e*e-6*e+(3*e*e-4*e+1)+(-6*e*e+6*e)+(3*e*e-2*e)},interpolate:function(e,t,i,r,o){var e=(i-e)*.5,r=(r-t)*.5,n=o*o;return(2*t-2*i+e+r)*o*n+(-3*t+3*i-2*e-r)*n+e*o+t}};THREE.Curve.create=function(e,t){e.prototype=new THREE.Curve;e.prototype.constructor=e;e.prototype.getPoint=t;return e};THREE.LineCurve3=THREE.Curve.create(function(e,t){this.v1=e;this.v2=t},function(e){var t=new THREE.Vector3;t.sub(this.v2,this.v1);t.multiplyScalar(e);t.addSelf(this.v1);return t});THREE.QuadraticBezierCurve3=THREE.Curve.create(function(e,t,i){this.v0=e;this.v1=t;this.v2=i},function(e){var t,i;t=THREE.Shape.Utils.b2(e,this.v0.x,this.v1.x,this.v2.x);i=THREE.Shape.Utils.b2(e,this.v0.y,this.v1.y,this.v2.y);e=THREE.Shape.Utils.b2(e,this.v0.z,this.v1.z,this.v2.z);return new THREE.Vector3(t,i,e)});THREE.CubicBezierCurve3=THREE.Curve.create(function(e,t,i,r){this.v0=e;this.v1=t;this.v2=i;this.v3=r},function(e){var t,i;t=THREE.Shape.Utils.b3(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x);i=THREE.Shape.Utils.b3(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y);e=THREE.Shape.Utils.b3(e,this.v0.z,this.v1.z,this.v2.z,this.v3.z);return new THREE.Vector3(t,i,e)});THREE.SplineCurve3=THREE.Curve.create(function(e){this.points=e==void 0?[]:e},function(e){var t=new THREE.Vector3,i=[],r=this.points,o,e=(r.length-1)*e;o=Math.floor(e);e=e-o;i[0]=o==0?o:o-1;i[1]=o;i[2]=o>r.length-2?r.length-1:o+1;i[3]=o>r.length-3?r.length-1:o+2;o=r[i[0]];var n=r[i[1]],a=r[i[2]],i=r[i[3]];t.x=THREE.Curve.Utils.interpolate(o.x,n.x,a.x,i.x,e);t.y=THREE.Curve.Utils.interpolate(o.y,n.y,a.y,i.y,e);t.z=THREE.Curve.Utils.interpolate(o.z,n.z,a.z,i.z,e);return t});THREE.ClosedSplineCurve3=THREE.Curve.create(function(e){this.points=e==void 0?[]:e},function(e){var t=new THREE.Vector3,i=[],r=this.points,o;o=(r.length-0)*e;e=Math.floor(o);o=o-e;e=e+(e>0?0:(Math.floor(Math.abs(e)/r.length)+1)*r.length);i[0]=(e-1)%r.length;i[1]=e%r.length;i[2]=(e+1)%r.length;i[3]=(e+2)%r.length;t.x=THREE.Curve.Utils.interpolate(r[i[0]].x,r[i[1]].x,r[i[2]].x,r[i[3]].x,o);t.y=THREE.Curve.Utils.interpolate(r[i[0]].y,r[i[1]].y,r[i[2]].y,r[i[3]].y,o);t.z=THREE.Curve.Utils.interpolate(r[i[0]].z,r[i[1]].z,r[i[2]].z,r[i[3]].z,o);return t});THREE.CurvePath=function(){this.curves=[];this.bends=[];this.autoClose=false};THREE.CurvePath.prototype=new THREE.Curve;THREE.CurvePath.prototype.constructor=THREE.CurvePath;THREE.CurvePath.prototype.add=function(e){this.curves.push(e)};THREE.CurvePath.prototype.checkConnection=function(){};THREE.CurvePath.prototype.closePath=function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new THREE.LineCurve(t,e))};THREE.CurvePath.prototype.getPoint=function(e){for(var t=e*this.getLength(),i=this.getCurveLengths(),e=0;e<i.length;){if(i[e]>=t){t=i[e]-t;e=this.curves[e];t=1-t/e.getLength();return e.getPointAt(t)}e++}return null};THREE.CurvePath.prototype.getLength=function(){var e=this.getCurveLengths();return e[e.length-1]};THREE.CurvePath.prototype.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length==this.curves.length)return this.cacheLengths;var e=[],t=0,i,r=this.curves.length;for(i=0;i<r;i++){t=t+this.curves[i].getLength();e.push(t)}return this.cacheLengths=e};THREE.CurvePath.prototype.getBoundingBox=function(){var e=this.getPoints(),t,i,r,o;t=i=Number.NEGATIVE_INFINITY;r=o=Number.POSITIVE_INFINITY;var n,a,s,l;l=new THREE.Vector2;a=0;for(s=e.length;a<s;a++){n=e[a];if(n.x>t)t=n.x;else if(n.x<r)r=n.x;if(n.y>i)i=n.y;else if(n.y<i)o=n.y;l.addSelf(n.x,n.y)}return{minX:r,minY:o,maxX:t,maxY:i,centroid:l.divideScalar(s)}};THREE.CurvePath.prototype.createPointsGeometry=function(e){return this.createGeometry(this.getPoints(e,true))};THREE.CurvePath.prototype.createSpacedPointsGeometry=function(e){return this.createGeometry(this.getSpacedPoints(e,true))};THREE.CurvePath.prototype.createGeometry=function(e){for(var t=new THREE.Geometry,i=0;i<e.length;i++)t.vertices.push(new THREE.Vector3(e[i].x,e[i].y,0));return t};THREE.CurvePath.prototype.addWrapPath=function(e){this.bends.push(e)};THREE.CurvePath.prototype.getTransformedPoints=function(e,t){var i=this.getPoints(e),r,o;if(!t)t=this.bends;r=0;for(o=t.length;r<o;r++)i=this.getWrapPoints(i,t[r]);return i};THREE.CurvePath.prototype.getTransformedSpacedPoints=function(e,t){var i=this.getSpacedPoints(e),r,o;if(!t)t=this.bends;r=0;for(o=t.length;r<o;r++)i=this.getWrapPoints(i,t[r]);return i};THREE.CurvePath.prototype.getWrapPoints=function(e,t){var i=this.getBoundingBox(),r,o,n,a,s,l;r=0;for(o=e.length;r<o;r++){n=e[r];a=n.x;s=n.y;l=a/i.maxX;l=t.getUtoTmapping(l,a);a=t.getPoint(l);s=t.getNormalVector(l).multiplyScalar(s);n.x=a.x+s.x;n.y=a.y+s.y}return e};THREE.EventTarget=function(){var e={};this.addEventListener=function(t,i){e[t]==void 0&&(e[t]=[]);e[t].indexOf(i)===-1&&e[t].push(i)};this.dispatchEvent=function(t){for(var i in e[t.type])e[t.type][i](t)};this.removeEventListener=function(t,i){var r=e[t].indexOf(i);r!==-1&&e[t].splice(r,1)}};THREE.Gyroscope=function(){THREE.Object3D.call(this)};THREE.Gyroscope.prototype=new THREE.Object3D;THREE.Gyroscope.prototype.constructor=THREE.Gyroscope;THREE.Gyroscope.prototype.updateMatrixWorld=function(e){this.matrixAutoUpdate&&this.updateMatrix();if(this.matrixWorldNeedsUpdate||e){if(this.parent){this.matrixWorld.multiply(this.parent.matrixWorld,this.matrix);this.matrixWorld.decompose(this.translationWorld,this.rotationWorld,this.scaleWorld);this.matrix.decompose(this.translationObject,this.rotationObject,this.scaleObject);this.matrixWorld.compose(this.translationWorld,this.rotationObject,this.scaleWorld)}else this.matrixWorld.copy(this.matrix);this.matrixWorldNeedsUpdate=false;e=true}for(var t=0,i=this.children.length;t<i;t++)this.children[t].updateMatrixWorld(e)};THREE.Gyroscope.prototype.translationWorld=new THREE.Vector3;THREE.Gyroscope.prototype.translationObject=new THREE.Vector3;THREE.Gyroscope.prototype.rotationWorld=new THREE.Quaternion;THREE.Gyroscope.prototype.rotationObject=new THREE.Quaternion;THREE.Gyroscope.prototype.scaleWorld=new THREE.Vector3;THREE.Gyroscope.prototype.scaleObject=new THREE.Vector3;THREE.Path=function(e){THREE.CurvePath.call(this);this.actions=[];e&&this.fromPoints(e)};THREE.Path.prototype=new THREE.CurvePath;THREE.Path.prototype.constructor=THREE.Path;THREE.PathActions={MOVE_TO:"moveTo",LINE_TO:"lineTo",QUADRATIC_CURVE_TO:"quadraticCurveTo",BEZIER_CURVE_TO:"bezierCurveTo",CSPLINE_THRU:"splineThru",ARC:"arc"};THREE.Path.prototype.fromPoints=function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,i=e.length;t<i;t++)this.lineTo(e[t].x,e[t].y)};THREE.Path.prototype.moveTo=function(e,t){var i=Array.prototype.slice.call(arguments);this.actions.push({action:THREE.PathActions.MOVE_TO,args:i})};THREE.Path.prototype.lineTo=function(e,t){var i=Array.prototype.slice.call(arguments),r=this.actions[this.actions.length-1].args;this.curves.push(new THREE.LineCurve(new THREE.Vector2(r[r.length-2],r[r.length-1]),new THREE.Vector2(e,t)));this.actions.push({action:THREE.PathActions.LINE_TO,args:i})};THREE.Path.prototype.quadraticCurveTo=function(e,t,i,r){var o=Array.prototype.slice.call(arguments),n=this.actions[this.actions.length-1].args;this.curves.push(new THREE.QuadraticBezierCurve(new THREE.Vector2(n[n.length-2],n[n.length-1]),new THREE.Vector2(e,t),new THREE.Vector2(i,r)));this.actions.push({action:THREE.PathActions.QUADRATIC_CURVE_TO,args:o})};THREE.Path.prototype.bezierCurveTo=function(e,t,i,r,o,n){var a=Array.prototype.slice.call(arguments),s=this.actions[this.actions.length-1].args;this.curves.push(new THREE.CubicBezierCurve(new THREE.Vector2(s[s.length-2],s[s.length-1]),new THREE.Vector2(e,t),new THREE.Vector2(i,r),new THREE.Vector2(o,n)));this.actions.push({action:THREE.PathActions.BEZIER_CURVE_TO,args:a})};THREE.Path.prototype.splineThru=function(e){var t=Array.prototype.slice.call(arguments),i=this.actions[this.actions.length-1].args,i=[new THREE.Vector2(i[i.length-2],i[i.length-1])];Array.prototype.push.apply(i,e);this.curves.push(new THREE.SplineCurve(i));this.actions.push({action:THREE.PathActions.CSPLINE_THRU,args:t})};THREE.Path.prototype.arc=function(e,t,i,r,o,n){var a=Array.prototype.slice.call(arguments),s=this.actions[this.actions.length-1],s=new THREE.ArcCurve(s.x+e,s.y+t,i,r,o,n);this.curves.push(s);s=s.getPoint(n?1:0);a.push(s.x);a.push(s.y);this.actions.push({action:THREE.PathActions.ARC,args:a})};THREE.Path.prototype.absarc=function(e,t,i,r,o,n){var a=Array.prototype.slice.call(arguments),s=new THREE.ArcCurve(e,t,i,r,o,n);this.curves.push(s);s=s.getPoint(n?1:0);a.push(s.x);a.push(s.y);this.actions.push({action:THREE.PathActions.ARC,args:a})};THREE.Path.prototype.getSpacedPoints=function(e){e||(e=40);for(var t=[],i=0;i<e;i++)t.push(this.getPoint(i/e));return t};THREE.Path.prototype.getPoints=function(e,t){if(this.useSpacedPoints){console.log("tata");return this.getSpacedPoints(e,t)}var e=e||12,i=[],r,o,n,a,s,l,h,c,f,u,E,p,d;r=0;for(o=this.actions.length;r<o;r++){n=this.actions[r];a=n.action;n=n.args;switch(a){case THREE.PathActions.MOVE_TO:i.push(new THREE.Vector2(n[0],n[1]));break;case THREE.PathActions.LINE_TO:i.push(new THREE.Vector2(n[0],n[1]));break;case THREE.PathActions.QUADRATIC_CURVE_TO:s=n[2];l=n[3];f=n[0];u=n[1];if(i.length>0){a=i[i.length-1];E=a.x;p=a.y}else{a=this.actions[r-1].args;E=a[a.length-2];p=a[a.length-1]}for(n=1;n<=e;n++){d=n/e;a=THREE.Shape.Utils.b2(d,E,f,s);d=THREE.Shape.Utils.b2(d,p,u,l);i.push(new THREE.Vector2(a,d))}break;case THREE.PathActions.BEZIER_CURVE_TO:s=n[4];l=n[5];f=n[0];u=n[1];h=n[2];c=n[3];if(i.length>0){a=i[i.length-1];E=a.x;p=a.y}else{a=this.actions[r-1].args;E=a[a.length-2];p=a[a.length-1]}for(n=1;n<=e;n++){d=n/e;a=THREE.Shape.Utils.b3(d,E,f,h,s);d=THREE.Shape.Utils.b3(d,p,u,c,l);i.push(new THREE.Vector2(a,d))}break;case THREE.PathActions.CSPLINE_THRU:a=this.actions[r-1].args;d=[new THREE.Vector2(a[a.length-2],a[a.length-1])];a=e*n[0].length;d=d.concat(n[0]);d=new THREE.SplineCurve(d);for(n=1;n<=a;n++)i.push(d.getPointAt(n/a));break;case THREE.PathActions.ARC:s=n[0];l=n[1];h=n[2];f=n[3];u=!!n[5];c=n[4]-f;E=e*2;for(n=1;n<=E;n++){d=n/E;u||(d=1-d);d=f+d*c;a=s+h*Math.cos(d);d=l+h*Math.sin(d);i.push(new THREE.Vector2(a,d))}}}r=i[i.length-1];Math.abs(r.x-i[0].x)<1e-10&&Math.abs(r.y-i[0].y)<1e-10&&i.splice(i.length-1,1);t&&i.push(i[0]);return i};THREE.Path.prototype.transform=function(e,t){this.getBoundingBox();return this.getWrapPoints(this.getPoints(t),e)};THREE.Path.prototype.nltransform=function(e,t,i,r,o,n){var a=this.getPoints(),s,l,h,c,f;s=0;for(l=a.length;s<l;s++){h=a[s];c=h.x;f=h.y;h.x=e*c+t*f+i;h.y=r*f+o*c+n}return a};THREE.Path.prototype.debug=function(e){var t=this.getBoundingBox();if(!e){e=document.createElement("canvas");e.setAttribute("width",t.maxX+100);e.setAttribute("height",t.maxY+100);document.body.appendChild(e)}t=e.getContext("2d");t.fillStyle="white";t.fillRect(0,0,e.width,e.height);t.strokeStyle="black";t.beginPath();var i,r,o,e=0;for(i=this.actions.length;e<i;e++){r=this.actions[e];o=r.args;r=r.action;r!=THREE.PathActions.CSPLINE_THRU&&t[r].apply(t,o)}t.stroke();t.closePath();t.strokeStyle="red";r=this.getPoints();e=0;for(i=r.length;e<i;e++){o=r[e];t.beginPath();t.arc(o.x,o.y,1.5,0,Math.PI*2,false);t.stroke();t.closePath()}};THREE.Path.prototype.toShapes=function(){var e,t,i,r,o=[],n=new THREE.Path;e=0;for(t=this.actions.length;e<t;e++){i=this.actions[e];r=i.args;i=i.action;if(i==THREE.PathActions.MOVE_TO&&n.actions.length!=0){o.push(n);n=new THREE.Path}n[i].apply(n,r)}n.actions.length!=0&&o.push(n);if(o.length==0)return[];var a;r=[];e=!THREE.Shape.Utils.isClockWise(o[0].getPoints());if(o.length==1){n=o[0];a=new THREE.Shape;a.actions=n.actions;a.curves=n.curves;r.push(a);return r}if(e){a=new THREE.Shape;e=0;for(t=o.length;e<t;e++){n=o[e];if(THREE.Shape.Utils.isClockWise(n.getPoints())){a.actions=n.actions;a.curves=n.curves;r.push(a);a=new THREE.Shape}else a.holes.push(n)}}else{e=0;for(t=o.length;e<t;e++){n=o[e];if(THREE.Shape.Utils.isClockWise(n.getPoints())){a&&r.push(a);a=new THREE.Shape;a.actions=n.actions;a.curves=n.curves}else a.holes.push(n)}r.push(a)}return r};THREE.Shape=function(){THREE.Path.apply(this,arguments);this.holes=[]};THREE.Shape.prototype=new THREE.Path;THREE.Shape.prototype.constructor=THREE.Path;THREE.Shape.prototype.extrude=function(e){return new THREE.ExtrudeGeometry(this,e)};THREE.Shape.prototype.getPointsHoles=function(e){var t,i=this.holes.length,r=[];for(t=0;t<i;t++)r[t]=this.holes[t].getTransformedPoints(e,this.bends);return r};THREE.Shape.prototype.getSpacedPointsHoles=function(e){var t,i=this.holes.length,r=[];for(t=0;t<i;t++)r[t]=this.holes[t].getTransformedSpacedPoints(e,this.bends);return r};THREE.Shape.prototype.extractAllPoints=function(e){return{shape:this.getTransformedPoints(e),holes:this.getPointsHoles(e)}};THREE.Shape.prototype.extractPoints=function(e){return this.useSpacedPoints?this.extractAllSpacedPoints(e):this.extractAllPoints(e)};THREE.Shape.prototype.extractAllSpacedPoints=function(e){return{shape:this.getTransformedSpacedPoints(e),holes:this.getSpacedPointsHoles(e)}};THREE.Shape.Utils={removeHoles:function(e,t){var i=e.concat(),r=i.concat(),o,n,a,s,l,h,c,f,u,E,p=[];for(l=0;l<t.length;l++){h=t[l];Array.prototype.push.apply(r,h);n=Number.POSITIVE_INFINITY;for(o=0;o<h.length;o++){u=h[o];E=[];for(f=0;f<i.length;f++){c=i[f];c=u.distanceToSquared(c);E.push(c);if(c<n){n=c;a=o;s=f}}}o=s-1>=0?s-1:i.length-1;n=a-1>=0?a-1:h.length-1;var d=[h[a],i[s],i[o]];f=THREE.FontUtils.Triangulate.area(d);var m=[h[a],h[n],i[s]];u=THREE.FontUtils.Triangulate.area(m);E=s;c=a;s=s+1;a=a+-1;s<0&&(s=s+i.length);s=s%i.length;a<0&&(a=a+h.length);a=a%h.length;o=s-1>=0?s-1:i.length-1;n=a-1>=0?a-1:h.length-1;d=[h[a],i[s],i[o]];d=THREE.FontUtils.Triangulate.area(d);m=[h[a],h[n],i[s]];m=THREE.FontUtils.Triangulate.area(m);if(f+u>d+m){s=E;a=c;s<0&&(s=s+i.length);s=s%i.length;a<0&&(a=a+h.length);a=a%h.length;o=s-1>=0?s-1:i.length-1;n=a-1>=0?a-1:h.length-1}f=i.slice(0,s);u=i.slice(s);E=h.slice(a);c=h.slice(0,a);n=[h[a],h[n],i[s]];p.push([h[a],i[s],i[o]]);p.push(n);i=f.concat(E).concat(c).concat(u)}return{shape:i,isolatedPts:p,allpoints:r}},triangulateShape:function(e,t){var i=THREE.Shape.Utils.removeHoles(e,t),r=i.allpoints,o=i.isolatedPts,i=THREE.FontUtils.Triangulate(i.shape,false),n,a,s,l,h={};n=0;for(a=r.length;n<a;n++){l=r[n].x+":"+r[n].y;h[l]!==void 0&&console.log("Duplicate point",l);h[l]=n}n=0;for(a=i.length;n<a;n++){s=i[n];for(r=0;r<3;r++){l=s[r].x+":"+s[r].y;l=h[l];l!==void 0&&(s[r]=l)}}n=0;for(a=o.length;n<a;n++){s=o[n];for(r=0;r<3;r++){l=s[r].x+":"+s[r].y;l=h[l];l!==void 0&&(s[r]=l)}}return i.concat(o)},isClockWise:function(e){return THREE.FontUtils.Triangulate.area(e)<0},b2p0:function(e,t){var i=1-e;return i*i*t},b2p1:function(e,t){return 2*(1-e)*e*t},b2p2:function(e,t){return e*e*t},b2:function(e,t,i,r){return this.b2p0(e,t)+this.b2p1(e,i)+this.b2p2(e,r)},b3p0:function(e,t){var i=1-e;return i*i*i*t},b3p1:function(e,t){var i=1-e;return 3*i*i*e*t},b3p2:function(e,t){return 3*(1-e)*e*e*t},b3p3:function(e,t){return e*e*e*t},b3:function(e,t,i,r,o){return this.b3p0(e,t)+this.b3p1(e,i)+this.b3p2(e,r)+this.b3p3(e,o)}};THREE.TextPath=function(e,t){THREE.Path.call(this);this.parameters=t||{};this.set(e)};THREE.TextPath.prototype.set=function(e,t){t=t||this.parameters;this.text=e;var i=t.curveSegments!==void 0?t.curveSegments:4,r=t.font!==void 0?t.font:"helvetiker",o=t.weight!==void 0?t.weight:"normal",n=t.style!==void 0?t.style:"normal";THREE.FontUtils.size=t.size!==void 0?t.size:100;THREE.FontUtils.divisions=i;THREE.FontUtils.face=r;THREE.FontUtils.weight=o;THREE.FontUtils.style=n};THREE.TextPath.prototype.toShapes=function(){for(var e=THREE.FontUtils.drawText(this.text).paths,t=[],i=0,r=e.length;i<r;i++)Array.prototype.push.apply(t,e[i].toShapes());return t};THREE.AnimationHandler=function(){var e=[],t={},i={update:function(t){for(var i=0;i<e.length;i++)e[i].update(t)},addToUpdate:function(t){e.indexOf(t)===-1&&e.push(t)},removeFromUpdate:function(t){t=e.indexOf(t);t!==-1&&e.splice(t,1)},add:function(e){t[e.name]!==void 0&&console.log("THREE.AnimationHandler.add: Warning! "+e.name+" already exists in library. Overwriting.");
t[e.name]=e;if(e.initialized!==true){for(var i=0;i<e.hierarchy.length;i++){for(var r=0;r<e.hierarchy[i].keys.length;r++){if(e.hierarchy[i].keys[r].time<0)e.hierarchy[i].keys[r].time=0;if(e.hierarchy[i].keys[r].rot!==void 0&&!(e.hierarchy[i].keys[r].rot instanceof THREE.Quaternion)){var o=e.hierarchy[i].keys[r].rot;e.hierarchy[i].keys[r].rot=new THREE.Quaternion(o[0],o[1],o[2],o[3])}}if(e.hierarchy[i].keys.length&&e.hierarchy[i].keys[0].morphTargets!==void 0){o={};for(r=0;r<e.hierarchy[i].keys.length;r++)for(var n=0;n<e.hierarchy[i].keys[r].morphTargets.length;n++){var a=e.hierarchy[i].keys[r].morphTargets[n];o[a]=-1}e.hierarchy[i].usedMorphTargets=o;for(r=0;r<e.hierarchy[i].keys.length;r++){var s={};for(a in o){for(n=0;n<e.hierarchy[i].keys[r].morphTargets.length;n++)if(e.hierarchy[i].keys[r].morphTargets[n]===a){s[a]=e.hierarchy[i].keys[r].morphTargetsInfluences[n];break}n===e.hierarchy[i].keys[r].morphTargets.length&&(s[a]=0)}e.hierarchy[i].keys[r].morphTargetsInfluences=s}}for(r=1;r<e.hierarchy[i].keys.length;r++)if(e.hierarchy[i].keys[r].time===e.hierarchy[i].keys[r-1].time){e.hierarchy[i].keys.splice(r,1);r--}for(r=0;r<e.hierarchy[i].keys.length;r++)e.hierarchy[i].keys[r].index=r}r=parseInt(e.length*e.fps,10);e.JIT={};e.JIT.hierarchy=[];for(i=0;i<e.hierarchy.length;i++)e.JIT.hierarchy.push(Array(r));e.initialized=true}},get:function(e){if(typeof e==="string"){if(t[e])return t[e];console.log("THREE.AnimationHandler.get: Couldn't find animation "+e);return null}},parse:function(e){var t=[];if(e instanceof THREE.SkinnedMesh)for(var i=0;i<e.bones.length;i++)t.push(e.bones[i]);else r(e,t);return t}},r=function(e,t){t.push(e);for(var i=0;i<e.children.length;i++)r(e.children[i],t)};i.LINEAR=0;i.CATMULLROM=1;i.CATMULLROM_FORWARD=2;return i}();THREE.Animation=function(e,t,i,r){this.root=e;this.data=THREE.AnimationHandler.get(t);this.hierarchy=THREE.AnimationHandler.parse(e);this.currentTime=0;this.timeScale=1;this.isPlaying=false;this.loop=this.isPaused=true;this.interpolationType=i!==void 0?i:THREE.AnimationHandler.LINEAR;this.JITCompile=r!==void 0?r:true;this.points=[];this.target=new THREE.Vector3};THREE.Animation.prototype.play=function(e,t){if(!this.isPlaying){this.isPlaying=true;this.loop=e!==void 0?e:true;this.currentTime=t!==void 0?t:0;var i,r=this.hierarchy.length,o;for(i=0;i<r;i++){o=this.hierarchy[i];if(this.interpolationType!==THREE.AnimationHandler.CATMULLROM_FORWARD)o.useQuaternion=true;o.matrixAutoUpdate=true;if(o.animationCache===void 0){o.animationCache={};o.animationCache.prevKey={pos:0,rot:0,scl:0};o.animationCache.nextKey={pos:0,rot:0,scl:0};o.animationCache.originalMatrix=o instanceof THREE.Bone?o.skinMatrix:o.matrix}var n=o.animationCache.prevKey;o=o.animationCache.nextKey;n.pos=this.data.hierarchy[i].keys[0];n.rot=this.data.hierarchy[i].keys[0];n.scl=this.data.hierarchy[i].keys[0];o.pos=this.getNextKeyWith("pos",i,1);o.rot=this.getNextKeyWith("rot",i,1);o.scl=this.getNextKeyWith("scl",i,1)}this.update(0)}this.isPaused=false;THREE.AnimationHandler.addToUpdate(this)};THREE.Animation.prototype.pause=function(){this.isPaused?THREE.AnimationHandler.addToUpdate(this):THREE.AnimationHandler.removeFromUpdate(this);this.isPaused=!this.isPaused};THREE.Animation.prototype.stop=function(){this.isPaused=this.isPlaying=false;THREE.AnimationHandler.removeFromUpdate(this);for(var e=0;e<this.hierarchy.length;e++)if(this.hierarchy[e].animationCache!==void 0){this.hierarchy[e]instanceof THREE.Bone?this.hierarchy[e].skinMatrix=this.hierarchy[e].animationCache.originalMatrix:this.hierarchy[e].matrix=this.hierarchy[e].animationCache.originalMatrix;delete this.hierarchy[e].animationCache}};THREE.Animation.prototype.update=function(e){if(this.isPlaying){var t=["pos","rot","scl"],i,r,o,n,a,s,l,h,c=this.data.JIT.hierarchy,f,u;u=this.currentTime=this.currentTime+e*this.timeScale;f=this.currentTime=this.currentTime%this.data.length;h=parseInt(Math.min(f*this.data.fps,this.data.length*this.data.fps),10);for(var E=0,p=this.hierarchy.length;E<p;E++){e=this.hierarchy[E];l=e.animationCache;if(this.JITCompile&&c[E][h]!==void 0)if(e instanceof THREE.Bone){e.skinMatrix=c[E][h];e.matrixAutoUpdate=false;e.matrixWorldNeedsUpdate=false}else{e.matrix=c[E][h];e.matrixAutoUpdate=false;e.matrixWorldNeedsUpdate=true}else{if(this.JITCompile)e instanceof THREE.Bone?e.skinMatrix=e.animationCache.originalMatrix:e.matrix=e.animationCache.originalMatrix;for(var d=0;d<3;d++){i=t[d];a=l.prevKey[i];s=l.nextKey[i];if(s.time<=u){if(f<u)if(this.loop){a=this.data.hierarchy[E].keys[0];for(s=this.getNextKeyWith(i,E,1);s.time<f;){a=s;s=this.getNextKeyWith(i,E,s.index+1)}}else{this.stop();return}else{do{a=s;s=this.getNextKeyWith(i,E,s.index+1)}while(s.time<f)}l.prevKey[i]=a;l.nextKey[i]=s}e.matrixAutoUpdate=true;e.matrixWorldNeedsUpdate=true;r=(f-a.time)/(s.time-a.time);o=a[i];n=s[i];if(r<0||r>1){console.log("THREE.Animation.update: Warning! Scale out of bounds:"+r+" on bone "+E);r=r<0?0:1}if(i==="pos"){i=e.position;if(this.interpolationType===THREE.AnimationHandler.LINEAR){i.x=o[0]+(n[0]-o[0])*r;i.y=o[1]+(n[1]-o[1])*r;i.z=o[2]+(n[2]-o[2])*r}else if(this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD){this.points[0]=this.getPrevKeyWith("pos",E,a.index-1).pos;this.points[1]=o;this.points[2]=n;this.points[3]=this.getNextKeyWith("pos",E,s.index+1).pos;r=r*.33+.33;o=this.interpolateCatmullRom(this.points,r);i.x=o[0];i.y=o[1];i.z=o[2];if(this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD){r=this.interpolateCatmullRom(this.points,r*1.01);this.target.set(r[0],r[1],r[2]);this.target.subSelf(i);this.target.y=0;this.target.normalize();r=Math.atan2(this.target.x,this.target.z);e.rotation.set(0,r,0)}}}else if(i==="rot")THREE.Quaternion.slerp(o,n,e.quaternion,r);else if(i==="scl"){i=e.scale;i.x=o[0]+(n[0]-o[0])*r;i.y=o[1]+(n[1]-o[1])*r;i.z=o[2]+(n[2]-o[2])*r}}}}if(this.JITCompile&&c[0][h]===void 0){this.hierarchy[0].updateMatrixWorld(true);for(E=0;E<this.hierarchy.length;E++)c[E][h]=this.hierarchy[E]instanceof THREE.Bone?this.hierarchy[E].skinMatrix.clone():this.hierarchy[E].matrix.clone()}}};THREE.Animation.prototype.interpolateCatmullRom=function(e,t){var i=[],r=[],o,n,a,s,l,h;o=(e.length-1)*t;n=Math.floor(o);o=o-n;i[0]=n===0?n:n-1;i[1]=n;i[2]=n>e.length-2?n:n+1;i[3]=n>e.length-3?n:n+2;n=e[i[0]];s=e[i[1]];l=e[i[2]];h=e[i[3]];i=o*o;a=o*i;r[0]=this.interpolate(n[0],s[0],l[0],h[0],o,i,a);r[1]=this.interpolate(n[1],s[1],l[1],h[1],o,i,a);r[2]=this.interpolate(n[2],s[2],l[2],h[2],o,i,a);return r};THREE.Animation.prototype.interpolate=function(e,t,i,r,o,n,a){e=(i-e)*.5;r=(r-t)*.5;return(2*(t-i)+e+r)*a+(-3*(t-i)-2*e-r)*n+e*o+t};THREE.Animation.prototype.getNextKeyWith=function(e,t,i){for(var r=this.data.hierarchy[t].keys,i=this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD?i<r.length-1?i:r.length-1:i%r.length;i<r.length;i++)if(r[i][e]!==void 0)return r[i];return this.data.hierarchy[t].keys[0]};THREE.Animation.prototype.getPrevKeyWith=function(e,t,i){for(var r=this.data.hierarchy[t].keys,i=this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD?i>0?i:0:i>=0?i:i+r.length;i>=0;i--)if(r[i][e]!==void 0)return r[i];return this.data.hierarchy[t].keys[r.length-1]};THREE.KeyFrameAnimation=function(e,t,i){this.root=e;this.data=THREE.AnimationHandler.get(t);this.hierarchy=THREE.AnimationHandler.parse(e);this.currentTime=0;this.timeScale=.001;this.isPlaying=false;this.loop=this.isPaused=true;this.JITCompile=i!==void 0?i:true;e=0;for(t=this.hierarchy.length;e<t;e++){var i=this.data.hierarchy[e].sids,r=this.hierarchy[e];if(this.data.hierarchy[e].keys.length&&i){for(var o=0;o<i.length;o++){var n=i[o],a=this.getNextKeyWith(n,e,0);a&&a.apply(n)}r.matrixAutoUpdate=false;this.data.hierarchy[e].node.updateMatrix();r.matrixWorldNeedsUpdate=true}}};THREE.KeyFrameAnimation.prototype.play=function(e,t){if(!this.isPlaying){this.isPlaying=true;this.loop=e!==void 0?e:true;this.currentTime=t!==void 0?t:0;this.startTimeMs=t;this.startTime=1e7;this.endTime=-this.startTime;var i,r=this.hierarchy.length,o,n;for(i=0;i<r;i++){o=this.hierarchy[i];n=this.data.hierarchy[i];o.useQuaternion=true;if(n.animationCache===void 0){n.animationCache={};n.animationCache.prevKey=null;n.animationCache.nextKey=null;n.animationCache.originalMatrix=o instanceof THREE.Bone?o.skinMatrix:o.matrix}o=this.data.hierarchy[i].keys;if(o.length){n.animationCache.prevKey=o[0];n.animationCache.nextKey=o[1];this.startTime=Math.min(o[0].time,this.startTime);this.endTime=Math.max(o[o.length-1].time,this.endTime)}}this.update(0)}this.isPaused=false;THREE.AnimationHandler.addToUpdate(this)};THREE.KeyFrameAnimation.prototype.pause=function(){this.isPaused?THREE.AnimationHandler.addToUpdate(this):THREE.AnimationHandler.removeFromUpdate(this);this.isPaused=!this.isPaused};THREE.KeyFrameAnimation.prototype.stop=function(){this.isPaused=this.isPlaying=false;THREE.AnimationHandler.removeFromUpdate(this);for(var e=0;e<this.data.hierarchy.length;e++){var t=this.hierarchy[e],i=this.data.hierarchy[e];if(i.animationCache!==void 0){var r=i.animationCache.originalMatrix;if(t instanceof THREE.Bone){r.copy(t.skinMatrix);t.skinMatrix=r}else{r.copy(t.matrix);t.matrix=r}delete i.animationCache}}};THREE.KeyFrameAnimation.prototype.update=function(e){if(this.isPlaying){var t,i,r,o,n=this.data.JIT.hierarchy,a,s,l;s=this.currentTime=this.currentTime+e*this.timeScale;a=this.currentTime=this.currentTime%this.data.length;if(a<this.startTimeMs)a=this.currentTime=this.startTimeMs+a;o=parseInt(Math.min(a*this.data.fps,this.data.length*this.data.fps),10);if((l=a<s)&&!this.loop){for(var e=0,h=this.hierarchy.length;e<h;e++){var c=this.data.hierarchy[e].keys,n=this.data.hierarchy[e].sids;r=c.length-1;o=this.hierarchy[e];if(c.length){for(c=0;c<n.length;c++){a=n[c];(s=this.getPrevKeyWith(a,e,r))&&s.apply(a)}this.data.hierarchy[e].node.updateMatrix();o.matrixWorldNeedsUpdate=true}}this.stop()}else if(!(a<this.startTime)){e=0;for(h=this.hierarchy.length;e<h;e++){r=this.hierarchy[e];t=this.data.hierarchy[e];var c=t.keys,f=t.animationCache;if(this.JITCompile&&n[e][o]!==void 0)if(r instanceof THREE.Bone){r.skinMatrix=n[e][o];r.matrixWorldNeedsUpdate=false}else{r.matrix=n[e][o];r.matrixWorldNeedsUpdate=true}else if(c.length){if(this.JITCompile&&f)r instanceof THREE.Bone?r.skinMatrix=f.originalMatrix:r.matrix=f.originalMatrix;t=f.prevKey;i=f.nextKey;if(t&&i){if(i.time<=s){if(l&&this.loop){t=c[0];for(i=c[1];i.time<a;){t=i;i=c[t.index+1]}}else if(!l)for(var u=c.length-1;i.time<a&&i.index!==u;){t=i;i=c[t.index+1]}f.prevKey=t;f.nextKey=i}i.time>=a?t.interpolate(i,a):t.interpolate(i,i.time)}this.data.hierarchy[e].node.updateMatrix();r.matrixWorldNeedsUpdate=true}}if(this.JITCompile&&n[0][o]===void 0){this.hierarchy[0].updateMatrixWorld(true);for(e=0;e<this.hierarchy.length;e++)n[e][o]=this.hierarchy[e]instanceof THREE.Bone?this.hierarchy[e].skinMatrix.clone():this.hierarchy[e].matrix.clone()}}}};THREE.KeyFrameAnimation.prototype.getNextKeyWith=function(e,t,i){t=this.data.hierarchy[t].keys;for(i=i%t.length;i<t.length;i++)if(t[i].hasTarget(e))return t[i];return t[0]};THREE.KeyFrameAnimation.prototype.getPrevKeyWith=function(e,t,i){t=this.data.hierarchy[t].keys;for(i=i>=0?i:i+t.length;i>=0;i--)if(t[i].hasTarget(e))return t[i];return t[t.length-1]};THREE.CubeCamera=function(e,t,i){THREE.Object3D.call(this);var r=new THREE.PerspectiveCamera(90,1,e,t);r.up.set(0,-1,0);r.lookAt(new THREE.Vector3(1,0,0));this.add(r);var o=new THREE.PerspectiveCamera(90,1,e,t);o.up.set(0,-1,0);o.lookAt(new THREE.Vector3(-1,0,0));this.add(o);var n=new THREE.PerspectiveCamera(90,1,e,t);n.up.set(0,0,1);n.lookAt(new THREE.Vector3(0,1,0));this.add(n);var a=new THREE.PerspectiveCamera(90,1,e,t);a.up.set(0,0,-1);a.lookAt(new THREE.Vector3(0,-1,0));this.add(a);var s=new THREE.PerspectiveCamera(90,1,e,t);s.up.set(0,-1,0);s.lookAt(new THREE.Vector3(0,0,1));this.add(s);var l=new THREE.PerspectiveCamera(90,1,e,t);l.up.set(0,-1,0);l.lookAt(new THREE.Vector3(0,0,-1));this.add(l);this.renderTarget=new THREE.WebGLRenderTargetCube(i,i,{format:THREE.RGBFormat,magFilter:THREE.LinearFilter,minFilter:THREE.LinearFilter});this.updateCubeMap=function(e,t){var i=this.renderTarget,h=i.generateMipmaps;i.generateMipmaps=false;i.activeCubeFace=0;e.render(t,r,i);i.activeCubeFace=1;e.render(t,o,i);i.activeCubeFace=2;e.render(t,n,i);i.activeCubeFace=3;e.render(t,a,i);i.activeCubeFace=4;e.render(t,s,i);i.generateMipmaps=h;i.activeCubeFace=5;e.render(t,l,i)}};THREE.CubeCamera.prototype=new THREE.Object3D;THREE.CubeCamera.prototype.constructor=THREE.CubeCamera;THREE.CombinedCamera=function(e,t,i,r,o,n,a){THREE.Camera.call(this);this.fov=i;this.left=-e/2;this.right=e/2;this.top=t/2;this.bottom=-t/2;this.cameraO=new THREE.OrthographicCamera(e/-2,e/2,t/2,t/-2,n,a);this.cameraP=new THREE.PerspectiveCamera(i,e/t,r,o);this.zoom=1;this.toPerspective()};THREE.CombinedCamera.prototype=new THREE.Camera;THREE.CombinedCamera.prototype.constructor=THREE.CombinedCamera;THREE.CombinedCamera.prototype.toPerspective=function(){this.near=this.cameraP.near;this.far=this.cameraP.far;this.cameraP.fov=this.fov/this.zoom;this.cameraP.updateProjectionMatrix();this.projectionMatrix=this.cameraP.projectionMatrix;this.inPersepectiveMode=true;this.inOrthographicMode=false};THREE.CombinedCamera.prototype.toOrthographic=function(){var e=this.cameraP.aspect,t=(this.cameraP.near+this.cameraP.far)/2,t=Math.tan(this.fov/2)*t,e=2*t*e/2,t=t/this.zoom,e=e/this.zoom;this.cameraO.left=-e;this.cameraO.right=e;this.cameraO.top=t;this.cameraO.bottom=-t;this.cameraO.updateProjectionMatrix();this.near=this.cameraO.near;this.far=this.cameraO.far;this.projectionMatrix=this.cameraO.projectionMatrix;this.inPersepectiveMode=false;this.inOrthographicMode=true};THREE.CombinedCamera.prototype.setSize=function(e,t){this.cameraP.aspect=e/t;this.left=-e/2;this.right=e/2;this.top=t/2;this.bottom=-t/2};THREE.CombinedCamera.prototype.setFov=function(e){this.fov=e;this.inPersepectiveMode?this.toPerspective():this.toOrthographic()};THREE.CombinedCamera.prototype.updateProjectionMatrix=function(){if(this.inPersepectiveMode)this.toPerspective();else{this.toPerspective();this.toOrthographic()}};THREE.CombinedCamera.prototype.setLens=function(e,t){var i=2*Math.atan((t!==void 0?t:24)/(e*2))*(180/Math.PI);this.setFov(i);return i};THREE.CombinedCamera.prototype.setZoom=function(e){this.zoom=e;this.inPersepectiveMode?this.toPerspective():this.toOrthographic()};THREE.CombinedCamera.prototype.toFrontView=function(){this.rotation.x=0;this.rotation.y=0;this.rotation.z=0;this.rotationAutoUpdate=false};THREE.CombinedCamera.prototype.toBackView=function(){this.rotation.x=0;this.rotation.y=Math.PI;this.rotation.z=0;this.rotationAutoUpdate=false};THREE.CombinedCamera.prototype.toLeftView=function(){this.rotation.x=0;this.rotation.y=-Math.PI/2;this.rotation.z=0;this.rotationAutoUpdate=false};THREE.CombinedCamera.prototype.toRightView=function(){this.rotation.x=0;this.rotation.y=Math.PI/2;this.rotation.z=0;this.rotationAutoUpdate=false};THREE.CombinedCamera.prototype.toTopView=function(){this.rotation.x=-Math.PI/2;this.rotation.y=0;this.rotation.z=0;this.rotationAutoUpdate=false};THREE.CombinedCamera.prototype.toBottomView=function(){this.rotation.x=Math.PI/2;this.rotation.y=0;this.rotation.z=0;this.rotationAutoUpdate=false};THREE.FirstPersonControls=function(e,t){function i(e,t){return function(){t.apply(e,arguments)}}this.object=e;this.target=new THREE.Vector3(0,0,0);this.domElement=t!==void 0?t:document;this.movementSpeed=1;this.lookSpeed=.005;this.noFly=false;this.lookVertical=true;this.autoForward=false;this.activeLook=true;this.heightSpeed=false;this.heightCoef=1;this.heightMin=0;this.constrainVertical=false;this.verticalMin=0;this.verticalMax=Math.PI;this.theta=this.phi=this.lon=this.lat=this.mouseY=this.mouseX=this.autoSpeedFactor=0;this.mouseDragOn=this.freeze=this.moveRight=this.moveLeft=this.moveBackward=this.moveForward=false;if(this.domElement===document){this.viewHalfX=window.innerWidth/2;this.viewHalfY=window.innerHeight/2}else{this.viewHalfX=this.domElement.offsetWidth/2;this.viewHalfY=this.domElement.offsetHeight/2;this.domElement.setAttribute("tabindex",-1)}this.onMouseDown=function(e){this.domElement!==document&&this.domElement.focus();e.preventDefault();e.stopPropagation();if(this.activeLook)switch(e.button){case 0:this.moveForward=true;break;case 2:this.moveBackward=true}this.mouseDragOn=true};this.onMouseUp=function(e){e.preventDefault();e.stopPropagation();if(this.activeLook)switch(e.button){case 0:this.moveForward=false;break;case 2:this.moveBackward=false}this.mouseDragOn=false};this.onMouseMove=function(e){if(this.domElement===document){this.mouseX=e.pageX-this.viewHalfX;this.mouseY=e.pageY-this.viewHalfY}else{this.mouseX=e.pageX-this.domElement.offsetLeft-this.viewHalfX;this.mouseY=e.pageY-this.domElement.offsetTop-this.viewHalfY}};this.onKeyDown=function(e){switch(e.keyCode){case 38:case 87:this.moveForward=true;break;case 37:case 65:this.moveLeft=true;break;case 40:case 83:this.moveBackward=true;break;case 39:case 68:this.moveRight=true;break;case 82:this.moveUp=true;break;case 70:this.moveDown=true;break;case 81:this.freeze=!this.freeze}};this.onKeyUp=function(e){switch(e.keyCode){case 38:case 87:this.moveForward=false;break;case 37:case 65:this.moveLeft=false;break;case 40:case 83:this.moveBackward=false;break;case 39:case 68:this.moveRight=false;break;case 82:this.moveUp=false;break;case 70:this.moveDown=false}};this.update=function(e){var t=0;if(!this.freeze){if(this.heightSpeed){t=THREE.Math.clamp(this.object.position.y,this.heightMin,this.heightMax)-this.heightMin;this.autoSpeedFactor=e*t*this.heightCoef}else this.autoSpeedFactor=0;t=e*this.movementSpeed;(this.moveForward||this.autoForward&&!this.moveBackward)&&this.object.translateZ(-(t+this.autoSpeedFactor));this.moveBackward&&this.object.translateZ(t);this.moveLeft&&this.object.translateX(-t);this.moveRight&&this.object.translateX(t);this.moveUp&&this.object.translateY(t);this.moveDown&&this.object.translateY(-t);e=e*this.lookSpeed;this.activeLook||(e=0);this.lon=this.lon+this.mouseX*e;if(this.lookVertical)this.lat=this.lat-this.mouseY*e;this.lat=Math.max(-85,Math.min(85,this.lat));this.phi=(90-this.lat)*Math.PI/180;this.theta=this.lon*Math.PI/180;var t=this.target,i=this.object.position;t.x=i.x+100*Math.sin(this.phi)*Math.cos(this.theta);t.y=i.y+100*Math.cos(this.phi);t.z=i.z+100*Math.sin(this.phi)*Math.sin(this.theta);t=1;this.constrainVertical&&(t=Math.PI/(this.verticalMax-this.verticalMin));this.lon=this.lon+this.mouseX*e;if(this.lookVertical)this.lat=this.lat-this.mouseY*e*t;this.lat=Math.max(-85,Math.min(85,this.lat));this.phi=(90-this.lat)*Math.PI/180;this.theta=this.lon*Math.PI/180;if(this.constrainVertical)this.phi=THREE.Math.mapLinear(this.phi,0,Math.PI,this.verticalMin,this.verticalMax);t=this.target;i=this.object.position;t.x=i.x+100*Math.sin(this.phi)*Math.cos(this.theta);t.y=i.y+100*Math.cos(this.phi);t.z=i.z+100*Math.sin(this.phi)*Math.sin(this.theta);this.object.lookAt(t)}};this.domElement.addEventListener("contextmenu",function(e){e.preventDefault()},false);this.domElement.addEventListener("mousemove",i(this,this.onMouseMove),false);this.domElement.addEventListener("mousedown",i(this,this.onMouseDown),false);this.domElement.addEventListener("mouseup",i(this,this.onMouseUp),false);this.domElement.addEventListener("keydown",i(this,this.onKeyDown),false);this.domElement.addEventListener("keyup",i(this,this.onKeyUp),false)};THREE.PathControls=function(e,t){function i(e){return(e=e*2)<1?.5*e*e:-.5*(--e*(e-2)-1)}function r(e,t){return function(){t.apply(e,arguments)}}function o(e,t,i,r){var o={name:i,fps:.6,length:r,hierarchy:[]},n,a=t.getControlPointsArray(),s=t.getLength(),l=a.length,h=0;n=l-1;t={parent:-1,keys:[]};t.keys[0]={time:0,pos:a[0],rot:[0,0,0,1],scl:[1,1,1]};t.keys[n]={time:r,pos:a[n],rot:[0,0,0,1],scl:[1,1,1]};for(n=1;n<l-1;n++){h=r*s.chunks[n]/s.total;t.keys[n]={time:h,pos:a[n]}}o.hierarchy[0]=t;THREE.AnimationHandler.add(o);return new THREE.Animation(e,i,THREE.AnimationHandler.CATMULLROM_FORWARD,false)}function n(e,t){var i,r,o=new THREE.Geometry;for(i=0;i<e.points.length*t;i++){r=i/(e.points.length*t);r=e.getPoint(r);o.vertices[i]=new THREE.Vector3(r.x,r.y,r.z)}return o}this.object=e;this.domElement=t!==void 0?t:document;this.id="PathControls"+THREE.PathControlsIdCounter++;this.duration=1e4;this.waypoints=[];this.useConstantSpeed=true;this.resamplingCoef=50;this.debugPath=new THREE.Object3D;this.debugDummy=new THREE.Object3D;this.animationParent=new THREE.Object3D;this.lookSpeed=.005;this.lookHorizontal=this.lookVertical=true;this.verticalAngleMap={srcRange:[0,2*Math.PI],dstRange:[0,2*Math.PI]};this.horizontalAngleMap={srcRange:[0,2*Math.PI],dstRange:[0,2*Math.PI]};this.target=new THREE.Object3D;this.theta=this.phi=this.lon=this.lat=this.mouseY=this.mouseX=0;if(this.domElement===document){this.viewHalfX=window.innerWidth/2;this.viewHalfY=window.innerHeight/2}else{this.viewHalfX=this.domElement.offsetWidth/2;this.viewHalfY=this.domElement.offsetHeight/2;this.domElement.setAttribute("tabindex",-1)}var a=Math.PI*2,s=Math.PI/180;this.update=function(e){var t;if(this.lookHorizontal)this.lon=this.lon+this.mouseX*this.lookSpeed*e;if(this.lookVertical)this.lat=this.lat-this.mouseY*this.lookSpeed*e;this.lon=Math.max(0,Math.min(360,this.lon));this.lat=Math.max(-85,Math.min(85,this.lat));this.phi=(90-this.lat)*s;this.theta=this.lon*s;e=this.phi%a;this.phi=e>=0?e:e+a;t=this.verticalAngleMap.srcRange;e=this.verticalAngleMap.dstRange;t=THREE.Math.mapLinear(this.phi,t[0],t[1],e[0],e[1]);var r=e[1]-e[0];this.phi=i((t-e[0])/r)*r+e[0];t=this.horizontalAngleMap.srcRange;e=this.horizontalAngleMap.dstRange;t=THREE.Math.mapLinear(this.theta,t[0],t[1],e[0],e[1]);r=e[1]-e[0];this.theta=i((t-e[0])/r)*r+e[0];e=this.target.position;e.x=100*Math.sin(this.phi)*Math.cos(this.theta);e.y=100*Math.cos(this.phi);e.z=100*Math.sin(this.phi)*Math.sin(this.theta);this.object.lookAt(this.target.position)};this.onMouseMove=function(e){if(this.domElement===document){this.mouseX=e.pageX-this.viewHalfX;this.mouseY=e.pageY-this.viewHalfY}else{this.mouseX=e.pageX-this.domElement.offsetLeft-this.viewHalfX;this.mouseY=e.pageY-this.domElement.offsetTop-this.viewHalfY}};this.init=function(){this.spline=new THREE.Spline;this.spline.initFromArray(this.waypoints);this.useConstantSpeed&&this.spline.reparametrizeByArcLength(this.resamplingCoef);if(this.createDebugDummy){var e=new THREE.MeshLambertMaterial({color:30719}),t=new THREE.MeshLambertMaterial({color:65280}),i=new THREE.CubeGeometry(10,10,20),a=new THREE.CubeGeometry(2,2,10);this.animationParent=new THREE.Mesh(i,e);e=new THREE.Mesh(a,t);e.position.set(0,10,0);this.animation=o(this.animationParent,this.spline,this.id,this.duration);this.animationParent.add(this.object);this.animationParent.add(this.target);this.animationParent.add(e)}else{this.animation=o(this.animationParent,this.spline,this.id,this.duration);this.animationParent.add(this.target);this.animationParent.add(this.object)}if(this.createDebugPath){var e=this.debugPath,t=this.spline,a=n(t,10),i=n(t,10),s=new THREE.LineBasicMaterial({color:16711680,linewidth:3}),a=new THREE.Line(a,s),i=new THREE.ParticleSystem(i,new THREE.ParticleBasicMaterial({color:16755200,size:3}));a.scale.set(1,1,1);e.add(a);i.scale.set(1,1,1);e.add(i);for(var a=new THREE.SphereGeometry(1,16,8),s=new THREE.MeshBasicMaterial({color:65280}),l=0;l<t.points.length;l++){i=new THREE.Mesh(a,s);i.position.copy(t.points[l]);e.add(i)}}this.domElement.addEventListener("mousemove",r(this,this.onMouseMove),false)}};THREE.PathControlsIdCounter=0;THREE.FlyControls=function(e,t){function i(e,t){return function(){t.apply(e,arguments)}}this.object=e;this.domElement=t!==void 0?t:document;t&&this.domElement.setAttribute("tabindex",-1);this.movementSpeed=1;this.rollSpeed=.005;this.autoForward=this.dragToLook=false;this.object.useQuaternion=true;this.tmpQuaternion=new THREE.Quaternion;this.mouseStatus=0;this.moveState={up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0};this.moveVector=new THREE.Vector3(0,0,0);this.rotationVector=new THREE.Vector3(0,0,0);this.handleEvent=function(e){if(typeof this[e.type]=="function")this[e.type](e)};this.keydown=function(e){if(!e.altKey){switch(e.keyCode){case 16:this.movementSpeedMultiplier=.1;break;case 87:this.moveState.forward=1;break;case 83:this.moveState.back=1;break;case 65:this.moveState.left=1;break;case 68:this.moveState.right=1;break;case 82:this.moveState.up=1;break;case 70:this.moveState.down=1;break;case 38:this.moveState.pitchUp=1;break;case 40:this.moveState.pitchDown=1;break;case 37:this.moveState.yawLeft=1;break;case 39:this.moveState.yawRight=1;break;case 81:this.moveState.rollLeft=1;break;case 69:this.moveState.rollRight=1}this.updateMovementVector();this.updateRotationVector()}};this.keyup=function(e){switch(e.keyCode){case 16:this.movementSpeedMultiplier=1;break;case 87:this.moveState.forward=0;break;case 83:this.moveState.back=0;break;case 65:this.moveState.left=0;break;case 68:this.moveState.right=0;break;case 82:this.moveState.up=0;break;case 70:this.moveState.down=0;break;case 38:this.moveState.pitchUp=0;break;case 40:this.moveState.pitchDown=0;break;case 37:this.moveState.yawLeft=0;break;case 39:this.moveState.yawRight=0;break;case 81:this.moveState.rollLeft=0;break;case 69:this.moveState.rollRight=0}this.updateMovementVector();this.updateRotationVector()};this.mousedown=function(e){this.domElement!==document&&this.domElement.focus();e.preventDefault();e.stopPropagation();if(this.dragToLook)this.mouseStatus++;else switch(e.button){case 0:this.object.moveForward=true;break;case 2:this.object.moveBackward=true}};this.mousemove=function(e){if(!this.dragToLook||this.mouseStatus>0){var t=this.getContainerDimensions(),i=t.size[0]/2,r=t.size[1]/2;this.moveState.yawLeft=-(e.pageX-t.offset[0]-i)/i;this.moveState.pitchDown=(e.pageY-t.offset[1]-r)/r;this.updateRotationVector()}};this.mouseup=function(e){e.preventDefault();e.stopPropagation();if(this.dragToLook){this.mouseStatus--;this.moveState.yawLeft=this.moveState.pitchDown=0}else switch(e.button){case 0:this.moveForward=false;break;case 2:this.moveBackward=false}this.updateRotationVector()};this.update=function(e){var t=e*this.movementSpeed,e=e*this.rollSpeed;this.object.translateX(this.moveVector.x*t);this.object.translateY(this.moveVector.y*t);this.object.translateZ(this.moveVector.z*t);this.tmpQuaternion.set(this.rotationVector.x*e,this.rotationVector.y*e,this.rotationVector.z*e,1).normalize();this.object.quaternion.multiplySelf(this.tmpQuaternion);this.object.matrix.setPosition(this.object.position);this.object.matrix.setRotationFromQuaternion(this.object.quaternion);this.object.matrixWorldNeedsUpdate=true};this.updateMovementVector=function(){var e=this.moveState.forward||this.autoForward&&!this.moveState.back?1:0;this.moveVector.x=-this.moveState.left+this.moveState.right;this.moveVector.y=-this.moveState.down+this.moveState.up;this.moveVector.z=-e+this.moveState.back};this.updateRotationVector=function(){this.rotationVector.x=-this.moveState.pitchDown+this.moveState.pitchUp;this.rotationVector.y=-this.moveState.yawRight+this.moveState.yawLeft;this.rotationVector.z=-this.moveState.rollRight+this.moveState.rollLeft};this.getContainerDimensions=function(){return this.domElement!=document?{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,this.domElement.offsetTop]}:{size:[window.innerWidth,window.innerHeight],offset:[0,0]}};this.domElement.addEventListener("mousemove",i(this,this.mousemove),false);this.domElement.addEventListener("mousedown",i(this,this.mousedown),false);this.domElement.addEventListener("mouseup",i(this,this.mouseup),false);this.domElement.addEventListener("keydown",i(this,this.keydown),false);this.domElement.addEventListener("keyup",i(this,this.keyup),false);this.updateMovementVector();this.updateRotationVector()};THREE.RollControls=function(e,t){this.object=e;this.domElement=t!==void 0?t:document;this.mouseLook=true;this.autoForward=false;this.rollSpeed=this.movementSpeed=this.lookSpeed=1;this.constrainVertical=[-.9,.9];this.object.matrixAutoUpdate=false;this.forward=new THREE.Vector3(0,0,1);this.roll=0;var i=new THREE.Vector3,r=new THREE.Vector3,o=new THREE.Vector3,n=new THREE.Matrix4,a=false,s=1,l=0,h=0,c=0,f=0,u=0,E=window.innerWidth/2,p=window.innerHeight/2;this.update=function(e){if(this.mouseLook){var t=e*this.lookSpeed;this.rotateHorizontally(t*f);this.rotateVertically(t*u)}t=e*this.movementSpeed;this.object.translateZ(-t*(l>0||this.autoForward&&!(l<0)?1:l));this.object.translateX(t*h);this.object.translateY(t*c);if(a)this.roll=this.roll+this.rollSpeed*e*s;if(this.forward.y>this.constrainVertical[1]){this.forward.y=this.constrainVertical[1];this.forward.normalize()}else if(this.forward.y<this.constrainVertical[0]){this.forward.y=this.constrainVertical[0];this.forward.normalize()}o.copy(this.forward);r.set(0,1,0);i.cross(r,o).normalize();r.cross(o,i).normalize();this.object.matrix.elements[0]=i.x;this.object.matrix.elements[4]=r.x;this.object.matrix.elements[8]=o.x;this.object.matrix.elements[1]=i.y;this.object.matrix.elements[5]=r.y;this.object.matrix.elements[9]=o.y;this.object.matrix.elements[2]=i.z;this.object.matrix.elements[6]=r.z;this.object.matrix.elements[10]=o.z;n.identity();n.elements[0]=Math.cos(this.roll);n.elements[4]=-Math.sin(this.roll);n.elements[1]=Math.sin(this.roll);n.elements[5]=Math.cos(this.roll);this.object.matrix.multiplySelf(n);this.object.matrixWorldNeedsUpdate=true;this.object.matrix.elements[12]=this.object.position.x;this.object.matrix.elements[13]=this.object.position.y;this.object.matrix.elements[14]=this.object.position.z};this.translateX=function(e){this.object.position.x=this.object.position.x+this.object.matrix.elements[0]*e;this.object.position.y=this.object.position.y+this.object.matrix.elements[1]*e;this.object.position.z=this.object.position.z+this.object.matrix.elements[2]*e};this.translateY=function(e){this.object.position.x=this.object.position.x+this.object.matrix.elements[4]*e;this.object.position.y=this.object.position.y+this.object.matrix.elements[5]*e;this.object.position.z=this.object.position.z+this.object.matrix.elements[6]*e};this.translateZ=function(e){this.object.position.x=this.object.position.x-this.object.matrix.elements[8]*e;this.object.position.y=this.object.position.y-this.object.matrix.elements[9]*e;this.object.position.z=this.object.position.z-this.object.matrix.elements[10]*e};this.rotateHorizontally=function(e){i.set(this.object.matrix.elements[0],this.object.matrix.elements[1],this.object.matrix.elements[2]);i.multiplyScalar(e);this.forward.subSelf(i);this.forward.normalize()};this.rotateVertically=function(e){r.set(this.object.matrix.elements[4],this.object.matrix.elements[5],this.object.matrix.elements[6]);r.multiplyScalar(e);this.forward.addSelf(r);this.forward.normalize()};this.domElement.addEventListener("contextmenu",function(e){e.preventDefault()},false);this.domElement.addEventListener("mousemove",function(e){f=(e.clientX-E)/window.innerWidth;u=(e.clientY-p)/window.innerHeight},false);this.domElement.addEventListener("mousedown",function(e){e.preventDefault();e.stopPropagation();switch(e.button){case 0:l=1;break;case 2:l=-1}},false);this.domElement.addEventListener("mouseup",function(e){e.preventDefault();e.stopPropagation();switch(e.button){case 0:l=0;break;case 2:l=0}},false);this.domElement.addEventListener("keydown",function(e){switch(e.keyCode){case 38:case 87:l=1;break;case 37:case 65:h=-1;break;case 40:case 83:l=-1;break;case 39:case 68:h=1;break;case 81:a=true;s=1;break;case 69:a=true;s=-1;break;case 82:c=1;break;case 70:c=-1}},false);this.domElement.addEventListener("keyup",function(e){switch(e.keyCode){case 38:case 87:l=0;
break;case 37:case 65:h=0;break;case 40:case 83:l=0;break;case 39:case 68:h=0;break;case 81:a=false;break;case 69:a=false;break;case 82:c=0;break;case 70:c=0}},false)};THREE.TrackballControls=function(e,t){THREE.EventTarget.call(this);var i=this;this.object=e;this.domElement=t!==void 0?t:document;this.enabled=true;this.screen={width:window.innerWidth,height:window.innerHeight,offsetLeft:0,offsetTop:0};this.radius=(this.screen.width+this.screen.height)/4;this.rotateSpeed=1;this.zoomSpeed=1.2;this.panSpeed=.3;this.staticMoving=this.noPan=this.noZoom=this.noRotate=false;this.dynamicDampingFactor=.2;this.minDistance=0;this.maxDistance=Infinity;this.keys=[65,83,68];this.target=new THREE.Vector3;var r=new THREE.Vector3,o=false,n=-1,a=new THREE.Vector3,s=new THREE.Vector3,l=new THREE.Vector3,h=new THREE.Vector2,c=new THREE.Vector2,f=new THREE.Vector2,u=new THREE.Vector2,E={type:"change"};this.handleEvent=function(e){if(typeof this[e.type]=="function")this[e.type](e)};this.getMouseOnScreen=function(e,t){return new THREE.Vector2((e-i.screen.offsetLeft)/i.radius*.5,(t-i.screen.offsetTop)/i.radius*.5)};this.getMouseProjectionOnBall=function(e,t){var r=new THREE.Vector3((e-i.screen.width*.5-i.screen.offsetLeft)/i.radius,(i.screen.height*.5+i.screen.offsetTop-t)/i.radius,0),o=r.length();o>1?r.normalize():r.z=Math.sqrt(1-o*o);a.copy(i.object.position).subSelf(i.target);o=i.object.up.clone().setLength(r.y);o.addSelf(i.object.up.clone().crossSelf(a).setLength(r.x));o.addSelf(a.setLength(r.z));return o};this.rotateCamera=function(){var e=Math.acos(s.dot(l)/s.length()/l.length());if(e){var t=(new THREE.Vector3).cross(s,l).normalize(),r=new THREE.Quaternion,e=e*i.rotateSpeed;r.setFromAxisAngle(t,-e);r.multiplyVector3(a);r.multiplyVector3(i.object.up);r.multiplyVector3(l);if(i.staticMoving)s=l;else{r.setFromAxisAngle(t,e*(i.dynamicDampingFactor-1));r.multiplyVector3(s)}}};this.zoomCamera=function(){var e=1+(c.y-h.y)*i.zoomSpeed;if(e!==1&&e>0){a.multiplyScalar(e);i.staticMoving?h=c:h.y=h.y+(c.y-h.y)*this.dynamicDampingFactor}};this.panCamera=function(){var e=u.clone().subSelf(f);if(e.lengthSq()){e.multiplyScalar(a.length()*i.panSpeed);var t=a.clone().crossSelf(i.object.up).setLength(e.x);t.addSelf(i.object.up.clone().setLength(e.y));i.object.position.addSelf(t);i.target.addSelf(t);i.staticMoving?f=u:f.addSelf(e.sub(u,f).multiplyScalar(i.dynamicDampingFactor))}};this.checkDistances=function(){if(!i.noZoom||!i.noPan){i.object.position.lengthSq()>i.maxDistance*i.maxDistance&&i.object.position.setLength(i.maxDistance);a.lengthSq()<i.minDistance*i.minDistance&&i.object.position.add(i.target,a.setLength(i.minDistance))}};this.update=function(){a.copy(i.object.position).subSelf(i.target);i.noRotate||i.rotateCamera();i.noZoom||i.zoomCamera();i.noPan||i.panCamera();i.object.position.add(i.target,a);i.checkDistances();i.object.lookAt(i.target);if(r.distanceTo(i.object.position)>0){i.dispatchEvent(E);r.copy(i.object.position)}};this.domElement.addEventListener("contextmenu",function(e){e.preventDefault()},false);this.domElement.addEventListener("mousemove",function(e){if(i.enabled){if(o){s=l=i.getMouseProjectionOnBall(e.clientX,e.clientY);h=c=i.getMouseOnScreen(e.clientX,e.clientY);f=u=i.getMouseOnScreen(e.clientX,e.clientY);o=false}n!==-1&&(n===0&&!i.noRotate?l=i.getMouseProjectionOnBall(e.clientX,e.clientY):n===1&&!i.noZoom?c=i.getMouseOnScreen(e.clientX,e.clientY):n===2&&!i.noPan&&(u=i.getMouseOnScreen(e.clientX,e.clientY)))}},false);this.domElement.addEventListener("mousedown",function(e){if(i.enabled){e.preventDefault();e.stopPropagation();if(n===-1){n=e.button;n===0&&!i.noRotate?s=l=i.getMouseProjectionOnBall(e.clientX,e.clientY):n===1&&!i.noZoom?h=c=i.getMouseOnScreen(e.clientX,e.clientY):this.noPan||(f=u=i.getMouseOnScreen(e.clientX,e.clientY))}}},false);this.domElement.addEventListener("mouseup",function(e){if(i.enabled){e.preventDefault();e.stopPropagation();n=-1}},false);window.addEventListener("keydown",function(e){if(i.enabled&&n===-1){e.keyCode===i.keys[0]&&!i.noRotate?n=0:e.keyCode===i.keys[1]&&!i.noZoom?n=1:e.keyCode===i.keys[2]&&!i.noPan&&(n=2);n!==-1&&(o=true)}},false);window.addEventListener("keyup",function(){i.enabled&&n!==-1&&(n=-1)},false)};THREE.CubeGeometry=function(e,t,i,r,o,n,a,s){function l(e,t,i,a,s,l,c,f){var u,E=r||1,p=o||1,d=s/2,m=l/2,g=h.vertices.length;if(e==="x"&&t==="y"||e==="y"&&t==="x")u="z";else if(e==="x"&&t==="z"||e==="z"&&t==="x"){u="y";p=n||1}else if(e==="z"&&t==="y"||e==="y"&&t==="z"){u="x";E=n||1}var v=E+1,T=p+1,R=s/E,y=l/p,x=new THREE.Vector3;x[u]=c>0?1:-1;for(s=0;s<T;s++)for(l=0;l<v;l++){var H=new THREE.Vector3;H[e]=(l*R-d)*i;H[t]=(s*y-m)*a;H[u]=c;h.vertices.push(H)}for(s=0;s<p;s++)for(l=0;l<E;l++){e=new THREE.Face4(l+v*s+g,l+v*(s+1)+g,l+1+v*(s+1)+g,l+1+v*s+g);e.normal.copy(x);e.vertexNormals.push(x.clone(),x.clone(),x.clone(),x.clone());e.materialIndex=f;h.faces.push(e);h.faceVertexUvs[0].push([new THREE.UV(l/E,s/p),new THREE.UV(l/E,(s+1)/p),new THREE.UV((l+1)/E,(s+1)/p),new THREE.UV((l+1)/E,s/p)])}}THREE.Geometry.call(this);var h=this,c=e/2,f=t/2,u=i/2,E,p,d,m,g,v;if(a!==void 0){if(a instanceof Array)this.materials=a;else{this.materials=[];for(E=0;E<6;E++)this.materials.push(a)}E=0;m=1;p=2;g=3;d=4;v=5}else this.materials=[];this.sides={px:true,nx:true,py:true,ny:true,pz:true,nz:true};if(s!=void 0)for(var T in s)this.sides[T]!==void 0&&(this.sides[T]=s[T]);this.sides.px&&l("z","y",-1,-1,i,t,c,E);this.sides.nx&&l("z","y",1,-1,i,t,-c,m);this.sides.py&&l("x","z",1,1,e,i,f,p);this.sides.ny&&l("x","z",1,-1,e,i,-f,g);this.sides.pz&&l("x","y",1,-1,e,t,u,d);this.sides.nz&&l("x","y",-1,-1,e,t,-u,v);this.computeCentroids();this.mergeVertices()};THREE.CubeGeometry.prototype=new THREE.Geometry;THREE.CubeGeometry.prototype.constructor=THREE.CubeGeometry;THREE.CylinderGeometry=function(e,t,i,r,o,n){THREE.Geometry.call(this);var e=e!==void 0?e:20,t=t!==void 0?t:20,i=i!==void 0?i:100,a=i/2,r=r||8,o=o||1,s,l,h=[],c=[];for(l=0;l<=o;l++){var f=[],u=[],E=l/o,p=E*(t-e)+e;for(s=0;s<=r;s++){var d=s/r,m=new THREE.Vector3;m.x=p*Math.sin(d*Math.PI*2);m.y=-E*i+a;m.z=p*Math.cos(d*Math.PI*2);this.vertices.push(m);f.push(this.vertices.length-1);u.push(new THREE.UV(d,E))}h.push(f);c.push(u)}i=(t-e)/i;for(s=0;s<r;s++){if(e!==0){f=this.vertices[h[0][s]].clone();u=this.vertices[h[0][s+1]].clone()}else{f=this.vertices[h[1][s]].clone();u=this.vertices[h[1][s+1]].clone()}f.setY(Math.sqrt(f.x*f.x+f.z*f.z)*i).normalize();u.setY(Math.sqrt(u.x*u.x+u.z*u.z)*i).normalize();for(l=0;l<o;l++){var E=h[l][s],p=h[l+1][s],d=h[l+1][s+1],m=h[l][s+1],g=f.clone(),v=f.clone(),T=u.clone(),R=u.clone(),y=c[l][s].clone(),x=c[l+1][s].clone(),H=c[l+1][s+1].clone(),b=c[l][s+1].clone();this.faces.push(new THREE.Face4(E,p,d,m,[g,v,T,R]));this.faceVertexUvs[0].push([y,x,H,b])}}if(!n&&e>0){this.vertices.push(new THREE.Vector3(0,a,0));for(s=0;s<r;s++){E=h[0][s];p=h[0][s+1];d=this.vertices.length-1;g=new THREE.Vector3(0,1,0);v=new THREE.Vector3(0,1,0);T=new THREE.Vector3(0,1,0);y=c[0][s].clone();x=c[0][s+1].clone();H=new THREE.UV(x.u,0);this.faces.push(new THREE.Face3(E,p,d,[g,v,T]));this.faceVertexUvs[0].push([y,x,H])}}if(!n&&t>0){this.vertices.push(new THREE.Vector3(0,-a,0));for(s=0;s<r;s++){E=h[l][s+1];p=h[l][s];d=this.vertices.length-1;g=new THREE.Vector3(0,-1,0);v=new THREE.Vector3(0,-1,0);T=new THREE.Vector3(0,-1,0);y=c[l][s+1].clone();x=c[l][s].clone();H=new THREE.UV(x.u,1);this.faces.push(new THREE.Face3(E,p,d,[g,v,T]));this.faceVertexUvs[0].push([y,x,H])}}this.computeCentroids();this.computeFaceNormals()};THREE.CylinderGeometry.prototype=new THREE.Geometry;THREE.CylinderGeometry.prototype.constructor=THREE.CylinderGeometry;THREE.ExtrudeGeometry=function(e,t){if(typeof e!=="undefined"){THREE.Geometry.call(this);e=e instanceof Array?e:[e];this.shapebb=e[e.length-1].getBoundingBox();this.addShapeList(e,t);this.computeCentroids();this.computeFaceNormals()}};THREE.ExtrudeGeometry.prototype=new THREE.Geometry;THREE.ExtrudeGeometry.prototype.constructor=THREE.ExtrudeGeometry;THREE.ExtrudeGeometry.prototype.addShapeList=function(e,t){for(var i=e.length,r=0;r<i;r++)this.addShape(e[r],t)};THREE.ExtrudeGeometry.prototype.addShape=function(e,t){function i(e,t,i){t||console.log("die");return t.clone().multiplyScalar(i).addSelf(e)}function r(e,t,i){var r=THREE.ExtrudeGeometry.__v1,o=THREE.ExtrudeGeometry.__v2,n=THREE.ExtrudeGeometry.__v3,a=THREE.ExtrudeGeometry.__v4,s=THREE.ExtrudeGeometry.__v5,l=THREE.ExtrudeGeometry.__v6;r.set(e.x-t.x,e.y-t.y);o.set(e.x-i.x,e.y-i.y);r=r.normalize();o=o.normalize();n.set(-r.y,r.x);a.set(o.y,-o.x);s.copy(e).addSelf(n);l.copy(e).addSelf(a);if(s.equals(l))return a.clone();s.copy(t).addSelf(n);l.copy(i).addSelf(a);n=r.dot(a);a=l.subSelf(s).dot(a);if(n===0){console.log("Either infinite or no solutions!");a===0?console.log("Its finite solutions."):console.log("Too bad, no solutions.")}a=a/n;if(a<0){t=Math.atan2(t.y-e.y,t.x-e.x);e=Math.atan2(i.y-e.y,i.x-e.x);t>e&&(e=e+Math.PI*2);i=(t+e)/2;e=-Math.cos(i);i=-Math.sin(i);return new THREE.Vector2(e,i)}return r.multiplyScalar(a).addSelf(s).subSelf(e).clone()}function o(i,r){var o,n;for(N=i.length;--N>=0;){o=N;n=N-1;n<0&&(n=i.length-1);for(var a=0,s=u+c*2,a=0;a<s;a++){var l=V*a,h=V*(a+1),f=r+o+l,l=r+n+l,E=r+n+h,h=r+o+h,p=i,d=a,m=s,f=f+S,l=l+S,E=E+S,h=h+S;_.faces.push(new THREE.Face4(f,l,E,h,null,null,v));f=W.generateSideWallUV(_,e,p,t,f,l,E,h,d,m);_.faceVertexUvs[0].push(f)}}}function n(e,t,i){_.vertices.push(new THREE.Vector3(e,t,i))}function a(i,r,o,n){i=i+S;r=r+S;o=o+S;_.faces.push(new THREE.Face3(i,r,o,null,null,g));i=n?W.generateBottomUV(_,e,t,i,r,o):W.generateTopUV(_,e,t,i,r,o);_.faceVertexUvs[0].push(i)}var s=t.amount!==void 0?t.amount:100,l=t.bevelThickness!==void 0?t.bevelThickness:6,h=t.bevelSize!==void 0?t.bevelSize:l-2,c=t.bevelSegments!==void 0?t.bevelSegments:3,f=t.bevelEnabled!==void 0?t.bevelEnabled:true,u=t.steps!==void 0?t.steps:1,E=t.bendPath,p=t.extrudePath,d,m=false,g=t.material,v=t.extrudeMaterial,T,R,y,x;if(p){d=p.getSpacedPoints(u);m=true;f=false;T=new THREE.TubeGeometry.FrenetFrames(p,u,false);R=new THREE.Vector3;y=new THREE.Vector3;x=new THREE.Vector3}if(!f)h=l=c=0;var H,b,w,_=this,S=this.vertices.length;E&&e.addWrapPath(E);var p=e.extractPoints(),E=p.shape,M=p.holes;if(p=!THREE.Shape.Utils.isClockWise(E)){E=E.reverse();b=0;for(w=M.length;b<w;b++){H=M[b];THREE.Shape.Utils.isClockWise(H)&&(M[b]=H.reverse())}p=false}var A=THREE.Shape.Utils.triangulateShape(E,M),C=E;b=0;for(w=M.length;b<w;b++){H=M[b];E=E.concat(H)}var L,P,F,U,D,V=E.length,B,z=A.length,p=[],N=0;F=C.length;L=F-1;for(P=N+1;N<F;N++,L++,P++){L===F&&(L=0);P===F&&(P=0);p[N]=r(C[N],C[L],C[P])}var k=[],O,I=p.concat();b=0;for(w=M.length;b<w;b++){H=M[b];O=[];N=0;F=H.length;L=F-1;for(P=N+1;N<F;N++,L++,P++){L===F&&(L=0);P===F&&(P=0);O[N]=r(H[N],H[L],H[P])}k.push(O);I=I.concat(O)}for(L=0;L<c;L++){F=L/c;U=l*(1-F);P=h*Math.sin(F*Math.PI/2);N=0;for(F=C.length;N<F;N++){D=i(C[N],p[N],P);n(D.x,D.y,-U)}b=0;for(w=M.length;b<w;b++){H=M[b];O=k[b];N=0;for(F=H.length;N<F;N++){D=i(H[N],O[N],P);n(D.x,D.y,-U)}}}P=h;for(N=0;N<V;N++){D=f?i(E[N],I[N],P):E[N];if(m){y.copy(T.normals[0]).multiplyScalar(D.x);R.copy(T.binormals[0]).multiplyScalar(D.y);x.copy(d[0]).addSelf(y).addSelf(R);n(x.x,x.y,x.z)}else n(D.x,D.y,0)}for(F=1;F<=u;F++)for(N=0;N<V;N++){D=f?i(E[N],I[N],P):E[N];if(m){y.copy(T.normals[F]).multiplyScalar(D.x);R.copy(T.binormals[F]).multiplyScalar(D.y);x.copy(d[F]).addSelf(y).addSelf(R);n(x.x,x.y,x.z)}else n(D.x,D.y,s/u*F)}for(L=c-1;L>=0;L--){F=L/c;U=l*(1-F);P=h*Math.sin(F*Math.PI/2);N=0;for(F=C.length;N<F;N++){D=i(C[N],p[N],P);n(D.x,D.y,s+U)}b=0;for(w=M.length;b<w;b++){H=M[b];O=k[b];N=0;for(F=H.length;N<F;N++){D=i(H[N],O[N],P);m?n(D.x,D.y+d[u-1].y,d[u-1].x+U):n(D.x,D.y,s+U)}}}var W=THREE.ExtrudeGeometry.WorldUVGenerator;(function(){if(f){var e;e=V*0;for(N=0;N<z;N++){B=A[N];a(B[2]+e,B[1]+e,B[0]+e,true)}e=u+c*2;e=V*e;for(N=0;N<z;N++){B=A[N];a(B[0]+e,B[1]+e,B[2]+e,false)}}else{for(N=0;N<z;N++){B=A[N];a(B[2],B[1],B[0],true)}for(N=0;N<z;N++){B=A[N];a(B[0]+V*u,B[1]+V*u,B[2]+V*u,false)}}})();(function(){var e=0;o(C,e);e=e+C.length;b=0;for(w=M.length;b<w;b++){H=M[b];o(H,e);e=e+H.length}})()};THREE.ExtrudeGeometry.WorldUVGenerator={generateTopUV:function(e,t,i,r,o,n){t=e.vertices[o].x;o=e.vertices[o].y;i=e.vertices[n].x;n=e.vertices[n].y;return[new THREE.UV(e.vertices[r].x,1-e.vertices[r].y),new THREE.UV(t,1-o),new THREE.UV(i,1-n)]},generateBottomUV:function(e,t,i,r,o,n){return this.generateTopUV(e,t,i,r,o,n)},generateSideWallUV:function(e,t,i,r,o,n,a,s){var t=e.vertices[o].x,i=e.vertices[o].y,o=e.vertices[o].z,r=e.vertices[n].x,l=e.vertices[n].y,n=e.vertices[n].z,h=e.vertices[a].x,c=e.vertices[a].y,a=e.vertices[a].z,f=e.vertices[s].x,u=e.vertices[s].y,e=e.vertices[s].z;return Math.abs(i-l)<.01?[new THREE.UV(t,o),new THREE.UV(r,n),new THREE.UV(h,a),new THREE.UV(f,e)]:[new THREE.UV(i,o),new THREE.UV(l,n),new THREE.UV(c,a),new THREE.UV(u,e)]}};THREE.ExtrudeGeometry.__v1=new THREE.Vector2;THREE.ExtrudeGeometry.__v2=new THREE.Vector2;THREE.ExtrudeGeometry.__v3=new THREE.Vector2;THREE.ExtrudeGeometry.__v4=new THREE.Vector2;THREE.ExtrudeGeometry.__v5=new THREE.Vector2;THREE.ExtrudeGeometry.__v6=new THREE.Vector2;THREE.LatheGeometry=function(e,t,i){THREE.Geometry.call(this);for(var t=t||12,i=i||2*Math.PI,r=[],o=(new THREE.Matrix4).makeRotationZ(i/t),n=0;n<e.length;n++){r[n]=e[n].clone();this.vertices.push(r[n])}for(var a=t+1,i=0;i<a;i++)for(n=0;n<r.length;n++){r[n]=o.multiplyVector3(r[n].clone());this.vertices.push(r[n])}for(i=0;i<t;i++){r=0;for(o=e.length;r<o-1;r++){this.faces.push(new THREE.Face4(i*o+r,(i+1)%a*o+r,(i+1)%a*o+(r+1)%o,i*o+(r+1)%o));this.faceVertexUvs[0].push([new THREE.UV(1-i/t,r/o),new THREE.UV(1-(i+1)/t,r/o),new THREE.UV(1-(i+1)/t,(r+1)/o),new THREE.UV(1-i/t,(r+1)/o)])}}this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals()};THREE.LatheGeometry.prototype=new THREE.Geometry;THREE.LatheGeometry.prototype.constructor=THREE.LatheGeometry;THREE.PlaneGeometry=function(e,t,i,r){THREE.Geometry.call(this);for(var o=e/2,n=t/2,i=i||1,r=r||1,a=i+1,s=r+1,l=e/i,h=t/r,c=new THREE.Vector3(0,1,0),e=0;e<s;e++)for(t=0;t<a;t++)this.vertices.push(new THREE.Vector3(t*l-o,0,e*h-n));for(e=0;e<r;e++)for(t=0;t<i;t++){o=new THREE.Face4(t+a*e,t+a*(e+1),t+1+a*(e+1),t+1+a*e);o.normal.copy(c);o.vertexNormals.push(c.clone(),c.clone(),c.clone(),c.clone());this.faces.push(o);this.faceVertexUvs[0].push([new THREE.UV(t/i,e/r),new THREE.UV(t/i,(e+1)/r),new THREE.UV((t+1)/i,(e+1)/r),new THREE.UV((t+1)/i,e/r)])}this.computeCentroids()};THREE.PlaneGeometry.prototype=new THREE.Geometry;THREE.PlaneGeometry.prototype.constructor=THREE.PlaneGeometry;THREE.SphereGeometry=function(e,t,i,r,o,n,a){THREE.Geometry.call(this);var e=e||50,r=r!==void 0?r:0,o=o!==void 0?o:Math.PI*2,n=n!==void 0?n:0,a=a!==void 0?a:Math.PI,t=Math.max(3,Math.floor(t)||8),i=Math.max(2,Math.floor(i)||6),s,l,h=[],c=[];for(l=0;l<=i;l++){var f=[],u=[];for(s=0;s<=t;s++){var E=s/t,p=l/i,d=new THREE.Vector3;d.x=-e*Math.cos(r+E*o)*Math.sin(n+p*a);d.y=e*Math.cos(n+p*a);d.z=e*Math.sin(r+E*o)*Math.sin(n+p*a);this.vertices.push(d);f.push(this.vertices.length-1);u.push(new THREE.UV(E,p))}h.push(f);c.push(u)}for(l=0;l<i;l++)for(s=0;s<t;s++){var r=h[l][s+1],o=h[l][s],n=h[l+1][s],a=h[l+1][s+1],f=this.vertices[r].clone().normalize(),u=this.vertices[o].clone().normalize(),E=this.vertices[n].clone().normalize(),p=this.vertices[a].clone().normalize(),d=c[l][s+1].clone(),m=c[l][s].clone(),g=c[l+1][s].clone(),v=c[l+1][s+1].clone();if(Math.abs(this.vertices[r].y)==e){this.faces.push(new THREE.Face3(r,n,a,[f,E,p]));this.faceVertexUvs[0].push([d,g,v])}else if(Math.abs(this.vertices[n].y)==e){this.faces.push(new THREE.Face3(r,o,n,[f,u,E]));this.faceVertexUvs[0].push([d,m,g])}else{this.faces.push(new THREE.Face4(r,o,n,a,[f,u,E,p]));this.faceVertexUvs[0].push([d,m,g,v])}}this.computeCentroids();this.computeFaceNormals();this.boundingSphere={radius:e}};THREE.SphereGeometry.prototype=new THREE.Geometry;THREE.SphereGeometry.prototype.constructor=THREE.SphereGeometry;THREE.TextGeometry=function(e,t){var i=new THREE.TextPath(e,t).toShapes();t.amount=t.height!==void 0?t.height:50;if(t.bevelThickness===void 0)t.bevelThickness=10;if(t.bevelSize===void 0)t.bevelSize=8;if(t.bevelEnabled===void 0)t.bevelEnabled=false;if(t.bend){var r=i[i.length-1].getBoundingBox().maxX;t.bendPath=new THREE.QuadraticBezierCurve(new THREE.Vector2(0,0),new THREE.Vector2(r/2,120),new THREE.Vector2(r,0))}THREE.ExtrudeGeometry.call(this,i,t)};THREE.TextGeometry.prototype=new THREE.ExtrudeGeometry;THREE.TextGeometry.prototype.constructor=THREE.TextGeometry;THREE.FontUtils={faces:{},face:"helvetiker",weight:"normal",style:"normal",size:150,divisions:10,getFace:function(){return this.faces[this.face][this.weight][this.style]},loadFace:function(e){var t=e.familyName.toLowerCase();this.faces[t]=this.faces[t]||{};this.faces[t][e.cssFontWeight]=this.faces[t][e.cssFontWeight]||{};this.faces[t][e.cssFontWeight][e.cssFontStyle]=e;return this.faces[t][e.cssFontWeight][e.cssFontStyle]=e},drawText:function(e){for(var t=this.getFace(),i=this.size/t.resolution,r=0,o=(""+e).split(""),n=o.length,a=[],e=0;e<n;e++){var s=new THREE.Path,s=this.extractGlyphPoints(o[e],t,i,r,s),r=r+s.offset;a.push(s.path)}return{paths:a,offset:r/2}},extractGlyphPoints:function(e,t,i,r,o){var n=[],a,s,l,h,c,f,u,E,p,d,m,g=t.glyphs[e]||t.glyphs["?"];if(g){if(g.o){t=g._cachedOutline||(g._cachedOutline=g.o.split(" "));h=t.length;for(e=0;e<h;){l=t[e++];switch(l){case"m":l=t[e++]*i+r;c=t[e++]*i;n.push(new THREE.Vector2(l,c));o.moveTo(l,c);break;case"l":l=t[e++]*i+r;c=t[e++]*i;n.push(new THREE.Vector2(l,c));o.lineTo(l,c);break;case"q":l=t[e++]*i+r;c=t[e++]*i;E=t[e++]*i+r;p=t[e++]*i;o.quadraticCurveTo(E,p,l,c);if(a=n[n.length-1]){f=a.x;u=a.y;a=1;for(s=this.divisions;a<=s;a++){var v=a/s,T=THREE.Shape.Utils.b2(v,f,E,l),v=THREE.Shape.Utils.b2(v,u,p,c);n.push(new THREE.Vector2(T,v))}}break;case"b":l=t[e++]*i+r;c=t[e++]*i;E=t[e++]*i+r;p=t[e++]*-i;d=t[e++]*i+r;m=t[e++]*-i;o.bezierCurveTo(l,c,E,p,d,m);if(a=n[n.length-1]){f=a.x;u=a.y;a=1;for(s=this.divisions;a<=s;a++){v=a/s;T=THREE.Shape.Utils.b3(v,f,E,d,l);v=THREE.Shape.Utils.b3(v,u,p,m,c);n.push(new THREE.Vector2(T,v))}}}}}return{offset:g.ha*i,points:n,path:o}}}};(function(e){var t=function(e){for(var t=e.length,i=0,r=t-1,o=0;o<t;r=o++)i=i+(e[r].x*e[o].y-e[o].x*e[r].y);return i*.5};e.Triangulate=function(e,i){var r=e.length;if(r<3)return null;var o=[],n=[],a=[],s,l,h;if(t(e)>0)for(l=0;l<r;l++)n[l]=l;else for(l=0;l<r;l++)n[l]=r-1-l;var c=2*r;for(l=r-1;r>2;){if(c--<=0){console.log("Warning, unable to triangulate polygon!");break}s=l;r<=s&&(s=0);l=s+1;r<=l&&(l=0);h=l+1;r<=h&&(h=0);var f;e:{f=e;var u=s,E=l,p=h,d=r,m=n,g=void 0,v=void 0,T=void 0,R=void 0,y=void 0,x=void 0,H=void 0,b=void 0,w=void 0,v=f[m[u]].x,T=f[m[u]].y,R=f[m[E]].x,y=f[m[E]].y,x=f[m[p]].x,H=f[m[p]].y;if(1e-10>(R-v)*(H-T)-(y-T)*(x-v))f=false;else{for(g=0;g<d;g++)if(!(g==u||g==E||g==p)){var b=f[m[g]].x,w=f[m[g]].y,_=void 0,S=void 0,M=void 0,A=void 0,C=void 0,L=void 0,P=void 0,F=void 0,U=void 0,D=void 0,V=void 0,B=void 0,_=M=C=void 0,_=x-R,S=H-y,M=v-x,A=T-H,C=R-v,L=y-T,P=b-v,F=w-T,U=b-R,D=w-y,V=b-x,B=w-H,_=_*D-S*U,C=C*F-L*P,M=M*B-A*V;if(_>=0&&M>=0&&C>=0){f=false;break e}}f=true}}if(f){o.push([e[n[s]],e[n[l]],e[n[h]]]);a.push([n[s],n[l],n[h]]);s=l;for(h=l+1;h<r;s++,h++)n[s]=n[h];r--;c=2*r}}return i?a:o};e.Triangulate.area=t;return e})(THREE.FontUtils);self._typeface_js={faces:THREE.FontUtils.faces,loadFace:THREE.FontUtils.loadFace};THREE.TorusGeometry=function(e,t,i,r,o){THREE.Geometry.call(this);this.radius=e||100;this.tube=t||40;this.segmentsR=i||8;this.segmentsT=r||6;this.arc=o||Math.PI*2;o=new THREE.Vector3;e=[];t=[];for(i=0;i<=this.segmentsR;i++)for(r=0;r<=this.segmentsT;r++){var n=r/this.segmentsT*this.arc,a=i/this.segmentsR*Math.PI*2;o.x=this.radius*Math.cos(n);o.y=this.radius*Math.sin(n);var s=new THREE.Vector3;s.x=(this.radius+this.tube*Math.cos(a))*Math.cos(n);s.y=(this.radius+this.tube*Math.cos(a))*Math.sin(n);s.z=this.tube*Math.sin(a);this.vertices.push(s);e.push(new THREE.UV(r/this.segmentsT,1-i/this.segmentsR));t.push(s.clone().subSelf(o).normalize())}for(i=1;i<=this.segmentsR;i++)for(r=1;r<=this.segmentsT;r++){var o=(this.segmentsT+1)*i+r-1,n=(this.segmentsT+1)*(i-1)+r-1,a=(this.segmentsT+1)*(i-1)+r,s=(this.segmentsT+1)*i+r,l=new THREE.Face4(o,n,a,s,[t[o],t[n],t[a],t[s]]);l.normal.addSelf(t[o]);l.normal.addSelf(t[n]);l.normal.addSelf(t[a]);l.normal.addSelf(t[s]);l.normal.normalize();this.faces.push(l);this.faceVertexUvs[0].push([e[o].clone(),e[n].clone(),e[a].clone(),e[s].clone()])}this.computeCentroids()};THREE.TorusGeometry.prototype=new THREE.Geometry;THREE.TorusGeometry.prototype.constructor=THREE.TorusGeometry;THREE.TorusKnotGeometry=function(e,t,i,r,o,n,a){function s(e,t,i,r,o,n){var a=Math.cos(e);Math.cos(t);t=Math.sin(e);e=i/r*e;i=Math.cos(e);a=o*(2+i)*.5*a;t=o*(2+i)*t*.5;o=n*o*Math.sin(e)*.5;return new THREE.Vector3(a,t,o)}THREE.Geometry.call(this);this.radius=e||200;this.tube=t||40;this.segmentsR=i||64;this.segmentsT=r||8;this.p=o||2;this.q=n||3;this.heightScale=a||1;this.grid=Array(this.segmentsR);i=new THREE.Vector3;r=new THREE.Vector3;o=new THREE.Vector3;for(e=0;e<this.segmentsR;++e){this.grid[e]=Array(this.segmentsT);for(t=0;t<this.segmentsT;++t){var l=e/this.segmentsR*2*this.p*Math.PI,a=t/this.segmentsT*2*Math.PI,n=s(l,a,this.q,this.p,this.radius,this.heightScale),l=s(l+.01,a,this.q,this.p,this.radius,this.heightScale);i.sub(l,n);r.add(l,n);o.cross(i,r);r.cross(o,i);o.normalize();r.normalize();l=-this.tube*Math.cos(a);a=this.tube*Math.sin(a);n.x=n.x+(l*r.x+a*o.x);n.y=n.y+(l*r.y+a*o.y);n.z=n.z+(l*r.z+a*o.z);this.grid[e][t]=this.vertices.push(new THREE.Vector3(n.x,n.y,n.z))-1}}for(e=0;e<this.segmentsR;++e)for(t=0;t<this.segmentsT;++t){var o=(e+1)%this.segmentsR,n=(t+1)%this.segmentsT,i=this.grid[e][t],r=this.grid[o][t],o=this.grid[o][n],n=this.grid[e][n],a=new THREE.UV(e/this.segmentsR,t/this.segmentsT),l=new THREE.UV((e+1)/this.segmentsR,t/this.segmentsT),h=new THREE.UV((e+1)/this.segmentsR,(t+1)/this.segmentsT),c=new THREE.UV(e/this.segmentsR,(t+1)/this.segmentsT);this.faces.push(new THREE.Face4(i,r,o,n));this.faceVertexUvs[0].push([a,l,h,c])}this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals()};THREE.TorusKnotGeometry.prototype=new THREE.Geometry;THREE.TorusKnotGeometry.prototype.constructor=THREE.TorusKnotGeometry;THREE.TubeGeometry=function(e,t,i,r,o,n){THREE.Geometry.call(this);this.path=e;this.segments=t||64;this.radius=i||1;this.segmentsRadius=r||8;this.closed=o||false;if(n)this.debug=new THREE.Object3D;this.grid=[];var a,s,n=this.segments+1,l,h,c,f=new THREE.Vector3,u,E,p,t=new THREE.TubeGeometry.FrenetFrames(e,t,o);u=t.tangents;E=t.normals;p=t.binormals;this.tangents=u;this.normals=E;this.binormals=p;for(t=0;t<n;t++){this.grid[t]=[];r=t/(n-1);c=e.getPointAt(r);r=u[t];a=E[t];s=p[t];if(this.debug){this.debug.add(new THREE.ArrowHelper(r,c,i,255));this.debug.add(new THREE.ArrowHelper(a,c,i,16711680));this.debug.add(new THREE.ArrowHelper(s,c,i,65280))}for(r=0;r<this.segmentsRadius;r++){l=r/this.segmentsRadius*2*Math.PI;h=-this.radius*Math.cos(l);l=this.radius*Math.sin(l);f.copy(c);f.x=f.x+(h*a.x+l*s.x);f.y=f.y+(h*a.y+l*s.y);f.z=f.z+(h*a.z+l*s.z);this.grid[t][r]=this.vertices.push(new THREE.Vector3(f.x,f.y,f.z))-1}}for(t=0;t<this.segments;t++)for(r=0;r<this.segmentsRadius;r++){n=o?(t+1)%this.segments:t+1;f=(r+1)%this.segmentsRadius;e=this.grid[t][r];i=this.grid[n][r];n=this.grid[n][f];f=this.grid[t][f];u=new THREE.UV(t/this.segments,r/this.segmentsRadius);E=new THREE.UV((t+1)/this.segments,r/this.segmentsRadius);p=new THREE.UV((t+1)/this.segments,(r+1)/this.segmentsRadius);a=new THREE.UV(t/this.segments,(r+1)/this.segmentsRadius);this.faces.push(new THREE.Face4(e,i,n,f));this.faceVertexUvs[0].push([u,E,p,a])}this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals()};THREE.TubeGeometry.prototype=new THREE.Geometry;THREE.TubeGeometry.prototype.constructor=THREE.TubeGeometry;THREE.TubeGeometry.FrenetFrames=function(e,t,i){new THREE.Vector3;var r=new THREE.Vector3;new THREE.Vector3;var o=[],n=[],a=[],s=new THREE.Vector3,l=new THREE.Matrix4,t=t+1,h,c,f;this.tangents=o;this.normals=n;this.binormals=a;for(h=0;h<t;h++){c=h/(t-1);o[h]=e.getTangentAt(c);o[h].normalize()}n[0]=new THREE.Vector3;a[0]=new THREE.Vector3;e=Number.MAX_VALUE;h=Math.abs(o[0].x);c=Math.abs(o[0].y);f=Math.abs(o[0].z);if(h<=e){e=h;r.set(1,0,0)}if(c<=e){e=c;r.set(0,1,0)}f<=e&&r.set(0,0,1);s.cross(o[0],r).normalize();n[0].cross(o[0],s);a[0].cross(o[0],n[0]);for(h=1;h<t;h++){n[h]=n[h-1].clone();a[h]=a[h-1].clone();s.cross(o[h-1],o[h]);if(s.length()>1e-4){s.normalize();r=Math.acos(o[h-1].dot(o[h]));l.makeRotationAxis(s,r).multiplyVector3(n[h])}a[h].cross(o[h],n[h])}if(i){r=Math.acos(n[0].dot(n[t-1]));r=r/(t-1);o[0].dot(s.cross(n[0],n[t-1]))>0&&(r=-r);for(h=1;h<t;h++){l.makeRotationAxis(o[h],r*h).multiplyVector3(n[h]);a[h].cross(o[h],n[h])}}};THREE.PolyhedronGeometry=function(e,t,i,r){function o(e){var t=e.normalize().clone();t.index=l.vertices.push(t)-1;var i=Math.atan2(e.z,-e.x)/2/Math.PI+.5,e=Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))/Math.PI+.5;t.uv=new THREE.UV(i,e);return t}function n(e,t,i,r){if(r<1){r=new THREE.Face3(e.index,t.index,i.index,[e.clone(),t.clone(),i.clone()]);r.centroid.addSelf(e).addSelf(t).addSelf(i).divideScalar(3);r.normal=r.centroid.clone().normalize();l.faces.push(r);r=Math.atan2(r.centroid.z,-r.centroid.x);l.faceVertexUvs[0].push([s(e.uv,e,r),s(t.uv,t,r),s(i.uv,i,r)])}else{r=r-1;n(e,a(e,t),a(e,i),r);n(a(e,t),t,a(t,i),r);n(a(e,i),a(t,i),i,r);n(a(e,t),a(t,i),a(e,i),r)}}function a(e,t){f[e.index]||(f[e.index]=[]);f[t.index]||(f[t.index]=[]);var i=f[e.index][t.index];i===void 0&&(f[e.index][t.index]=f[t.index][e.index]=i=o((new THREE.Vector3).add(e,t).divideScalar(2)));return i}function s(e,t,i){i<0&&e.u===1&&(e=new THREE.UV(e.u-1,e.v));t.x===0&&t.z===0&&(e=new THREE.UV(i/2/Math.PI+.5,e.v));return e}THREE.Geometry.call(this);for(var i=i||1,r=r||0,l=this,h=0,c=e.length;h<c;h++)o(new THREE.Vector3(e[h][0],e[h][1],e[h][2]));for(var f=[],e=this.vertices,h=0,c=t.length;h<c;h++)n(e[t[h][0]],e[t[h][1]],e[t[h][2]],r);this.mergeVertices();h=0;for(c=this.vertices.length;h<c;h++)this.vertices[h].multiplyScalar(i);this.computeCentroids();this.boundingSphere={radius:i}};THREE.PolyhedronGeometry.prototype=new THREE.Geometry;THREE.PolyhedronGeometry.prototype.constructor=THREE.PolyhedronGeometry;THREE.IcosahedronGeometry=function(e,t){var i=(1+Math.sqrt(5))/2;THREE.PolyhedronGeometry.call(this,[[-1,i,0],[1,i,0],[-1,-i,0],[1,-i,0],[0,-1,i],[0,1,i],[0,-1,-i],[0,1,-i],[i,0,-1],[i,0,1],[-i,0,-1],[-i,0,1]],[[0,11,5],[0,5,1],[0,1,7],[0,7,10],[0,10,11],[1,5,9],[5,11,4],[11,10,2],[10,7,6],[7,1,8],[3,9,4],[3,4,2],[3,2,6],[3,6,8],[3,8,9],[4,9,5],[2,4,11],[6,2,10],[8,6,7],[9,8,1]],e,t)};THREE.IcosahedronGeometry.prototype=new THREE.Geometry;THREE.IcosahedronGeometry.prototype.constructor=THREE.IcosahedronGeometry;THREE.OctahedronGeometry=function(e,t){THREE.PolyhedronGeometry.call(this,[[1,0,0],[-1,0,0],[0,1,0],[0,-1,0],[0,0,1],[0,0,-1]],[[0,2,4],[0,4,3],[0,3,5],[0,5,2],[1,2,5],[1,5,3],[1,3,4],[1,4,2]],e,t)};THREE.OctahedronGeometry.prototype=new THREE.Geometry;THREE.OctahedronGeometry.prototype.constructor=THREE.OctahedronGeometry;THREE.TetrahedronGeometry=function(e,t){THREE.PolyhedronGeometry.call(this,[[1,1,1],[-1,-1,1],[-1,1,-1],[1,-1,-1]],[[2,1,0],[0,3,2],[1,3,0],[2,3,1]],e,t)};THREE.TetrahedronGeometry.prototype=new THREE.Geometry;THREE.TetrahedronGeometry.prototype.constructor=THREE.TetrahedronGeometry;THREE.ParametricGeometry=function(e,t,i,r){THREE.Geometry.call(this);var o=this.vertices,n=this.faces,a=this.faceVertexUvs[0],r=r===void 0?false:r,s,l,h,c,f=t+1;for(s=0;s<=i;s++){c=s/i;for(l=0;l<=t;l++){h=l/t;h=e(h,c);o.push(h)}}var u,E,p,d;for(s=0;s<i;s++)for(l=0;l<t;l++){e=s*f+l;o=s*f+l+1;c=(s+1)*f+l;h=(s+1)*f+l+1;u=new THREE.UV(s/t,l/i);E=new THREE.UV(s/t,(l+1)/i);p=new THREE.UV((s+1)/t,l/i);d=new THREE.UV((s+1)/t,(l+1)/i);if(r){n.push(new THREE.Face3(e,o,c));n.push(new THREE.Face3(o,h,c));a.push([u,E,p]);a.push([E,d,p])}else{n.push(new THREE.Face4(e,o,h,c));a.push([u,E,p,d])}}this.computeCentroids();this.computeFaceNormals();this.computeVertexNormals()};THREE.ParametricGeometry.prototype=new THREE.Geometry;THREE.ParametricGeometry.prototype.constructor=THREE.ParametricGeometry;THREE.AxisHelper=function(){THREE.Object3D.call(this);var e=new THREE.Geometry;e.vertices.push(new THREE.Vector3);e.vertices.push(new THREE.Vector3(0,100,0));var t=new THREE.CylinderGeometry(0,5,25,5,1),i;i=new THREE.Line(e,new THREE.LineBasicMaterial({color:16711680}));i.rotation.z=-Math.PI/2;this.add(i);i=new THREE.Mesh(t,new THREE.MeshBasicMaterial({color:16711680}));i.position.x=100;i.rotation.z=-Math.PI/2;this.add(i);i=new THREE.Line(e,new THREE.LineBasicMaterial({color:65280}));this.add(i);i=new THREE.Mesh(t,new THREE.MeshBasicMaterial({color:65280}));i.position.y=100;this.add(i);i=new THREE.Line(e,new THREE.LineBasicMaterial({color:255}));i.rotation.x=Math.PI/2;this.add(i);i=new THREE.Mesh(t,new THREE.MeshBasicMaterial({color:255}));i.position.z=100;i.rotation.x=Math.PI/2;this.add(i)};THREE.AxisHelper.prototype=new THREE.Object3D;THREE.AxisHelper.prototype.constructor=THREE.AxisHelper;THREE.ArrowHelper=function(e,t,i,r){THREE.Object3D.call(this);r===void 0&&(r=16776960);i===void 0&&(i=20);var o=new THREE.Geometry;o.vertices.push(new THREE.Vector3(0,0,0));o.vertices.push(new THREE.Vector3(0,1,0));this.line=new THREE.Line(o,new THREE.LineBasicMaterial({color:r}));this.add(this.line);o=new THREE.CylinderGeometry(0,.05,.25,5,1);this.cone=new THREE.Mesh(o,new THREE.MeshBasicMaterial({color:r}));this.cone.position.set(0,1,0);this.add(this.cone);if(t instanceof THREE.Vector3)this.position=t;this.setDirection(e);this.setLength(i)};THREE.ArrowHelper.prototype=new THREE.Object3D;THREE.ArrowHelper.prototype.constructor=THREE.ArrowHelper;THREE.ArrowHelper.prototype.setDirection=function(e){var t=new THREE.Vector3(0,1,0).crossSelf(e),e=Math.acos(new THREE.Vector3(0,1,0).dot(e.clone().normalize()));this.matrix=(new THREE.Matrix4).makeRotationAxis(t.normalize(),e);this.rotation.getRotationFromMatrix(this.matrix,this.scale)};THREE.ArrowHelper.prototype.setLength=function(e){this.scale.set(e,e,e)};THREE.ArrowHelper.prototype.setColor=function(e){this.line.material.color.setHex(e);this.cone.material.color.setHex(e)};THREE.CameraHelper=function(e){function t(e,t,r){i(e,r);i(t,r)}function i(e,t){r.lineGeometry.vertices.push(new THREE.Vector3);r.lineGeometry.colors.push(new THREE.Color(t));r.pointMap[e]===void 0&&(r.pointMap[e]=[]);r.pointMap[e].push(r.lineGeometry.vertices.length-1)}THREE.Object3D.call(this);var r=this;this.lineGeometry=new THREE.Geometry;this.lineMaterial=new THREE.LineBasicMaterial({color:16777215,vertexColors:THREE.FaceColors});this.pointMap={};t("n1","n2",16755200);t("n2","n4",16755200);t("n4","n3",16755200);t("n3","n1",16755200);t("f1","f2",16755200);t("f2","f4",16755200);t("f4","f3",16755200);t("f3","f1",16755200);t("n1","f1",16755200);t("n2","f2",16755200);t("n3","f3",16755200);t("n4","f4",16755200);t("p","n1",16711680);t("p","n2",16711680);t("p","n3",16711680);t("p","n4",16711680);t("u1","u2",43775);t("u2","u3",43775);t("u3","u1",43775);t("c","t",16777215);t("p","c",3355443);t("cn1","cn2",3355443);t("cn3","cn4",3355443);t("cf1","cf2",3355443);t("cf3","cf4",3355443);this.camera=e;this.update(e);this.lines=new THREE.Line(this.lineGeometry,this.lineMaterial,THREE.LinePieces);this.add(this.lines)};THREE.CameraHelper.prototype=new THREE.Object3D;THREE.CameraHelper.prototype.constructor=THREE.CameraHelper;THREE.CameraHelper.prototype.update=function(){function e(e,i,r,o){THREE.CameraHelper.__v.set(i,r,o);THREE.CameraHelper.__projector.unprojectVector(THREE.CameraHelper.__v,THREE.CameraHelper.__c);e=t.pointMap[e];if(e!==void 0){i=0;for(r=e.length;i<r;i++)t.lineGeometry.vertices[e[i]].copy(THREE.CameraHelper.__v)}}var t=this;THREE.CameraHelper.__c.projectionMatrix.copy(this.camera.projectionMatrix);e("c",0,0,-1);e("t",0,0,1);e("n1",-1,-1,-1);
e("n2",1,-1,-1);e("n3",-1,1,-1);e("n4",1,1,-1);e("f1",-1,-1,1);e("f2",1,-1,1);e("f3",-1,1,1);e("f4",1,1,1);e("u1",.7,1.1,-1);e("u2",-.7,1.1,-1);e("u3",0,2,-1);e("cf1",-1,0,1);e("cf2",1,0,1);e("cf3",0,-1,1);e("cf4",0,1,1);e("cn1",-1,0,-1);e("cn2",1,0,-1);e("cn3",0,-1,-1);e("cn4",0,1,-1);this.lineGeometry.verticesNeedUpdate=true};THREE.CameraHelper.__projector=new THREE.Projector;THREE.CameraHelper.__v=new THREE.Vector3;THREE.CameraHelper.__c=new THREE.Camera;THREE.SubdivisionModifier=function(e){this.subdivisions=e===void 0?1:e;this.useOldVertexColors=false;this.supportUVs=true;this.debug=false};THREE.SubdivisionModifier.prototype.constructor=THREE.SubdivisionModifier;THREE.SubdivisionModifier.prototype.modify=function(e){for(var t=this.subdivisions;t-->0;)this.smooth(e)};THREE.SubdivisionModifier.prototype.smooth=function(e){function t(){u.debug&&console.log.apply(console,arguments)}function i(){console&&console.log.apply(console,arguments)}function r(e,i,r,o,a,s,l){var h=new THREE.Face4(e,i,r,o,null,a.color,a.material);if(u.useOldVertexColors){h.vertexColors=[];for(var E,p,d,m=0;m<4;m++){d=s[m];E=new THREE.Color;E.setRGB(0,0,0);for(var g=0;g<d.length;g++){p=a.vertexColors[d[g]-1];E.r=E.r+p.r;E.g=E.g+p.g;E.b=E.b+p.b}E.r=E.r/d.length;E.g=E.g/d.length;E.b=E.b/d.length;h.vertexColors[m]=E}}c.push(h);if(u.supportUVs){a=[n(e,""),n(i,l),n(r,l),n(o,l)];a[0]?a[1]?a[2]?a[3]?f.push(a):t("d :( ",o+":"+l):t("c :( ",r+":"+l):t("b :( ",i+":"+l):t("a :( ",e+":"+l)}}function o(e,t){return Math.min(e,t)+"_"+Math.max(e,t)}function n(e,r){var o=e+":"+r,n=v[o];if(!n){e>=T&&e<T+p.length?t("face pt"):t("edge pt");i("warning, UV not found for",o);return null}return n}function a(e,t,r){var o=e+":"+t;o in v?i("dup vertexNo",e,"oldFaceNo",t,"value",r,"key",o,v[o]):v[o]=r}function s(e,t){A[e]===void 0&&(A[e]=[]);A[e].push(t)}function l(e,t,i){C[e]===void 0&&(C[e]={});C[e][t]=i}var h=[],c=[],f=[],u=this,E=e.vertices,p=e.faces,h=E.concat(),d=[],m={},g={},v={},T=E.length,R,y,x,H,b,w=e.faceVertexUvs[0],_;t("originalFaces, uvs, originalVerticesLength",p.length,w.length,T);if(u.supportUVs){R=0;for(y=w.length;R<y;R++){x=0;for(H=w[R].length;x<H;x++){_=p[R]["abcd".charAt(x)];a(_,R,w[R][x])}}}if(w.length==0)u.supportUVs=false;R=0;for(b in v)R++;if(!R){u.supportUVs=false;t("no uvs")}t("-- Original Faces + Vertices UVs completed",v,"vs",w.length);R=0;for(y=p.length;R<y;R++){b=p[R];d.push(b.centroid);h.push(b.centroid);if(u.supportUVs){w=new THREE.UV;if(b instanceof THREE.Face3){w.u=n(b.a,R).u+n(b.b,R).u+n(b.c,R).u;w.v=n(b.a,R).v+n(b.b,R).v+n(b.c,R).v;w.u=w.u/3;w.v=w.v/3}else if(b instanceof THREE.Face4){w.u=n(b.a,R).u+n(b.b,R).u+n(b.c,R).u+n(b.d,R).u;w.v=n(b.a,R).v+n(b.b,R).v+n(b.c,R).v+n(b.d,R).v;w.u=w.u/4;w.v=w.v/4}a(T+R,"",w)}}t("-- added UVs for new Faces",v);y=function(e){function t(e,t){s[e]===void 0&&(s[e]=[]);s[e].push(t)}var i,r,n,a,s={};i=0;for(r=e.faces.length;i<r;i++){n=e.faces[i];if(n instanceof THREE.Face3){a=o(n.a,n.b);t(a,i);a=o(n.b,n.c);t(a,i);a=o(n.c,n.a);t(a,i)}else if(n instanceof THREE.Face4){a=o(n.a,n.b);t(a,i);a=o(n.b,n.c);t(a,i);a=o(n.c,n.d);t(a,i);a=o(n.d,n.a);t(a,i)}}return s}(e);_=0;var S,M,A={},C={};for(R in y){w=y[R];S=R.split("_");M=S[0];S=S[1];s(M,[M,S]);s(S,[M,S]);x=0;for(H=w.length;x<H;x++){b=w[x];l(M,b,R);l(S,b,R)}w.length<2&&(g[R]=true)}t("vertexEdgeMap",A,"vertexFaceMap",C);for(R in y){w=y[R];b=w[0];H=w[1];S=R.split("_");M=S[0];S=S[1];w=new THREE.Vector3;if(g[R]){w.addSelf(E[M]);w.addSelf(E[S]);w.multiplyScalar(.5)}else{w.addSelf(d[b]);w.addSelf(d[H]);w.addSelf(E[M]);w.addSelf(E[S]);w.multiplyScalar(.25)}m[R]=T+p.length+_;h.push(w);_++;if(u.supportUVs){w=new THREE.UV;w.u=n(M,b).u+n(S,b).u;w.v=n(M,b).v+n(S,b).v;w.u=w.u/2;w.v=w.v/2;a(m[R],b,w);if(!g[R]){w=new THREE.UV;w.u=n(M,H).u+n(S,H).u;w.v=n(M,H).v+n(S,H).v;w.u=w.u/2;w.v=w.v/2;a(m[R],H,w)}}}t("-- Step 2 done");var L,P;H=["123","12","2","23"];S=["123","23","3","31"];var F=["123","31","1","12"],U=["1234","12","2","23"],D=["1234","23","3","34"],V=["1234","34","4","41"],B=["1234","41","1","12"];R=0;for(y=d.length;R<y;R++){b=p[R];w=T+R;if(b instanceof THREE.Face3){_=o(b.a,b.b);M=o(b.b,b.c);L=o(b.c,b.a);r(w,m[_],b.b,m[M],b,H,R);r(w,m[M],b.c,m[L],b,S,R);r(w,m[L],b.a,m[_],b,F,R)}else if(b instanceof THREE.Face4){_=o(b.a,b.b);M=o(b.b,b.c);L=o(b.c,b.d);P=o(b.d,b.a);r(w,m[_],b.b,m[M],b,U,R);r(w,m[M],b.c,m[L],b,D,R);r(w,m[L],b.d,m[P],b,V,R);r(w,m[P],b.a,m[_],b,B,R)}else t("face should be a face!",b)}m=new THREE.Vector3;b=new THREE.Vector3;R=0;for(y=E.length;R<y;R++)if(A[R]!==void 0){m.set(0,0,0);b.set(0,0,0);M=new THREE.Vector3(0,0,0);w=0;for(x in C[R]){m.addSelf(d[x]);w++}H=0;_=A[R].length;for(x=0;x<_;x++)g[o(A[R][x][0],A[R][x][1])]&&H++;if(H!=2){m.divideScalar(w);for(x=0;x<_;x++){w=A[R][x];w=E[w[0]].clone().addSelf(E[w[1]]).divideScalar(2);b.addSelf(w)}b.divideScalar(_);M.addSelf(E[R]);M.multiplyScalar(_-3);M.addSelf(m);M.addSelf(b.multiplyScalar(2));M.divideScalar(_);h[R]=M}}e.vertices=h;e.faces=c;e.faceVertexUvs[0]=f;delete e.__tmpVertices;e.computeCentroids();e.computeFaceNormals();e.computeVertexNormals()};THREE.ImmediateRenderObject=function(){THREE.Object3D.call(this);this.render=function(){}};THREE.ImmediateRenderObject.prototype=new THREE.Object3D;THREE.ImmediateRenderObject.prototype.constructor=THREE.ImmediateRenderObject;THREE.LensFlare=function(e,t,i,r,o){THREE.Object3D.call(this);this.lensFlares=[];this.positionScreen=new THREE.Vector3;this.customUpdateCallback=void 0;e!==void 0&&this.add(e,t,i,r,o)};THREE.LensFlare.prototype=new THREE.Object3D;THREE.LensFlare.prototype.constructor=THREE.LensFlare;THREE.LensFlare.prototype.supr=THREE.Object3D.prototype;THREE.LensFlare.prototype.add=function(e,t,i,r,o,n){t===void 0&&(t=-1);i===void 0&&(i=0);n===void 0&&(n=1);o===void 0&&(o=new THREE.Color(16777215));if(r===void 0)r=THREE.NormalBlending;i=Math.min(i,Math.max(0,i));this.lensFlares.push({texture:e,size:t,distance:i,x:0,y:0,z:0,scale:1,rotation:1,opacity:n,color:o,blending:r})};THREE.LensFlare.prototype.updateLensFlares=function(){var e,t=this.lensFlares.length,i,r=-this.positionScreen.x*2,o=-this.positionScreen.y*2;for(e=0;e<t;e++){i=this.lensFlares[e];i.x=this.positionScreen.x+r*i.distance;i.y=this.positionScreen.y+o*i.distance;i.wantedRotation=i.x*Math.PI*.25;i.rotation=i.rotation+(i.wantedRotation-i.rotation)*.25}};THREE.MorphBlendMesh=function(e,t){THREE.Mesh.call(this,e,t);this.animationsMap={};this.animationsList=[];var i=this.geometry.morphTargets.length;this.createAnimation("__default",0,i-1,i/1);this.setAnimationWeight("__default",1)};THREE.MorphBlendMesh.prototype=new THREE.Mesh;THREE.MorphBlendMesh.prototype.constructor=THREE.MorphBlendMesh;THREE.MorphBlendMesh.prototype.createAnimation=function(e,t,i,r){t={startFrame:t,endFrame:i,length:i-t+1,fps:r,duration:(i-t)/r,lastFrame:0,currentFrame:0,active:false,time:0,direction:1,weight:1,directionBackwards:false,mirroredLoop:false};this.animationsMap[e]=t;this.animationsList.push(t)};THREE.MorphBlendMesh.prototype.autoCreateAnimations=function(e){for(var t=/([a-z]+)(\d+)/,i,r={},o=this.geometry,n=0,a=o.morphTargets.length;n<a;n++){var s=o.morphTargets[n].name.match(t);if(s&&s.length>1){var l=s[1];r[l]||(r[l]={start:Infinity,end:-Infinity});s=r[l];if(n<s.start)s.start=n;if(n>s.end)s.end=n;i||(i=l)}}for(l in r){s=r[l];this.createAnimation(l,s.start,s.end,e)}this.firstAnimation=i};THREE.MorphBlendMesh.prototype.setAnimationDirectionForward=function(e){if(e=this.animationsMap[e]){e.direction=1;e.directionBackwards=false}};THREE.MorphBlendMesh.prototype.setAnimationDirectionBackward=function(e){if(e=this.animationsMap[e]){e.direction=-1;e.directionBackwards=true}};THREE.MorphBlendMesh.prototype.setAnimationFPS=function(e,t){var i=this.animationsMap[e];if(i){i.fps=t;i.duration=(i.end-i.start)/i.fps}};THREE.MorphBlendMesh.prototype.setAnimationDuration=function(e,t){var i=this.animationsMap[e];if(i){i.duration=t;i.fps=(i.end-i.start)/i.duration}};THREE.MorphBlendMesh.prototype.setAnimationWeight=function(e,t){var i=this.animationsMap[e];if(i)i.weight=t};THREE.MorphBlendMesh.prototype.setAnimationTime=function(e,t){var i=this.animationsMap[e];if(i)i.time=t};THREE.MorphBlendMesh.prototype.getAnimationTime=function(e){var t=0;if(e=this.animationsMap[e])t=e.time;return t};THREE.MorphBlendMesh.prototype.getAnimationDuration=function(e){var t=-1;if(e=this.animationsMap[e])t=e.duration;return t};THREE.MorphBlendMesh.prototype.playAnimation=function(e){var t=this.animationsMap[e];if(t){t.time=0;t.active=true}else console.warn("animation["+e+"] undefined")};THREE.MorphBlendMesh.prototype.stopAnimation=function(e){if(e=this.animationsMap[e])e.active=false};THREE.MorphBlendMesh.prototype.update=function(e){for(var t=0,i=this.animationsList.length;t<i;t++){var r=this.animationsList[t];if(r.active){var o=r.duration/r.length;r.time=r.time+r.direction*e;if(r.mirroredLoop){if(r.time>r.duration||r.time<0){r.direction=r.direction*-1;if(r.time>r.duration){r.time=r.duration;r.directionBackwards=true}if(r.time<0){r.time=0;r.directionBackwards=false}}}else{r.time=r.time%r.duration;if(r.time<0)r.time=r.time+r.duration}var n=r.startFrame+THREE.Math.clamp(Math.floor(r.time/o),0,r.length-1),a=r.weight;if(n!==r.currentFrame){this.morphTargetInfluences[r.lastFrame]=0;this.morphTargetInfluences[r.currentFrame]=1*a;this.morphTargetInfluences[n]=0;r.lastFrame=r.currentFrame;r.currentFrame=n}o=r.time%o/o;r.directionBackwards&&(o=1-o);this.morphTargetInfluences[r.currentFrame]=o*a;this.morphTargetInfluences[r.lastFrame]=(1-o)*a}}};THREE.LensFlarePlugin=function(){function e(e){var i=t.createProgram(),r=t.createShader(t.FRAGMENT_SHADER),o=t.createShader(t.VERTEX_SHADER);t.shaderSource(r,e.fragmentShader);t.shaderSource(o,e.vertexShader);t.compileShader(r);t.compileShader(o);t.attachShader(i,r);t.attachShader(i,o);t.linkProgram(i);return i}var t,i,r,o,n,a,s,l,h,c,f,u,E;this.init=function(p){t=p.context;i=p;r=new Float32Array(16);o=new Uint16Array(6);p=0;r[p++]=-1;r[p++]=-1;r[p++]=0;r[p++]=0;r[p++]=1;r[p++]=-1;r[p++]=1;r[p++]=0;r[p++]=1;r[p++]=1;r[p++]=1;r[p++]=1;r[p++]=-1;r[p++]=1;r[p++]=0;r[p++]=1;p=0;o[p++]=0;o[p++]=1;o[p++]=2;o[p++]=0;o[p++]=2;o[p++]=3;n=t.createBuffer();a=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,n);t.bufferData(t.ARRAY_BUFFER,r,t.STATIC_DRAW);t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,a);t.bufferData(t.ELEMENT_ARRAY_BUFFER,o,t.STATIC_DRAW);s=t.createTexture();l=t.createTexture();t.bindTexture(t.TEXTURE_2D,s);t.texImage2D(t.TEXTURE_2D,0,t.RGB,16,16,0,t.RGB,t.UNSIGNED_BYTE,null);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST);t.bindTexture(t.TEXTURE_2D,l);t.texImage2D(t.TEXTURE_2D,0,t.RGBA,16,16,0,t.RGBA,t.UNSIGNED_BYTE,null);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST);if(t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS)<=0){h=false;c=e(THREE.ShaderFlares.lensFlare)}else{h=true;c=e(THREE.ShaderFlares.lensFlareVertexTexture)}f={};u={};f.vertex=t.getAttribLocation(c,"position");f.uv=t.getAttribLocation(c,"uv");u.renderType=t.getUniformLocation(c,"renderType");u.map=t.getUniformLocation(c,"map");u.occlusionMap=t.getUniformLocation(c,"occlusionMap");u.opacity=t.getUniformLocation(c,"opacity");u.color=t.getUniformLocation(c,"color");u.scale=t.getUniformLocation(c,"scale");u.rotation=t.getUniformLocation(c,"rotation");u.screenPosition=t.getUniformLocation(c,"screenPosition");E=false};this.render=function(e,r,o,p){var e=e.__webglFlares,d=e.length;if(d){var m=new THREE.Vector3,g=p/o,v=o*.5,T=p*.5,R=16/p,y=new THREE.Vector2(R*g,R),x=new THREE.Vector3(1,1,0),H=new THREE.Vector2(1,1),b=u,R=f;t.useProgram(c);if(!E){t.enableVertexAttribArray(f.vertex);t.enableVertexAttribArray(f.uv);E=true}t.uniform1i(b.occlusionMap,0);t.uniform1i(b.map,1);t.bindBuffer(t.ARRAY_BUFFER,n);t.vertexAttribPointer(R.vertex,2,t.FLOAT,false,16,0);t.vertexAttribPointer(R.uv,2,t.FLOAT,false,16,8);t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,a);t.disable(t.CULL_FACE);t.depthMask(false);var w,_,S,M,A;for(w=0;w<d;w++){R=16/p;y.set(R*g,R);M=e[w];m.set(M.matrixWorld.elements[12],M.matrixWorld.elements[13],M.matrixWorld.elements[14]);r.matrixWorldInverse.multiplyVector3(m);r.projectionMatrix.multiplyVector3(m);x.copy(m);H.x=x.x*v+v;H.y=x.y*T+T;if(h||H.x>0&&H.x<o&&H.y>0&&H.y<p){t.activeTexture(t.TEXTURE1);t.bindTexture(t.TEXTURE_2D,s);t.copyTexImage2D(t.TEXTURE_2D,0,t.RGB,H.x-8,H.y-8,16,16,0);t.uniform1i(b.renderType,0);t.uniform2f(b.scale,y.x,y.y);t.uniform3f(b.screenPosition,x.x,x.y,x.z);t.disable(t.BLEND);t.enable(t.DEPTH_TEST);t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0);t.activeTexture(t.TEXTURE0);t.bindTexture(t.TEXTURE_2D,l);t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,H.x-8,H.y-8,16,16,0);t.uniform1i(b.renderType,1);t.disable(t.DEPTH_TEST);t.activeTexture(t.TEXTURE1);t.bindTexture(t.TEXTURE_2D,s);t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0);M.positionScreen.copy(x);M.customUpdateCallback?M.customUpdateCallback(M):M.updateLensFlares();t.uniform1i(b.renderType,2);t.enable(t.BLEND);_=0;for(S=M.lensFlares.length;_<S;_++){A=M.lensFlares[_];if(A.opacity>.001&&A.scale>.001){x.x=A.x;x.y=A.y;x.z=A.z;R=A.size*A.scale/p;y.x=R*g;y.y=R;t.uniform3f(b.screenPosition,x.x,x.y,x.z);t.uniform2f(b.scale,y.x,y.y);t.uniform1f(b.rotation,A.rotation);t.uniform1f(b.opacity,A.opacity);t.uniform3f(b.color,A.color.r,A.color.g,A.color.b);i.setBlending(A.blending,A.blendEquation,A.blendSrc,A.blendDst);i.setTexture(A.texture,1);t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0)}}}}t.enable(t.CULL_FACE);t.enable(t.DEPTH_TEST);t.depthMask(true)}}};THREE.ShadowMapPlugin=function(){var e,t,i,r,o=new THREE.Frustum,n=new THREE.Matrix4,a=new THREE.Vector3,s=new THREE.Vector3;this.init=function(o){e=o.context;t=o;var o=THREE.ShaderLib.depthRGBA,n=THREE.UniformsUtils.clone(o.uniforms);i=new THREE.ShaderMaterial({fragmentShader:o.fragmentShader,vertexShader:o.vertexShader,uniforms:n});r=new THREE.ShaderMaterial({fragmentShader:o.fragmentShader,vertexShader:o.vertexShader,uniforms:n,morphTargets:true});i._shadowPass=true;r._shadowPass=true};this.render=function(e,i){t.shadowMapEnabled&&t.shadowMapAutoUpdate&&this.update(e,i)};this.update=function(l,h){var c,f,u,E,p,d,m,g,v,T=[];E=0;e.clearColor(1,1,1,1);e.disable(e.BLEND);e.enable(e.CULL_FACE);t.shadowMapCullFrontFaces?e.cullFace(e.FRONT):e.cullFace(e.BACK);t.setDepthTest(true);c=0;for(f=l.__lights.length;c<f;c++){u=l.__lights[c];if(u.castShadow)if(u instanceof THREE.DirectionalLight&&u.shadowCascade)for(p=0;p<u.shadowCascadeCount;p++){var R;if(u.shadowCascadeArray[p])R=u.shadowCascadeArray[p];else{v=u;m=p;R=new THREE.DirectionalLight;R.isVirtual=true;R.onlyShadow=true;R.castShadow=true;R.shadowCameraNear=v.shadowCameraNear;R.shadowCameraFar=v.shadowCameraFar;R.shadowCameraLeft=v.shadowCameraLeft;R.shadowCameraRight=v.shadowCameraRight;R.shadowCameraBottom=v.shadowCameraBottom;R.shadowCameraTop=v.shadowCameraTop;R.shadowCameraVisible=v.shadowCameraVisible;R.shadowDarkness=v.shadowDarkness;R.shadowBias=v.shadowCascadeBias[m];R.shadowMapWidth=v.shadowCascadeWidth[m];R.shadowMapHeight=v.shadowCascadeHeight[m];R.pointsWorld=[];R.pointsFrustum=[];g=R.pointsWorld;d=R.pointsFrustum;for(var y=0;y<8;y++){g[y]=new THREE.Vector3;d[y]=new THREE.Vector3}g=v.shadowCascadeNearZ[m];v=v.shadowCascadeFarZ[m];d[0].set(-1,-1,g);d[1].set(1,-1,g);d[2].set(-1,1,g);d[3].set(1,1,g);d[4].set(-1,-1,v);d[5].set(1,-1,v);d[6].set(-1,1,v);d[7].set(1,1,v);R.originalCamera=h;d=new THREE.Gyroscope;d.position=u.shadowCascadeOffset;d.add(R);d.add(R.target);h.add(d);u.shadowCascadeArray[p]=R;console.log("Created virtualLight",R)}m=u;g=p;v=m.shadowCascadeArray[g];v.position.copy(m.position);v.target.position.copy(m.target.position);v.lookAt(v.target);v.shadowCameraVisible=m.shadowCameraVisible;v.shadowDarkness=m.shadowDarkness;v.shadowBias=m.shadowCascadeBias[g];d=m.shadowCascadeNearZ[g];m=m.shadowCascadeFarZ[g];v=v.pointsFrustum;v[0].z=d;v[1].z=d;v[2].z=d;v[3].z=d;v[4].z=m;v[5].z=m;v[6].z=m;v[7].z=m;T[E]=R;E++}else{T[E]=u;E++}}c=0;for(f=T.length;c<f;c++){u=T[c];if(!u.shadowMap){u.shadowMap=new THREE.WebGLRenderTarget(u.shadowMapWidth,u.shadowMapHeight,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBAFormat});u.shadowMapSize=new THREE.Vector2(u.shadowMapWidth,u.shadowMapHeight);u.shadowMatrix=new THREE.Matrix4}if(!u.shadowCamera){if(u instanceof THREE.SpotLight)u.shadowCamera=new THREE.PerspectiveCamera(u.shadowCameraFov,u.shadowMapWidth/u.shadowMapHeight,u.shadowCameraNear,u.shadowCameraFar);else if(u instanceof THREE.DirectionalLight)u.shadowCamera=new THREE.OrthographicCamera(u.shadowCameraLeft,u.shadowCameraRight,u.shadowCameraTop,u.shadowCameraBottom,u.shadowCameraNear,u.shadowCameraFar);else{console.error("Unsupported light type for shadow");continue}l.add(u.shadowCamera);t.autoUpdateScene&&l.updateMatrixWorld()}if(u.shadowCameraVisible&&!u.cameraHelper){u.cameraHelper=new THREE.CameraHelper(u.shadowCamera);u.shadowCamera.add(u.cameraHelper)}if(u.isVirtual&&R.originalCamera==h){p=h;E=u.shadowCamera;d=u.pointsFrustum;v=u.pointsWorld;a.set(Infinity,Infinity,Infinity);s.set(-Infinity,-Infinity,-Infinity);for(m=0;m<8;m++){g=v[m];g.copy(d[m]);THREE.ShadowMapPlugin.__projector.unprojectVector(g,p);E.matrixWorldInverse.multiplyVector3(g);if(g.x<a.x)a.x=g.x;if(g.x>s.x)s.x=g.x;if(g.y<a.y)a.y=g.y;if(g.y>s.y)s.y=g.y;if(g.z<a.z)a.z=g.z;if(g.z>s.z)s.z=g.z}E.left=a.x;E.right=s.x;E.top=s.y;E.bottom=a.y;E.updateProjectionMatrix()}E=u.shadowMap;d=u.shadowMatrix;p=u.shadowCamera;p.position.copy(u.matrixWorld.getPosition());p.lookAt(u.target.matrixWorld.getPosition());p.updateMatrixWorld();p.matrixWorldInverse.getInverse(p.matrixWorld);if(u.cameraHelper)u.cameraHelper.lines.visible=u.shadowCameraVisible;u.shadowCameraVisible&&u.cameraHelper.update();d.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1);d.multiplySelf(p.projectionMatrix);d.multiplySelf(p.matrixWorldInverse);if(!p._viewMatrixArray)p._viewMatrixArray=new Float32Array(16);if(!p._projectionMatrixArray)p._projectionMatrixArray=new Float32Array(16);p.matrixWorldInverse.flattenToArray(p._viewMatrixArray);p.projectionMatrix.flattenToArray(p._projectionMatrixArray);n.multiply(p.projectionMatrix,p.matrixWorldInverse);o.setFromMatrix(n);t.setRenderTarget(E);t.clear();v=l.__webglObjects;u=0;for(E=v.length;u<E;u++){m=v[u];d=m.object;m.render=false;if(d.visible&&d.castShadow&&(!(d instanceof THREE.Mesh)||!d.frustumCulled||o.contains(d))){d._modelViewMatrix.multiply(p.matrixWorldInverse,d.matrixWorld);m.render=true}}u=0;for(E=v.length;u<E;u++){m=v[u];if(m.render){d=m.object;m=m.buffer;g=d.customDepthMaterial?d.customDepthMaterial:d.geometry.morphTargets.length?r:i;m instanceof THREE.BufferGeometry?t.renderBufferDirect(p,l.__lights,null,g,m,d):t.renderBuffer(p,l.__lights,null,g,m,d)}}v=l.__webglObjectsImmediate;u=0;for(E=v.length;u<E;u++){m=v[u];d=m.object;if(d.visible&&d.castShadow){d._modelViewMatrix.multiply(p.matrixWorldInverse,d.matrixWorld);t.renderImmediateObject(p,l.__lights,null,i,d)}}}c=t.getClearColor();f=t.getClearAlpha();e.clearColor(c.r,c.g,c.b,f);e.enable(e.BLEND);t.shadowMapCullFrontFaces&&e.cullFace(e.BACK)}};THREE.ShadowMapPlugin.__projector=new THREE.Projector;THREE.SpritePlugin=function(){function e(e,t){return t.z-e.z}var t,i,r,o,n,a,s,l,h,c;this.init=function(e){t=e.context;i=e;r=new Float32Array(16);o=new Uint16Array(6);e=0;r[e++]=-1;r[e++]=-1;r[e++]=0;r[e++]=1;r[e++]=1;r[e++]=-1;r[e++]=1;r[e++]=1;r[e++]=1;r[e++]=1;r[e++]=1;r[e++]=0;r[e++]=-1;r[e++]=1;r[e++]=0;e=r[e++]=0;o[e++]=0;o[e++]=1;o[e++]=2;o[e++]=0;o[e++]=2;o[e++]=3;n=t.createBuffer();a=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,n);t.bufferData(t.ARRAY_BUFFER,r,t.STATIC_DRAW);t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,a);t.bufferData(t.ELEMENT_ARRAY_BUFFER,o,t.STATIC_DRAW);var e=THREE.ShaderSprite.sprite,f=t.createProgram(),u=t.createShader(t.FRAGMENT_SHADER),E=t.createShader(t.VERTEX_SHADER);t.shaderSource(u,e.fragmentShader);t.shaderSource(E,e.vertexShader);t.compileShader(u);t.compileShader(E);t.attachShader(f,u);t.attachShader(f,E);t.linkProgram(f);s=f;l={};h={};l.position=t.getAttribLocation(s,"position");l.uv=t.getAttribLocation(s,"uv");h.uvOffset=t.getUniformLocation(s,"uvOffset");h.uvScale=t.getUniformLocation(s,"uvScale");h.rotation=t.getUniformLocation(s,"rotation");h.scale=t.getUniformLocation(s,"scale");h.alignment=t.getUniformLocation(s,"alignment");h.color=t.getUniformLocation(s,"color");h.map=t.getUniformLocation(s,"map");h.opacity=t.getUniformLocation(s,"opacity");h.useScreenCoordinates=t.getUniformLocation(s,"useScreenCoordinates");h.affectedByDistance=t.getUniformLocation(s,"affectedByDistance");h.screenPosition=t.getUniformLocation(s,"screenPosition");h.modelViewMatrix=t.getUniformLocation(s,"modelViewMatrix");h.projectionMatrix=t.getUniformLocation(s,"projectionMatrix");c=false};this.render=function(r,o,f,u){var r=r.__webglSprites,E=r.length;if(E){var p=l,d=h,m=u/f,f=f*.5,g=u*.5,v=true;t.useProgram(s);if(!c){t.enableVertexAttribArray(p.position);t.enableVertexAttribArray(p.uv);c=true}t.disable(t.CULL_FACE);t.enable(t.BLEND);t.depthMask(true);t.bindBuffer(t.ARRAY_BUFFER,n);t.vertexAttribPointer(p.position,2,t.FLOAT,false,16,0);t.vertexAttribPointer(p.uv,2,t.FLOAT,false,16,8);t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,a);t.uniformMatrix4fv(d.projectionMatrix,false,o._projectionMatrixArray);t.activeTexture(t.TEXTURE0);t.uniform1i(d.map,0);for(var T,R=[],p=0;p<E;p++){T=r[p];if(T.visible&&T.opacity!==0)if(T.useScreenCoordinates)T.z=-T.position.z;else{T._modelViewMatrix.multiply(o.matrixWorldInverse,T.matrixWorld);T.z=-T._modelViewMatrix.elements[14]}}r.sort(e);for(p=0;p<E;p++){T=r[p];if(T.visible&&T.opacity!==0&&T.map&&T.map.image&&T.map.image.width){if(T.useScreenCoordinates){t.uniform1i(d.useScreenCoordinates,1);t.uniform3f(d.screenPosition,(T.position.x-f)/f,(g-T.position.y)/g,Math.max(0,Math.min(1,T.position.z)))}else{t.uniform1i(d.useScreenCoordinates,0);t.uniform1i(d.affectedByDistance,T.affectedByDistance?1:0);t.uniformMatrix4fv(d.modelViewMatrix,false,T._modelViewMatrix.elements)}o=T.map.image.width/(T.scaleByViewport?u:1);R[0]=o*m*T.scale.x;R[1]=o*T.scale.y;t.uniform2f(d.uvScale,T.uvScale.x,T.uvScale.y);t.uniform2f(d.uvOffset,T.uvOffset.x,T.uvOffset.y);t.uniform2f(d.alignment,T.alignment.x,T.alignment.y);t.uniform1f(d.opacity,T.opacity);t.uniform3f(d.color,T.color.r,T.color.g,T.color.b);t.uniform1f(d.rotation,T.rotation);t.uniform2fv(d.scale,R);if(T.mergeWith3D&&!v){t.enable(t.DEPTH_TEST);v=true}else if(!T.mergeWith3D&&v){t.disable(t.DEPTH_TEST);v=false}i.setBlending(T.blending,T.blendEquation,T.blendSrc,T.blendDst);i.setTexture(T.map,0);t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0)}}t.enable(t.CULL_FACE);t.enable(t.DEPTH_TEST);t.depthMask(true)}}};THREE.DepthPassPlugin=function(){this.enabled=false;this.renderTarget=null;var e,t,i,r,o=new THREE.Frustum,n=new THREE.Matrix4;this.init=function(o){e=o.context;t=o;var o=THREE.ShaderLib.depthRGBA,n=THREE.UniformsUtils.clone(o.uniforms);i=new THREE.ShaderMaterial({fragmentShader:o.fragmentShader,vertexShader:o.vertexShader,uniforms:n});r=new THREE.ShaderMaterial({fragmentShader:o.fragmentShader,vertexShader:o.vertexShader,uniforms:n,morphTargets:true});i._shadowPass=true;r._shadowPass=true};this.render=function(e,t){this.enabled&&this.update(e,t)};this.update=function(a,s){var l,h,c,f,u,E;e.clearColor(1,1,1,1);e.disable(e.BLEND);t.setDepthTest(true);t.autoUpdateScene&&a.updateMatrixWorld();if(!s._viewMatrixArray)s._viewMatrixArray=new Float32Array(16);if(!s._projectionMatrixArray)s._projectionMatrixArray=new Float32Array(16);s.matrixWorldInverse.getInverse(s.matrixWorld);s.matrixWorldInverse.flattenToArray(s._viewMatrixArray);s.projectionMatrix.flattenToArray(s._projectionMatrixArray);n.multiply(s.projectionMatrix,s.matrixWorldInverse);o.setFromMatrix(n);t.setRenderTarget(this.renderTarget);t.clear();E=a.__webglObjects;l=0;for(h=E.length;l<h;l++){c=E[l];u=c.object;c.render=false;if(u.visible&&(!(u instanceof THREE.Mesh)||!u.frustumCulled||o.contains(u))){u._modelViewMatrix.multiply(s.matrixWorldInverse,u.matrixWorld);c.render=true}}l=0;for(h=E.length;l<h;l++){c=E[l];if(c.render){u=c.object;c=c.buffer;t.setObjectFaces(u);f=u.customDepthMaterial?u.customDepthMaterial:u.geometry.morphTargets.length?r:i;c instanceof THREE.BufferGeometry?t.renderBufferDirect(s,a.__lights,null,f,c,u):t.renderBuffer(s,a.__lights,null,f,c,u)}}E=a.__webglObjectsImmediate;l=0;for(h=E.length;l<h;l++){c=E[l];u=c.object;if(u.visible&&u.castShadow){u._modelViewMatrix.multiply(s.matrixWorldInverse,u.matrixWorld);t.renderImmediateObject(s,a.__lights,null,i,u)}}l=t.getClearColor();h=t.getClearAlpha();e.clearColor(l.r,l.g,l.b,h);e.enable(e.BLEND)}};THREE.ShaderFlares={lensFlareVertexTexture:{vertexShader:"uniform vec3 screenPosition;\nuniform vec2 scale;\nuniform float rotation;\nuniform int renderType;\nuniform sampler2D occlusionMap;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvarying float vVisibility;\nvoid main() {\nvUV = uv;\nvec2 pos = position;\nif( renderType == 2 ) {\nvec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) ) +\ntexture2D( occlusionMap, vec2( 0.5, 0.1 ) ) +\ntexture2D( occlusionMap, vec2( 0.9, 0.1 ) ) +\ntexture2D( occlusionMap, vec2( 0.9, 0.5 ) ) +\ntexture2D( occlusionMap, vec2( 0.9, 0.9 ) ) +\ntexture2D( occlusionMap, vec2( 0.5, 0.9 ) ) +\ntexture2D( occlusionMap, vec2( 0.1, 0.9 ) ) +\ntexture2D( occlusionMap, vec2( 0.1, 0.5 ) ) +\ntexture2D( occlusionMap, vec2( 0.5, 0.5 ) );\nvVisibility = (       visibility.r / 9.0 ) *\n( 1.0 - visibility.g / 9.0 ) *\n(       visibility.b / 9.0 ) *\n( 1.0 - visibility.a / 9.0 );\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n}\ngl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",fragmentShader:"precision mediump float;\nuniform sampler2D map;\nuniform float opacity;\nuniform int renderType;\nuniform vec3 color;\nvarying vec2 vUV;\nvarying float vVisibility;\nvoid main() {\nif( renderType == 0 ) {\ngl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );\n} else if( renderType == 1 ) {\ngl_FragColor = texture2D( map, vUV );\n} else {\nvec4 texture = texture2D( map, vUV );\ntexture.a *= opacity * vVisibility;\ngl_FragColor = texture;\ngl_FragColor.rgb *= color;\n}\n}"},lensFlare:{vertexShader:"uniform vec3 screenPosition;\nuniform vec2 scale;\nuniform float rotation;\nuniform int renderType;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvoid main() {\nvUV = uv;\nvec2 pos = position;\nif( renderType == 2 ) {\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n}\ngl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",fragmentShader:"precision mediump float;\nuniform sampler2D map;\nuniform sampler2D occlusionMap;\nuniform float opacity;\nuniform int renderType;\nuniform vec3 color;\nvarying vec2 vUV;\nvoid main() {\nif( renderType == 0 ) {\ngl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );\n} else if( renderType == 1 ) {\ngl_FragColor = texture2D( map, vUV );\n} else {\nfloat visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 ) ).a +\ntexture2D( occlusionMap, vec2( 0.9, 0.5 ) ).a +\ntexture2D( occlusionMap, vec2( 0.5, 0.9 ) ).a +\ntexture2D( occlusionMap, vec2( 0.1, 0.5 ) ).a;\nvisibility = ( 1.0 - visibility / 4.0 );\nvec4 texture = texture2D( map, vUV );\ntexture.a *= opacity * visibility;\ngl_FragColor = texture;\ngl_FragColor.rgb *= color;\n}\n}"}};THREE.ShaderSprite={sprite:{vertexShader:"uniform int useScreenCoordinates;\nuniform int affectedByDistance;\nuniform vec3 screenPosition;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform float rotation;\nuniform vec2 scale;\nuniform vec2 alignment;\nuniform vec2 uvOffset;\nuniform vec2 uvScale;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvoid main() {\nvUV = uvOffset + uv * uvScale;\nvec2 alignedPosition = position + alignment;\nvec2 rotatedPosition;\nrotatedPosition.x = ( cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y ) * scale.x;\nrotatedPosition.y = ( sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y ) * scale.y;\nvec4 finalPosition;\nif( useScreenCoordinates != 0 ) {\nfinalPosition = vec4( screenPosition.xy + rotatedPosition, screenPosition.z, 1.0 );\n} else {\nfinalPosition = projectionMatrix * modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\nfinalPosition.xy += rotatedPosition * ( affectedByDistance == 1 ? 1.0 : finalPosition.z );\n}\ngl_Position = finalPosition;\n}",fragmentShader:"precision mediump float;\nuniform vec3 color;\nuniform sampler2D map;\nuniform float opacity;\nvarying vec2 vUV;\nvoid main() {\nvec4 texture = texture2D( map, vUV );\ngl_FragColor = vec4( color * texture.xyz, texture.a * opacity );\n}"}};